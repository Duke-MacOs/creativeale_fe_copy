"use strict";(self.webpackChunk_byted_editor=self.webpackChunk_byted_editor||[]).push([[189],{34125:function(e,t,n){var r=n(30655),o=n.n(r),a=n(60811),l=n.n(a)()(o());l.push([e.id,"body {\n  overflow: hidden;\n  overscroll-behavior-x: none;\n}\n*,\n*::before,\n*::after {\n  box-sizing: border-box;\n}\ncanvas {\n  outline: none;\n}\n#root {\n  height: 100vh;\n  overflow-x: auto;\n}\n.global-dragging-cursor {\n  cursor: move;\n  pointer-events: none;\n  user-select: none;\n}\n.global-resize-y-cursor {\n  cursor: ns-resize;\n  pointer-events: none;\n  user-select: none;\n}\n[disabled] {\n  pointer-events: none;\n}\n.global-user-drag-none img {\n  -webkit-user-drag: none;\n}\n",""]),t.Z=l},4285:function(e,t,n){var r=n(30655),o=n.n(r),a=n(60811),l=n.n(a)()(o());l.push([e.id,".scene-ops{position:absolute;top:4px}.scene-ops>.ant-btn{margin-left:4px}.scene-history{position:absolute;display:none;bottom:4px;right:4px}.scene-item{padding:8px 6px 36px 6px}.scene-item .scene-ops{transition-delay:1s;transition:1s;display:flex;opacity:0}.scene-item .scene-history{transition-delay:1s;transition:1s;display:block;opacity:0}.scene-item:hover{transition:2s;background-color:#eef3fe}.scene-item:hover .scene-ops{opacity:1}.scene-item:hover .scene-history{opacity:1}.scene-item-content{padding:0;border:1px solid #f0f0f0;border-radius:2px;position:relative;cursor:pointer}.scene-item-loading{position:absolute;left:0;bottom:0;display:flex;align-items:center;padding:0 6px;height:26px;border-radius:0px 2px 0px 0px;font-size:12px;line-height:26px;text-align:center;color:#fff}.scene-item-index{position:absolute;left:0;bottom:0;width:26px;height:26px;border-radius:0px 2px 0px 0px;font-size:12px;line-height:26px;text-align:center;color:#fff}.scene-item-preview{width:100%;height:100%;background-size:100% 100%;display:flex;align-items:center;justify-content:center;border-radius:1px}.scene-item-name{height:20px;margin-top:8px}.scene-item-name>div{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}",""]),t.Z=l},40643:function(e,t,n){var r=n(30655),o=n.n(r),a=n(60811),l=n.n(a)()(o());l.push([e.id,".editor-scenes{flex:0 0 164px;height:100%;display:flex;flex-direction:column;cursor:pointer}.editor-scenes>.scene-menu{width:100%;padding:8px;display:flex;flex-direction:column;align-items:center;justify-content:center}.editor-scenes>.scene-list{padding:0 10px;overflow-y:hidden}.editor-scenes>.scene-list::-webkit-scrollbar{width:10px}.editor-scenes>.scene-list::-webkit-scrollbar-thumb{background-color:#c1c1c1;border-radius:10px;height:30%;border:3px solid #fff}.editor-scenes>.scene-list:hover{overflow-y:scroll;padding-right:0}.sceneModal .ant-modal-header{padding:0 !important;border-bottom:none}.sceneModal .ant-tabs-nav{margin:0}.sceneModal a{color:#333}.sceneModal a:hover{color:#3955f6}",""]),t.Z=l},65759:function(e,t,n){var r=n(30655),o=n.n(r),a=n(60811),l=n.n(a)()(o());l.push([e.id,".editor-timeline-control-bar-main{position:relative;display:flex;flex:0 0 42px}.editor-timeline-control-bar-edit,.editor-timeline-control-bar-play{display:flex;align-items:center}.editor-timeline-control-bar-edit{flex:0 0 240px}.editor-timeline-control-bar-play{flex:auto}.editor-timeline-control-bar-moment{height:42px;line-height:42px;padding:0 8px;flex:auto}.editor-timeline-control-bar-icons{cursor:pointer;margin:0 8px;flex:none}",""]),t.Z=l},22476:function(e,t,n){var r=n(30655),o=n.n(r),a=n(60811),l=n.n(a)()(o());l.push([e.id,'.editor-timeline-scene-content-main{padding-bottom:32px;position:relative}.editor-timeline-scene-content-item{height:32px;display:flex;position:relative;align-items:center;padding:0 24px 0 20px;overflow:hidden}.editor-timeline-scene-content-item:nth-child(2n-1){background-color:#f0f0f0}.editor-timeline-scene-content-item:nth-child(2n){background-color:#fafafa}.editor-timeline-scene-content-item-selected:nth-child(2n-1){background-color:#c5cfdb}.editor-timeline-scene-content-item-selected:nth-child(2n){background-color:#c5cfdb}.editor-timeline-scene-content-item-disabled{opacity:.48;filter:grayscale(1)}.editor-timeline-scene-content-item-tips{color:#999;pointer-events:none;transition:200ms;opacity:0}.editor-timeline-scene-content-item:hover .editor-timeline-scene-content-item-tips{opacity:1}.editor-timeline-scene-content-effect{position:absolute;height:24px;border-radius:6px;opacity:.48;cursor:pointer;transition:opacity 1s}.editor-timeline-scene-content-effect:hover{opacity:.72}.editor-timeline-scene-content-effect-activated,.editor-timeline-scene-content-effect-selected{opacity:1}.editor-timeline-scene-content-effect-altKey{transition:transform 400ms}.editor-timeline-scene-content-effect-disabled{opacity:.48;filter:grayscale(1)}.editor-timeline-scene-content-effect-shadowed{pointer-events:none;opacity:.1}.editor-timeline-scene-content-effect-interval{opacity:.1}.editor-timeline-scene-content-effect-interval:hover,.editor-timeline-scene-content-effect-interval-activated{opacity:.48}.editor-timeline-scene-content-handle{display:flex;justify-content:center;align-items:center}.editor-timeline-scene-content-handle::after{content:"";background-color:#fff;border-radius:2px;height:10px;width:2px}.editor-timeline-scene-content-script{position:absolute;border-radius:100%;cursor:pointer;opacity:.48;height:20px;width:20px;left:10px;line-height:12px;text-align:center;display:flex;justify-content:center;align-items:center}.editor-timeline-scene-content-script:hover{opacity:.72}.editor-timeline-scene-content-script-altKey{transition:transform 400ms}.editor-timeline-scene-content-script-selected{opacity:1}.editor-timeline-scene-content-script-disabled{opacity:.48;filter:grayscale(1)}.editor-timeline-scene-content-script-item{padding:8px;transition:200ms}.editor-timeline-scene-content-script-item:hover{background-color:#f0f2f5}.editor-timeline-scene-content-modal .ant-modal-content{border-radius:4px}.editor-timeline-scene-content-modal .ant-modal-content>.ant-modal-close span{font-size:10px}.editor-timeline-scene-content-modal .ant-modal-header{font-size:16px;line-height:24px;padding-bottom:0px;border:none}.editor-timeline-scene-content-modal .ant-modal-body{padding:0px}',""]),t.Z=l},8979:function(e,t,n){var r=n(30655),o=n.n(r),a=n(60811),l=n.n(a)()(o());l.push([e.id,".editor-timeline-scene-header-main{position:sticky;left:0;z-index:1;padding-bottom:32px}.editor-timeline-scene-header-item{display:flex;align-items:center;height:32px;position:relative;white-space:nowrap;text-overflow:ellipsis;border-right:1px solid #fff;scroll-margin-top:32px}.editor-timeline-scene-header-item-disabled{opacity:.38;filter:grayscale(1)}.editor-timeline-scene-header-item:nth-child(2n-1){background-color:#f0f0f0}.editor-timeline-scene-header-item:nth-child(2n-1)>button svg{background-color:#f0f0f0}.editor-timeline-scene-header-item:nth-child(2n){background-color:#fafafa}.editor-timeline-scene-header-item:nth-child(2n)>button svg{background-color:#fafafa}.editor-timeline-scene-header-item-selected:nth-child(2n-1){background-color:#c5cfdb}.editor-timeline-scene-header-item-selected:nth-child(2n-1)>button svg{background-color:#c5cfdb}.editor-timeline-scene-header-item-selected:nth-child(2n){background-color:#c5cfdb}.editor-timeline-scene-header-item-selected:nth-child(2n)>button svg{background-color:#c5cfdb}.editor-timeline-scene-header-item-after{border-top:2px solid #1890ff}.editor-timeline-scene-header-item-before{border-bottom:2px solid #1890ff}.editor-timeline-scene-header-item-inside{color:#fff !important;background-color:#1890ff !important}.editor-timeline-scene-header-item-inside>button svg{background-color:#1890ff !important}",""]),t.Z=l},96827:function(e,t,n){n(17436);var r=n(22142),o=n(14540),a=n(42761),l=n(48837),i=n(91372),c=n(5635),s=n(55506),d=n(95611),p=n.n(d),u=n(93379),m=n.n(u),f=n(7795),y=n.n(f),g=n(90569),h=n.n(g),v=n(3565),b=n.n(v),E=n(19216),x=n.n(E),k=n(44589),w=n.n(k),S=n(34125),O={};O.styleTagTransform=w(),O.setAttributes=b(),O.insert=h().bind(null,"head"),O.domAPI=y(),O.insertStyleElement=x(),m()(S.Z,O),S.Z&&S.Z.locals&&S.Z.locals;var Z=n(291),P=n(32078),C=n(89591),I=n(34394),j=n(76151),A=n(23264),M=n(33099),D=n(85349),N=n(19104),T=n(92187),R=n(40985),F=n(50509),L=n(78296),z=n(63361),$=n(95787),B=n(22669),V=n(22142);function H(){const{edit3d:e}=(0,N.useEditor)("edit3d"),{contextMenu:t,onChange:n}=(0,N.useEditor)(0,"contextMenu"),{canJoinGroup:o,canSplitGroup:a,onJoinGroup:l,onSplitGroup:i}=(0,N.useGrouping)(),{canPutBottom:c,canPutTop:s,onPutBottom:d,onPutTop:p}=(0,N.useOnPutBottom)(),{canIntoModel:u,modelUrl:m}=(0,$.QR)(),{canIntoParticle3D:f,particle3DUrl:y}=(0,z.yk)(),{canIntoPanorama:g,nodeComponentUrl:h,panoramaSpaceId:v}=(0,B.PL)(),{onEditPanorama:b}=(0,B.tA)(),{onEditParticle3D:E}=(0,z.Dp)(),{onEditModel:x}=(0,$.em)(),{canIntoComponent:k,onIntoComponent:w}=(0,N.useOnIntoComponent)(),{canIntoButton:S,onIntoButton:O}=(0,N.useOnIntoButton)(),{hiddenStatus:Z,lockedStatus:P,onChange:C}=(0,N.useNodesEditor)(),{canAddEffect:I,canAddScript:j}=(0,N.useCanAddScripts)(),{onEditComponent:A}=(0,N.useOnEditComponent)(),{asMask:M,disabled:D,canApplyMask:T,onMask:H}=(0,N.useOnMask)(),{canPasteNodes:G,onPaste:_}=(0,N.useOnPaste)(),{canDelete:U,onDelete:W}=(0,N.useOnDelete)(),{canCopy:K,onCopy:X}=(0,N.useOnCopy)(),Y=(0,N.useEmitter)("AddScripts"),J=2!==U&&!G(),q=(0,N.useSettings)("typeOfPlay"),Q=(0,N.useSettings)("category"),ee=3===q&&3===Q;if((0,N.useEditorHotkeys)(`${(0,R.zO)("command","control")}+[`,(e=>{e.preventDefault(),p(!0)})),(0,N.useEditorHotkeys)(`${(0,R.zO)("command","control")}+alt+[`,(e=>{e.preventDefault(),p()})),(0,N.useEditorHotkeys)(`${(0,R.zO)("command","control")}+]`,(e=>{e.preventDefault(),d(!0)})),(0,N.useEditorHotkeys)(`${(0,R.zO)("command","control")}+alt+]`,(e=>{e.preventDefault(),d()})),(0,r.useEffect)((()=>{t&&J&&n(void 0)}),[t,J,n]),!t||J)return null;const{x:te,y:ne}=t;let re=0;const oe=2!==U?V.createElement(F.Z,{onClick:()=>n(void 0),style:{width:"180px"}},V.createElement(F.Z.Item,{key:re++,disabled:!G(),onClick:()=>_()},"粘贴",V.createElement("span",{style:{float:"right"}},R.eE?"Cmd":"Ctrl"," + V"))):V.createElement(F.Z,{onClick:()=>n(void 0),style:{width:"180px"}},4!==q&&!ee&&V.createElement(F.Z.Item,{key:re++,disabled:!I,onClick:()=>Y(!1)},"添加动画"),4!==q&&!ee&&V.createElement(F.Z.Item,{key:re++,disabled:!j,onClick:()=>Y(!0)},"添加事件"),V.createElement(F.Z.Divider,null),V.createElement(F.Z.Item,{key:re++,disabled:!K,onClick:()=>X()},"复制",V.createElement("span",{style:{float:"right"}},R.eE?"Cmd":"Ctrl"," + C")),V.createElement(F.Z.Item,{key:re++,disabled:!K||2!==U,onClick:()=>X(!0)},"剪切",V.createElement("span",{style:{float:"right"}},R.eE?"Cmd":"Ctrl"," + X")),V.createElement(F.Z.Item,{key:re++,disabled:!G(),onClick:()=>_()},"粘贴",V.createElement("span",{style:{float:"right"}},R.eE?"Cmd":"Ctrl"," + V")),V.createElement(F.Z.Item,{key:re++,disabled:2!==U,onClick:()=>W()},"删除",V.createElement("span",{style:{float:"right"}},"Delete")),V.createElement(F.Z.Divider,null),!e&&4!==q&&!ee&&V.createElement(V.Fragment,null,V.createElement(F.Z.Item,{key:re++,disabled:D,onClick:H},T?"应用蒙版":M?"取消蒙版":"作为蒙版",V.createElement("span",{style:{float:"right"}},R.eE?"Cmd":"Ctrl"," + M")),V.createElement(F.Z.Divider,null)),"into"!==k.can||4===q||ee?"edit"!==k.can||4===q||ee?"view"!==k.can||4===q||ee?null:V.createElement(F.Z.Item,{key:re++,onClick:()=>A(k.url)},"查看互动组件"):V.createElement(F.Z.Item,{key:re++,onClick:()=>A(k.url)},"编辑互动组件"):V.createElement(F.Z.Item,{key:re++,onClick:w},"转为互动组件"),S&&V.createElement(F.Z.Item,{key:re++,onClick:O},"一键转为按钮"),"None"!==u&&V.createElement(F.Z.Item,{key:re++,onClick:()=>x(m)},"view"===u&&"查看","edit"===u&&"编辑","模型"),f&&V.createElement(F.Z.Item,{key:re++,onClick:()=>E(y)},"编辑粒子"),g&&V.createElement(F.Z.Item,{key:re++,onClick:()=>b(h,v)},"编辑全景"),4!==q&&!ee&&V.createElement(F.Z.SubMenu,{key:"subMenu",title:"移动层级"},V.createElement(F.Z.Item,{key:re++,disabled:!s,onClick:()=>p(!1)},"置顶  ",V.createElement("span",{style:{float:"right"}},R.eE?"Opt":"Alt"," + ",R.eE?"Cmd":"Ctrl"," + [")),V.createElement(F.Z.Item,{key:re++,disabled:!s,onClick:()=>p(!0)},"上移  ",V.createElement("span",{style:{float:"right"}},R.eE?"Cmd":"Ctrl"," + [")),V.createElement(F.Z.Item,{key:re++,disabled:!c,onClick:()=>d(!0)},"下移  ",V.createElement("span",{style:{float:"right"}},R.eE?"Cmd":"Ctrl"," + ]")),V.createElement(F.Z.Item,{key:re++,disabled:!c,onClick:()=>d(!1)},"置底  ",V.createElement("span",{style:{float:"right"}},R.eE?"Opt":"Alt"," + ",R.eE?"Cmd":"Ctrl"," + ]"))),a&&4!==q&&!ee?V.createElement(F.Z.Item,{key:re++,onClick:i},"打散",V.createElement("span",{style:{float:"right"}},R.eE?"Cmd":"Ctrl"," + G")):o&&4!==q&&!ee?V.createElement(F.Z.Item,{key:re++,onClick:l},"组合",V.createElement("span",{style:{float:"right"}},R.eE?"Cmd":"Ctrl"," + G")):4===q||ee?null:V.createElement(F.Z.Item,{key:re++,disabled:!0,onClick:i},"组合/打散",V.createElement("span",{style:{float:"right"}},R.eE?"Cmd":"Ctrl"," + G")),V.createElement(F.Z.Divider,null),V.createElement(F.Z.Item,{key:re++,onClick:()=>C({isHidden:!Z})},Z?"显示":"临时隐藏"),V.createElement(F.Z.Item,{key:re++,onClick:()=>C({isLocked:!P})},P?"解锁":"锁定"));return V.createElement(L.Z,{key:`${te}:${ne}`,overlay:oe,open:!0,trigger:["contextMenu"],onOpenChange:e=>{e||n(void 0)}},V.createElement("div",{style:{position:"fixed",left:Math.abs(te),top:Math.abs(ne),width:1,height:1,zIndex:999}}))}var G=n(96193),_=Object.defineProperty,U=Object.defineProperties,W=Object.getOwnPropertyDescriptors,K=Object.getOwnPropertySymbols,X=Object.prototype.hasOwnProperty,Y=Object.prototype.propertyIsEnumerable,J=(e,t,n)=>t in e?_(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,q=(e,t)=>{for(var n in t||(t={}))X.call(t,n)&&J(e,n,t[n]);if(K)for(var n of K(t))Y.call(t,n)&&J(e,n,t[n]);return e},Q=(e,t)=>U(e,W(t));const ee=(0,G.Z)();var te=()=>{const[e,t]=(0,r.useState)({time:-2,replacing:!1}),n=(0,N.useOnAddScripts)(),o=(0,N.useGetSelected)(),a=(0,r.useRef)(-1),l=(0,r.useCallback)((e=>{o().nodeIds.length&&(e?n("Script",{script:"Click",name:"单击",time:a.current}):t({replacing:!1,time:a.current}),null==i||i())}),[]);let i;(0,N.useEmitter)("AddScripts",l);const c=(0,N.useSettings)("typeOfPlay"),s=(0,N.useSettings)("category"),d=3===c&&3===s,p=(0,r.useCallback)((({left:e,top:o,script:l,scale:s,hideOverlay:p})=>{const u=Math.max(R.T6.px2ms(e-R.T6.LENGTH*R.T6.OFF_HEAD,s),0),{canAddBlueprint:m,canAddEffect:f,canAddScript:y}=(0,N.useCanAddScripts)(),{canPasteScripts:g,onPaste:h}=(0,N.useOnPaste)(),{canDelete:v,onDelete:b}=(0,N.useOnDelete)(),{onCopy:E}=(0,N.useOnCopy)();(0,r.useEffect)((()=>(null==i||i(),i=p,a.current=u,()=>{i=void 0,a.current=-1})),[s]);let x=0;return 4===c?null:r.createElement(L.Z,{key:`${e}:${o}`,trigger:["contextMenu"],onOpenChange:e=>{e||p()},overlay:r.createElement(F.Z,null,r.createElement(F.Z.Item,{key:x++,disabled:!f,onClick:()=>{t({replacing:!1,time:u})}},"添加动画"),!d&&r.createElement(F.Z.Item,{key:x++,disabled:!y,onClick:()=>{n("Script",{script:"Click",name:"单击",time:u}),(0,R.r3)(R.GM.UserSelectEventTrigger,{name:"单击"})}},"添加事件"),!d&&r.createElement(F.Z.Item,{key:x++,disabled:!m,onClick:()=>{n("Blueprint",{script:"Blueprint",name:"节点蓝图",time:0},{inputPosition:{x:100,y:100},inputs:[{label:"开始",key:"onStart",tooltip:"蓝图开始触发起点"}],nodeType:"node",outputPosition:{x:500,y:100},outputs:[]})}},"添加蓝图"),l&&1===v?r.createElement(r.Fragment,null,r.createElement(F.Z.Item,{key:x++,onClick:()=>{E()}},"复制",r.createElement("span",{style:{float:"right",marginLeft:"1em"}},(0,R.zO)("Cmd","Ctrl")," + C")),r.createElement(F.Z.Item,{key:x++,onClick:()=>{E(!0)}},"剪切",r.createElement("span",{style:{float:"right",marginLeft:"1em"}},(0,R.zO)("Cmd","Ctrl")," + X")),r.createElement(F.Z.Item,{key:x++,onClick:()=>{b()}},"删除",r.createElement("span",{style:{float:"right",marginLeft:"1em"}},"Delete"))):g()&&r.createElement(F.Z.Item,{key:x++,onClick:()=>{h(u)}},"粘贴",r.createElement("span",{style:{float:"right",marginLeft:"1em"}},(0,R.zO)("Cmd","Ctrl")," + V")))},r.createElement("div",{style:{top:o,left:e,position:"absolute",width:1,height:1,zIndex:999}}))}),[]);return{Overlay:p,element:e.time>-2?r.createElement(ee,{onClose:()=>{t({time:-2,replacing:!1})},onChange:({props:r})=>{n("Effect",Q(q({},r),{time:e.time}),{},e.replacing),t(Q(q({},e),{replacing:!0}))}}):null}},ne=n(12570),re=n(86694),oe=n(33058),ae=n(41999),le=n(55309),ie=n(26840),ce=n(70072),se=n(45858),de=n(81513),pe=n(68961),ue=n(71076),me=n(24202),fe=n(39583),ye=n(34450),ge=n.n(ye);const he=(0,r.memo)((()=>{const{moment:e}=(0,N.useMoment)();return r.createElement("div",{className:`${at}-moment`},ge()(e).format("mm:ss.SSS").slice(0,-1))})),ve=()=>{const{canUndo:e,onUndo:t}=(0,N.useOnUndo)();return r.createElement(ie.Z,{title:"撤回(⌘+z)"},r.createElement(ce.Z,{type:"text",icon:r.createElement(ne.Z,null),disabled:!e,onClick:t}))},be=()=>{const{redoSteps:e,onRedo:t}=(0,N.useOnRedo)();return r.createElement(se.Z,{size:"small",count:e,offset:[-6,6]},r.createElement(ie.Z,{title:"重做(⇧+⌘+z)"},r.createElement(ce.Z,{type:"text",icon:r.createElement(re.Z,null),disabled:0===e,onClick:t})))};function Ee({collapsed:e,toggleCollapsed:t}){const{canJoinGroup:n,canSplitGroup:o,onJoinGroup:a,onSplitGroup:l}=(0,N.useGrouping)(),{playRate:i,onChange:c}=(0,N.useEditor)(0,"playRate"),{playing:s,disabled:d,onStopAndReset:p,onPlayOrStop:u}=(0,N.usePlaying)(),{scale:m,onChange:f}=(0,N.useEditor)("scale"),y=(0,N.useSettings)("typeOfPlay"),g=(0,N.useSettings)("category"),h=3===y&&3===g,v=()=>{m>100?f(100*Math.ceil(m/100-1),!0):m>10&&f(10*Math.ceil(m/10-1),!0)},b=()=>{m<100?f(10*Math.floor(m/10+1),!0):m<500&&f(100*Math.floor(m/100+1),!0)};return(0,N.useEditorHotkeys)("-",b,void 0,[b]),(0,N.useEditorHotkeys)("=",v,void 0,[v]),(0,N.useEditorHotkeys)(`${(0,R.zO)("command","control")}+g`,(e=>{e.preventDefault(),l()||a()})),(0,N.useEditorHotkeys)("escape",p),(0,N.useEditorHotkeys)("space",(e=>{e.preventDefault(),u(!0)})),r.createElement("div",{className:`${at}-play`},r.createElement("div",{className:`${at}-icons`},4!==y&&!h&&r.createElement(r.Fragment,null,r.createElement(ie.Z,{title:o?"组合":"组合(⌘+g)"},r.createElement(ce.Z,{type:"text",icon:r.createElement(oe.Z,{component:N.JoinGroupIcon}),disabled:!n,onClick:a})),r.createElement(ie.Z,{title:"打散(⌘+g)"},r.createElement(ce.Z,{type:"text",icon:r.createElement(oe.Z,{component:N.SplitGroupIcon}),disabled:!o,onClick:l}))),r.createElement(de.Z,{type:"vertical"}),r.createElement(ve,null),r.createElement(be,null),r.createElement(de.Z,{type:"vertical"}),r.createElement(ie.Z,{title:`空格键${["播放","停止"][s%2]}, esc${["将指针置零","停止并重置"][s%2]}`},r.createElement(ce.Z,{type:"text",disabled:d,icon:[N.playIcon,N.pauseIcon][s%2],onClick:u}))),r.createElement("div",{style:{flex:"0 0 auto",padding:"8px"}},r.createElement(pe.Z,{bordered:!1,size:"small",value:i,onChange:e=>c(e,!0),suffixIcon:r.createElement(oe.Z,{component:me.Z})},[.1,.2,.5,1,1.5].map((e=>r.createElement(pe.Z.Option,{key:e,value:e,title:`播放速度x${e}`},e.toFixed(1),"倍速"))))),r.createElement(he,null),r.createElement("div",{style:{flex:"0 1 212px",display:"flex",lineHeight:"42px",alignItems:"center",cursor:"pointer"}},r.createElement(ie.Z,{title:"缩小时间线(-)"},r.createElement(ce.Z,{type:"text",icon:r.createElement(ae.Z,null),disabled:m>=500,onClick:b})),r.createElement(ue.Z,{style:{flex:"auto"},onChange:e=>f(10*-e,!0),value:-Math.floor(m/10),min:-50,max:-1}),r.createElement(ie.Z,{title:"放大时间线(+)"},r.createElement(ce.Z,{type:"text",icon:r.createElement(le.Z,null),disabled:m<=10,onClick:v}))),e?r.createElement(ce.Z,{type:"text",onClick:t},"展开面板",r.createElement(oe.Z,{component:fe.Z})):r.createElement(ce.Z,{type:"text",onClick:t},"收起面板",r.createElement(oe.Z,{component:me.Z})))}var xe=n(38499),ke=n(26698),we=n(99350),Se=n(67870),Oe=n(5571),Ze=n(47567),Pe=n(61754),Ce=n(73073),Ie=n(14766),je=n.n(Ie),Ae=n(26494),Me=n(56683),De=n(7910),Ne=n(73760),Te=n(98466),Re=n(49405),Fe=Object.defineProperty,Le=Object.getOwnPropertySymbols,ze=Object.prototype.hasOwnProperty,$e=Object.prototype.propertyIsEnumerable,Be=(e,t,n)=>t in e?Fe(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Ve=(e,t)=>{for(var n in t||(t={}))ze.call(t,n)&&Be(e,n,t[n]);if(Le)for(var n of Le(t))$e.call(t,n)&&Be(e,n,t[n]);return e},He=(e,t,n)=>new Promise(((r,o)=>{var a=e=>{try{i(n.next(e))}catch(e){o(e)}},l=e=>{try{i(n.throw(e))}catch(e){o(e)}},i=e=>e.done?r(e.value):Promise.resolve(e.value).then(a,l);i((n=n.apply(e,t)).next())}));const Ge=(e,t)=>{var n,r,o;const a=null!=(n=e.nodes)?n:[],l=null!=(r=e.scripts)?r:[];return"Scene3D"==e.type?e.id=t:e.id=(0,Ne.isNumber)(e.id)?t+e.id:(0,R.xv)(),!(0,Ne.isNil)(e.props)&&(0,Ne.isArray)(e.props.bones)&&(e.props.bones=e.props.bones.map((e=>e+t))),!(0,Ne.isNil)(e.props)&&(0,Ne.isNumber)(e.props.rootBone)&&(e.props.rootBone+=t),{id:e.id,type:e.type,props:e.props,editor:null!=(o=e.editor)?o:{},nodes:a.reduce(((e,n)=>(e.push(Ge(n,t)),e)),[]),scripts:l.reduce(((e,n)=>(e.push(_e(n,t)),e)),[])}},_e=(e,t)=>{e.id=(0,R.xv)();const n=Ve({},e.props);return n.scripts&&(n.scripts=n.scripts.reduce(((e,n)=>(e.push(_e(n,t)),e)),[])),{id:e.id,type:e.type,props:n}},Ue=(e,t)=>{var n;const r=e.split("/");if(void 0===t)return null!=(n=r.pop())?n:"";{const e=r.lastIndexOf(t);return r.reduce(((t,n,o)=>(o>=e&&(t+=`${n}`,o<r.length-1&&(t+="/")),t)),"")}},We=(e,t,n)=>(t.forEach((t=>{t.forEach((t=>{e=e.replaceAll(Ue(t[0],n),t[1])}))})),e),Ke=(e,t,n,r,o=0)=>He(void 0,null,(function*(){const a=[];for(let r=0;r<e.length;r++){const l=yield e[r][1].async("blob");if(e[r][0].endsWith(".json"))a.push((0,Te.SN)(Ve({file:new File([l],e[r][0],{type:"application/json"}),type:t,name:e[r][2]},n)).catch((e=>e)));else{const i=Ve({file:new File([l],e[r][0]),name:e[r][2],type:t},n);a.push(0===o?(0,Te.SN)(i).catch((e=>e)):(0,Te.rB)(i).catch((e=>e)))}}return a.length>0?(yield Promise.all(a)).reduce(((t,n,o)=>(n&&(n.url?t.push([e[o][0],(0,De.Hn)(n.url)]):n.message&&r.push(`${e[o][0]} ${n.message}`)),t)),[]):[]})),Xe=(e,t,n)=>He(void 0,null,(function*(){var r;const o=Object.entries(e.files),a={projectId:t,distinct:!0},l=[],i=[],c=[],s=[],d=[],p=[],u=[],m=[],f=[],y=Math.floor((0,R.xv)()/1e3);for(const[e,t]of o){const n=e.split("/"),o=n[n.length-1];if(!e.startsWith("__MACOSX/")&&!t.dir&&!o.startsWith(".")){let n;try{n=null==(r=JSON.parse(yield t.async("string")).props)?void 0:r.name}catch(e){}o.endsWith(".png")||o.endsWith(".jpg")||o.endsWith(".jpeg")?p.push([e,t,n]):o.endsWith(".rmat")?i.push([e,t,n]):o.endsWith(".rmesh")?c.push([e,t,n]):o.endsWith(".rani")?s.push([e,t,n]):o.endsWith(".rtcb")?d.push([e,t,n]):o.endsWith(".rtex")?u.push([e,t,n]):o.endsWith(".json")&&(/assets\/[\d\D]+.json$/.test(e)?m.push([e,t,n]):f.push([e,t,n]))}}const g=yield Ke(p,5,a,l,1),h=yield Ke(c,0,a,l),v=yield Ke(s,0,a,l),b=yield Ke(d,0,a,l);for(let t=0;t<u.length;t++){let r=yield u[t][1].async("string");r=We(r,[g],n),r=JSON.stringify(JSON.parse(r)),e.file(u[t][0],r),u[t][1]=yield e.file(u[t][0])}for(let t=0;t<i.length;t++){let r=yield i[t][1].async("string");r=We(r,[g],n);const o=JSON.parse(r);for(let e=0,t=Object.entries(o.props);e<t.length;e++){const[n,r]=t[e];if(n.endsWith("Url")){const e=u.find((([e])=>e===r));if(e){const t=yield e[1].async("blob"),r=yield(0,Te.SN)(Ve({file:new File([t],`${e[0]}`,{type:"application/rtex"}),type:0,name:`${e[2]}.rtex`},a)).catch((e=>e));o.props[n]=(0,De.Hn)(r.url)}}}r=JSON.stringify(o),e.file(i[t][0],r),i[t][1]=yield e.file(i[t][0])}const E=yield Ke(i,28,a,l),x=[];for(let t=0;t<m.length;t++){let r=yield m[t][1].async("string");x[t]=JSON.parse(r).type,r=We(r,[g,E,h,v,b],n);const o=Ge(JSON.parse(r),y);e.file(m[t][0],JSON.stringify(o)),m[t][1]=yield e.file(m[t][0])}const k=yield((e,t,n,r,o,a,l)=>He(void 0,null,(function*(){const i={0:t};let c=0;const s=[];let d=-1;for(;s.length<n.length&&0!=d;){const e=[];d=0;for(let t=0;t<n.length;t++){const r=n[t];if(!s.includes(r[0]))for(let t=0;t<i[c].length;t++)-1!=(yield i[c][t][1].async("string")).indexOf(Ue(r[0]))&&(e.push(r),s.push(r[0]),d++)}c+=1,i[`${c}`]=e}for(let t=c;t>0;t--){const n=i[`${t}`],c=yield Ke(n,Array.isArray(r)?Re._g[r[t-1]]||28:r,o,a);if(!(t>1))return c;{const n=i[""+(t-1)];for(let t=0;t<n.length;t++){let r=yield n[t][1].async("string");r=We(r,[c],l),e.file(n[t][0],r),n[t][1]=yield e.file(n[t][0])}}}return[]})))(e,f,m,x,a,l,n),w=[];for(let t=0;t<f.length;t++){let r=yield f[t][1].async("string");r=We(r,[g,E,h,v,b,k],n);const o=Ge(JSON.parse(r),y);e.file(f[t][0],JSON.stringify(o)),f[t][1]=yield e.file(f[t][0]);const a=yield f[t][1].async("blob");w.push({node:o,blob:a})}return{res:w,errors:l}}));var Ye=n(55791),Je=n(22142),qe=(e,t,n)=>new Promise(((r,o)=>{var a=e=>{try{i(n.next(e))}catch(e){o(e)}},l=e=>{try{i(n.throw(e))}catch(e){o(e)}},i=e=>e.done?r(e.value):Promise.resolve(e.value).then(a,l);i((n=n.apply(e,t)).next())})),Qe=(0,r.memo)((({uploading:e,setUploading:t})=>{const n=(0,N.useAddNodeWith3D)(),{onAddNode:o}=(0,N.useOnAddNodeFromFiles)(),l=(0,N.useProject)("id"),{edit3d:i}=(0,N.useEditor)("edit3d"),{dispatch:c,getState:s}=(0,a.oR)(),[d,p]=(0,r.useState)([]),[u,m]=(0,r.useState)(!1),{onDelete:f}=(0,N.useOnDelete)(),{getConvertParticleNode:y}=(0,z.Rv)(),{onChange:g}=(0,N.useEditor)(0,"loading"),{createMaterial:h}=(0,Ye.Z)(),v=(0,N.useSettings)("typeOfPlay");(0,r.useEffect)((()=>{e&&p([])}),[e]);const b=(0,Ae.Z)((()=>{p([])})),E=Je.createElement(Je.Fragment,null,Je.createElement(F.Z.Item,{key:"1"},Je.createElement(Ce.BX,{uploading:e,setUploading:t,onAddResourceEntry:e=>{o(e)}},"本地文件",Je.createElement("span",{style:{color:"gray"}}," 图片、声音、视频、粒子(.plist), Lottie(.json)"))),Je.createElement(F.Z.Item,{key:"2"},Je.createElement(Ce.g6,{uploading:e,setUploading:t,onAddResourceEntry:e=>{o(e)}},"动画序列",Je.createElement("span",{style:{color:"gray"}}," 请选择多个图片文件..."))),Je.createElement(F.Z.Item,{key:"3",onClick:()=>{o({mime:"Container",name:"容器",url:""})}},"添加容器"),3===v&&Je.createElement(F.Z.Item,{key:"4",onClick:()=>{o({mime:"AlphaVideo",name:"出框视频",url:"https://creativelab-proxy.bytedance.com/api/upload/bucket/material/private/preview/1f37e35899cfe85acecfb28cb26e1f45/00b9f975104efcede5106a8facfd7afc.mp4",cover:"https://p7.itc.cn/images01/20210208/735c861e79684b1d9e9e743eabf1cfd5.png"})}},"出框视频")),x=Je.createElement(Je.Fragment,null,Je.createElement(P.Z,{title:"请注意",open:u,onCancel:()=>{m(!1)},footer:Je.createElement(Je.Fragment,null,Je.createElement(ce.Z,{onClick:()=>{m(!1)}},"取消"),Je.createElement(ce.Z,{type:"primary"},Je.createElement(Ce.BX,{uploading:e,accepts:".zip",setUploading:t,beforeUpload:()=>e=>qe(void 0,null,(function*(){var n;try{g(!0);const{project:r}=s(),o=(0,R.zh)(r),a=o.nodes.find((e=>"Scene3D"===e.type));a&&f({nodeIds:[a.id]}),m(!1),t(!0);const i=new(je()),d=yield i.loadAsync(e),{res:u,errors:v}=yield Xe(d,l,"assets");for(let e=0;e<u.length;e++){const t=u[e].node;if("Scene3D"===t.type&&(null==(n=t.props)?void 0:n.skyboxMaterialUrl)){const e=yield h(t.props.skyboxMaterialUrl);t.props.skyboxMaterialUrl=e}}for(const{node:e}of u){const t=yield y(e);c((0,N.addFromNode)(o.id,0,t)),c((0,N.restoreState)(yield(0,Me.Z)(s().project)))}p(v),t(!1)}catch(e){p([`导入失败: ${e.message}`])}finally{t(!1),g(!1)}return!1})),onAddResourceEntry:()=>{}},Je.createElement("span",{style:{color:"#fff"}},"继续"))))},"2222导入新的3D场景会替换掉原本的3D场景，仍要继续吗？"),Je.createElement(F.Z.Item,{key:"3",onClick:()=>{m(!0)}},"导入 3D 场景"),Je.createElement(F.Z.Item,{key:"11"},Je.createElement(Ce.BX,{uploading:e,accepts:".zip",setUploading:t,beforeUpload:()=>e=>qe(void 0,null,(function*(){var n;const{project:r}=s(),o=(0,R.zh)(r),a=Object.keys(o.editor.selected).map(Number)[0],i=o.nodes.find((e=>"Scene3D"===e.type));if(!i)return Pe.ZP.error("当前无3D场景，无法导入节点"),!1;const d=null==(n=(0,R.qC)(i.nodes,a))?void 0:n[0];t(!0);const u=new(je()),m=yield u.loadAsync(e),{res:f,errors:y}=yield Xe(m,l,"assets");let g=d?null==d?void 0:d.nodes.length:i.nodes.length;for(const{node:e}of f)e.id=(0,R.xv)(),c((0,N.addFromNode)(i.id,g,e)),c((0,N.restoreState)(yield(0,Me.Z)(s().project))),g++;return p(y),t(!1),!1})),onAddResourceEntry:()=>{}},Je.createElement("span",null,"导入 3D 节点"))),Je.createElement(F.Z.Item,{key:"5",onClick:()=>{o({mime:"Scene3D",name:"3D场景",url:""})}},"添加 3D 场景"),Je.createElement(F.Z.Item,{key:"10",onClick:()=>{n("Sprite3D",(()=>{o({mime:"Sprite3D",name:"容器",url:""})}))}},"添加 3D 容器"));return Je.createElement(Je.Fragment,null,Je.createElement(L.Z,{overlay:Je.createElement(F.Z,null,i?x:E)},Je.createElement(ce.Z,{type:"link",size:"small",icon:Je.createElement(le.Z,null),loading:e},"添加节点")),Je.createElement(P.Z,{title:"提示",open:d.length>0,onOk:b,onCancel:b},d.map(((e,t)=>Je.createElement("p",{key:`msg-${t}`},e)))))})),et=n(2245),tt=n(22142),nt=(0,r.memo)((()=>{const[e,t]=(()=>{const e=(0,r.useState)((()=>location.search.includes("storyboard=1"))),[t]=e;return(0,r.useEffect)((()=>{const e=new URL(location.href);t?e.searchParams.set("storyboard","1"):e.searchParams.delete("storyboard"),history.replaceState(void 0,"",e.href)}),[t]),e})(),{hiddenStatus:n,lockedStatus:o,onChange:i}=(0,N.useNodesEditor)(),[c,s]=(0,r.useState)(!1),{canDelete:d,onDelete:p}=(0,N.useOnDelete)(),u=(0,N.useOnArrowKeys)(),m=(0,N.useOnSelectAll)(),{onCopy:f}=(0,N.useOnCopy)(),{onMask:y}=(0,N.useOnMask)(),g=(0,N.useSettings)("typeOfPlay"),h=(0,N.useSettings)("category"),v=3===g&&3===h;return(e=>{const{subscribe:t,getState:n,dispatch:o}=(0,a.oR)();(0,r.useEffect)((()=>{if(4===e)return t((()=>{const e=(0,R.zh)(n().project);for(const[t,{type:n,jumpSceneId:r,soundUrl:a}]of Object.entries(e.props))"PVVideo"===n&&((0,Ze.U3)(e.props)?r&&o((0,N.changeProps)([Number(t)],{jumpSceneId:0},{flag:l.ActionFlag.SideEffect})):a&&o((0,N.changeProps)([Number(t)],{soundUrl:""},{flag:l.ActionFlag.SideEffect})))}))}),[o,n,t,e])})(g),(e=>{const{onAddNodeFromFiles:t}=(0,N.useOnAddNodeFromFiles)(),{onPaste:n}=(0,N.useOnPaste)();(0,r.useEffect)((()=>{const r=r=>qe(void 0,null,(function*(){var o;const{enableBlueprint:a}=N.default.getState().project.editor;if(!a){const a=Array.from((null==(o=r.clipboardData)?void 0:o.items)||[]).filter((e=>"file"===e.kind)).map((e=>e.getAsFile()));if(a.length)e(!0),t(a).finally((()=>{e(!1)}));else if(r.target!==document.activeElement||document.activeElement===document.body){const e=yield n();e&&Pe.ZP.success(`${e}粘贴成功`,.6)}}}));return document.addEventListener("paste",r),()=>{document.removeEventListener("paste",r)}}),[t,n])})(s),(0,N.useEditorHotkeys)("delete,backspace",(()=>p())),(0,N.useEditorHotkeys)(`${(0,R.zO)("command","control")}+a`,(()=>{m()})),(0,N.useEditorHotkeys)(`${(0,R.zO)("command","control")}+c`,(()=>f())),(0,N.useEditorHotkeys)(`${(0,R.zO)("command","control")}+x`,(()=>f(!0))),(0,N.useEditorHotkeys)(`${(0,R.zO)("command","control")}+m`,(e=>{e.preventDefault(),y()})),(0,N.useEditorHotkeys)(["up","down","left","right"].map((e=>[`shift+${e}`,e].join(","))).join(","),(e=>{e.preventDefault(),u(e)}),void 0,[u]),tt.createElement("div",{className:`${at}-edit`,style:{flex:v?"0 1 auto":""}},tt.createElement("div",{className:`${at}-icons`},4===g?tt.createElement(ce.Z,{ghost:!0,type:"primary",loading:c,icon:tt.createElement(oe.Z,{component:et.Z}),onClick:()=>t(!0)},"故事板"):v?null:tt.createElement(Qe,{uploading:c,setUploading:s})),tt.createElement("div",{style:{flex:"auto"}}),tt.createElement("div",{className:`${at}-icons`},tt.createElement(ie.Z,{title:"删除",trigger:"hover"},tt.createElement(ce.Z,{type:"text",title:"删除",icon:tt.createElement(xe.Z,null),disabled:!d,onClick:()=>p()})),n?tt.createElement(ie.Z,{title:"显示"},tt.createElement(ce.Z,{type:"text",title:"显示",icon:tt.createElement(ke.Z,null),onClick:()=>i({isHidden:!1})})):tt.createElement(ie.Z,{title:"临时隐藏"},tt.createElement(ce.Z,{type:"text",title:"临时隐藏",icon:tt.createElement(we.Z,null),disabled:void 0===n,onClick:()=>i({isHidden:!0})})),o?tt.createElement(ie.Z,{title:"解锁"},tt.createElement(ce.Z,{type:"text",title:"解锁",icon:tt.createElement(Se.Z,null),onClick:()=>i({isLocked:!1})})):tt.createElement(ie.Z,{title:"锁定"},tt.createElement(ce.Z,{type:"text",title:"锁定",icon:tt.createElement(Oe.Z,null),disabled:void 0===o,onClick:()=>i({isLocked:!0})}))),e&&tt.createElement(Ze.bh,{onClose:()=>t(!1)}))})),rt=n(65759),ot={};ot.styleTagTransform=w(),ot.setAttributes=b(),ot.insert=h().bind(null,"head"),ot.domAPI=y(),ot.insertStyleElement=x(),m()(rt.Z,ot),rt.Z&&rt.Z.locals&&rt.Z.locals;const at="editor-timeline-control-bar";function lt({collapsed:e,onReheight:t,toggleCollapsed:n}){return r.createElement("div",{className:`${at}-main`},r.createElement(nt,null),r.createElement(Ee,{collapsed:e,toggleCollapsed:n}),r.createElement("div",{onMouseDown:t,style:{position:"absolute",width:"100%",height:"6px",left:0,top:-3,zIndex:2,cursor:"ns-resize"}}))}var it=n(62255),ct=n(85071),st=n(32319),dt=n(98468),pt=n(80330),ut=n(65852),mt=n(62732);const ft=(0,mt.iv)({background:"inherit",position:"absolute",cursor:"pointer",paddingRight:8,opacity:0,height:32,right:0,top:0,"&-hoverable:hover, &-dirty":{opacity:1}});var yt=(0,r.memo)((({node:e,resizing:t,onChangeEditor:n})=>{const o=(0,r.useCallback)((t=>{t.stopPropagation(),["VRVideo"].includes(e.type)?Pe.ZP.warning("不允许执行该操作"):n(e.id,{isHidden:!e.isHidden})}),[e]),a=(0,r.useCallback)((t=>{t.stopPropagation(),["PVVideo","PVAlphaVideo","VRVideo"].includes(e.type)?Pe.ZP.warning("不允许执行该操作"):n(e.id,{isLocked:!e.isLocked})}),[e]);return r.createElement("div",{draggable:!0,className:(0,R.xG)({[ft]:{hoverable:!t,dirty:e.isHidden||e.isLocked}}),onDragStart:e=>{e.stopPropagation(),e.preventDefault()}},e.isHidden?r.createElement(ce.Z,{type:"text",title:"可见",icon:r.createElement(ke.Z,null),onClick:o}):r.createElement(ce.Z,{type:"text",title:"临时隐藏",icon:r.createElement(we.Z,null),onClick:o}),e.isLocked?r.createElement(ce.Z,{type:"text",title:"解锁",icon:r.createElement(Se.Z,null),onClick:a}):r.createElement(ce.Z,{type:"text",title:"锁定",icon:r.createElement(Oe.Z,null),onClick:a}))}));function gt({nodeId:e,setIsEditing:t}){const{name:n,onChange:o}=(0,N.useProps)(e,"name");return r.createElement(it.Z,{style:{background:"none",borderRadius:2,padding:0,flex:"auto"},maxLength:20,autoFocus:!0,spellCheck:!1,defaultValue:n||"",onBlur:e=>{t(!1),o(e.target.value)},onPressEnter:e=>{t(!1),o(e.currentTarget.value)}})}var ht=n(75919),vt=n(22142),bt=Object.defineProperty,Et=Object.defineProperties,xt=Object.getOwnPropertyDescriptors,kt=Object.getOwnPropertySymbols,wt=Object.prototype.hasOwnProperty,St=Object.prototype.propertyIsEnumerable,Ot=(e,t,n)=>t in e?bt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Zt=(0,r.memo)((({node:e,resizing:t})=>{const n=(0,r.useRef)(null),o=(0,N.useOnChangeEditor)(),[l,i]=(0,r.useState)(""),[c,s]=(0,r.useState)(!1),{getState:d}=(0,a.oR)(),p=(0,N.useOnAddScripts)(),{onAddNode:u,onAddNodeFromFiles:m}=(0,N.useOnAddNodeFromFiles)(),{selected:f,onSelect:y,onSelectId:g}=(0,N.useSelected)(e.id,!0),{isDroppable:h,onDropNodes:v}=(0,N.useOnDropNodes)(),{beginDrag:b,didDrag:E}=(()=>{const e=(0,r.useRef)(!1);return{beginDrag:(0,r.useCallback)((()=>{e.current=!0}),[]),didDrag:(0,r.useCallback)((t=>{const n=["mouseleave","mouseup"],r=()=>{t(e.current);for(const e of n)document.removeEventListener(e,r)};for(const e of n)document.addEventListener(e,r);e.current=!1}),[])}})(),x=(0,N.useSettings)("typeOfPlay"),k=(0,N.useSettings)("category"),w=3===x&&3===k,[{isOver:S},O]=(0,pt.L)({accept:["node","resource",dt.FILE],drop(t){var n,r;l&&("node"===t.type?v(e.id,l):"resource"===t.type?"CustomScript"===t.mime?(g({},[e.id],!0),p("Script",{script:"Auto",name:"自动触发",once:!0,time:(0,R.zh)(d().project).editor.moment,scripts:[{id:(0,R.xv)(),type:"Script",props:{name:"自定义脚本",script:"CustomScript",url:t.url}}]})):u((n=((e,t)=>{for(var n in t||(t={}))wt.call(t,n)&&Ot(e,n,t[n]);if(kt)for(var n of kt(t))St.call(t,n)&&Ot(e,n,t[n]);return e})({},t),r={targetId:e.id,dropWhere:l},Et(n,xt(r)))):void 0===t.type&&m(t.files,{targetId:e.id,dropWhere:l}))},collect(e){return{isOver:e.canDrop()&&e.isOver()}},hover(t,r){var o;const a=(()=>{if("resource"===t.type&&"CustomScript"===t.mime)return"inside";const e=r.getClientOffset();if(!n.current||!e)return"";const o=n.current.getBoundingClientRect(),a=(o.bottom-o.top)/2,l=e.y-o.top;return l+8<a?"after":l>a+8?"before":"inside"})();a&&h(e.id,a,null!=(o=t.type)?o:"undefined")?(i(a),4===x&&"inside"===a&&i(""),4===x&&"PVVideo"===e.type&&i("after"),w&&"inside"===a&&i(""),w&&"VRVideo"===e.type&&i("after")):i("")}}),[{isDragging:Z},P]=(0,ut.c)({item:{type:"node",id:e.id},begin:b,collect:e=>({isDragging:e.isDragging()}),canDrag(){return(4!==x||"PVVideo"!==e.type)&&!c&&f}});return P(O(n)),(0,r.useEffect)((()=>{f&&setTimeout((()=>{n.current&&n.current.scrollIntoView({block:"nearest",behavior:"smooth"})}))}),[f]),vt.createElement("div",{key:e.id,ref:n,className:(0,R.xG)({"editor-timeline-scene-header-item":{selected:f||Z,disabled:!e.enabled,[l]:S}}),style:{paddingLeft:20*(e.depth-1)+"px"},onDoubleClick:()=>{w&&"VR3D场景"===e.name||(s(!0),y({}))},onMouseDown:e=>{2===e.button?(f||y(e),setTimeout((()=>o(0,{contextMenu:{x:-e.clientX,y:-e.clientY}})))):f?(e.persist(),E((t=>{t||y(e)}))):y(e)}},e.maskDepths.map((e=>vt.createElement("div",{key:e,style:{position:"absolute",height:"100%",borderLeft:"0.1px solid #999",left:20*(e-1)+9}}))),e.asMask&&vt.createElement("div",{style:{position:"absolute",height:"50%",width:10,borderLeft:"0.1px solid #999",borderBottom:"0.1px solid #999",top:0,left:20*(e.depth-1)+9}}),vt.createElement(ce.Z,{type:"text",size:"small",className:(0,R.xG)([(0,mt.iv)({color:"#999",flex:"0 0 20px","& svg":{transform:"scale(0.72)"},"&:hover":{opacity:"#333"}}),0===e.children&&(0,mt.iv)({visibility:"hidden"})]),onMouseDown:t=>{t.stopPropagation(),o(e.id,{isCollapsed:!e.isCollapsed},!0)},icon:e.isCollapsed?vt.createElement(ct.Z,null):vt.createElement(st.Z,null)}),vt.createElement("div",{style:{flex:"0 0 20px",textAlign:"center"}},vt.createElement(ht.Z,{type:e.type,asMask:e.asMask})),c?vt.createElement(gt,{nodeId:e.id,setIsEditing:s}):vt.createElement("div",{style:{flex:"auto",overflow:"hidden"}},e.name||"未命名节点",e.visible?"":"（已隐藏）"),!c&&vt.createElement(yt,{node:e,resizing:t,onChangeEditor:o}))}),Ne.isEqual),Pt=n(8979),Ct={};Ct.styleTagTransform=w(),Ct.setAttributes=b(),Ct.insert=h().bind(null,"head"),Ct.domAPI=y(),Ct.insertStyleElement=x(),m()(Pt.Z,Ct),Pt.Z&&Pt.Z.locals&&Pt.Z.locals;const It=(e,t)=>e&&t&&e.includes(t)?e.split(t).reduce(((e,n,o)=>(o&&e.push(r.createElement("span",{key:o,className:(0,mt.iv)({color:"#f50"})},t)),n&&e.push(n),e)),[]):e;var jt=(0,r.memo)((({nodes:e,resizing:t,onReWidth:n})=>r.createElement("div",{className:"editor-timeline-scene-header-main"},e.map((e=>r.createElement(Zt,{key:e.id,node:e,resizing:t}))),r.createElement("div",{style:{position:"absolute",width:17,height:"100%",top:0,right:-8},onMouseDown:e=>{e.stopPropagation()}},r.createElement("div",{style:{width:5,margin:"0 auto",height:"100%",cursor:"ew-resize"},onMouseDown:n}))))),At=n(76566),Mt=Object.defineProperty,Dt=Object.defineProperties,Nt=Object.getOwnPropertyDescriptors,Tt=Object.getOwnPropertySymbols,Rt=Object.prototype.hasOwnProperty,Ft=Object.prototype.propertyIsEnumerable,Lt=(e,t,n)=>t in e?Mt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,zt=(e,t)=>{for(var n in t||(t={}))Rt.call(t,n)&&Lt(e,n,t[n]);if(Tt)for(var n of Tt(t))Ft.call(t,n)&&Lt(e,n,t[n]);return e},$t=(e,t)=>Dt(e,Nt(t));const Bt=(e,t)=>t&&e.length?e.reduce(((e,n)=>{if(n.name.includes(t)||n.scripts.some((({name:e})=>e.includes(t))))e.push($t(zt({},n),{name:It(n.name,t),scripts:n.scripts.map((e=>e.name.includes(t)?$t(zt({},e),{name:It(e.name,t)}):e)),nodes:Bt(n.nodes,t)}));else{const r=Bt(n.nodes,t);r.length&&e.push($t(zt({},n),{nodes:r}))}return e}),[]):e,Vt=(e,t=1,n=[],r=!0,o=!0)=>{const a=e.map((({asMask:e})=>e)).lastIndexOf(!0);return e.reduce(((e,{id:l,type:i,name:c="",enabled:s=!0,visible:d=!0,asMask:p=!1,nodes:u=[],scripts:m=[],editor:{isLocked:f,isHidden:y,isCollapsed:g}={}},h)=>{const v=h<a?n.concat(t):n;if(e.push({id:l,type:i,name:c,enabled:r&&s,visible:o&&d,children:u.length,depth:t,asMask:p,maskDepths:v,isLocked:f,isHidden:y,isCollapsed:g,scripts:m}),!g)for(const n of Vt(u.slice().reverse(),t+1,v,r&&s,o&&d))e.push(n);return e}),[])};var Ht=n(44547),Gt={container:(0,mt.iv)({position:"absolute",bottom:"13px",transform:"translateY(100%)",display:"flex",flexDirection:"column",alignItems:"center",width:"9px"}),handle:(0,mt.iv)({scrollMarginLeft:"280px",scrollMarginRight:"96px",opacity:"0.6"})};const _t=r.forwardRef((({offset:e,length:t},n)=>r.createElement("div",{className:Gt.container,style:{left:`${e}px`}},r.createElement("svg",{ref:n,height:"13",width:"9",className:Gt.handle},r.createElement("polyline",{points:"0,9 4,13 5,13 9,9",style:{fill:"#0dce8a",stroke:"#0dce8a",strokeWidth:"1"}}),r.createElement("polyline",{points:"0,9 0,0 9,0 9,9",style:{fill:"#0dce8a",stroke:"#0dce8a",strokeWidth:"2"}})),r.createElement("div",{style:{width:"1px",height:`${t}px`,backgroundColor:"#0dce8a",pointerEvents:"none",position:"absolute",opacity:.6,top:"13px"}}))));var Ut=(0,r.memo)(_t);function Wt({count:e,scale:t,length:n}){const{token:o}=c.Z.useToken(),{moment:a,onChange:l}=(0,N.useMoment)(e*t),i=(0,r.useRef)(null),[s,d]=(0,r.useState)(0),p=a-s,[u,m,f]=(0,r.useMemo)((()=>((e,t,n)=>{const r=Math.min(Math.floor(e*R.T6.LENGTH/t),n*R.T6.LENGTH);return[-r,n*R.T6.LENGTH-r,r+R.T6.OFF_HEAD*R.T6.LENGTH-4]})(p,t,e)),[p,t,e]),{accumulative:y,activated:g,activate:h}=(0,T.kL)(u,m);(0,Ht.Z)((()=>{const e=Math.floor(y/R.T6.LENGTH)*t;l(p+e),d(e)}),[Math.floor(y/R.T6.LENGTH)]),(0,r.useEffect)((()=>{!g&&y&&(l(p+R.T6.px2ms(y,t)),d(0))}),[g]),(0,r.useEffect)((()=>{i.current&&!g&&i.current.scrollIntoView({inline:"nearest",block:"nearest"})}),[p]);const v=(0,T._0)((([e],[t])=>e>t),[e]);return r.createElement("div",{className:(0,mt.iv)({position:"sticky",zIndex:1,top:"0",display:"flex",alignItems:"flex-end",userSelect:"none",borderTop:"1px solid #d9d9d9",borderBottom:"1px solid #d9d9d9",cursor:"pointer",background:o.colorBgLayout}),style:{width:(e+R.T6.OFF_HEAD+R.T6.OFF_TAIL+1)*R.T6.LENGTH+"px",transition:`width ${v?200:0}ms`},onMouseDown:e=>{const{currentTarget:n,clientX:r}=e,o=n.getBoundingClientRect();l(R.T6.px2ms(r-o.left-R.T6.OFF_HEAD*R.T6.LENGTH,t)),h(e)}},r.createElement(Kt,{count:e,scale:t}),r.createElement(Ut,{ref:i,offset:f+y,length:32*n}))}const Kt=(0,r.memo)((({count:e,scale:t})=>r.createElement(r.Fragment,null,Array.from({length:e+R.T6.OFF_HEAD+R.T6.OFF_TAIL+1}).map(((e,n)=>{const o=n-R.T6.OFF_HEAD;return r.createElement("div",{key:o,className:(0,mt.iv)({flex:"1 1 0",position:"relative",borderLeft:"1px solid #d9d9d9"}),style:{height:(o%10?o%5?5:8:32)+"px"}},o%10==0&&r.createElement("div",{className:(0,mt.iv)({position:"absolute",top:"6px",left:"5px",fontSize:"10px"})},((e,t)=>0===e?"0":(e*t/1e3).toFixed(t%100==0?0:t%10==0?1:2))(o,t),"s"))})))));var Xt=n(87630),Yt=n.n(Xt),Jt=Object.defineProperty,qt=Object.defineProperties,Qt=Object.getOwnPropertyDescriptors,en=Object.getOwnPropertySymbols,tn=Object.prototype.hasOwnProperty,nn=Object.prototype.propertyIsEnumerable,rn=(e,t,n)=>t in e?Jt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,on=(e,t)=>{for(var n in t||(t={}))tn.call(t,n)&&rn(e,n,t[n]);if(en)for(var n of en(t))nn.call(t,n)&&rn(e,n,t[n]);return e},an=Object.defineProperty,ln=Object.defineProperties,cn=Object.getOwnPropertyDescriptors,sn=Object.getOwnPropertySymbols,dn=Object.prototype.hasOwnProperty,pn=Object.prototype.propertyIsEnumerable,un=(e,t,n)=>t in e?an(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,mn=(e,t)=>{for(var n in t||(t={}))dn.call(t,n)&&un(e,n,t[n]);if(sn)for(var n of sn(t))pn.call(t,n)&&un(e,n,t[n]);return e},fn=(e,t)=>ln(e,cn(t));const yn=(e,t)=>{var n;return e.set(t,(null!=(n=e.get(t))?n:0)+1)},gn=(e,t,n,r={current:0})=>e.reduce(((e,n,o)=>{var a;const l=t(e,n,o,r.current++);return(null==(a=n.editor)?void 0:a.isCollapsed)?l:gn(n.nodes,t,l,r)}),n),hn=(0,R.nE)((e=>{const{editor:{count:t}}=e,{nodes:n,props:r,editor:{scale:o,moment:a,selected:l}}=(0,R.zh)(e),i=o*t,c=(0,R.Pe)(n,r);return Array.from(gn(n.map((e=>{var t;const n=null==(t=e.editor)?void 0:t.stateId;return n?fn(mn({},e),{nodes:e.nodes.map((t=>{var r,o,a,l;const i=null==(r=((e,t)=>{const n=[],r=(e,t)=>{e.forEach((e=>{t.push(e),e.nodes&&r(e.nodes,t)}))};return r(e,n),n.find((e=>e.id===t))})(c,t.id))?void 0:r.state;return fn(mn({},t),{scripts:null!=(l=null==(a=null==(o=null==i?void 0:i[n])?void 0:o.scripts)?void 0:a.map((t=>e.props[t.id])).filter((e=>e)))?l:[]})}))}):e})),((e,{id:t,scripts:n})=>n.reduce(((e,{id:n,time:a,duration:c=0,loopInterval:s=0,loop:d,loopTimes:p=0})=>{for(var u;a<i&&(yn(e,R.T6.ms2px(a,o)),c&&yn(e,R.T6.ms2px(a+c,o)),c+s>0&&d&&(-1===p||--p>0));)a+=c+s;if(t in l)for(const t of vn((null==(u=r[n])?void 0:u.scripts)||[]))yn(e,R.T6.ms2px(t,o));return e}),e)),new Map([[R.T6.ms2px(a,o),1]])))})),vn=(e,t=[])=>e.reduce(((e,{props:{script:t,startTime:n,stopTime:r,scripts:o}})=>("GotoAndPlay"===t?e.push(n||0):"GotoAndStop"===t?e.push(r||0):"Conditions"===t&&vn(o||[],e),e)),t),bn=()=>{const{getState:e}=(0,a.oR)(),t=(0,N.useEmitter)("UseReflines");return(0,r.useCallback)(((n,r)=>{const o=hn(e().project),[a,l]=((e,t,n)=>{const r=t.reduce(((t,r)=>(e.forEach((([e,o])=>{r===e&&1===o?t.push(Number.MAX_SAFE_INTEGER):t.push(e-r-n)})),t)),[]);if(!r.length)return[[],0];const[o,a]=r.reduce((([e,t],n,r)=>Math.abs(n)<Math.abs(e)?[n,[r]]:Math.abs(n)>Math.abs(e)||n!==e?[e,t]:[n,[...t,r]]),[r[0],[0]]);return Math.abs(o)<R.T6.LENGTH?[a.map((t=>e[t%e.length][0])).filter(((e,t,n)=>n.indexOf(e)===t)),o]:[[],0]})(o,n,r);return t(a),l}),[e,t])},En={namespace:"",movement:0,min:0,max:0,alignment:0},xn={Scripts:[],Nodes:[],LeftOfScripts:[],RightOfScripts:[]},kn={Scripts:[],Nodes:[],LeftOfScripts:[],RightOfScripts:[]},wn=(e,t,n=!1)=>(n?xn[e].unshift(t):xn[e].push(t),()=>{xn[e].splice(xn[e].indexOf(t),1)}),Sn=(e,t,n=!1)=>(n?kn[e].unshift(t):kn[e].push(t),()=>{kn[e].splice(kn[e].indexOf(t),1)}),On=(e,t)=>{xn[e].slice().forEach((e=>e(t)))};for(const e of["mouseleave","mouseup"])document.addEventListener(e,(()=>{En.namespace&&(On(En.namespace,!1),En.namespace="")}));const Zn={clientX:0};document.addEventListener("mousemove",(({clientX:e})=>{if(En.namespace){0===En.movement&&On(En.namespace,!0);const t=En.movement-=Zn.clientX-(Zn.clientX=e);((e,t)=>{kn[e].slice().forEach((e=>e(t)))})(En.namespace,t)}}));const Pn=(e,t,n=!1)=>{const{getState:o,dispatch:l}=(0,a.oR)();return(0,r.useCallback)(((r,a)=>{if(0!==r.button||n&&r.currentTarget!==r.target)null==a||a(0);else{const{editor:{selected:n,scale:i},nodes:c,props:s}=(0,R.zh)(o().project),{scriptIds:d,nodeIds:p}=(0,R.bN)(n);try{const{onFinish:n,getAlignment:o}=t({scriptIds:d,nodeIds:p,nodes:c,props:s,scale:i,setStartEndTime(t,n=Number.MAX_SAFE_INTEGER){En.min=-R.T6.ms2px(t,i),En.max=R.T6.ms2px(n,i),On(e,En.namespace===e)}});Zn.clientX=r.clientX,En.namespace=e,En.alignment=0,En.movement=0;let u=0;const m=Sn(e,(e=>{u=Math.max(u,Math.abs(e)),En.alignment=o(e)}),!0),f=wn(e,(e=>{e||(null==a||a(u),n(l,R.T6.px2ms(Math.min(Math.max(En.movement+En.alignment,En.min),En.max),i)),f(),m())}),!0)}catch(e){null==a||a(0)}}}),[e,n,l,o,t])},Cn=(e,t)=>{const[n,o]=(0,r.useState)(!1),[a,l]=(0,r.useState)(0);return(0,r.useEffect)((()=>{const t=wn(e,o),n=Sn(e,l);return()=>{t(),n()}}),[e]),{accumulative:t&&n?Math.min(Math.max(a+En.alignment,En.min),En.max):0,activated:t&&n}};function In(e){const t=(()=>{const{getState:e}=(0,a.oR)();return(0,r.useCallback)((()=>{const{nodes:t,editor:{scale:n}}=(0,R.zh)(e().project);return Array.from(gn(t,((e,{scripts:t})=>t.reduce(((e,{duration:t=0})=>t>0?e.add(t):e),e)),new Set)).map((e=>R.T6.ms2px(e,n)))}),[e])})();return Pn(e,(0,r.useCallback)((({scriptIds:n,props:r,scale:o,setStartEndTime:a})=>{let l=[];const i=[];for(const e of n){const{time:t,duration:n=0}=r[e];l.push(t),n&&l.push(t+n),i.push(n)}l=l.map((e=>R.T6.ms2px(e,o)));const c=i.map((e=>R.T6.ms2px(e,o))),s=i.reduce(((e,t)=>Math.min(e,t)));return"LeftOfScripts"===e?a(n.reduce(((e,t)=>{const{time:n}=r[t];return Math.min(e,n)}),Number.MAX_SAFE_INTEGER)%Number.MAX_SAFE_INTEGER,s-2*o):a(s-2*o),{getAlignment(n){"LeftOfScripts"===e&&(n=-n);const r=t().map((e=>c.includes(e)?Number.MAX_SAFE_INTEGER:c.map((t=>e-(t+n))))).flat(2).reduce(((e,t)=>Math.abs(t)<Math.abs(e)?t:e),0);return Math.abs(r)<R.T6.LENGTH?"LeftOfScripts"===e?-r:r:0},onFinish(t,o){o&&t((0,N.groupActions)(n.map((t=>(0,N.changeProps)([t],"LeftOfScripts"===e?{time:Math.max(r[t].time+o,0),duration:Math.max(r[t].duration-o,0)}:{duration:Math.max(r[t].duration+o,0)})))))}}}),[e,t]))}var jn=(0,r.memo)((({start:e,end:t,selected:n,onChange:o})=>{const{accumulative:a,activate:l,activated:i}=(0,T.kL)(-t,Number.MAX_SAFE_INTEGER),[c,s]=(0,r.useState)(0),d=bn();(0,r.useLayoutEffect)((()=>{i&&s(d([t],a))}),[t,a,i,d]),(0,Ht.Z)((()=>{!i&&p&&o(t+p),d([],0),s(0)}),[i]);const p=a+c,u=Math.abs(t-e+p),m=n?"red":"#0dce8a",f=`solid 1px ${m}`;return r.createElement("div",{style:{height:1,position:"absolute",top:10,left:10,width:`${u}px`,zIndex:-1,backgroundColor:m,transformOrigin:"0 50%",transform:`rotateY(${t+p<e?"180deg":"0deg"})`,pointerEvents:n?"inherit":"none"},onMouseDown:e=>{e.stopPropagation()}},r.createElement("div",{style:{position:"absolute",height:32,width:5,right:t+p<e?-2:-3,top:-16,padding:"0 2px",cursor:n&&!i?"ew-resize":void 0},onMouseDown:e=>{n&&l(e)}},r.createElement("div",{style:{height:32,width:1,background:m}}),r.createElement("div",{style:{width:9,height:9,position:"absolute",top:12,right:4,borderTop:f,borderRight:f,transform:"rotate(45deg)"}})))})),An=n(71092),Mn=n(43047),Dn=Object.defineProperty,Nn=Object.defineProperties,Tn=Object.getOwnPropertyDescriptors,Rn=Object.getOwnPropertySymbols,Fn=Object.prototype.hasOwnProperty,Ln=Object.prototype.propertyIsEnumerable,zn=(e,t,n)=>t in e?Dn(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,$n=(e,t)=>{for(var n in t||(t={}))Fn.call(t,n)&&zn(e,n,t[n]);if(Rn)for(var n of Rn(t))Ln.call(t,n)&&zn(e,n,t[n]);return e},Bn=(e,t)=>Nn(e,Tn(t));const Vn=e=>`(${e.map((({props:{name:e,script:t,scripts:n=[]}})=>"Conditions"===t?Vn(n):e)).join(" ")})`;function Hn({script:{id:e,type:t,name:n,time:o,enabled:l=!0},nodeSelected:i,movement:c,scale:s,onScriptContextMenu:d,activate:p}){const u=R.T6.ms2px(o,s),{scripts:m,onChange:f}=(0,N.useProps)(e,"scripts",[]),{selected:y,onSelect:g}=(0,N.useSelected)(e),{accumulative:h,activated:v}=Cn("Scripts",y),b=u+c+h,{trigger:E}=(0,An.Z)("Blueprint"),{getState:x}=(0,a.oR)(),k=(e,t=[],n=[])=>t.reduce(((n,{id:o,props:a},l)=>{var i;if("GotoAndStop"===a.script||"GotoAndPlay"===a.script){const c="GotoAndStop"===a.script?"stopTime":"startTime";n.push(r.createElement(jn,{key:o,start:b,selected:y||v,end:R.T6.ms2px(null!=(i=a[c])?i:0,s),onChange:n=>{e(t.map(((e,t)=>l!==t?e:Bn($n({},e),{props:Bn($n({},e.props),{[c]:R.T6.px2ms(n,s)})}))))}}))}else"Conditions"===a.script&&k((n=>{e(t.map(((e,t)=>l!==t?e:Bn($n({},e),{props:Bn($n({},e.props),{scripts:n})}))))}),a.scripts,n);return n}),n);return r.createElement("div",{title:`${n}${Vn(m)}`,className:(0,R.xG)({[`${tr}-script`]:{selected:y||v,disabled:!l}}),style:{transform:`translateX(${b}px)`},onMouseDown:e=>{2===e.button?d(e):y?(e.persist(),p(e,(t=>{t||g(e)}))):(g(e),p(e))},onDoubleClick:()=>{if("Blueprint"===t){const t=(0,R.v$)((0,R.zh)(x().project)),[n]=(0,R.qC)(t,e,!0);if(n){const e=(0,R.zh)(x().project);E({type:e.id===n.id?"Scene":"Node",id:n.id})}}},"data-script":String(e)},r.createElement(_n,{type:t,id:e,scripts:m}),(i||y||v)&&k(f,m))}function Gn({id:e}){return r.createElement(_n,{id:e,scripts:(0,N.useProps)(e,"scripts",[]).scripts})}function _n({type:e,id:t,scripts:n=[]}){const{token:o}=c.Z.useToken(),a=(0,N.useScriptError)(t),l="Blueprint"===e?Mn.P.Blueprint:n.map((e=>(0,Mn.F)(e))).reduce(((e,t)=>t||e),Mn.P.default);return r.createElement(ce.Z,{size:"small",type:"text",icon:r.createElement(oe.Z,{component:l}),className:(0,mt.cx)((0,mt.iv)({pointerEvents:"none",color:a?o.colorErrorText:o.colorPrimaryText,padding:0}))})}function Un({scripts:e,scale:t,scriptIds:n,onSelectId:o,activate:a,backgroundColor:l,nodeMovement:i}){const[c,s]=(0,r.useState)(!1),{accumulative:d,activated:p}=Cn("Scripts",e.some((({id:e})=>n.includes(e))));(0,r.useEffect)((()=>{p&&s(!1)}),[p]);const{onDelete:u}=(0,N.useOnDelete)(),m=`rgba(0,0,139,${c||e.some((({id:e})=>n.includes(e)))?1:.48})`;if(e.length<2)return null;const[{time:f,duration:y=0}]=e;let g=R.T6.ms2px(f,t),h=20;return y?(h=R.T6.ms2px(y,t)-24,g+=12):g-=10,r.createElement(L.Z,{mouseEnterDelay:.4,open:c&&!p,onOpenChange:e=>s(e),overlay:r.createElement(F.Z,{selectedKeys:n.map(String)},e.slice().reverse().map((e=>r.createElement(F.Z.Item,{key:String(e.id),onMouseDown:t=>{t.stopPropagation(),s(!1),o(t,[e.id]),a(t)}},r.createElement("div",{style:{display:"flex"}},"Script"===e.type&&r.createElement(r.Fragment,null,r.createElement(Gn,{id:e.id})," "),r.createElement("div",{style:{flex:"auto",paddingRight:"1em"}},e.name||e.type),r.createElement(ce.Z,{size:"small",type:"link",onMouseDown:e=>{e.stopPropagation()},onClick:t=>{t.stopPropagation(),u({scriptIds:[e.id]})}},"删除"))))))},r.createElement("div",{style:{position:"absolute",cursor:"pointer",height:"20px",width:`${h}px`,transform:`translateX(${i+(e.every((({id:e})=>n.includes(e)))?d+g:g)}px)`},onMouseDown:t=>{t.stopPropagation(),s(!1),e.some((({id:e})=>n.includes(e)))?(t.persist(),a(t,(n=>{t.persist(),n||o(t,e.map((({id:e})=>e)))}))):(o(t,e.map((({id:e})=>e))),a(t))}},y>0?r.createElement(r.Fragment,null,r.createElement("div",{style:Wn(.5,2,2)}),r.createElement("div",{style:Wn(.7,4,4)}),r.createElement("div",{style:Wn(1,6,6),className:(0,mt.iv)({textAlign:"center",fontSize:12})},e.length)):e.some((({type:e})=>"Script"===e))&&r.createElement("div",{style:{position:"relative",top:-1}},r.createElement(ce.Z,{type:"text",icon:r.createElement(oe.Z,{component:Mn.P.default}),className:(0,mt.iv)({pointerEvents:"none",padding:0,height:20,width:20,color:m,transitionProperty:"-background",backgroundColor:l})}),r.createElement("div",{style:{position:"absolute",color:m,right:0,bottom:0,lineHeight:"8px",transform:"scale(.5)"}},e.length))))}const Wn=(e,t,n)=>({position:"absolute",opacity:e,height:16,width:16,right:n-4,top:t-2});var Kn=n(12653),Xn=n(47709);function Yn({script:{id:e,name:t,time:n,enabled:o=!0,duration:l=0,playBySelf:i,intervalId:s=0,loopInterval:d=0},binDisabled:p,movement:u,scale:m,onScriptContextMenu:f,activate:y,activateLeft:g,activateRight:h}){const v=R.T6.ms2px(n,m),b=R.T6.ms2px(l,m),{selected:E,onSelect:x,onSelectId:k}=(0,N.useSelected)(e),{activated:w,accumulative:S}=Cn("Scripts",E),{activated:O,accumulative:Z}=Cn("LeftOfScripts",E),{activated:P,accumulative:C}=Cn("RightOfScripts",E),{accumulative:I,activated:j,activate:A}=((e,t,n,o)=>{const l=bn(),i=(0,r.useRef)(0),c=-R.T6.ms2px(t,n),{accumulative:s,activated:d,activate:p}=(0,T.kL)(c,Number.MAX_SAFE_INTEGER,{onChange:e=>{i.current=l(o,Math.max(e,c))}}),{dispatch:u}=(0,a.oR)();return(0,Ht.Z)((()=>{d||(u((0,N.changeProps)([e],{loopInterval:t+R.T6.px2ms(s+i.current,n)})),l([],0),i.current=0)}),[d]),{accumulative:s+i.current,activated:d,activate:p}})(s,d,m,[(0,Xn.ms2px)(n,m),(0,Xn.ms2px)(n+l,m)]),M=O||w||P,D=(0,N.useSettings)("typeOfPlay"),{token:F}=c.Z.useToken();return r.createElement("div",{title:t,className:(0,mt.cx)((0,mt.cx)(`${tr}-effect`,(0,mt.iv)({background:F.colorPrimary,border:`2px solid ${F.colorPrimary}`})),M&&`${tr}-effect-activated`,(E||M)&&(0,mt.cx)(`${tr}-effect-selected`,(0,mt.iv)({borderColor:F.colorPrimaryActive})),!o&&`${tr}-effect-disabled`,s>0&&{activated:j}&&`${tr}-effect-interval`,e<0&&!s&&`${tr}-effect-shadowed`),style:{width:`${Math.max(b-Z+C,3*R.T6.LENGTH)}px`,transform:`translateX(${v+S+I+Z+u}px)`,display:"flex"},"data-script":String(e),onMouseDown:e=>{2===e.button&&f(e)}},r.createElement("div",{style:{position:"absolute",width:"100%",height:"100%",whiteSpace:"nowrap",pointerEvents:"none",display:"flex",justifyContent:"center",alignItems:"center",color:"white"}},r.createElement("div",{style:{flex:"auto",display:"flex",justifyContent:"center",alignItems:"center",overflow:"hidden"}},b>3*R.T6.LENGTH?t:""),i&&r.createElement("div",{style:{flex:"none",display:"flex",justifyContent:"center",alignItems:"center",width:18,paddingRight:8,height:14}},i&&r.createElement(Kn.Z,{style:{position:"absolute",fontSize:"12px"}})),(O||w||P)&&r.createElement("div",{style:w?{left:0}:void 0,className:(0,mt.iv)({position:"absolute",height:"100%",margin:"0 6px",padding:"0 8px",pointerEvents:"none",background:"rgba(0, 0, 0, 0.6)"})},(R.T6.px2ms(w?v+S+Z+u:b-Z+C,m)/1e3).toFixed(2),"s")),!p&&r.createElement("div",{className:(0,mt.cx)((E||M)&&(0,mt.cx)(`${tr}-handle`,(0,mt.iv)({background:F.colorPrimary}))),style:{flex:"0 1 6px",cursor:"w-resize"},onMouseDown:e=>{4!==D&&2!==e.button&&(E?(e.persist(),g(e,(t=>{t||x(e)}))):(x(e),g(e)))}}),r.createElement("div",{style:{flex:"1 1 12px"},onMouseDown:e=>{4!==D&&2!==e.button&&(E?(e.persist(),y(e,(t=>{t||x(e)}))):s?(k({},[s]),A(e)):(x(e),y(e)))}}),!p&&r.createElement("div",{className:(0,R.xG)({[`${tr}-handle`]:E||M}),style:{flex:"0 1 6px",cursor:"e-resize"},onMouseDown:e=>{4!==D&&2!==e.button&&(E?(e.persist(),h(e,(t=>{t||x(e)}))):(x(e),h(e)))}}))}const Jn=(0,r.memo)((({node:e,scale:t,count:n,Overlay:o,movement:l=0})=>{var i,c;const s=bn(),d=function(e){return Pn("Scripts",(0,r.useCallback)((({scriptIds:t,props:n,scale:r,setStartEndTime:o})=>{const a=t.reduce(((e,t)=>{const{time:r}=n[t];return Math.min(e,r)}),Number.MAX_SAFE_INTEGER)%Number.MAX_SAFE_INTEGER,l=t.reduce(((e,t)=>{const{time:r,duration:o}=n[t];return e.push(r),o&&e.push(r+o),e}),[]).map((e=>R.T6.ms2px(e,r)));return o(a),{getAlignment(t){return e(l,t)},onFinish(r,o){e([],0),o&&r((0,N.groupActions)(t.map((e=>(0,N.changeProps)([e],{time:Math.max(n[e].time+o,0)})))))}}}),[e]))}(s),p=In("LeftOfScripts"),u=In("RightOfScripts"),{scriptGroups:m,edges:f}=(({id:e,scripts:t},n,o)=>{const{resourceDeleted:l,isAnimationNode:i}=(0,a.v9)((({project:t})=>{const{props:{[e]:n}}=(0,R.zh)(t);let r=!1;switch(n.type){case"Video":case"Sound":r=!n.url}return{resourceDeleted:r,isAnimationNode:(0,R.W6)(n.type)}}),a.wU);return(0,r.useMemo)((()=>{l&&(t=t.filter((({type:e})=>"Controller"!==e))),i&&(t=t.filter((({type:e})=>"Blueprint"!==e)));const e=n*o;let r=-1;const a=t.filter((({loop:e,duration:t})=>e&&t)).reduce(((t,n)=>{let{loopTimes:o=-1}=n,a=n.id;for(;;){const{time:c,duration:s=0,loopInterval:d=0}=n,p=c+s+d;if(!(c<p&&p<e&&(o<=-1||o-- >1)))break;l=on({},n),i={time:p,id:r--,intervalId:a},n=qt(l,Qt(i)),a=0,t.push(n)}var l,i;return t}),[]).concat(t.sort((({time:e,duration:t=0},{time:n,duration:r=0})=>{return o=e-n,a=r-t,Math.abs(a)>Math.abs(o)?a:o;var o,a}))),c=Object.values(Yt()(a,(({time:e,type:t,duration:r=0,script:o})=>`${"Script"===t}:${Math.floor("Script"===o?e/n:e/n/2)}:${Math.floor(r/n/2)}`)));return{scriptGroups:c,edges:Array.from(a.reduce(((e,{time:t,duration:n=0})=>e.add(t).add(t+n)),new Set)).map((e=>R.T6.ms2px(e,n)))}}),[t,n,o,l])})(e,t,n),{onScriptContextMenu:y,onContextMenu:g,onSelect:h,selected:v,overlay:b}=((e,t,n)=>{const o=(0,N.useGetSelected)(),[a,l]=(0,r.useState)(null),{selected:i,onSelect:c,onSelectId:s}=(0,N.useSelected)(e.id,!0,!0);return(0,r.useEffect)((()=>{if(i)return()=>l(null)}),[i,t]),{onScriptContextMenu:(0,r.useCallback)((({target:e,currentTarget:t})=>{e.dataset.script=t.dataset.script}),[]),onContextMenu:a=>{const d=a.currentTarget.getBoundingClientRect(),{dataset:{script:p}}=a.target,u=e.scripts.find((({id:e})=>e===Number(p)));u&&!o().scriptIds.includes(u.id)?s(a,[u.id],!1,!1):u||i||c(a),l(r.createElement(n,{left:a.clientX-d.left,top:a.clientY-d.top,hideOverlay:()=>l(null),script:u,scale:t}))},onSelect:c,selected:i,overlay:a}})(e,t,o),{nodeMovement:E,passMovement:x,onMoveNode:k}=((e,t,n)=>{const o=(0,r.useRef)(!1),a=(0,T.b)("ctrlMeta",(0,r.useCallback)((e=>{"boolean"==typeof o.current?o.current=e:o.current(e)}),[])),{accumulative:l}=Cn("Nodes",e);return{onMoveNode:Pn("Nodes",(0,r.useCallback)((({nodeIds:e,scriptIds:r,nodes:a,setStartEndTime:l})=>{if(r.length||"boolean"!=typeof o.current)throw new Error;const i=e.map((e=>(0,R.qC)(a,e)[0]));if(!i.length)throw new Error;let c=o.current;return o.current=e=>{c=e,l((0,N.minStartTime)(i,e))},o.current(c),{getAlignment(e){return n(t,e)},onFinish(e,t){if(o.current=c,n([],0),t){const n=(e,r=[])=>e.reduce(((e,{scripts:r,nodes:o})=>(r.forEach((({id:n,time:r})=>e.push((0,N.changeProps)([n],{time:r+t})))),c?n(o,e):e)),r);e((0,N.groupActions)(n(i)))}}}}),[t,n]),!0),nodeMovement:l,passMovement:a?l:0}})(v,f,s),{selected:{scriptIds:w},onSelectId:S}=(0,N.useSelected)(0),[O,Z]=(0,r.useState)(),{edit3d:P}=(0,N.useEditor)("edit3d"),C=(0,N.useSettings)("typeOfPlay");return r.createElement(r.Fragment,null,r.createElement("div",{key:e.id,ref:e=>{if(e){const t=getComputedStyle(e).backgroundColor;Z(t)}},className:(0,R.xG)({[`${tr}-item`]:{disabled:!(null==(i=e.enabled)||i),selected:v}}),onMouseDown:e=>{2===e.button?g(e):v?(e.persist(),k(e,(t=>{t||h(e)}))):(h(e),k(e))}},m.length?m.map(((n,o)=>r.createElement(r.Fragment,{key:o},n.map((n=>"Script"===n.type||"Blueprint"===n.type?r.createElement(Hn,{key:n.id,scale:t,script:n,nodeSelected:v,movement:l+E,onScriptContextMenu:y,activate:d}):r.createElement(Yn,{key:n.id,scale:t,script:n,binDisabled:"Controller"===n.type&&["Animation","Sound","Video"].includes(e.type)||Boolean(n.intervalId),movement:l+E,onScriptContextMenu:y,activate:d,activateLeft:p,activateRight:u}))),r.createElement(Un,{scriptIds:w,onSelectId:S,scripts:n.filter((({id:e})=>e>0)),scale:t,activate:d,backgroundColor:O,nodeMovement:E+l})))):4!==C&&r.createElement("span",{className:`${tr}-item-tips`},"在时间轴上右击可添加动画、事件"),b),!(null==(c=e.editor)?void 0:c.isCollapsed)&&("Scene3D"!==e.type||"Scene3D"===e.type&&P)&&e.nodes.slice().reverse().map((e=>r.createElement(Jn,{key:e.id,node:e,scale:t,count:n,Overlay:o,movement:l+x}))))}));var qn=Jn,Qn=n(22476),er={};er.styleTagTransform=w(),er.setAttributes=b(),er.insert=h().bind(null,"head"),er.domAPI=y(),er.insertStyleElement=x(),m()(Qn.Z,er),Qn.Z&&Qn.Z.locals&&Qn.Z.locals;const tr="editor-timeline-scene-content";function nr({scale:e,count:t,nodes:n,length:o}){const a=(()=>{const[e,t]=(0,r.useState)([]);return(0,N.useEmitter)("UseReflines",t),e})(),{Overlay:l,element:i}=te();return r.createElement("div",{className:`${tr}-main`},n.slice().reverse().map((n=>r.createElement(qn,{key:n.id,node:n,scale:e,count:t,Overlay:l}))),r.createElement("div",{style:{position:"absolute",left:0,top:0}},a.map(((e,t)=>r.createElement("div",{key:t,style:{height:32*o+"px",position:"absolute",left:R.T6.OFF_HEAD*R.T6.LENGTH+"px",transform:`translateX(${e}px)`,transition:"200ms",top:"0",pointerEvents:"none",borderLeft:"1px dashed #0dce8a",zIndex:1}})))),i)}const rr={input:(0,mt.iv)({position:"sticky",left:"0",top:"0",zIndex:2}),container:(0,mt.iv)({flex:"auto",display:"grid",gridTemplateRows:"32px 1fr",overflow:"auto"})};function or(){const{token:e}=c.Z.useToken(),{scale:t}=(0,N.useEditor)("scale"),[n,o]=(0,r.useState)(""),l=(0,r.useRef)(null),{count:i,onChangeCount:s}=(0,N.useEditorCount)(),{nodes:d,filtered:p,flattened:u}=(e=>{const t=(0,a.v9)((({project:e})=>{const t=(0,R.zh)(e),n=(0,R.v$)(t);return(0,At.Yt)(e)?"Animation3D"===t.type?n[0].nodes.filter((e=>"Scene3D"!==e.type)):t.editor.edit3d?[]:n.filter((e=>"Scene3D"!==e.type)):"PanoramaData"===e.type?n[0].nodes:e.settings.enabled3d&&"Scene"===t.type?t.editor.edit3d?n.filter((({type:e})=>"Scene3D"===e)):n.map((e=>"Scene3D"!==e.type?e:$t(zt({},e),{nodes:[]}))):n}),a.wU),n=(0,r.useMemo)((()=>Bt(t,e)),[t,e]),o=(0,r.useMemo)((()=>Vt(n.slice().reverse())),[n]);return{nodes:t,filtered:n,flattened:o}})(n),m=(0,r.useMemo)((()=>(0,N.maxEndTime)(d)),[d]),{accumulative:f,activate:y,activated:g}=(0,T.kL)(0,240,{reserved:!0});return(0,r.useEffect)((()=>{if(l.current){const{LENGTH:e,OFF_HEAD:n,OFF_TAIL:r}=R.T6,o=new ResizeObserver((o=>{for(const{contentRect:a}of o){const o=(a.width-240-f)/e-n-r;s(Math.ceil(m/t),Math.ceil(o))}}));return o.observe(l.current),()=>o.disconnect()}}),[l.current,t,m,g||f]),r.createElement("div",{ref:l,className:rr.container,style:{gridTemplateColumns:`${240+f}px 1fr`}},r.createElement(it.Z,{className:(0,mt.cx)(rr.input,(0,mt.iv)({borderRadius:0,background:e.colorBgLayout})),placeholder:"搜索",onChange:({target:{value:e}})=>{o(e)}}),r.createElement(Wt,{scale:t,count:i,length:u.length}),u.length?r.createElement(r.Fragment,null,r.createElement(jt,{nodes:u,resizing:g,onReWidth:y}),r.createElement(nr,{scale:t,count:i,nodes:p,length:u.length})):d.length?r.createElement(Ce.ju,null):r.createElement(Ce.xI,null))}var ar=n(48030),lr=n(80926);function ir(){const{subscribe:e,getState:t}=(0,a.oR)(),[n,o]=(0,r.useState)(null);return(0,r.useEffect)((()=>e((0,Ne.debounce)((()=>{const e=(0,R.zh)(t().project),n=Array.from((0,N.checkPlayableAreaBase)(e));return n.length?n.length<4?o(`${e.name}中存在${n.map((({nodeName:e})=>e)).join("、")}元素在限制互动区域，可能会影响互动效果，请及时预览检查`):o(`${e.name}中存在${n.slice(0,3).map((({nodeName:e})=>e)).join("、")}等${n.length}个元素在限制互动区域，可能会影响互动效果，请及时预览检查`):o(null)}),1e3))),[t,e]),n?r.createElement("div",{className:(0,mt.iv)({flex:"0 0 30px",overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis",boxShadow:"0px -2px 8px rgba(0, 0, 0, 0.08)",fontSize:12,width:"100%",paddingLeft:16,lineHeight:"30px",zIndex:1})},r.createElement(lr.Z.Text,{type:"warning"},r.createElement(ar.Z,null))," ",n):null}var cr=n(20469),sr=n(22142);function dr(){const e=(0,N.useSettings)("typeOfPlay"),{state:t,toggle:n,setFalse:o}=(0,cr.Z)(!1),{accumulative:a,activate:l,activated:i}=(0,T.kL)(-448,128,{storage:"ui.settings.elements.height",reserved:!0,vertical:!0});return(0,r.useEffect)((()=>{i&&o()}),[i,o]),sr.createElement(Z.Z.Content,{style:{flex:t?"none":`0 0 ${298-a}px`,boxShadow:"0px -2px 8px rgba(0,0,0,0.08)",display:"flex",flexDirection:"column",userSelect:"none"}},3===e&&sr.createElement(ir,null),sr.createElement(lt,{collapsed:t,toggleCollapsed:n,onReheight:l}),t?sr.createElement(pr,null):sr.createElement(or,null))}const pr=(0,r.memo)((()=>te().element));var ur=n(86750),mr=n(9610),fr=n(26423),yr=n(3207),gr=n(53983),hr=n(39139),vr=n(22142);const br=()=>{const e=(0,ur.hz)(),t=(()=>{const e=(0,ur.lu)((0,a.oR)()),[t,n]=(0,r.useState)([0]);return{spark:"context",content:{spark:"visit",index:0,label:"全景编辑",content:{spark:"group",label:"VR 全局配置",content:{spark:"grid",content:[{spark:"block",content:{spark:"label",label:"全景标记",content:{spark:"value",index:"landMarkUrl",content(e,t){return{spark:"element",content(){return vr.createElement(gr.r,{type:"Sprite",url:e,deletable:!0,onChange:({url:e})=>{t(e)}})}}}}}},{spark:"block",content:{spark:"enter",index:"plan",content:{spark:"grid",content:[{spark:"label",label:"观察点",tooltip:"中心观察点必须在图的正中央",content:{spark:"value",index:"viewerUrl",content(e,t){return{spark:"element",content(){return vr.createElement(gr.r,{deletable:!0,type:"Sprite",url:e,onChange:({url:e})=>{t(e)}})}}}}},{spark:"label",label:"平面图",content:{spark:"value",index:"planUrl",content(e,t){return{spark:"element",content(){return vr.createElement(gr.r,{deletable:!0,type:"Sprite",url:e,onChange:({url:e})=>{t(e)}})}}}}}]}}}]}}},provide:()=>({openKeys:{},useValue:e,visiting:{next:t,onVisit:n}})}})(),n=(()=>{const e=(({dispatch:e})=>{const{onChange:t}=(0,N.useEditor)(0,"selectedSceneId");return n=>{const{indexValue:r,indexEntries:o}=(0,yr.getIndexer)(n),{value:l,panoramaSpaceId:i,mainSceneId:c}=(0,a.v9)((({project:e})=>{var t;const{panoramaEdit:{panoramaSpaceId:n,mainSceneId:o}}=e.editor,a=e.scenes.find((e=>e.id===o)),l=a?null==(t=Object.entries(a.props).find((([e])=>e===`${n}`)))?void 0:t[1]:{};return{value:[r(l)],panoramaSpaceId:n,mainSceneId:o}}),a.wU);return{value:l,onChange:n=>{return r=[n],a=function*([n]){t(c),e((0,N.changeProps)([i],Object.fromEntries(o(n))))},new Promise(((e,t)=>{var n=e=>{try{l(a.next(e))}catch(e){t(e)}},o=e=>{try{l(a.throw(e))}catch(e){t(e)}},l=t=>t.done?e(t.value):Promise.resolve(t.value).then(n,o);l((a=a.apply(void 0,r)).next())}));var r,a}}}})((0,a.oR)()),[t,n]=(0,r.useState)([0]);return{spark:"context",content:{spark:"visit",index:0,label:"全景编辑",content:hr.sf},provide:()=>({openKeys:{},useValue:e,visiting:{next:t,onVisit:n}})}})();return vr.createElement("div",null,(0,yr.default)(e),(0,yr.default)(t),vr.createElement("br",null),(0,yr.default)(n))};var Er=n(47681);function xr(){const{getState:e}=(0,a.oR)(),t=(0,ur.hz)(),n=(0,ur.KW)(),o=(0,ur._v)();return r.createElement(kr,null,((a,l,i,c)=>{if(a)return(0,At.Yt)(e().project)?r.createElement(br,null):(0,yr.default)(t);if(c.type)return(0,yr.default)(n);if(l)return r.createElement(Er.E,null);if(!o)throw new Error("未匹配到合适的Group");return r.createElement("div",{className:(0,mt.iv)({position:"relative"})},(0,yr.default)(o),r.createElement(mr.Z.BackTop,{target:()=>i.current,className:(0,mt.iv)({position:"absolute",bottom:-10,right:30})},r.createElement("div",{className:(0,mt.iv)({height:40,width:40,borderRadius:"50%",color:"#fff",textAlign:"center",fontSize:14,display:"flex",alignItems:"center",justifyContent:"center",lineHeight:"11px",backgroundColor:"rgba(57, 85, 246, 0.6)",zIndex:100,cursor:"pointer",transition:"background-color 0.3s ease","&:hover":{backgroundColor:"rgba(57, 85, 246, 0.8)"}})},r.createElement(fr.Z,{theme:"outline",size:"18",fill:"#fff"}))))}))}function kr({children:e}){const{settingsOn:t}=(0,N.useEditor)(0,"settingsOn"),{propsMode:n}=(0,N.useEditor)(0,"propsMode"),{playable:o}=(0,N.useEditor)("playable"),{panoramaEdit:a}=(0,N.useEditor)(0,"panoramaEdit"),l=(0,r.useRef)(null),i="Product"===n?378:340,{token:s}=c.Z.useToken();return r.createElement("div",{id:"editor-property",ref:l,style:{flex:`0 0 ${i}px`,maxWidth:`${i}px`},className:(0,mt.iv)({position:"relative",height:"100%",borderLeft:`1px solid ${s.colorBorder}`,overflow:"auto",paddingBottom:32,"&::-webkit-scrollbar":{display:"none"}})},e(t,o,l,a))}var wr=n(22142);const Sr=({children:e,title:t})=>wr.createElement("div",{className:(0,mt.iv)({padding:"8px 12px"})},wr.createElement("h4",{className:(0,mt.iv)({paddingBottom:12,margin:0})},t),e);var Or=Object.defineProperty,Zr=Object.defineProperties,Pr=Object.getOwnPropertyDescriptors,Cr=Object.getOwnPropertySymbols,Ir=Object.prototype.hasOwnProperty,jr=Object.prototype.propertyIsEnumerable,Ar=(e,t,n)=>t in e?Or(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Mr=(e,t)=>{for(var n in t||(t={}))Ir.call(t,n)&&Ar(e,n,t[n]);if(Cr)for(var n of Cr(t))jr.call(t,n)&&Ar(e,n,t[n]);return e};function Dr(){const{getState:e}=(0,a.oR)(),[t,n]=(0,r.useState)(""),[o,l]=(0,r.useState)("abcde"),[i,c]=(0,r.useState)("none"),[s,d]=(0,r.useState)(""),p=(0,r.useRef)(null),{clearIframe:u,postMessage:m}=function(e){const t=(0,r.useRef)([]);return window.previewLog=()=>{console.log(t.current)},{postMessage:n=>{var r,o;t.current.push(n),null==(o=null==(r=e.current)?void 0:r.contentWindow)||o.postMessage(JSON.stringify(n),"*")},clearIframe:()=>{var t,n;null==(n=null==(t=e.current)?void 0:t.contentWindow)||n.postMessage(JSON.stringify({type:"clear"}),"*")}}}(p);return(0,An.Z)("ViewResource",(t=>{return r=this,o=[t],a=function*({type:t,entry:r}){if("enter"===t){const{category:t,url:i,name:s,description:u,extra:f}=r;if(["Lottie","Particle","FrameAnime","Spine","DragonBones","Sprite","Animation","PSD","Live2d","Skybox"].includes(t)){const r=Tr(t);if(["spine","dragonBones","component","psd"].includes(r)?c("big"):c("small"),n(s),l(u),null==f?void 0:f.previewVideo)d(null==f?void 0:f.previewVideo);else if(p.current)if("number"==typeof i){const{project:t}=e(),{scenes:n,customScripts:r,settings:l}=t,c={scenes:n.filter((e=>"Animation"===e.type)).map((e=>(0,R.GV)(e))),customScripts:r,settings:(o=Mr({},l),a={sceneOrders:[i]},Zr(o,Pr(a)))};m({type:"change",url:l.basePath,projectType:"scene",loop:!0,data:c})}else m({type:"change",url:i,projectType:r,loop:!0})}}else c("none"),d(""),u();var o,a},new Promise(((e,t)=>{var n=e=>{try{i(a.next(e))}catch(e){t(e)}},l=e=>{try{i(a.throw(e))}catch(e){t(e)}},i=t=>t.done?e(t.value):Promise.resolve(t.value).then(n,l);i((a=a.apply(r,o)).next())}));var r,o,a})),r.createElement("div",{className:(0,mt.iv)({position:"absolute",top:4,right:-4,width:214,padding:6,borderRadius:4,border:"1px solid #d9d9d9",transform:"translate(100%)",pointerEvents:"none"}),style:{visibility:"none"!==i?"visible":"hidden"}},s&&r.createElement("video",{style:{position:"absolute",top:6,left:6,zIndex:99999},src:s,autoPlay:!0,loop:!0,width:200,height:"big"===i?356:200}),r.createElement(Nr,{ref:p,width:200,height:"big"===i?356:200,scale:1.2}),r.createElement("div",{className:(0,mt.iv)({overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis",textAlign:"center"})},t),o&&r.createElement("div",{className:(0,mt.iv)({borderTop:"1px solid #ccc",paddingTop:4,wordBreak:"break-all",wordWrap:"break-word",maxHeight:200,overflow:"scroll"})},o))}const Nr=r.memo(r.forwardRef(((e,t)=>{var n=e,{width:o,height:a,scale:l=1}=n,i=((e,t)=>{var n={};for(var r in e)Ir.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&Cr)for(var r of Cr(e))t.indexOf(r)<0&&jr.call(e,r)&&(n[r]=e[r]);return n})(n,["width","height","scale"]);return r.createElement("div",{className:(0,mt.iv)({width:o,height:a,overflow:"hidden"})},r.createElement("iframe",Mr({ref:t,src:(0,De.cM)({release:!0})?"https://magicplay.oceanengine.com/static-cloud/invoke/riko_player?type=preload":["https://local-clab.","bytedance",".net/static-cloud/invoke/riko_player?type=preload"].join(""),allow:"autoplay",frameBorder:"0",className:(0,mt.iv)(Mr({width:o,height:a,position:"relative",transformOrigin:"0 0",border:"none"},l?{transform:`scale(${l})`,left:`-${o*(l-1)/2}px`,top:`-${a*(l-1)/2}px`}:{}))},i)))}))),Tr=e=>("FrameAnime"===e&&(e="frame"),"Sprite"===e&&(e="image"),"Animation"===e&&(e="component"),"PSD"===e&&(e="psd"),e.replace(/^\w/,(e=>e.toLowerCase())));var Rr=Object.defineProperty,Fr=Object.defineProperties,Lr=Object.getOwnPropertyDescriptors,zr=Object.getOwnPropertySymbols,$r=Object.prototype.hasOwnProperty,Br=Object.prototype.propertyIsEnumerable,Vr=(e,t,n)=>t in e?Rr(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Hr=(e,t)=>{for(var n in t||(t={}))$r.call(t,n)&&Vr(e,n,t[n]);if(zr)for(var n of zr(t))Br.call(t,n)&&Vr(e,n,t[n]);return e},Gr=(e,t)=>Fr(e,Lr(t)),_r=(e,t,n)=>new Promise(((r,o)=>{var a=e=>{try{i(n.next(e))}catch(e){o(e)}},l=e=>{try{i(n.throw(e))}catch(e){o(e)}},i=e=>e.done?r(e.value):Promise.resolve(e.value).then(a,l);i((n=n.apply(e,t)).next())})),Ur=n(22142),Wr=Object.defineProperty,Kr=Object.defineProperties,Xr=Object.getOwnPropertyDescriptors,Yr=Object.getOwnPropertySymbols,Jr=Object.prototype.hasOwnProperty,qr=Object.prototype.propertyIsEnumerable,Qr=(e,t,n)=>t in e?Wr(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,eo=(e,t)=>{for(var n in t||(t={}))Jr.call(t,n)&&Qr(e,n,t[n]);if(Yr)for(var n of Yr(t))qr.call(t,n)&&Qr(e,n,t[n]);return e},to=(e,t)=>Kr(e,Xr(t));const no=({entries:e})=>Ur.createElement("div",{className:(0,mt.iv)({display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gridAutoRows:"auto",overflow:"auto",maxHeight:"100%",rowGap:"8px",width:256})},e.map((e=>Ur.createElement(ro,eo({key:e.id},e))))),ro=e=>{const t=(e=>{const{trigger:t}=(0,An.Z)("ViewResource");return(0,r.useEffect)((()=>{t({type:"leave"})}),[t]),{onMouseEnter(){t({type:"enter",entry:e})},onMouseLeave(){t({type:"leave"})}}})(e),n=(({category:e,url:t,name:n,cover:r,extra:o,props:a})=>{const l=(0,N.useAddNode)(),[,i]=(0,ut.c)({item:{type:"resource",mime:e,url:t,name:n,cover:r,props:a}});return{ref:i,onClick:(c=()=>_r(void 0,null,(function*(){if("PVSlider"===e){const e=yield new Promise(((e,t)=>{let n;l({mime:"PVSlider",name:"滑条轨道",url:"https://creativelab-proxy.bytedance.com/api/upload/bucket/material/private/db0847b71d6608d9e48307f0de76dd5e.png",mapNode(e){return e.type="PVSprite",n=e,e}},!0).then((()=>{e(n)})).catch(t)}));a=Gr(Hr({},a),{x:e.props.x+4,y:e.props.y+4,distance:428})}return yield l({mime:e,name:n,url:t,cover:r,extra:o,mapNode(e){return"PVAlphaVideo"===(e=Gr(Hr({},e),{props:Hr(Hr({},e.props),a)})).type&&((e=(0,R.kj)(e,720,1280)).editor=Gr(Hr({},e.editor),{isLocked:!0})),e}},!0)})),()=>_r(void 0,null,(function*(){try{return yield c()}catch(e){Pe.ZP.error(e.message)}})))};var c})(e);return Ur.createElement("div",to(eo({},t),{className:(0,mt.iv)({flexDirection:"column",justifySelf:"center",display:"flex"})}),Ur.createElement("img",to(eo({},n),{src:e.cover,className:(0,mt.iv)({width:72,height:72,objectFit:"contain",borderRadius:"2px",border:"1px solid #f0f0f0",backgroundColor:"#F5F5F5",cursor:"pointer"})})),Ur.createElement(lr.Z.Text,{type:"secondary",className:(0,mt.iv)({width:72,textAlign:"center",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"})},e.name))};var oo=n(2376),ao=n(35553),lo=n(22142);const io=[{title:"跳转组件",entries:[{id:"PVGuider",category:"PVGuider",cover:"https://creativelab-proxy.bytedance.com/api/upload/bucket/material/f4d08e5f8f2f13de20d04fe4bd03f037.png",url:"https://creativelab-proxy.bytedance.com/api/upload/bucket/material/f4d08e5f8f2f13de20d04fe4bd03f037.png",name:"引导手势",description:"引导手势",props:{name:"引导手势"}},{id:"PVButton",category:"PVButton",cover:"https://creativelab-proxy.bytedance.com/api/upload/bucket/material/ea45652bee36e9d4d34a03c879d55f86.png",url:"https://creativelab-proxy.bytedance.com/api/upload/bucket/material/1ac7643d1f6d110b27ffbcfe122a27bc.png",name:"图文按钮",description:"图文按钮",props:{activeUrl:"https://creativelab-proxy.bytedance.com/api/upload/bucket/material/1ac7643d1f6d110b27ffbcfe122a27bc.png",jumpSceneId:0,buttonType:"normal",showGuide:!1,text:"图文按钮",guideTitle:"点击"}},{id:"PVClickArea",category:"PVClickArea",cover:"https://creativelab-proxy.bytedance.com/api/upload/bucket/material/6224a5d9661264dc72e24d91b45b6349.png",url:"https://creativelab-proxy.bytedance.com/api/upload/bucket/material/6224a5d9661264dc72e24d91b45b6349.png",name:"点击热区",description:"热区",props:{showGuide:!1,jumpSceneId:0,guideTitle:"点击"}},{id:"PVSlider",category:"PVSlider",cover:"https://creativelab-proxy.bytedance.com/api/upload/bucket/material/a17f99015eae9222eaef3a4e36f388f3.png",url:"https://creativelab-proxy.bytedance.com/api/upload/bucket/material/private/b39ddc37a7111eefb85c6c8e8380bcec.png",name:"滑条组件",description:"滑条",props:{jumpSceneId:0,name:"滑条滑块",guideTitle:"滑动"}},{id:"PVDragger",category:"PVDragger",cover:"https://creativelab-proxy.bytedance.com/api/upload/bucket/material/private/01bb66972e8be5cf4445d44e478bfd8c.png",url:"https://creativelab-proxy.bytedance.com/api/upload/bucket/material/private/6dfdaf56f636e48f615723ce20daf9d8.png",name:"拖拽组件",description:"拖拽",props:{jumpSceneId:0,name:"拖拽组件",guideTitle:"拖拽"}}]},{title:"装饰组件",entries:[{id:"PVSprite",category:"PVSprite",cover:"https://creativelab-proxy.bytedance.com/api/upload/bucket/material/0866050d5fc094bf01ee60f32f3321d0.png",url:"https://creativelab-proxy.bytedance.com/api/upload/bucket/material/0866050d5fc094bf01ee60f32f3321d0.png",name:"图片",description:"装饰图片"},{id:"PVFrameAnime",category:"PVFrameAnime",cover:"https://creativelab-proxy.bytedance.com/api/upload/bucket/material/0866050d5fc094bf01ee60f32f3321d0.png",url:"material/preview/2ce4506f3725ba354e09cb0b67715493/sequence.json?mid=7019122308006592556",name:"动画",description:"动画"},{id:"PVText",category:"PVText",cover:"https://creativelab-proxy.bytedance.com/api/upload/bucket/material/9b9e6c80c3e32aaba88fb958fe72bc3d.png",url:"说明文案",name:"文本",description:"说明文案"},{id:"PVAlphaVideo",category:"PVAlphaVideo",cover:"https://p7.itc.cn/images01/20210208/735c861e79684b1d9e9e743eabf1cfd5.png",url:"https://creativelab-proxy.bytedance.com/api/upload/bucket/material/private/preview/1f37e35899cfe85acecfb28cb26e1f45/00b9f975104efcede5106a8facfd7afc.mp4",name:"出框视频",description:"出框视频"}]}];function co(){const[e,t]=(0,r.useState)(!0),{token:n}=c.Z.useToken();return lo.createElement("div",{className:(0,mt.iv)({flex:"0 0 auto",position:"relative",zIndex:1})},lo.createElement("div",{className:(0,mt.iv)({background:n.colorBgContainer,boxShadow:"4px 2px 6px -3px rgba(0,0,0,0.08)",transform:"translateX(100%)",position:"absolute",height:"100%",right:0,top:0})},e&&lo.createElement("div",{className:(0,mt.iv)({overflow:"auto",maxHeight:"100%"})},io.map((({title:e,entries:t},n)=>lo.createElement(Sr,{key:n,title:e},lo.createElement(no,{entries:t}))))),lo.createElement(ce.Z,{size:"small",icon:lo.createElement(oe.Z,{component:e?oo.Z:ao.Z}),type:"default",style:{borderRadius:"0 4px 4px 0",transform:"translate(100%)",position:"absolute",transition:"0s",border:"none",right:0,top:0},onClick:()=>t(!e)}),lo.createElement(Dr,null)))}var so=n(3606),po=n(13718),uo=n(3391),mo=n(90906),fo=n(18878),yo=n(14099),go=n(63451),ho=n(83509),vo=n(79887),bo=n(49814),Eo=n(27904),xo=n(64983),ko=n(97723),wo=n(94670),So=n(43230),Oo=n(74173),Zo=n(48751),Po=n(90812),Co=n.p+"f43f07dc61bc19be5c55e0927c71eb28.svg",Io=n.p+"dd2acb35934b0c4e20dbac3b6896295c.svg",jo=n.p+"55d9ef6afffbdf136dc92d802fb7f095.svg",Ao=n.p+"a1304265c1fa219ca56512c9c1c323a5.svg",Mo=n(22142);const Do=[{cover:Co,name:"基础按钮",props:{width:700,height:84,leftBottomRounded:10,rightBottomRounded:10,rightTopRounded:10,leftTopRounded:10,buttonType:"download",url:""}},{cover:jo,name:"右常驻按钮",props:{buttonType:"download",width:300,height:84,leftBottomRounded:42,leftTopRounded:42,url:""}},{cover:Ao,name:"左常驻按钮",props:{buttonType:"download",width:300,height:84,rightBottomRounded:42,rightTopRounded:42,url:""}}],No=[{cover:Io,name:"图片按钮",props:{width:700,height:84,buttonType:"download",text:"",url:(0,De.cM)({online:!1})?"material/private/de3736930ee9417e9e9afa9d5bcb2472.png":"material/private/a8434bac3cd34cfd937ae9489d814308.png"}}];function To(){return Mo.createElement(Mo.Fragment,null,Mo.createElement(Po.v,{title:"转化按钮"}),Mo.createElement(Oo.G,{groups:[{name:"图形样式",status:"loaded",expandable:!0,list:Do,total:Do.length},{name:"图片样式",status:"loaded",expandable:!0,list:No,total:No.length}]},(({list:e})=>Mo.createElement("div",{className:(0,mt.iv)({display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gridAutoRows:"auto",rowGap:"8px"})},e.map(((e,t)=>Mo.createElement(Zo.vE,{key:t,cover:e.cover,category:"Button",url:e.props.url,props:e.props,name:e.name})))))))}var Ro,Fo,Lo=n(25961),zo=n(88158),$o=n(53957),Bo=Object.defineProperty,Vo=Object.getOwnPropertySymbols,Ho=Object.prototype.hasOwnProperty,Go=Object.prototype.propertyIsEnumerable,_o=(e,t,n)=>t in e?Bo(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Uo=({name:e,Comp:t})=>{const n=(0,$o.Z)({mime:"Shape",name:e,url:e});return r.createElement("div",((e,t)=>{for(var n in t||(t={}))Ho.call(t,n)&&_o(e,n,t[n]);if(Vo)for(var n of Vo(t))Go.call(t,n)&&_o(e,n,t[n]);return e})({className:(0,mt.iv)({width:"72px",height:"72px",borderRadius:"2px",backgroundRepeat:"no-repeat",backgroundSize:"contain",backgroundPosition:"center",cursor:"pointer",marginRight:"8px",marginBottom:"8px",":nth-child(3n+3)":{marginRight:0}})},n),r.createElement(t,null))},Wo=["title","titleId"];function Ko(){return Ko=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Ko.apply(this,arguments)}var Xo,Yo,Jo=function(e,t){var n=e.title,o=e.titleId,a=function(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}(e,Wo);return r.createElement("svg",Ko({width:64,height:64,viewBox:"0 0 64 64",fill:"none",xmlns:"http://www.w3.org/2000/svg",ref:t,"aria-labelledby":o},a),n?r.createElement("title",{id:o},n):null,Ro||(Ro=r.createElement("rect",{width:64,height:64,rx:2,fill:"#F9F9F9"})),Fo||(Fo=r.createElement("circle",{cx:32.0002,cy:32.0002,r:15.0588,fill:"#2860ED"})))},qo=(0,r.forwardRef)(Jo),Qo=(n.p,["title","titleId"]);function ea(){return ea=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},ea.apply(this,arguments)}var ta,na,ra=function(e,t){var n=e.title,o=e.titleId,a=function(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}(e,Qo);return r.createElement("svg",ea({width:64,height:64,viewBox:"0 0 64 64",fill:"none",xmlns:"http://www.w3.org/2000/svg",ref:t,"aria-labelledby":o},a),n?r.createElement("title",{id:o},n):null,Xo||(Xo=r.createElement("rect",{width:64,height:64,rx:2,fill:"#F9F9F9"})),Yo||(Yo=r.createElement("rect",{x:19.7646,y:19.7646,width:24.4706,height:24.4706,fill:"#2860ED"})))},oa=(0,r.forwardRef)(ra),aa=(n.p,["title","titleId"]);function la(){return la=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},la.apply(this,arguments)}var ia=function(e,t){var n=e.title,o=e.titleId,a=function(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}(e,aa);return r.createElement("svg",la({width:64,height:64,viewBox:"0 0 64 64",fill:"none",xmlns:"http://www.w3.org/2000/svg",ref:t,"aria-labelledby":o},a),n?r.createElement("title",{id:o},n):null,ta||(ta=r.createElement("rect",{width:64,height:64,rx:2,fill:"#F9F9F9"})),na||(na=r.createElement("path",{d:"M31.5294 17.8823L46.6085 44H16.4504L31.5294 17.8823Z",fill:"#2860ED"})))},ca=(0,r.forwardRef)(ia);n.p;const sa=[{name:"circle",comp:qo},{name:"rectangle",comp:oa},{name:"triangle",comp:ca}];function da(){return r.createElement(Oo.G,{groups:[{name:"基础图形",status:"loaded",expandable:!0,list:sa,total:sa.length}]},(e=>r.createElement("div",{className:(0,mt.iv)({display:"flex",flexWrap:"wrap"})},e.list.map(((e,t)=>r.createElement(Uo,{key:t,name:e.name,Comp:e.comp}))))))}var pa=n(35001),ua=n(18765),ma=Object.defineProperty,fa=Object.getOwnPropertySymbols,ya=Object.prototype.hasOwnProperty,ga=Object.prototype.propertyIsEnumerable,ha=(e,t,n)=>t in e?ma(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,va=({title:e,content:t,props:n})=>{const o=(0,$o.Z)({mime:"Text",url:t,name:e,props:n});return r.createElement("div",((e,t)=>{for(var n in t||(t={}))ya.call(t,n)&&ha(e,n,t[n]);if(fa)for(var n of fa(t))ga.call(t,n)&&ha(e,n,t[n]);return e})({className:(0,mt.iv)({fontSize:n.fontSize/2,fontWeight:n.bold?"bold":void 0,background:"#F5F5F5",padding:12,color:n.color,borderRadius:"2px",cursor:"pointer",marginBottom:"8px",textAlign:"center",":hover":{background:"#EBEBEB"},":active":{background:"#D6D6D6"}})},o),t)};const ba=[{content:"添加标题内容",props:{fontSize:34,color:"#333333",bold:!0}},{content:"添加说明内容",props:{fontSize:26,color:"#333333"}},{content:"添加正文内容",props:{fontSize:30,color:"#333333"}}];function Ea(){return r.createElement(Oo.G,{groups:[{name:"普通文字",status:"loaded",expandable:!0,list:ba,total:ba.length}]},(e=>r.createElement(r.Fragment,null,e.list.map(((t,n)=>r.createElement(va,{key:n,title:e.name,content:t.content,props:t.props}))))))}var xa=n(10839),ka=n(72704),wa=n(92529),Sa=Object.defineProperty,Oa=Object.getOwnPropertySymbols,Za=Object.prototype.hasOwnProperty,Pa=Object.prototype.propertyIsEnumerable,Ca=(e,t,n)=>t in e?Sa(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Ia=({item:{id:e,cover:t,userId:n,name:o,previewUrl:a},provider:l,staffId:i})=>{const c=(0,wa.Z)(),s=(0,$o.Z)({mime:"Text",url:"艺术字体",name:"艺术字体",props:{fontSize:30,color:"#333333",font:a}});return r.createElement("div",((e,t)=>{for(var n in t||(t={}))Za.call(t,n)&&Ca(e,n,t[n]);if(Oa)for(var n of Oa(t))Pa.call(t,n)&&Ca(e,n,t[n]);return e})({className:(0,mt.iv)({position:"relative",borderRadius:4,cursor:"pointer",":hover>div":{display:"flex !important"}})},s),r.createElement("img",{style:{width:"100%",padding:"project"===l||"shared"===l&&i===n?"4px 32px 4px 16px":"4px 16px",height:76,objectFit:"contain"},src:t,alt:"Font Cover"}),r.createElement("div",{style:{height:"100%",width:"100%",background:"rgba(0, 0, 0, 0.1)",position:"absolute",transition:"200ms",top:0,left:0,borderRadius:4,display:"none",justifyContent:"end",alignItems:"center"}},("project"===l||"shared"===l&&i===n)&&r.createElement(ce.Z,{type:"text",onClick:t=>{t.stopPropagation(),P.Z.confirm({title:`确定删除${o}吗？`,okText:"确定",cancelText:"取消",onOk(){c("Font",l,e)}})},icon:r.createElement(oe.Z,{component:ka.Z})})))},ja=Object.defineProperty,Aa=Object.defineProperties,Ma=Object.getOwnPropertyDescriptors,Da=Object.getOwnPropertySymbols,Na=Object.prototype.hasOwnProperty,Ta=Object.prototype.propertyIsEnumerable,Ra=(e,t,n)=>t in e?ja(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Fa=(e,t)=>{for(var n in t||(t={}))Na.call(t,n)&&Ra(e,n,t[n]);if(Da)for(var n of Da(t))Ta.call(t,n)&&Ra(e,n,t[n]);return e},La=(e,t)=>Aa(e,Ma(t));const za=(0,Oo.Z)((({groupData:e,provider:t})=>{const n=(0,N.useUserInfo)();return e.list.length?r.createElement(r.Fragment,null,e.list.map(((e,o)=>r.createElement(Ia,{key:o,item:e,provider:t,staffId:null==n?void 0:n.userId})))):r.createElement(xa.Z,{image:xa.Z.PRESENTED_IMAGE_SIMPLE,description:r.createElement(r.Fragment,null,"点击本地上传",r.createElement("br",null),"丰富你的字体吧～")})}));var $a=(0,ua.Z)("Font",(e=>"public"===e.provider?r.createElement(r.Fragment,null,!e.searching&&r.createElement(Ea,null),r.createElement(za,La(Fa({},e),{groups:e.groups.map((e=>La(Fa({},e),{name:"艺术字体"})))}))):r.createElement(r.Fragment,null,r.createElement(Ea,null),r.createElement(za,La(Fa({},e),{groups:e.groups.map((e=>La(Fa({},e),{expandable:!1})))}))))),Ba=n(70983),Va=n(19091);const Ha={container:(0,mt.iv)({display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gridAutoRows:"auto",rowGap:"8px"})},Ga=(0,Oo.Z)((function({groupData:e,category:t,provider:n}){const o=(0,N.useUserInfo)(),{replacing:a}=(0,Va.Z)(),l=(0,wa.Z)();return r.createElement("div",{className:Ha.container},e.list.map((e=>r.createElement(Zo.vE,{key:e.id,materialId:e.id,provider:n,category:t,name:e.name,cover:e.cover,url:e.previewUrl,description:e.description,onDelete:a||"shared"!==n||(null==o?void 0:o.userId)!==e.userId?void 0:()=>l(t,n,e.id)}))))}));(0,ua.Z)("Material",Ga);var _a=n(86274),Ua=n(12278),Wa=n(83413),Ka=n(79428),Xa=n(22142),Ya=Object.defineProperty,Ja=Object.defineProperties,qa=Object.getOwnPropertyDescriptors,Qa=Object.getOwnPropertySymbols,el=Object.prototype.hasOwnProperty,tl=Object.prototype.propertyIsEnumerable,nl=(e,t,n)=>t in e?Ya(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,rl=e=>{const[t,n]=(0,r.useState)("");return(0,r.useEffect)((()=>{let t=!0;return(0,l.captureNode3DData)(e.cover).then((e=>{t&&n(e)})),()=>{t=!1}}),[e.cover]),Xa.createElement(Zo.vE,(o=((e,t)=>{for(var n in t||(t={}))el.call(t,n)&&nl(e,n,t[n]);if(Qa)for(var n of Qa(t))tl.call(t,n)&&nl(e,n,t[n]);return e})({},e),Ja(o,qa({cover:t}))));var o},ol=n(26995),al=Object.defineProperty,ll=Object.getOwnPropertySymbols,il=Object.prototype.hasOwnProperty,cl=Object.prototype.propertyIsEnumerable,sl=(e,t,n)=>t in e?al(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;const dl={container:(0,mt.iv)({display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gridAutoRows:"auto",rowGap:"8px"})};function pl({groupData:e,category:t,provider:n}){const{onDeleteSceneResource:o}=(0,z.aZ)("Particle3D"),l=(0,$o.Z)({mime:"ParticleSystem3D",name:"ParticleSystem3D",url:""}),i=(0,a.v9)((({project:t})=>{if("project"===n){const e=[];for(;t;){for(const n of t.scenes)"Particle3D"!==n.type||e.some((({orderId:e})=>e===n.orderId))||e.push(n);t=t.editor.prevState}return e.map((({id:e,orderId:t,name:n})=>({id:e,previewUrl:t,name:n,cover:`${t}`,userId:0})))}return e.list}),a.wU),c=(0,a.v9)((({project:e})=>e.type)),s="project"===n&&"Particle3D"===c;return r.createElement("div",{className:dl.container},s&&r.createElement("div",{style:{fontSize:11,textAlign:"center",color:"gray"}},r.createElement("div",((e,t)=>{for(var n in t||(t={}))il.call(t,n)&&sl(e,n,t[n]);if(ll)for(var n of ll(t))cl.call(t,n)&&sl(e,n,t[n]);return e})({style:{width:"72px",height:"72px",cursor:"pointer",border:"1px solid #f0f0f0",borderRadius:"2px",justifySelf:"center",background:"#eef3fe",display:"flex",justifyContent:"center",color:"#3955f6",alignItems:"center",fontSize:"1.62em"}},l),r.createElement(oe.Z,{component:ol.Z})),"空白粒子"),i.map((e=>r.createElement(rl,{key:e.id,materialId:e.id,category:t,provider:n,name:e.name,cover:e.previewUrl,url:e.previewUrl,onDelete:"project"===n?()=>{return t=this,null,n=function*(){"number"==typeof e.previewUrl&&(yield o(e.previewUrl))},new Promise(((e,r)=>{var o=e=>{try{l(n.next(e))}catch(e){r(e)}},a=e=>{try{l(n.throw(e))}catch(e){r(e)}},l=t=>t.done?e(t.value):Promise.resolve(t.value).then(o,a);l((n=n.apply(t,null)).next())}));var t,n}:void 0}))))}var ul=n(22142),ml=Object.defineProperty,fl=Object.defineProperties,yl=Object.getOwnPropertyDescriptors,gl=Object.getOwnPropertySymbols,hl=Object.prototype.hasOwnProperty,vl=Object.prototype.propertyIsEnumerable,bl=(e,t,n)=>t in e?ml(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,El=(e,t)=>{for(var n in t||(t={}))hl.call(t,n)&&bl(e,n,t[n]);if(gl)for(var n of gl(t))vl.call(t,n)&&bl(e,n,t[n]);return e};const xl=(0,Oo.Z)(pl);var kl=(0,ua.Z)("Particle3D",(e=>{return"public"===e.provider?ul.createElement(xl,El({},e)):ul.createElement("div",{style:{padding:"16px 12px 0"}},ul.createElement(pl,(t=El({},e),n={groupData:e.groups[0]},fl(t,yl(n)))));var t,n})),wl=(n(44128),n(22142)),Sl=n(1293),Ol=n(14908),Zl=n(68373),Pl=n(76637),Cl=n(28324),Il=Object.defineProperty,jl=Object.defineProperties,Al=Object.getOwnPropertyDescriptors,Ml=Object.getOwnPropertySymbols,Dl=Object.prototype.hasOwnProperty,Nl=Object.prototype.propertyIsEnumerable,Tl=(e,t,n)=>t in e?Il(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Rl=(e,t)=>{for(var n in t||(t={}))Dl.call(t,n)&&Tl(e,n,t[n]);if(Ml)for(var n of Ml(t))Nl.call(t,n)&&Tl(e,n,t[n]);return e},Fl=(e,t)=>jl(e,Al(t));const Ll=(0,Cl.ZP)((e=>({modalState:{keyword:"",categoryId:"1",sidebarType:Pl.tI.Store,dimension:Pl.Ro.D2,resourceType:Pl.KD.Component2D,previewId:0,selectedItems:[],page:1,total:0},updateModalState:t=>e((e=>({modalState:Rl(Rl({},e.modalState),t)})))}))),zl=(0,Cl.ZP)((e=>({categories:{store:[],team:[]},updateCategories:(t,n)=>e((e=>({categories:Fl(Rl({},e.categories),{[t]:n})})))}))),$l=(0,Cl.ZP)((e=>({data:[],updateData:t=>e((()=>({data:t})))}))),Bl=(0,Cl.ZP)(((e,t)=>({selectedList:[],selectedAIList:[],getSelectedList:()=>t().selectedList,getSelectedAIList:()=>t().selectedAIList,updateSelectedList:t=>e((()=>({selectedList:t}))),updateSelectedAIList:t=>e((()=>({selectedAIList:t})))}))),Vl=(0,Cl.ZP)((e=>({detail:void 0,updateDetail:t=>e((()=>({detail:t})))}))),Hl={status:Pl.d2.rest,desc:"",percent:0,error:[],finish:0,total:0},Gl=(0,Cl.ZP)(((e,t)=>({state:Hl,start:t=>e((e=>({state:Fl(Rl(Rl({},e.state),t),{status:Pl.d2.handing})}))),finishOne:()=>e((e=>({state:Fl(Rl({},e.state),{finish:e.state.finish+1})}))),errorOne:t=>e((e=>({state:Fl(Rl({},e.state),{error:[...e.state.error,t]})}))),updateImportState:t=>e((e=>({state:Rl(Rl({},e.state),t)}))),resetState:()=>e((()=>({state:Hl}))),getState:()=>t().state,onFinish:()=>e((e=>({state:Fl(Rl({},e.state),{status:Pl.d2.finish})})))}))),_l=(0,Cl.ZP)((e=>({data:[],initialFetch:!1,updateData:t=>e((e=>Rl(Rl({},e),t)))})));var Ul=n(30919),Wl=Object.defineProperty,Kl=Object.defineProperties,Xl=Object.getOwnPropertyDescriptors,Yl=Object.getOwnPropertySymbols,Jl=Object.prototype.hasOwnProperty,ql=Object.prototype.propertyIsEnumerable,Ql=(e,t,n)=>t in e?Wl(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;const ei=[{label:"2D",value:Pl.Ro.D2},{label:"3D",value:Pl.Ro.D3}],ti=[{value:Pl.KD.Component2D,name:"组件",icon:r.createElement(mo.Z,{theme:"outline",size:"22"})},{value:Pl.KD.Image,name:"图片",icon:r.createElement(vo.Z,{theme:"outline",size:"22"})},{value:Pl.KD.Video,name:"视频",icon:r.createElement(bo.Z,{theme:"outline",size:"22"})},{value:Pl.KD.Audio,name:"声音",icon:r.createElement(Eo.Z,{theme:"outline",size:"22"})},{value:Pl.KD.Effect,name:"动效",icon:r.createElement(xo.Z,{theme:"outline",size:"22"})},{value:Pl.KD.Text,name:"文字",icon:r.createElement(ko.Z,{theme:"outline",size:"22"})}],ni=[{value:Pl.KD.Component3D,name:"组件",icon:r.createElement(mo.Z,{theme:"outline",size:"22"})},{value:Pl.KD.Model,name:"模型",icon:r.createElement(yo.Z,{theme:"outline",size:"22"})},{value:Pl.KD.Particle,name:"粒子",icon:r.createElement(go.Z,{theme:"outline",size:"22"})}],ri=({value:e,name:t,icon:n,selected:o,onChangeResourceType:a})=>r.createElement("div",{key:e,style:{color:o?"blue":"unset",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",cursor:"pointer"},onClick:()=>{a(e)}},n,t);var oi=r.memo((({onFetchData:e})=>{const{sidebarType:t,keyword:n,resourceType:o,dimension:a,updateModalState:l}=Ll((e=>({sidebarType:e.modalState.sidebarType,keyword:e.modalState.keyword,resourceType:e.modalState.resourceType,dimension:e.modalState.dimension,updateModalState:e.updateModalState})),Ul.Z),i=e=>{l({categoryId:"1",resourceType:e})},c=(0,r.useMemo)((()=>a===Pl.Ro.D2?ti:ni),[a]);return t===Pl.tI.AI?null:r.createElement(r.Fragment,null,r.createElement("div",{style:{position:"relative"}},r.createElement(Ol.Z,{size:"large",style:{padding:"0 24px"}},r.createElement(Zl.ZP.Group,{options:ei,onChange:e=>{var t;t=e.target.value,l({categoryId:"1",dimension:t,resourceType:t===Pl.Ro.D2?Pl.KD.Component2D:Pl.KD.Component3D})},value:a,optionType:"button"}),r.createElement(Ol.Z,{size:"middle"},c.map((e=>{return r.createElement(ri,(t=((e,t)=>{for(var n in t||(t={}))Jl.call(t,n)&&Ql(e,n,t[n]);if(Yl)for(var n of Yl(t))ql.call(t,n)&&Ql(e,n,t[n]);return e})({},e),n={selected:o===e.value,onChangeResourceType:i},Kl(t,Xl(n))));var t,n})))),r.createElement(it.Z.Search,{style:{position:"absolute",right:"-40px",top:"50%",transform:"translate(-50%, -50%)",width:200},placeholder:"搜索关键词",allowClear:!0,value:n,onChange:e=>{l({keyword:e.target.value})},onSearch:t=>{l({keyword:t}),e({keyword:t})}})),r.createElement(de.Z,{style:{marginTop:"12px",marginBottom:0}}))})),ai=n(30013),li=n(46927),ii=n(40953),ci=n(8702),si=n(86128),di=Object.defineProperty,pi=Object.defineProperties,ui=Object.getOwnPropertyDescriptors,mi=Object.getOwnPropertySymbols,fi=Object.prototype.hasOwnProperty,yi=Object.prototype.propertyIsEnumerable,gi=(e,t,n)=>t in e?di(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;const hi=e=>{var t,n;return e.type.cid===Pl.KD.Image?r.createElement("span",{style:{fontSize:"9px"}},`${null!=(t=e.extra.width)?t:"未知"} x ${null!=(n=e.extra.height)?n:"未知"}`):null},vi=({items:e})=>r.createElement(Ol.Z,{direction:"vertical",align:"end"},e.map(((e,t)=>r.createElement("span",{key:t,style:{padding:"5px",borderRadius:"10px",backgroundColor:e.color,fontSize:"11px"}},e.label)))),bi=r.memo((({data:e,isExist:t,onEffectPreviewStart:n,onEffectPreviewEnd:o})=>{const a=(0,r.useRef)(null),l=Ll((e=>e.modalState.resourceType),Ul.Z),{updateSelectedList:i,getSelectedList:c}=Bl((e=>({updateSelectedList:e.updateSelectedList,getSelectedList:e.getSelectedList})),Ul.Z),s=Vl((e=>e.updateDetail),Ul.Z),{addViewCountMaterial:d}=(0,si.Z)(),p=[];return l===Pl.KD.Effect&&p.push({label:(0,ci.Yj)(e.type.cid),color:"#fbe0c3"}),t&&p.push({label:"已添加",color:"#ffbb98"}),r.createElement(li.Z,{key:e.id,size:"small",style:{position:"relative",borderRadius:"20px",overflow:"hidden"},onMouseEnter:t=>{l===Pl.KD.Effect&&n(t.currentTarget,e)},onMouseLeave:o,cover:r.createElement("div",{ref:a,style:{cursor:"pointer",borderRadius:"20px",width:"180px",height:"180px"},onClick:()=>{var n;n=e,t?Pe.ZP.warning("该资源已添加进项目"):c().length>=20?Pe.ZP.warning("最多同时添加20个资源"):c().some((e=>e.id===n.id))?Pe.ZP.warning("无法重复添加资源"):i([...c(),n])}},r.createElement(ii.Z,{data:e,CoverBoxRef:a}),r.createElement("div",{style:{position:"absolute",top:"0",right:"0",zIndex:10}},r.createElement(vi,{items:p})))},r.createElement(li.Z.Meta,{title:r.createElement(lr.Z.Text,{ellipsis:!0,style:{width:"130px",fontSize:"14px"}},e.name),description:hi(e)}),r.createElement(ai.Z,{style:{position:"absolute",bottom:"4px",right:"15px",cursor:"pointer"},onClick:()=>{var t;t=e,console.log("show detail:",t),d(t.id),s(t)},theme:"outline",size:"20",fill:"#f5a623"}))}));var Ei=r.memo((({showBottomLine:e})=>{const t=(0,r.useRef)(null),n=$l((e=>e.data),Ul.Z),o=_l((e=>e.data),Ul.Z),{clearIframe:a,postMessage:l}=(0,Sl.s_)(t),[i,c]=(0,r.useState)({left:0,top:0,visible:!1}),s=(0,r.useCallback)(((e,n)=>{const{offsetLeft:r,offsetTop:o}=e;console.log("!!:",r,o),c({left:r,top:o,visible:!0}),console.log("convertRikoPreviewCategory(getResourceMime(data.type.cid):",(0,ci.zI)((0,ci.PC)(n.type.cid))),t.current&&l({type:"change",url:n.previewUrl,projectType:(0,ci.zI)((0,ci.PC)(n.type.cid)),loop:!0})}),[]),d=(0,r.useCallback)((()=>{i.visible&&(c((e=>{return t=((e,t)=>{for(var n in t||(t={}))fi.call(t,n)&&gi(e,n,t[n]);if(mi)for(var n of mi(t))yi.call(t,n)&&gi(e,n,t[n]);return e})({},e),pi(t,ui({visible:!1}));var t})),a())}),[i]);return r.createElement("div",{style:{width:"100%",height:"100%",padding:"24px 0"}},r.createElement(Ol.Z,{style:{position:"relative"},wrap:!0,size:"large",align:"center"},n.map((e=>{return r.createElement(bi,{key:e.id,data:e,isExist:(t=e,o.some((e=>t.url.endsWith(e.url)||t.previewUrl.endsWith(e.url)))),onEffectPreviewEnd:d,onEffectPreviewStart:s});var t})),r.createElement("div",{style:{left:`${i.left}px`,top:`${i.top}px`,borderRadius:"20px 20px 0 0",position:"absolute",zIndex:9,visibility:i.visible?"visible":"hidden",pointerEvents:"none",overflow:"hidden"},onMouseLeave:d},r.createElement(Sl.t1,{ref:t,width:180,height:180}))),e&&r.createElement(de.Z,{plain:!0},"我是有底线的"))})),xi=n(73998),ki=n(52972),wi=n(80094),Si=n(32231),Oi=n(82641),Zi=r.memo((()=>{const{sidebarType:e,updateModalState:t}=Ll((e=>({sidebarType:e.modalState.sidebarType,updateModalState:e.updateModalState})),Ul.Z),[n,o]=(0,r.useState)(!1);return r.createElement("div",{style:{position:"relative",borderRight:"1px solid #f0f0f0"}},r.createElement("div",{style:{position:"absolute",width:"100%",padding:"6px 0",bottom:0,right:0,cursor:"pointer",color:"orange",borderTop:"1px solid #f0f0f0"},onClick:()=>{o(!n)}},r.createElement("div",{className:(0,mt.iv)({display:"flex",alignItems:"center",padding:"6px 12px","&:hover":{background:"#f0f0f0"}})},n?r.createElement(r.Fragment,null,r.createElement(oe.Z,{style:{fontSize:"18px"},component:Si.Z}),r.createElement("span",{style:{marginLeft:"5px"}},"展开")):r.createElement(r.Fragment,null,r.createElement(oe.Z,{style:{fontSize:"18px"},component:Oi.Z}),r.createElement("span",{style:{marginLeft:"5px"}},"收起")))),r.createElement(F.Z,{selectedKeys:[(e=>{switch(e){case Pl.tI.Store:return"1";case Pl.tI.Team:return"2";case Pl.tI.AI:return"3";default:return"1"}})(e)],mode:"inline",inlineCollapsed:n,items:(a=e,[{key:"1",icon:r.createElement(oe.Z,{style:{color:"orange"},component:xi.Z}),label:r.createElement("span",{style:{color:a===Pl.tI.Store?"orange":"black"}},"资源商城"),title:"资源商城"},{key:"2",icon:r.createElement(oe.Z,{style:{color:"orange"},component:ki.Z}),label:r.createElement("span",{style:{color:a===Pl.tI.Team?"orange":"black"}},"团队资源"),title:"团队资源"},{key:"3",icon:r.createElement(oe.Z,{style:{color:"orange"},component:wi.Z}),label:r.createElement("span",{style:{color:a===Pl.tI.AI?"orange":"black"}},"AI 工具"),title:"AI 工具"}]),onClick:e=>{t({categoryId:"1",sidebarType:"1"===e.key?Pl.tI.Store:"2"===e.key?Pl.tI.Team:Pl.tI.AI})}}));var a})),Pi=Object.defineProperty,Ci=Object.getOwnPropertySymbols,Ii=Object.prototype.hasOwnProperty,ji=Object.prototype.propertyIsEnumerable,Ai=(e,t,n)=>t in e?Pi(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Mi=(e,t)=>{for(var n in t||(t={}))Ii.call(t,n)&&Ai(e,n,t[n]);if(Ci)for(var n of Ci(t))ji.call(t,n)&&Ai(e,n,t[n]);return e};const Di=({data:e})=>{var t;const n=null!=(t=e.extra)?t:{},{ext:o,size:a,width:l,height:i,usedCount:c,viewDetailCount:s}=n;return r.createElement("div",{style:{width:"250px",position:"relative",maxHeight:"650px",overflowY:"scroll",padding:"10px 20px",backgroundColor:"#00000087",color:"white"}},(0,Ne.isEmpty)(n)?r.createElement(xa.Z,{description:"无额外信息",style:{position:"absolute",left:"50%",top:"50%",transform:"translate(-50%,-50%)"}}):r.createElement(r.Fragment,null,r.createElement("p",null,"名称：",e.name),o&&r.createElement("p",null,"格式：",o),a&&r.createElement("p",null,"大小：",function(e){if(e=Number(e),isNaN(e))return"";let t=Math.floor(Math.log(e)/Math.log(2));t<1&&(t=0);const n=Math.floor(t/10);return(e/=Math.pow(2,10*n)).toString().length>e.toFixed(2).toString().length&&(e=e.toFixed(2)),`${e} ${["B","KB","MB","GB","TB","PB","EB","ZB","YB"][n]}`}(a)),l&&i&&r.createElement("p",null,"分辨率：",e.extra.width," * ",e.extra.height),c&&r.createElement("p",null,"使用次数：",c),s&&r.createElement("p",null,"查看次数：",s)))};var Ni=r.memo((()=>{const e=(0,r.useRef)(null),t=(0,r.useRef)(null),{detail:n,updateDetail:o}=((0,r.useRef)(null),Vl((e=>e),Ul.Z)),[a,l]=(0,r.useState)({width:"450px",height:"450px"}),{postMessage:i}=(0,Sl.s_)(t);(0,r.useEffect)((()=>{n&&(0,ci.Nm)({id:n.type.cid})&&c(n)}),[n]);const c=e=>{var n,r;l({width:"450px",height:"450px"}),e&&(null==(r=null==(n=t.current)?void 0:n.contentWindow)||r.postMessage(JSON.stringify({type:"change",url:e.previewUrl,projectType:(0,ci.zI)((0,ci.PC)(e.type.cid)),loop:!0}),"*"))};return r.createElement(P.Z,{title:null,className:(0,mt.iv)({".ant-modal-content":{overflow:"hidden"},".ant-modal-body":{padding:"0"}}),width:"auto",zIndex:2e3,getContainer:!1,closable:!1,visible:void 0!==n,footer:null,centered:!0,onCancel:()=>{o(void 0)}},n?r.createElement("div",{style:{display:"flex"}},r.createElement("div",{ref:e,style:Mi({},a)},r.createElement("iframe",{ref:t,src:(0,De.cM)({release:!0})?"https://magicplay.oceanengine.com/static-cloud/invoke/riko_player?type=preload":["https://local-clab.","bytedance",".net/static-cloud/invoke/riko_player?type=preload"].join(""),allow:"autoplay",frameBorder:"0",style:{position:(0,ci.Nm)({id:n.type.cid})?"relative":"absolute",width:(0,ci.Nm)({id:n.type.cid})?"100%":"0px",height:(0,ci.Nm)({id:n.type.cid})?"100%":"0px",left:(0,ci.Nm)({id:n.type.cid})?"0":"9999px",visibility:(0,ci.Nm)({id:n.type.cid})?"visible":"hidden"},onLoad:()=>{(0,ci.Nm)({id:n.type.cid})&&c(n)}}),!(0,ci.Nm)({id:n.type.cid})&&r.createElement(ii.Z,{data:n,CoverBoxRef:e,customStyle:{width:"100%",height:"100%"},onLoad:e=>{const t=e instanceof HTMLImageElement||e instanceof HTMLVideoElement?650:450;let n=t,r=t;e instanceof HTMLImageElement?(n=e.naturalWidth,r=e.naturalHeight):e instanceof HTMLVideoElement&&(n=e.videoWidth,r=e.videoHeight),console.log("!!:",n,r);const o=n/r;l({width:`${Math.max(n>r?t:o*t,300)}px`,height:`${Math.max(n>r?t/o:t,300)}px`})}})),r.createElement(Di,{data:n})):null)})),Ti=n(51665),Ri=n(66305),Fi=n(50585),Li=n(61645),zi=(e,t,n)=>new Promise(((r,o)=>{var a=e=>{try{i(n.next(e))}catch(e){o(e)}},l=e=>{try{i(n.throw(e))}catch(e){o(e)}},i=e=>e.done?r(e.value):Promise.resolve(e.value).then(a,l);i((n=n.apply(e,t)).next())})),$i=(e,t,n)=>new Promise(((r,o)=>{var a=e=>{try{i(n.next(e))}catch(e){o(e)}},l=e=>{try{i(n.throw(e))}catch(e){o(e)}},i=e=>e.done?r(e.value):Promise.resolve(e.value).then(a,l);i((n=n.apply(e,t)).next())}));const Bi=({data:e,onDeleteSelected:t})=>{const n=(0,r.useRef)(null),o=Vl((e=>e.updateDetail),Ul.Z);return r.createElement("div",{key:e.id,style:{position:"relative",borderRadius:"10px",backgroundColor:"#FFF1E9",padding:"10px"}},r.createElement(Ti.Z,{theme:"outline",size:"20",fill:"#f5a623",style:{position:"absolute",top:"-10px",right:"-10px",color:"red",cursor:"pointer"},onClick:()=>{t([e.id])}}),r.createElement(Ol.Z,{direction:"vertical"},r.createElement("div",{style:{width:"50px",height:"50px",cursor:"pointer"},onClick:()=>{o(e)}},r.createElement(ii.Z,{ref:n,data:e,CoverBoxRef:n,playIcon:null})),r.createElement("div",{style:{position:"absolute",right:0,bottom:0,padding:"0 8px",borderRadius:"4px 0 4px 0",backgroundColor:"rgba(57, 85, 246,.8)",lineHeight:"20px",fontSize:"12px",color:"#fff"}},(0,ci.Yj)(e.type.cid))))},Vi=({data:e,onDeleteSelected:t})=>r.createElement("div",{key:e.url,style:{position:"relative",borderRadius:"10px",backgroundColor:"#FFF1E9",padding:"10px"}},r.createElement(Ti.Z,{theme:"outline",size:"20",fill:"#f5a623",style:{position:"absolute",top:"-10px",right:"-10px",color:"red",cursor:"pointer"},onClick:()=>{t(e.url)}}),r.createElement(Ol.Z,{direction:"vertical"},r.createElement("div",{style:{width:"50px",height:"50px",cursor:"pointer"}},r.createElement(Ri.Z,{style:{width:"100%",height:"100%",objectFit:"cover"},src:e.url})),r.createElement("div",{style:{position:"absolute",right:0,bottom:0,padding:"0 8px",borderRadius:"4px 0 4px 0",backgroundColor:"rgba(57, 85, 246,.8)",lineHeight:"20px",fontSize:"12px",color:"#fff"}},"AI生成")));var Hi=r.memo((()=>{const[e,t]=(0,r.useState)(!0),[n,o]=(0,r.useState)(!1),l=(0,a.v9)((e=>e.project.settings.enabled3d)),{selectedList:i,selectedAIList:c,getSelectedList:s,getSelectedAIList:d,updateSelectedList:p,updateSelectedAIList:u}=Bl((e=>({selectedList:e.selectedList,selectedAIList:e.selectedAIList,getSelectedList:e.getSelectedList,getSelectedAIList:e.getSelectedAIList,updateSelectedList:e.updateSelectedList,updateSelectedAIList:e.updateSelectedAIList})),Ul.Z),{uploadNormalMaterial:m,uploadSceneMaterial:f,uploadAIImage:y}=(()=>{const{dispatch:e}=(0,a.oR)(),t=(0,a.v9)((({project:e})=>e),a.wU),{settings:n}=t,r=(0,N.useProject)("id");return{uploadAIImage:e=>zi(void 0,null,(function*(){return yield(0,Te.SN)({projectId:t.id,file:e,type:5})})),uploadNormalMaterial:e=>zi(void 0,null,(function*(){return yield(0,Li.R7)(r,e)})),uploadSceneMaterial:r=>zi(void 0,null,(function*(){const o={success:[],exists:[],materials:[]};for(let a=0;a<r.length;a++){const l=r[a],i=yield(0,R.sH)(t,l.url);i.props[i.id].name=i.name=l.name,i.editor.store=n.store,i.editor.capture=l.cover;const c=yield(0,Fi.E)(t,i,!0);console.log("newComponent:",c),e((0,N.addComponent)(c)),o.success.push(c)}return o}))}})(),g=(0,N.useAddNode)(),h=(0,N.useAddNodeWith3D)(),{updateImportState:v,finishOne:b,errorOne:E,start:x,resetState:k,getState:w,onFinish:S}=Gl(),{addUsedCountMaterial:O}=(0,si.Z)(),Z=e=>{p(s().filter((t=>!e.includes(t.id))))},P=e=>{u(d().filter((t=>t.url!==e)))},C=(e,t,n)=>(e.then((e=>{console.log("res:",e),t()})).catch((e=>{console.log(e.message),E(`${n}：${e.message||e.msg||"未知原因"}`)})),e),j=e=>$i(void 0,null,(function*(){return yield h(e.mime,(()=>$i(this,null,(function*(){return yield g({mime:e.mime,name:e.name,url:e.url,edit3d:l&&(0,ci.rI)({mime:e.mime})},!0)}))))}));return 0===[...i,...c].length?null:r.createElement("div",{style:{borderTop:"1px solid #f0f0f0",width:"100%",bottom:"0"}},r.createElement(Ol.Z,{style:{width:"100%",padding:"12px",overflowX:"scroll"}},i.map((e=>r.createElement(Bi,{key:e.id,data:e,onDeleteSelected:Z}))),c.map((e=>r.createElement(Vi,{key:e.url,data:e,onDeleteSelected:P})))),r.createElement(de.Z,{style:{margin:"0"}}),r.createElement("div",{style:{display:"flex",justifyContent:"right"}},r.createElement(Ol.Z,{style:{padding:"12px"}},r.createElement(I.Z,{checked:e,onChange:e=>{t(e.target.checked)}},"同时添加进场景"),r.createElement(ce.Z,{style:{position:"relative"},loading:n,onClick:()=>$i(void 0,null,(function*(){o(!0);const t=i.filter((e=>(0,ci.dI)(e.type.cid))),n=i.filter((e=>(0,ci.Fo)(e.type.cid)));x({desc:"开始上传",finish:0,total:t.length+n.length+c.length}),console.log("sceneMaterial:",n);try{const r=yield Promise.all(t.map((e=>C(m([e.id]),(()=>{b(),O(e.id),Z([e.id])}),`${e.name}导入失败`)))),a=[];for(let e=0;e<n.length;e++){const t=n[e],r=yield C(f([{url:t.previewUrl,cover:t.cover,name:t.name}]),(()=>{b(),O(t.id),Z([t.id])}),`${t.name}导入失败`);a.push(r)}const l=yield Promise.all(c.map((e=>C(y(e.file),(()=>{b(),P(e.url)}),"AI 图片导入失败"))));if(e){v({desc:"正在将资源添加进场景..."});const e=r.reduce(((e,t)=>[...e,...t.success]),[]);yield Promise.all(e.map((e=>C(j({mime:(0,ci.PC)(e.type),name:e.name,url:e.previewUrl}),(()=>{console.log("添加节点成功")}),`${e.name}添加到场景失败`))));const t=a.reduce(((e,t)=>[...e,...t.success]),[]);yield Promise.all(t.map((e=>C(j({mime:e.type,name:e.name,url:e.orderId}),(()=>{console.log("添加节点成功")}),`${e.name}添加到场景失败`)))),yield Promise.all(l.map((e=>C(j({mime:"Sprite",name:e.name,url:e.url}),(()=>{console.log("添加节点成功")}),`${e.name}添加到场景失败`))))}0===w().error.length?(Pe.ZP.success("资源全部添加成功"),p([]),k(),Ec.hideModal()):S()}catch(e){E("资源异常，剩余资源操作均已终止"),S()}finally{o(!1)}}))},"确认添加",0!==[...i,...c].length&&r.createElement("span",{style:{position:"absolute",top:"-7px",right:"-7px",width:"22px",borderRadius:"22px",fontSize:"11px",color:"white",backgroundColor:"red"}},[...i,...c].length)),r.createElement(ce.Z,{disabled:n,onClick:()=>{p([])}},"清除"))))})),Gi=n(99674),_i=r.memo((()=>{const{categoryId:e,sidebarType:t,resourceType:n,updateModalState:o}=Ll((e=>({resourceType:e.modalState.resourceType,categoryId:e.modalState.categoryId,sidebarType:e.modalState.sidebarType,updateModalState:e.updateModalState})),Ul.Z),{categories:{team:a,store:l},updateCategories:i}=zl((e=>e));(0,r.useEffect)((()=>{t===Pl.tI.Store&&c(n)}),[n,t]);const c=e=>{return void 0,null,t=function*(){o({categoryId:"1"});try{const t=yield(0,Gi.n3)(e);i("store",t)}catch(e){Pe.ZP.error(`查询商城资源分类错误:${e.message}`),i("store",[])}},new Promise(((e,n)=>{var r=e=>{try{a(t.next(e))}catch(e){n(e)}},o=e=>{try{a(t.throw(e))}catch(e){n(e)}},a=t=>t.done?e(t.value):Promise.resolve(t.value).then(r,o);a((t=t.apply(undefined,null)).next())}));var t};if(t===Pl.tI.Store&&0===l.length)return null;if(t===Pl.tI.Team)return null;const s=t===Pl.tI.Store?[{id:"1",name:"全部"},...l.map((e=>({id:e.id,name:e.name})))]:a.map((e=>({id:e.id,name:e.name}))).filter((e=>"回收站"!==e.name));return r.createElement(Ol.Z,{style:{padding:"10px 24px",overflowX:"scroll"}},s.map((t=>r.createElement("span",{style:{display:"inline-block",padding:"2px 5px",borderRadius:"5px",border:"1px solid",backgroundColor:e===t.id?"orange":"white",borderColor:e===t.id?"orange":"gray",cursor:"pointer"},onClick:()=>{var e;e=t.id,o({categoryId:e})}},t.name))))})),Ui=n(62441),Wi=n(60837),Ki=n(22142),Xi=e=>{const{state:t,updateImportState:n,resetState:r}=Gl(),o=()=>{r()},a=Ki.createElement(Ui.ZP,{status:"warning",title:Ki.createElement("div",{style:{width:"600px",maxHeight:"200px",overflowY:"scroll",overflowX:"scroll"}},t.error.map((e=>Ki.createElement("p",{style:{fontSize:"14px"}},Ki.createElement(lr.Z.Text,{type:"warning"},e))))),extra:Ki.createElement(ce.Z,{type:"primary",key:"console",onClick:o},"关闭")}),l=Ki.createElement(Ki.Fragment,null,Ki.createElement(j.Z,null),Ki.createElement(Wi.Z,{style:{width:"80%"},percent:Math.floor(t.finish/t.total*100),status:"active"}),Ki.createElement("p",null,t.desc,":",t.finish,"/",t.total));return Ki.createElement(P.Z,{title:null,className:(0,mt.iv)({".ant-modal-body":{padding:"0"}}),width:"auto",zIndex:2e3,getContainer:!1,closable:!1,destroyOnClose:!0,visible:t.status!==Pl.d2.rest,footer:null,centered:!0,onCancel:o},Ki.createElement("div",{style:{width:"800px",height:"400px",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"}},t.status===Pl.d2.handing&&l,t.status===Pl.d2.finish&&a))},Yi=n(2961),Ji=n(16969),qi=n(88902),Qi=n(22142),ec=(e,t,n)=>new Promise(((r,o)=>{var a=e=>{try{i(n.next(e))}catch(e){o(e)}},l=e=>{try{i(n.throw(e))}catch(e){o(e)}},i=e=>e.done?r(e.value):Promise.resolve(e.value).then(a,l);i((n=n.apply(e,t)).next())}));const tc=I.Z.Group,nc={Sun:"太阳",Earth:"地球",Moon:"月球",Sky:"天空",Tree:"树",River:"河流",Mountain:"山脉",Ocean:"海洋",Beach:"海滩",Forest:"森林",Flower:"花",Grass:"草",Rock:"岩石",Lake:"湖泊",Rain:"雨",Snow:"雪",Cloud:"云",Storm:"暴风雨",Thunder:"雷声",Lightning:"闪电",Volcano:"火山",Waterfall:"瀑布",Stream:"小溪",Valley:"山谷",Desert:"沙漠",Iceberg:"冰山",Aurora:"极光",Rainbow:"彩虹",Fog:"雾",Sunlight:"阳光",Raindrop:"雨滴",Dew:"露珠",Hail:"冰雹",Snowflake:"雪花",Mist:"薄雾",Breeze:"微风",Wind:"风",Hurricane:"飓风",Typhoon:"台风",Tornado:"龙卷风",Earthquake:"地震",Tsunami:"海啸",Flood:"洪水",Wildfire:"野火",Blizzard:"暴风雪",Landslide:"山崩","Tree trunk":"树干","Tree bark":"树皮","Tree leaves":"树叶","Tree branch":"树枝","Tree root":"树根","Flower petal":"花瓣","Flower stem":"花茎","Flower bud":"花蕾","Grass blade":"草刺","Grass seed":"草种","Mountain peak":"山峰","Mountain range":"山脉","Mountain trail":"山径","Ocean wave":"海浪","Ocean current":"海流","Ocean tide":"潮汐","Ocean depth":"海洋深度","Beach sand":"沙滩","Beach shell":"海贝壳","Beach rock":"海岸岩石","Forest canopy":"森林冠层","Forest floor":"森林地面","Forest animals":"森林动物"},rc={"game art":"游戏艺术","oil painting":"油画","fantasy vivid colors":"色彩动人",photorealistic:"照片"},oc=()=>{const{selectedAIList:e,updateSelectedAIList:t}=Bl(),[n,o]=(0,r.useState)([]),[a]=Yi.Z.useForm(),[l,i]=(0,r.useState)(!1);return Qi.createElement(Qi.Fragment,null,Qi.createElement(Yi.Z,{form:a,labelCol:{span:3},wrapperCol:{span:12}},Qi.createElement(Yi.Z.Item,{name:"keywords1",label:"风格"},Qi.createElement(tc,{options:Object.entries(rc).map((([e,t])=>({label:t,value:e})))})),Qi.createElement(Yi.Z.Item,{name:"keywords2",label:"预设关键词"},Qi.createElement(pe.Z,{mode:"multiple",placeholder:"预设关键词",allowClear:!0,options:Object.entries(nc).map((([e,t])=>({label:t,value:e})))})),Qi.createElement(Yi.Z.Item,{name:"keywords3",label:"自定义关键词"},Qi.createElement(pe.Z,{mode:"tags",placeholder:"自定义关键词（英文）",allowClear:!0})),Qi.createElement(Yi.Z.Item,{colon:!1,label:Qi.createElement(ce.Z,{type:"primary",loading:l,onClick:()=>{a.validateFields().then((e=>ec(void 0,null,(function*(){var t,n;try{i(!0);const{keywords1:r=[],keywords2:a=[],keywords3:l=[]}=e,{data:{data:c}}=yield(0,Gi.$d)([[...r,...a,...l].join(",")]);if(!(null==(n=null==(t=null==c?void 0:c.images)?void 0:t[0])?void 0:n.data))throw new Error("图像生成失败，请重新尝试");{const e=new File([new Blob([new Uint8Array(c.images[0].data).buffer])],"未命名AI"),t=URL.createObjectURL(e);o([{file:e,url:t}])}}catch(e){Pe.ZP.error(e.message)}finally{i(!1)}}))))}},0===n.length?"生成图片":"换一种")})),Qi.createElement(Ol.Z,null,n.map((n=>Qi.createElement("img",{src:n.url,onClick:()=>{t([...e,n])},style:{cursor:"pointer",width:"240px",height:"240px",objectFit:"cover"},alt:""})))))},ac=()=>{const{selectedAIList:e,updateSelectedAIList:t}=Bl(),[n,o]=(0,r.useState)(),[a,l]=(0,r.useState)(),[i,c]=(0,r.useState)(),[s,d]=(0,r.useState)(!1),p=Qi.createElement("div",null,Qi.createElement(le.Z,null),Qi.createElement("div",{style:{marginTop:8}},"点击上传图片"));return Qi.createElement(Ol.Z,null,Qi.createElement("div",{className:(0,mt.iv)({width:"300px",".ant-upload.ant-upload-select":{width:"300px !important",height:"350px !important"}})},Qi.createElement(Ji.Z,{name:"avatar",listType:"picture-card",className:"avatar-uploader",showUploadList:!1,beforeUpload:e=>ec(void 0,null,(function*(){if("image/jpeg"===e.type||"image/png"===e.type)return console.log("file:",e),o({file:e,url:URL.createObjectURL(e)}),!1;Pe.ZP.error("只接受 jpeg/png 格式图片")}))},n?Qi.createElement("img",{src:n.url,alt:"avatar",style:{width:"100%"}}):p),Qi.createElement(pe.Z,{style:{width:"300px"},value:i,mode:"tags",placeholder:"自定义关键词（英文）",allowClear:!0,onChange:e=>{c(e)}})),Qi.createElement(ce.Z,{type:"primary",loading:s,onClick:()=>ec(void 0,null,(function*(){var e,t;if(n)try{d(!0);const{data:{data:r}}=yield(0,Gi.mK)(n.file,null!=i?i:"");if(console.log("data:",r),!(null==(t=null==(e=null==r?void 0:r.images)?void 0:e[0])?void 0:t.data))throw new Error("图像生成失败，请重新尝试");{const e=new File([new Blob([new Uint8Array(r.images[0].data).buffer])],"未命名AI");l({file:e,url:URL.createObjectURL(e)})}}catch(e){Pe.ZP.error(e.message)}finally{d(!1)}else Pe.ZP.warning("缺少原始图片")}))},"点击转化"),a&&Qi.createElement(Qi.Fragment,null,Qi.createElement(Ri.Z,{src:a.url,style:{visibility:a?"visible":"hidden",width:"300px",height:"350px",objectFit:"cover",cursor:"pointer"}}),Qi.createElement(ce.Z,{type:"primary",loading:s,onClick:()=>{a&&t([...e,a])}},"添加")))};var lc=()=>Qi.createElement("div",{style:{position:"relative",height:"100%",width:"100%"}},Qi.createElement(qi.Z,{style:{padding:"0 20px"},defaultActiveKey:"1",onChange:e=>{console.log(e)},items:[{label:"关键词生成",key:"1",children:Qi.createElement(oc,null)},{label:"图片转化",key:"2",children:Qi.createElement(ac,null)}]}));const ic=(0,Ne.debounce)((e=>{console.log("onIncreasePage2"),e()}),1500,{leading:!0,trailing:!1});var cc=Object.defineProperty,sc=Object.defineProperties,dc=Object.getOwnPropertyDescriptors,pc=Object.getOwnPropertySymbols,uc=Object.prototype.hasOwnProperty,mc=Object.prototype.propertyIsEnumerable,fc=(e,t,n)=>t in e?cc(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,yc=(e,t)=>{for(var n in t||(t={}))uc.call(t,n)&&fc(e,n,t[n]);if(pc)for(var n of pc(t))mc.call(t,n)&&fc(e,n,t[n]);return e},gc=(e,t)=>sc(e,dc(t)),hc=(e,t,n)=>new Promise(((r,o)=>{var a=e=>{try{i(n.next(e))}catch(e){o(e)}},l=e=>{try{i(n.throw(e))}catch(e){o(e)}},i=e=>e.done?r(e.value):Promise.resolve(e.value).then(a,l);i((n=n.apply(e,t)).next())})),vc=r.memo((()=>{const e=(0,N.useProject)("id"),{modalState:t,updateModalState:n}=Ll((e=>({modalState:e.modalState,updateModalState:e.updateModalState}))),{dimension:o,resourceType:a,sidebarType:l,categoryId:i}=t,{data:c,updateData:s}=$l(),{updateData:d,initialFetch:p}=_l(),{request:u,state:m,getProjectMaterials:f}=(0,si.Z)(),y=Gl((e=>e.state.status),Ul.Z),[g,h]=(0,r.useState)(!1),v=(0,r.useRef)(null),b=()=>({keyword:t.keyword,categoryId:t.categoryId,sidebarType:t.sidebarType,page:t.page,pageSize:60,type:t.resourceType}),E=(0,r.useCallback)((()=>hc(void 0,null,(function*(){try{if(g)return;const e=gc(yc({},b()),{page:t.page+1}),r=yield u(e);s([...c,...r.data]),n({total:r.pagination.total,page:e.page})}catch(e){Pe.ZP.error(e.message)}}))),[t,g]);((e,t)=>{(0,r.useEffect)((()=>{if(!e)return;const n=()=>{const{scrollHeight:n,clientHeight:r,scrollTop:o}=e,a=n-(o+r);a>0&&a<10&&t&&ic(t)};return e.addEventListener("scroll",n),()=>{e.removeEventListener("scroll",n)}}),[e,t])})(v.current,E),(0,r.useEffect)((()=>{y!==Pl.d2.finish&&!1!==p||f(e).then((e=>{console.log("!@33:",y,e),d({data:e.data,initialFetch:!0})}))}),[y,p]),(0,r.useEffect)((()=>{c.length===t.total&&h(!0)}),[c,t.total]),(0,r.useEffect)((()=>{h(!1),x()}),[o,a,l,i]);const x=(0,r.useCallback)((e=>hc(void 0,null,(function*(){console.log("modalState!:",t);try{s([]);const t=yc(gc(yc({},b()),{page:1}),e),r=yield u(t);console.log("res:",r),s(r.data),n({total:r.pagination.total,page:t.page})}catch(e){console.log("error:",e),Pe.ZP.error(e.message)}}))),[t,u]),k=r.createElement(r.Fragment,null,r.createElement(_i,null),r.createElement("div",{ref:v,style:{height:"100%",overflowY:"scroll",margin:"0 0 20px 20px",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center"}},0===c.length?!m.loading&&r.createElement(xa.Z,null):r.createElement(Ei,{showBottomLine:g&&t.page>1})),m.loading===a&&r.createElement(j.Z,{style:0===c.length?{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)"}:{marginTop:"20px"},tip:"加载中..."}));return r.createElement("div",{id:"container"},r.createElement(Xi,null),r.createElement(oi,{onFetchData:x}),r.createElement("div",{style:{display:"flex"}},r.createElement(Zi,null),r.createElement("div",{style:{position:"relative",display:"flex",flexDirection:"column",height:"70vh",flex:1,width:"0"}},l===Pl.tI.AI?r.createElement(lc,null):k,r.createElement(Hi,null)),r.createElement(Ni,null)))})),bc=n(22142);const Ec={showModal:()=>{throw new Error("Empty function")},hideModal:()=>{throw new Error("Empty function")}};var xc=()=>{const[e,t]=(0,r.useState)(!1),n=()=>{t(!1)};return Ec.showModal=()=>{t(!0)},Ec.hideModal=n,console.log("Modal:",e),bc.createElement(P.Z,{style:{padding:"12px 0"},className:(0,mt.iv)({".ant-modal-content":{padding:"0"},".ant-modal-body":{padding:"12px 0 0 0"}}),title:null,visible:e,onCancel:n,width:1200,footer:!1,destroyOnClose:!0},bc.createElement(vc,null))};const kc={scroll:(0,mt.iv)({overflow:"auto",scrollbarWidth:"none","&::-webkit-scrollbar":{display:"none"}}),side:(0,mt.iv)({flex:"0 0 48px",position:"relative",zIndex:1}),menu:(0,mt.iv)({display:"flex",height:"100%",flexDirection:"column"}),item:(0,mt.iv)({flex:"none",display:"flex",justifyContent:"center",flexDirection:"column",alignItems:"center",cursor:"pointer",padding:"8px 0","&-active":{fontWeight:"bold",color:"blue"}}),content:(0,mt.iv)({width:"256px",position:"absolute",height:"100%",right:0,top:0,transform:"translateX(100%)",boxShadow:"4px 2px 6px -3px rgba(0,0,0,0.08)"})};function wc(){const{propsMode:e}=(0,N.useEditor)(0,"propsMode"),t=(0,N.useSettings)("typeOfPlay"),{edit3d:n}=(0,N.useEditor)("edit3d"),o=(0,N.useProject)("type"),l=(0,a.I0)(),i=(0,a.v9)((e=>e.resource.category)),s=(0,r.useMemo)((()=>(({type:e,edit3d:t,typeOfPlay:n,propsMode:r})=>t?"Product"===r?[{key:"Animation",hide:["Model","Particle3D"].includes(e),comp:wl.createElement(Wa.Z,null),name:"组件",icon:wl.createElement(mo.Z,{theme:"outline",size:"22"})}]:[{key:"Animation",hide:["Model","Particle3D"].includes(e),comp:wl.createElement(Wa.Z,null),name:"组件",icon:wl.createElement(mo.Z,{theme:"outline",size:"22"})},{key:"Basic3D",hide:["Particle3D"].includes(e),comp:wl.createElement(Ka.Z,null),name:"基础",icon:wl.createElement(fo.Z,{theme:"outline",size:"22"})},{key:"Model",hide:["Particle3D"].includes(e),comp:wl.createElement(Ua.Z,null),name:"模型",icon:wl.createElement(yo.Z,{theme:"outline",size:"22"})},{key:"Particle3D",comp:wl.createElement(kl,null),name:"粒子",icon:wl.createElement(go.Z,{theme:"outline",size:"22"})},{key:"Cubemaps",hide:"Project"!==e,comp:wl.createElement(_a.Z,null),name:"天空盒",icon:wl.createElement(ho.Z,{theme:"outline",size:"22"})}].filter((({hide:e=!1})=>!e)):[{key:"Animation",comp:wl.createElement(Lo.Z,null),name:"组件",icon:wl.createElement(mo.Z,{theme:"outline",size:"22"})},{key:"Sprite",comp:wl.createElement(zo.Z,null),name:"图片",icon:wl.createElement(vo.Z,{theme:"outline",size:"22"})},{key:"Video",comp:wl.createElement(Ba.ZP,null),name:"视频",icon:wl.createElement(bo.Z,{theme:"outline",size:"22"})},{key:"Sound",comp:wl.createElement(pa.Z,null),name:"声音",icon:wl.createElement(Eo.Z,{theme:"outline",size:"22"})},{key:"effect",comp:wl.createElement(Po.Z,null),name:"动效",icon:wl.createElement(xo.Z,{theme:"outline",size:"22"})},{key:"Text",comp:wl.createElement($a,null),name:"文字",icon:wl.createElement(ko.Z,{theme:"outline",size:"22"})},{key:"Shape",comp:wl.createElement(da,null),name:"图形",icon:wl.createElement(wo.Z,{theme:"outline",size:"22"})},{key:"Button",hide:0!==n,comp:wl.createElement(To,null),name:"转化",icon:wl.createElement(So.Z,{theme:"outline",size:"22"}),tips:{title:"新增转化按钮",content:"“APP下载”事件已下线，新增“转化”按钮，直接使用即可实现“APP下载”事件部署，无需编排事件。"}}].filter((({hide:e=!1})=>!e)))({type:o,edit3d:n,typeOfPlay:t,propsMode:e})),[o,n,t,e]),d=s.find((({key:e})=>e===i)),{token:p}=c.Z.useToken();return r.createElement("div",{className:kc.side},r.createElement("div",{className:(0,mt.cx)(kc.menu,kc.scroll,(0,mt.iv)({background:p.colorBgLayout})),id:po.mA},s.map((({key:e,icon:t,name:n,tips:o})=>{const a=r.createElement("div",{key:e,className:(0,R.xG)({[kc.item]:{active:i===e}}),onClick:()=>{"Shape"!==e&&"Button"!==e||(0,R.r3)(R.GM.SelectResource,{type:e}),l((0,N.changeCategory)(e===i?"":e))}},t,r.createElement("div",null,n));return o?r.createElement(uo.Z,{key:e,placement:"right",title:o.title,content:o.content,visibleKey:`${e}ResourceTips`},a):a})),r.createElement("div",{style:{color:"blue",marginTop:"auto"},className:kc.item,onClick:()=>{Ec.showModal}},r.createElement(so.Z,{theme:"outline",size:"22"}),r.createElement("div",null,"资源库"))),d&&r.createElement(r.Fragment,null,r.createElement("div",{className:(0,mt.cx)(kc.content,kc.scroll,(0,mt.iv)({background:p.colorBgContainer}))},d.comp),r.createElement(ce.Z,{size:"small",icon:r.createElement(oe.Z,{component:oo.Z}),type:"default",style:{position:"absolute",border:"none",borderRadius:"0 4px 4px 0",top:0,right:-256,transform:"translate(100%)"},onClick:()=>l((0,N.changeCategory)(""))})),r.createElement(Sl.ZP,{content:null==d?void 0:d.comp}))}var Sc=n(60439),Oc=n(88460),Zc=n(47910),Pc=n.n(Zc),Cc=n(12031),Ic=Object.defineProperty,jc=Object.defineProperties,Ac=Object.getOwnPropertyDescriptors,Mc=Object.getOwnPropertySymbols,Dc=Object.prototype.hasOwnProperty,Nc=Object.prototype.propertyIsEnumerable,Tc=(e,t,n)=>t in e?Ic(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Rc=(e,t)=>{for(var n in t||(t={}))Dc.call(t,n)&&Tc(e,n,t[n]);if(Mc)for(var n of Mc(t))Nc.call(t,n)&&Tc(e,n,t[n]);return e},Fc=(e,t)=>jc(e,Ac(t));ge().extend(Pc());var Lc=(0,r.memo)((function(){const{selectedSceneId:e}=(0,N.useEditor)(0,"selectedSceneId"),{loading:t,histories:n}=(0,Oc.ZP)(e),[o,a]=(0,r.useState)(null);return r.createElement("div",{className:(0,mt.iv)({boxSizing:"border-box",flex:"0 0 164px",maxWidth:"164px",display:"flex",flexDirection:"column",alignItems:"center",overflowY:"hidden",padding:"0 10px","&:hover":{overflowY:"scroll",padding:"0 0 0 10px!important"},"&::-webkit-scrollbar":{width:"10px"},"&::-webkit-scrollbar-thumb":{backgroundColor:"#c1c1c1",height:"30%",border:"3px solid #fff",borderRadius:10}})},t?r.createElement("div",{style:{width:"100%",height:"100%",display:"flex",justifyContent:"center",alignItems:"center"}},r.createElement(j.Z,null)):0!==(null==n?void 0:n.length)?n.map((e=>r.createElement(zc,{selected:o,setSelected:a,history:e,key:e.historyId}))):r.createElement("div",{style:{width:"100%",height:"100%",display:"flex",justifyContent:"center",alignItems:"center"}},r.createElement(xa.Z,{image:xa.Z.PRESENTED_IMAGE_SIMPLE})))}));function zc({selected:e,setSelected:t,history:n}){const{historyId:o,scene:l,cover:i,createTime:s}=n,[d,u]=(0,r.useState)(n.star),m=(0,a.v9)((({project:e})=>e)),{dispatch:f}=(0,a.oR)(),y=(0,Sc.xe)(),{token:g}=c.Z.useToken();return r.createElement("section",{key:o,className:(0,mt.iv)({padding:"8px 6px",flexShrink:0,backgroundColor:e===s?g.colorPrimaryBg:g.colorBgContainer,cursor:"pointer",display:"flex",flexDirection:"column"}),onClick:()=>{const e=m.scenes.findIndex((e=>e.id===l.id)),n=m.scenes.slice();n.splice(e,1,l);const{prevState:r}=m.editor;t(s),f((0,N.restoreState)(Fc(Rc({},m),{type:"History",scenes:n,editor:Fc(Rc({},m.editor),{prevState:Rc({},r||m)})}))),y()}},r.createElement("div",{className:`${(0,mt.iv)({width:132,height:234,backgroundSize:"cover",border:e===s?`1px solid ${g.colorPrimaryBorderHover}`:`1px solid ${g.colorBorderSecondary}`,position:"relative",backgroundImage:`url(${i})`})}`},r.createElement(Cc.Z,{theme:"two-tone",size:"24",fill:["#333",d?g.colorError:g.colorBgContainer],strokeWidth:2,style:{position:"absolute",right:8,top:8,transition:"all 3s"},onClick:()=>{o&&(0,Oc.Z7)(o,{star:Number(!d)}),u(Number(!d))}})),r.createElement("div",{style:{fontSize:14,padding:"6px 0"}},ge()(new Date(s)).locale(p()).fromNow()))}var $c=n(78930),Bc=n(10322),Vc=n(15610),Hc=n(19061),Gc=n(19167),_c=n(27086),Uc=n(57558),Wc=n(50969),Kc=n(3799),Xc=[{title:"首帧(loading页面后的第一屏内容)",items:["1. 带有明确可点击的按钮，交互方式尽量简洁明了，并使用手势进行引导","2. 建议不要使用视频作为首帧内容，以免影响开始互动率"]},{title:"首个主场景",items:["1. 首个主场景中的素材资源建议不超过1.5M。不要放置较大视频和大量序列帧，以免影响加载完成率"]},{title:"视频资源的使用",items:["1. 循环视频在iOS部分机型上存在卡顿问题，建议慎用","2. 作品中视频总数建议不超过6个，单个场景不超过1个，否则可能降低加载率","3. 单段视频时长应当尽量控制在1s-15s"]},{title:"交互事件的使用",items:["1. 对于添加了“下载APP”事件的素材，请保持素材的点击区域与可视区域一致(尽量不要使用透明素材)，以避免审核风险"]}],Yc=n(22142),Jc=Object.defineProperty,qc=Object.defineProperties,Qc=Object.getOwnPropertyDescriptors,es=Object.getOwnPropertySymbols,ts=Object.prototype.hasOwnProperty,ns=Object.prototype.propertyIsEnumerable,rs=(e,t,n)=>t in e?Jc(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,os=(0,r.memo)((()=>{const[e,t]=(0,r.useState)(!1),n=(()=>{const{subscribe:e,getState:t}=(0,a.oR)(),[n,o]=(0,r.useState)([]),l=(0,r.useRef)(0);return(0,r.useEffect)((()=>e((0,Ne.debounce)((()=>{const{project:e}=t(),n=Array.from((0,N.checkSceneWarnings)((0,R.zh)(e)));e.editor.selectedSceneId===l.current?o((e=>{for(const{message:t}of(0,Ne.differenceBy)(n,e,(({type:e})=>e)))Pe.ZP.warning(t);return n})):(l.current=e.editor.selectedSceneId,o(n))}),1e3))),[e,t]),n.map((({warning:e},t)=>({items:[(0,De.F3)(`${t+1}. `,e)]})))})();return Yc.createElement("div",{className:(0,R.xG)([cs,n.length>0&&(0,mt.iv)({background:"#FFA900 !important",button:{color:"white !important"}})])},Yc.createElement(Wc.Z,{destroyTooltipOnHide:!0,placement:"leftTop",trigger:"click",overlayClassName:ss,onOpenChange:e=>{e&&(n.length?(0,R.r3)(R.GM.RiskAlert,{from:"编辑中曝光"}):(0,R.r3)(R.GM.CraftSuggestion,null)),t(e)},open:e,content:Yc.createElement(as,{warnings:n,onClose:()=>{t(!1)}})},Yc.createElement(Kc.sg,{title:"制作建议",placement:"left"},Yc.createElement(ce.Z,{type:"text",icon:Yc.createElement(oe.Z,{component:Gc.Z})}))))}));const as=({onClose:e,warnings:t})=>Yc.createElement(qi.Z,{defaultActiveKey:t.length?"2":"1",tabBarExtraContent:Yc.createElement(ce.Z,{type:"text",style:{marginRight:10},onClick:e,icon:Yc.createElement(oe.Z,{component:_c.Z})}),onChange:e=>{(0,R.r3)("1"===e?R.GM.CraftSuggestion:R.GM.RiskAlert,null),"1"===e?(0,R.r3)(R.GM.CraftSuggestion,null):(0,R.r3)(R.GM.RiskAlert,{from:"编辑中曝光"})}},Yc.createElement(qi.Z.TabPane,{key:"1",tab:"制作建议"},Yc.createElement(ls,{description:"暂无制作建议",items:Xc})),Yc.createElement(qi.Z.TabPane,{key:"2",tab:t.length?Yc.createElement(Yc.Fragment,null,"风险提示 ",Yc.createElement(oe.Z,{component:is})):"风险提示"},Yc.createElement(ls,{description:"暂无风险提示",items:t}))),ls=({items:e,description:t})=>Yc.createElement("div",{className:(0,mt.iv)({height:400,overflow:"auto","::-webkit-scrollbar":{display:"none"}})},e.length?e.map((({items:e,title:t},n)=>Yc.createElement("div",{key:n,className:(0,mt.iv)({padding:"12px 16px"})},t&&Yc.createElement("div",{className:(0,mt.iv)({fontSize:14,fontWeight:600,paddingBottom:8})},t),e.map(((e,t)=>Yc.createElement("div",{key:t,className:(0,mt.iv)({color:"#666666"})},e)))))):Yc.createElement(xa.Z,{description:t,image:xa.Z.PRESENTED_IMAGE_SIMPLE})),is=e=>{return Yc.createElement(Uc.Z,(t=((e,t)=>{for(var n in t||(t={}))ts.call(t,n)&&rs(e,n,t[n]);if(es)for(var n of es(t))ns.call(t,n)&&rs(e,n,t[n]);return e})({},e),qc(t,Qc({theme:"filled",fill:"#FFA900"}))));var t},cs=(0,mt.iv)({display:"flex",justifyContent:"center",alignItems:"center",width:34}),ss=(0,mt.iv)({".ant-popover-inner-content":{padding:0,width:300},".ant-tabs-nav-wrap":{padding:"0 16px"}});var ds=n(65164),ps=n(22142),us=({id:e,title:t,Icon:n})=>{const[o,a]=(0,ds.Z)(`canvas.settings.flag.${e}`,!0),{trigger:i}=(0,An.Z)("EmitStateEvent");return(0,r.useEffect)((()=>{setTimeout((()=>{i({type:l.ActionType.Toolbar,[e]:o})}))}),[i,e,o]),ps.createElement(Kc.sg,{title:t,placement:"left"},ps.createElement(ce.Z,{type:o?"link":"text",className:(0,mt.cx)((0,mt.iv)({pointerEvents:"auto",margin:"0 1px"})),onClick:()=>a(!o),icon:ps.createElement(oe.Z,{component:n})}))},ms=n(12672),fs=n(74856),ys=n(1502),gs=n(48585),hs=n(15252),vs=n(59446),bs=n(57028),Es=n(64515),xs=n(38200),ks=n(20145),ws=n(22142);const Ss=e=>{const{onAdd:t}=e,[n,o]=(0,r.useState)(!1),a=ws.createElement("div",null,[{type:"number",text:"数字"},{type:"string",text:"文本"},{type:"boolean",text:"开关"},{type:"object",text:"对象"},{type:"array",text:"数组"}].map((e=>ws.createElement("p",{key:e.type,className:(0,mt.iv)({padding:"10px 15px",margin:"0","&:hover":{cursor:"pointer",background:"#f0f5ff"}}),onClick:()=>{(e=>{t(e),o(!1)})(e.type)}},e.text))));return ws.createElement(Wc.Z,{overlayClassName:(0,mt.iv)({".ant-popover-inner-content":{padding:0}}),content:a,trigger:"click",placement:"left",open:n,onOpenChange:e=>o(e)},ws.createElement(vs.Z,{theme:"outline",size:"14",fill:"#333",style:{marginRight:"5px"}}))},Os=e=>{const{value:t,onSelect:n}=e;return ws.createElement("div",{style:{paddingLeft:"12px",display:"flex",alignItems:"center"}},ws.createElement(ie.Z,{placement:"top",title:"开关"},ws.createElement(bs.Z,{theme:"outline",size:"12",fill:"#c1c1c1"})),ws.createElement(hs.Z,{style:{marginLeft:"5px"},checkedChildren:"开启",unCheckedChildren:"关闭",checked:t,onChange:n,size:"small"}))},Zs=e=>{const{item:t,value:n,type:o="value",disabled:a=!1,prefix:l,lightTip:i=!1,onFocus:c,onBlur:s}=e,[d,p]=(0,r.useState)(),u=(0,r.useRef)(null),[m,f]=(0,r.useState)("transparent"),y=(0,r.useRef)(n);return(0,r.useEffect)((()=>{i&&(f("pink"),setTimeout((()=>{f("transparent")}),150))}),[n]),(0,r.useEffect)((()=>{p(n)}),[n]),ws.createElement("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",background:m}},ws.createElement(it.Z,{id:t.id,key:t.id,ref:u,style:{padding:"5px"},placeholder:"Empty",bordered:!1,value:d,disabled:a,prefix:l,onFocus:e=>{c(e),y.current=e.target.value},onBlur:e=>{s(e.target.value,o)||p(y.current)},onChange:e=>{p(e.target.value)},onPressEnter:()=>{var e;null==(e=u.current)||e.blur()}}))},Ps=e=>{const{item:t,arrayIdx:n,lightTip:o,onDelete:a,onBlur:l,onFocusInput:i,onAdd:c,onSelect:s}=e,[d,p]=(0,r.useState)(!1),u=!(0,De.OB)(t.objectValue),m=()=>{p(!0)},f=()=>ws.createElement("div",{key:t.id,style:{position:"absolute",right:"5px",top:"5px",zIndex:99,visibility:d?"unset":"hidden"},onMouseOver:m},u&&ws.createElement(Ss,{onAdd:c}),ws.createElement(Es.Z,{theme:"outline",size:"14",fill:"#333",onClick:a})),y="boolean"===t.type?ws.createElement(Os,{value:t.objectValue,onSelect:s}):(0,De.OB)(t.objectValue)?ws.createElement(Zs,{item:t,value:t.objectValue,lightTip:o,disabled:"loop"===t.type,type:"value",prefix:"number"===t.type?ws.createElement(ie.Z,{placement:"top",title:"数字"},ws.createElement(xs.Z,{style:{color:"#c1c1c1"}})):ws.createElement(ie.Z,{placement:"top",title:"文本"},ws.createElement(ks.Z,{style:{color:"#c1c1c1"}})),onAdd:c,onFocus:i,onBlur:l}):ws.createElement(it.Z,{placeholder:"Borderless",bordered:!1,value:(0,De.Sw)(t.objectValue),disabled:!0});return ws.createElement("div",{key:t.id,style:{display:"flex",alignItems:"center",borderBottom:"1px solid #f0f0f0"},onMouseOver:m,onMouseLeave:()=>{p(!1)}},ws.createElement("div",{style:{width:"150px"}},ws.createElement(Zs,{item:t,value:null!=n?n:t.objectKey,type:"key",disabled:void 0!==n,visibleSuffixNode:!0,onAdd:c,onFocus:i,onBlur:l})),ws.createElement("div",{style:{width:"150px"}},y),ws.createElement(f,null))};var Cs=({minHeight:e=0,maxHeightEqualHeight:t=!1,record:n={}})=>{const o=(0,r.useRef)(null),a=(0,r.useRef)(null),l=(0,r.useRef)(0),{isDragging:i,dragOffset:c}=(0,T.c0)(a);return(0,r.useEffect)((()=>{const t=o.current;if(!(0,Ne.isNil)(t)&&!i){const n=t.getBoundingClientRect().height;l.current=Math.max(n,e)}}),[i]),(0,r.useEffect)((()=>{var t;const n=()=>{var t,r,i,c;const s=null!=(i=null==(r=null==(t=o.current)?void 0:t.getBoundingClientRect())?void 0:r.height)?i:0;l.current=Math.max(s,e),null==(c=a.current)||c.removeEventListener("mouseover",n)};return null==(t=a.current)||t.addEventListener("mouseover",n),()=>{var e;null==(e=a.current)||e.removeEventListener("mouseover",n)}}),[]),(0,r.useEffect)((()=>{const r=o.current;if(!(0,Ne.isNil)(r)&&i){const o=r.getBoundingClientRect();let a=l.current+c.y;a<e?a=e:o.top+a>document.documentElement.clientHeight&&(a=document.documentElement.clientHeight-o.top),r.style.height=`${a}px`,t&&(r.style.maxHeight=r.style.height),n.height=a}}),[i,c.y]),{mainRef:o,footerRef:a}},Is=n(22142),js=Object.defineProperty,As=Object.getOwnPropertySymbols,Ms=Object.prototype.hasOwnProperty,Ds=Object.prototype.propertyIsEnumerable,Ns=(e,t,n)=>t in e?js(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;const Ts={height:150},Rs=()=>Math.floor(1e7*Math.random()).toString(),Fs=e=>"[object Object]"===Object.prototype.toString.call(e)&&"Object"!==e.constructor.name&&"Array"!==e.constructor.name,Ls={},zs=(e,t)=>{if(void 0===t)return;let n;for(let r=0;r<e.length;r++){const o=e[r];if(o.id===t)return o;if(o.children&&o.children.length>0&&(n=zs(o.children,t)),n)return n}};var $s=(0,r.memo)((({visible:e=!0,isPlaying:t=!1})=>{const[n,o]=(0,r.useState)([]),[l,i]=(0,r.useState)([]),[c,s]=(0,r.useState)([]),[d,p]=(0,r.useState)([]),{mainRef:u,footerRef:m}=Cs({minHeight:150,maxHeightEqualHeight:!0,record:Ts}),f=(0,r.useRef)(!1),y=(0,r.useRef)(""),g=(0,r.useRef)([]),h=(0,a.I0)(),{storeData:v,playing:b}=(0,a.v9)((({project:e})=>({storeData:(0,R.AR)(e),playing:e.editor.playing})),a.wU);(0,r.useEffect)((()=>{b&&v&&(g.current=Object.keys(v))}),[b]),(0,r.useEffect)((()=>{f.current&&(x(),f.current=!1)})),(0,r.useEffect)((()=>{var e,t;const n=["SceneLoadingProgress","SupportShake"],r=g.current,a=null==(t=null==(e=Object.entries(null!=v?v:[]))?void 0:e.filter((e=>!n.includes(e[0])&&(!b||r.includes(e[0]))&&!Fs(e[1]))))?void 0:t.map((e=>w(e[1],e[0],[])));o(a)}),[v]),(0,r.useEffect)((()=>{p(null==n?void 0:n.map((e=>Z(e))))}),[n]);const{trigger:E}=(0,An.Z)("forceSceneReload"),x=()=>{h((0,N.updateGlobalVars)(S(n))),E()},k=(e,t,r=[])=>{var o;const a=null!=(o=null==t?void 0:t.children)?o:n,l={string:"文本",number:"数字",boolean:"开关",object:"对象",array:"数组",loop:"变量"}[e];let i=0,c=l;for(;a.find((e=>e.objectKey===c));)i+=1,c=`${l}${i}`;const s={id:Rs(),type:e,parentId:null==t?void 0:t.id,objectValue:{string:"",number:0,boolean:!0,object:{},array:[],loop:""}[e],objectKey:c};return"object"!==e&&"array"!==e||(s.children=r),s},w=(e,t="",n,r)=>{var o,a,l;const{id:i}=null!=(o=Ls[`${r}${t}`])?o:{},c=Object.prototype.toString.call(e),s=()=>{if(n.includes(e)){const n=null!=i?i:Rs();return Ls[`${r}${t}`]={id:n,value:e},{id:n,type:"loop",parentId:r,objectValue:"循环引用",objectKey:t}}n.push(e)};if("[object Array]"===c){const o=null!=i?i:Rs();return Ls[`${r}${t}`]={id:o,value:e},null!=(a=s())?a:{id:o,type:"array",parentId:r,objectValue:e,objectKey:t,children:e.filter((e=>!Fs(e))).map(((e,t)=>w(e,t.toString(),n,o)))}}if("[object Object]"===c){const o=null!=i?i:Rs();return Ls[`${r}${t}`]={id:o,value:e},null!=(l=s())?l:{id:o,type:"object",parentId:r,objectValue:e,objectKey:t,children:Object.entries(e).filter((e=>!Fs(e[1]))).map((e=>w(e[1],e[0],n,o)))}}const d=null!=i?i:Rs();return Ls[`${r}${t}`]={id:d,value:e},{id:d,type:"[object Number]"===c?"number":"[object Boolean]"===c?"boolean":"string",parentId:r,objectValue:"[object Number]"===c||"[object Boolean]"===c?e:`${e}`,objectKey:t}},S=e=>{const t={},n=(e,t,r=!1)=>{var o;if(!r&&""===e.objectKey)return;if("loop"===e.type)return;const a=Object.prototype.toString.call(e.objectValue);if("[object Array]"===a||"[object Object]"===a){const r="[object Array]"===a?[]:{};return Array.isArray(t)?t.push(r):t[e.objectKey]=r,void(null==(o=e.children)||o.forEach((t=>n(t,r,Array.isArray(e.objectValue)))))}((e,t)=>{let n;"string"===t.type&&(n=t.objectValue.toString(),"null"===n&&(n=null),"undefined"===n&&(n=void 0)),"boolean"===t.type&&(n=t.objectValue),"number"===t.type&&(n=isNaN(Number(t.objectValue))?t.objectValue.toString():Number(t.objectValue)),Array.isArray(e)?e.push(n):e[t.objectKey]=n})(t,e)};return e.forEach((e=>n(e,t))),t},O=e=>{i([e.target.id]),y.current=e.target.value},Z=(e,r)=>{if(e)return{title:Is.createElement(Ps,{key:e.id,item:e,arrayIdx:r,value:null!=r?r:e.objectKey,disabled:void 0!==r,visibleSuffixNode:!0,lightTip:t,onAdd:t=>{"loop"!==t&&(0,R.r3)(R.GM.CreateGlobalVar,{type:t});const r=k(t,e);e.children&&(-1===c.indexOf(e.id)&&s([...c,e.id]),e.children.push(r),o((0,Ne.cloneDeep)(n))),x()},onDelete:()=>{const t=zs(n,e.parentId);t&&t.children?(t.children=(0,Ne.filter)(t.children,(t=>t.id!==e.id)),o((0,Ne.cloneDeep)(n))):o((0,Ne.filter)(n,(t=>t.id!==e.id))),f.current=!0},onFocus:O,onFocusInput:O,onBlur:(t,r)=>{i([]);const a=zs(n,e.parentId),l=((e,t)=>{for(var n in t||(t={}))Ms.call(t,n)&&Ns(e,n,t[n]);if(As)for(var n of As(t))Ds.call(t,n)&&Ns(e,n,t[n]);return e})({},e);"key"===r&&(l.objectKey=t),"value"===r&&(l.objectValue=t);const c=((e,t,n)=>{if((void 0===n||!Array.isArray(n.objectValue))&&""===e.objectKey)return Pe.ZP.warning("key 值不能为空"),!1;for(let n=0;n<t.length;n++)if(t[n].objectKey===e.objectKey&&t[n].id!==e.id)return Pe.ZP.warning("Key 值重复了"),!1;return!0})(l,(null==a?void 0:a.children)||n,a);return t!=y.current&&c&&("key"===r&&(t=>{const r=`${e.parentId}${e.objectKey}`,a=Ls[r],l=`${e.parentId}${t}`;e.objectKey=t,Ls[l]=a,delete Ls[r],o((0,Ne.cloneDeep)(n))})(t),"value"===r&&(t=>{e.objectValue=t,o((0,Ne.cloneDeep)(n))})(t),x()),c},onSelect:t=>{e.objectValue=t,o((0,Ne.cloneDeep)(n)),x()}}),key:e.id,children:e.children&&(null==e?void 0:e.children.map(((t,n)=>Z(t,Array.isArray(e.objectValue)?n:void 0))))}};return Is.createElement("div",{className:(0,mt.iv)({display:e?"unset":"none"})},Is.createElement("div",{style:{position:"absolute",top:"5px",right:"10px"}},Is.createElement(Ss,{onAdd:e=>{"loop"!==e&&(0,R.r3)(R.GM.CreateGlobalVar,{type:e});const t=k(e);n.splice(0,0,t),o((0,Ne.cloneDeep)(n)),x()}})),Is.createElement("div",{ref:u,className:(0,mt.iv)({display:"flex",marginTop:"15px",paddingBottom:"20px",minWidth:"330px",minHeight:"150px",height:Ts.height,overflow:"auto","::-webkit-scrollbar":{display:"none"}})},d.length>0?Is.createElement(fs.Z,{className:(0,mt.iv)({".ant-tree":{background:"inherit"},".ant-tree-switcher":{marginRight:"-7px"}}),blockNode:!0,expandedKeys:c,selectedKeys:l,switcherIcon:Is.createElement(ys.Z,null),onExpand:e=>{s([...e])},treeData:d}):Is.createElement(xa.Z,{description:"暂无数据",style:{margin:"0 auto"}}),Is.createElement("div",{className:Qs,ref:m},Is.createElement(gs.Z,{theme:"outline",size:"10",fill:"#333"}))))})),Bs=n(43279),Vs=n.n(Bs),Hs=n(73775),Gs=n(22142);const _s={default:"black",log:"#9b9b28",error:"red"},Us={height:150};var Ws=({logs:e,visible:t,onClean:n})=>{const{mainRef:o,footerRef:a}=Cs({minHeight:150,maxHeightEqualHeight:!0,record:Us});return(0,r.useEffect)((()=>{if(o.current&&o.current&&o.current.scrollHeight<=o.current.clientHeight+o.current.scrollTop+50){const e=o.current.scrollHeight;o.current.scrollTo(0,e)}}),[e]),Gs.createElement("div",{ref:o,className:(0,mt.iv)({minWidth:330,height:Us.height,display:t?"block":"none",overflow:"auto",zIndex:99,"::-webkit-scrollbar":{display:"none"}})},Gs.createElement(ce.Z,{type:"text",style:{marginRight:10,position:"absolute",right:"2px",top:"0px",zIndex:99},onClick:n,icon:Gs.createElement(Hs.Z,{size:12})}),e.map(((e,t)=>Gs.createElement("div",{key:t,className:(0,mt.iv)({color:_s[e.level]||"black",padding:"5px 10px",overflowWrap:"anywhere"})},e.message))),Gs.createElement("div",{className:Qs,ref:a},Gs.createElement(gs.Z,{theme:"outline",size:"10",fill:"#333"})))},Ks=n(22142);let Xs;const Ys=(0,mt.iv)({display:"flex",justifyContent:"center",alignItems:"center",width:34,".riko-log-modal":{width:"0px"},".ant-modal":{position:"fixed"},".ant-modal-body":{position:"relative"},".ant-popover-inner-content":{padding:0}}),Js=(0,mt.iv)({display:"flex",alignItems:"center",width:"100%",cursor:"move",".ant-tabs-top > .ant-tabs-nav":{margin:0}}),qs=(0,mt.iv)({".ant-tree":{background:"inherit"},".ant-tree-switcher":{display:"flex",justifyContent:"center",alignItems:"center",background:"inherit"},".riko-log-modal":{width:"0"},".ant-modal-wrap":{width:"0px"},".ant-modal":{position:"fixed"}}),Qs=(0,mt.iv)({position:"absolute",bottom:0,left:0,right:0,height:"12px",borderTop:"1px solid #E8E8E8",textAlign:"center",fontSize:"0 !important",verticalAlign:"middle",cursor:"ns-resize","& .i-icon":{fontSize:"0 !important"}});var ed=(0,r.memo)((()=>{const[e,t]=(0,r.useState)([]),[n,o]=(0,r.useState)({left:0,top:0,bottom:0,right:0}),[l,i]=(0,r.useState)(!1),[c,s]=(0,r.useState)(!0),[d,p]=(0,r.useState)("log"),[u,m]=(0,r.useState)({left:500,top:200}),{playing:f}=(0,a.v9)((({project:e})=>({playing:e.editor.playing})),a.wU),y=(0,r.useRef)(null),g=(0,r.useRef)(null);(0,N.useEmitter)("UpdateRikoLog",(n=>{t([...e,n])})),(0,r.useEffect)((()=>{var e;Xs=null!=(e=document.getElementById("rikoLogModal"))?e:void 0}),[]),(0,r.useEffect)((()=>{l&&(0,R.r3)(R.GM.GlobalLog,{type:"log"===d?"日志":"全局变量"})}),[d,l]),(0,r.useEffect)((()=>{g.current&&!l&&m({left:g.current.left,top:g.current.top})}),[l]),(0,r.useEffect)((()=>{f&&t([])}),[f]),(0,An.Z)("RikoLog",(e=>{i(!0),e&&p(e)}));const h=(e,t)=>{var n;const{clientWidth:r,clientHeight:a}=window.document.documentElement,l=null==(n=y.current)?void 0:n.getBoundingClientRect();l&&o({left:-l.left+t.x,right:r-(l.right-t.x),top:-l.top+t.y,bottom:a-(l.bottom-t.y)})},v=()=>{var e;g.current=null==(e=y.current)?void 0:e.getBoundingClientRect()},b=Ks.createElement("div",{className:Js,onMouseOver:()=>{c&&s(!1)},onMouseOut:()=>{s(!0)}},Ks.createElement(qi.Z,{activeKey:d,onChange:e=>{p(e)}},Ks.createElement(qi.Z.TabPane,{tab:"日志",key:"log"}),Ks.createElement(qi.Z.TabPane,{tab:"全局变量",key:"globalVar"})));return Ks.createElement("div",{className:(0,R.xG)([Ys])},Ks.createElement(Kc.sg,{title:"全局变量",placement:"left"},Ks.createElement(ce.Z,{type:"text",onClick:()=>{i(!0)},icon:Ks.createElement(ms.Z,null)})),Ks.createElement("div",{id:"rikoLogModal",className:qs}),Ks.createElement(P.Z,{title:b,className:(0,mt.iv)({".ant-modal-body":{padding:"12px 5px"}}),width:"auto",transitionName:"",style:u,keyboard:!1,destroyOnClose:!0,getContainer:Xs,wrapClassName:"riko-log-modal",mask:!1,maskClosable:!1,open:l,footer:!1,onOk:()=>{i(!1)},onCancel:()=>{i(!1)},modalRender:e=>Ks.createElement(Vs(),{disabled:c,bounds:n,onStart:h,onStop:v},Ks.createElement("div",{ref:y},e))},Ks.createElement(Ws,{logs:e,visible:"log"===d,onClean:()=>{t([])}}),Ks.createElement($s,{visible:"globalVar"===d,isPlaying:1===f})))})),td=n(93955),nd=n.p+"images/58ffda76d05e4d51d5b9.png",rd=n(22142);function od(){const e=(0,N.useSettings)("typeOfPlay"),t=(0,N.useSettings)("category"),n=3===e&&3===t,r=(0,N.useProject)("type"),{trigger:o}=(0,An.Z)("Blueprint");return rd.createElement("div",{className:(0,mt.iv)({flex:"0 0 40px",display:"flex",flexDirection:"column",alignItems:"center",padding:"16px 0"})},(3===e||4===e)&&"Project"===r&&!n&&rd.createElement(Kc.HY,{id:"straight.playable.mask",head:"建议开启直出互动元素限制区域",placement:"leftTop",body:rd.createElement("div",null,rd.createElement("div",null,"直出互动内容支持用户在信息流里直接互动，会与抖音 App 信息流上下边缘的点击等交互产生冲突，对用户体验造成严重影响，进而影响转化效果"),rd.createElement("img",{src:nd,style:{width:"100%",objectFit:"contain",display:"block",margin:"16px 0 0"}}))},rd.createElement(us,{id:"enableDirectMask",title:rd.createElement(rd.Fragment,null,"直出互动限制区域"," ",rd.createElement(lr.Z.Link,{href:"https://bytedance.feishu.cn/docx/doxcnk5lo6W8ZaBGCVjYpSzdOIh",target:"_blank"},"详情 ",rd.createElement(oe.Z,{component:$c.Z}))),Icon:td.z})),(0,De.cM)({release:!1})&&rd.createElement(rd.Fragment,null,4!==e&&!n&&rd.createElement(us,{id:"enableGuides",title:"物理辅助线",Icon:ad}),!n&&rd.createElement(us,{id:"enableGrid",title:"网格",Icon:Bc.Z}),rd.createElement(us,{id:"enableMagnet",title:"吸附",Icon:Vc.Z})),4!==e&&!n&&rd.createElement(rd.Fragment,null,rd.createElement(os,null),rd.createElement(ed,null)),rd.createElement(ie.Z,{title:"故事板",placement:"left"},rd.createElement(ce.Z,{type:"text",icon:rd.createElement(oe.Z,{component:Hc.Z}),onClick:()=>{o({type:"Project",id:0})}})))}function ad(){return rd.createElement("svg",{className:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"4742",width:"1em",height:"1em"},rd.createElement("path",{d:"M416 882.368l45.248 45.248-45.248 45.248-45.248-45.248 45.248-45.248z m192 0l45.248 45.248-45.248 45.248-45.248-45.248 45.248-45.248zM512 160v76.16a304 304 0 1 1 0 551.68v76.16H96v-704H512z m-59.456 70.4H155.52v563.2H452.48v-42.24A303.488 303.488 0 0 1 336 512c0-97.152 45.568-183.68 116.544-239.36V230.4zM640 272c-47.04 0-90.88 13.504-128 36.928v406.144a240 240 0 1 0 128-443.072zM400 512c0 56.704 19.648 108.8 52.544 149.888V362.112A238.976 238.976 0 0 0 400 512zM416 51.2l45.248 45.248-45.248 45.248-45.248-45.248L416 51.2z m192 0l45.248 45.248-45.248 45.248-45.248-45.248L608 51.2z",fill:"currentColor"}))}var ld=n(29352),id=n(72299),cd=n(92181);function sd(e){return(0,Ne.isObject)(e)&&!(0,Ne.isArray)(e)}const dd=(e,t)=>{const n=["x","y","alpha","rotation","anchorX","anchorY","scaleX","scaleY"];e.scripts.find((e=>"ImmediateIO"==e.props.script))&&n.push("visible");const r={id:(0,R.xv)(),type:"Script",props:{script:"Auto",name:"自动触发",time:t,scripts:n.reduce(((t,n)=>{const r={editor:{},id:(0,R.xv)(),type:"Script",props:{name:"赋值",script:"ModifyData",time:0,_event_option:!0,enabled:!0,expression:{from:{ids:[-1],key:n,type:"node"},mode:"=",to:e.props[n]}}};return t.push(r),t}),[])}};e.scripts.push(r)},pd=e=>{var t,n,r,o;const a=null!=(t=e.scripts)?t:[];for(let e=0;e<a.length;e++)a[e].id=(0,R.xv)();const l=null!=(n=e.nodes)?n:[];for(let e=0;e<l.length;e++){l[e].id=(0,R.xv)();const t=null!=(r=l[e].nodes)?r:[],n=null!=(o=l[e].scripts)?o:[];((0,Ne.isArray)(t)&&t.length>0||(0,Ne.isArray)(n)&&n.length>0)&&pd(l[e])}},ud=e=>{let t=e[0][0],n=e[0][1],r=e[0][0],o=e[0][1];for(let a=0;a<e.length;a+=1){const l=e[a];l[0]<t?t=l[0]:l[0]>r&&(r=l[0]),l[1]<n?n=l[1]:l[1]>o&&(o=l[1])}return[{x:t,y:n},{x:r,y:n},{x:r,y:o},{x:t,y:o}]},md=e=>({x:e.x+e.anchorX*e.width,y:e.y+e.anchorY*e.height}),fd=e=>({x:(e[0].x+e[1].x)/2,y:(e[0].y+e[3].y)/2}),yd=e=>({width:e[1].x-e[0].x,height:e[3].y-e[0].y}),gd=(e,t)=>{const n=t[e],r=t[e+1];return!!(n&&r&&1==n.td&&r.tt>0)},hd=(e,t)=>[t[0]-e[0],t[1]-e[1]],vd=(e,t)=>{var n,r,o,a;return{x1:null!=(n=t.x[0])?n:t.x,y1:null!=(r=t.y[0])?r:t.y,x2:null!=(o=e.x[0])?o:e.x,y2:null!=(a=e.y[0])?a:e.y}},bd=e=>{switch(e){case 0:return"合成";case 1:return"纯色";case 2:return"图片";case 3:return"空";case 4:return"图形";case 5:return"文字";case 6:return"音频";case 9:return"视频";case 13:return"相机";default:return"未知"}},Ed=e=>{var t,n;const r=null==e?void 0:e.split("_");return{count:Number(null!=(t=null==r?void 0:r[0])?t:0),gap:Number(null!=(n=null==r?void 0:r[1])?n:0)}};var xd=Object.defineProperty,kd=Object.defineProperties,wd=Object.getOwnPropertyDescriptors,Sd=Object.getOwnPropertySymbols,Od=Object.prototype.hasOwnProperty,Zd=Object.prototype.propertyIsEnumerable,Pd=(e,t,n)=>t in e?xd(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Cd=(e,t)=>{for(var n in t||(t={}))Od.call(t,n)&&Pd(e,n,t[n]);if(Sd)for(var n of Sd(t))Zd.call(t,n)&&Pd(e,n,t[n]);return e},Id=(e,t)=>kd(e,wd(t));const jd=new URLSearchParams(window.location.search).get("debug"),Ad=(e,t=[])=>({id:(0,R.xv)(),type:"Container",props:Cd({name:"容器",width:0,height:0,anchorX:.5,anchorY:.5,scaleX:1,scaleY:1,rotation:0,x:0,y:0},e.props),nodes:t}),Md=e=>{for(let t=1;t<e.length;t++){const n=e[t],r=e[t-1];if(n.props.asMask&&r.ind==n.ind+1)if(delete n.ind,n.props.x-=r.props.x,n.props.y-=r.props.y,"Container"===r.type){const o=Ad(r,[r,n]);r.props.x=0,r.props.y=0,e.splice(t-1,0,o),e.splice(t,2)}else r.nodes.push(n),e.splice(t,1)}},Dd=(e,t,n)=>{const r=[],o=t[e],a=Ld(o),l=o.op-o.ip;let i=-1,c=0;for(let s=e+1;s<t.length;s++){const d=t[s];if(d.refId!==o.refId||d.op-d.ip!=l||r.includes(d.ind)||n.includes(d.ind))break;if((0,Ne.isEqual)(a.ks,Ld(d).ks)){const n=s==e+1?o.ip-d.op:t[s-1].ip-d.op;if(-1!=i&&n!=i)break;jd&&console.log({type:"optimizeLoopLayer",target:(0,Ne.cloneDeep)(o),loop:(0,Ne.cloneDeep)(d)}),c++,i=n,o._loop=`${c}_${n}`,o.ip=d.ip,o.op=d.op,o.st=d.st,o.ks=d.ks,r.push(d.ind)}}return r},Nd=(e,t)=>{let n=[];for(let r=0;r<e.length;r++){const o=[];for(let a=0;a<t.length;a++){const l=t[a];l.refId!=e[r].id||n.includes(l.ind)||o.push(a)}for(let e=0;e<o.length;e++){const r=o[e],a=t[r];n.includes(a.ind)||(n=n.concat(Dd(r,t,n)))}}const r=[];for(let e=0;e<t.length;e++)n.includes(t[e].ind)||r.push(t[e]);let o=[];for(let t=0;t<e.length;t++){const n=[];for(let a=0;a<r.length;a++){const l=r[a];l.refId!=e[t].id||o.includes(l.ind)||n.push(a)}for(let e=0;e<n.length;e++){const t=n[e],a=r[t];o.includes(a.ind)||(o=o.concat(Td(t,r,o)))}}const a=[];for(let e=0;e<r.length;e++)o.includes(r[e].ind)||a.push(r[e]);return a},Td=(e,t,n)=>{var r,o;const a=[];let l=t[e];for(let i=e+1;i<t.length;i++){let e=t[i];if(e.refId!==l.refId||(null==(r=null==l?void 0:l.tm)?void 0:r.k)!=(null==(o=null==e?void 0:e.tm)?void 0:o.k)||l._loop||e._loop||l.op!=e.ip&&l.ip!=e.op||a.includes(e.ind)||n.includes(e.ind))break;if(l.op==e.ip||l.ip==e.op){if(l.ip==e.op){const t=l;l=e,e=t}const t=zd(l,e);t&&(l.op=e.op,l.ks=t.ks,a.push(e.ind))}}return a},Rd=e=>{const t={};for(let n=0;n<e.nodes.length;n++){const r=e.nodes[n];t[r.ind]=r,delete r.ind}$d(e.nodes,t)},Fd=e=>{var t,n,r;for(let o=0;o<e.length;o++){const a=e[o],l=a.op,i=a.ip,c=Object.keys(null!=(t=a.ks)?t:{});for(let e=0;e<c.length;e++){const t=c[e];if(["o","r"].includes(t)){const e=null==(n=a.ks)?void 0:n[t];if((0,Ne.isArray)(null==e?void 0:e.k)){const n=Bd(null==e?void 0:e.k,i,l);a.ks[t].k=sd(n[0])?n:n[0]}}else{const e=null==(r=a.ks)?void 0:r[t];sd(null==e?void 0:e.k[0])&&(a.ks[t].k=Bd(null==e?void 0:e.k,i,l))}}}return e},Ld=e=>{var t,n,r;const o=(0,Ne.cloneDeep)(e),a=o.ip,l=Object.keys(null!=(t=o.ks)?t:{});for(let e=0;e<l.length;e++){const t=l[e];if(["o","r"].includes(t)){const e=null==(n=o.ks)?void 0:n[t];if((0,Ne.isArray)(null==e?void 0:e.k))for(let t=0;t<e.k.length;t++)e.k[t].t-=a}else{const e=null==(r=o.ks)?void 0:r[t];if(sd(null==e?void 0:e.k[0]))for(let t=0;t<e.k.length;t++)e.k[t].t-=a}}return o},zd=(e,t)=>{var n,r,o,a,l;const i=(0,Ne.cloneDeep)(e),c=Object.keys(null!=(n=e.ks)?n:{});for(let n=0;n<c.length;n++){const s=c[n];if(["o","r"].includes(s)){const n=null==(r=e.ks)?void 0:r[s],a=null==(o=t.ks)?void 0:o[s];if(!(0,Ne.isArray)(null==n?void 0:n.k)&&(0,Ne.isArray)(null==a?void 0:a.k)){if((null==n?void 0:n.k)!=a.k[0].s[0]||a.k[0].t<e.op)return null;i.ks[s]=a,i.op=t.op}else if((0,Ne.isArray)(null==n?void 0:n.k)||(0,Ne.isArray)(null==a?void 0:a.k)){if((0,Ne.isArray)(null==n?void 0:n.k)&&!(0,Ne.isArray)(null==a?void 0:a.k)){if(n.k[n.k.length-1].s[0]!=(null==a?void 0:a.k))return null}else if((0,Ne.isArray)(null==n?void 0:n.k)&&(0,Ne.isArray)(null==a?void 0:a.k)){if(n.k[n.k.length-1].s[0]!=a.k[0].s[0]||a.k[0].t<e.op)return null;i.ks[s]=Id(Cd({},n),{k:n.k.concat(a.k)}),i.op=t.op}}else if((null==n?void 0:n.k)!=(null==a?void 0:a.k))return null}else{const n=null==(a=e.ks)?void 0:a[s],r=null==(l=t.ks)?void 0:l[s];if(!sd(null==n?void 0:n.k[0])&&sd(null==r?void 0:r.k[0])){if(!(0,Ne.isEqual)(null==n?void 0:n.k,r.k[0].s)||r.k[0].t<e.op)return null;i.ks[s]=r,i.op=t.op}else if(sd(null==n?void 0:n.k[0])||sd(null==r?void 0:r.k[0])){if(sd(null==n?void 0:n.k[0])&&!sd(null==r?void 0:r.k[0])){if(!(0,Ne.isEqual)(n.k[n.k.length-1].s,null==r?void 0:r.k))return null}else if(sd(null==n?void 0:n.k[0])&&sd(null==r?void 0:r.k[0])){if(!(0,Ne.isEqual)(n.k[n.k.length-1].s,r.k[0].s)||r.k[0].t<e.op)return null;i.ks[s]=Id(Cd({},n),{k:n.k.concat(r.k)}),i.op=t.op}}else if(!(0,Ne.isEqual)(null==n?void 0:n.k,null==r?void 0:r.k))return null}}return i},$d=(e,t)=>{var n;for(let r=0;r<e.length;r++){const o=e[r];if(o.parent){const a=(0,Ne.cloneDeep)(t[o.parent]),l=e[r-1];l&&a.id==l.id?(l.nodes.push(o),e.splice(r,1),r-=1):(a.nodes=null!=(n=a.nodes)?n:[],a.type="Container",a.id=(0,R.xv)(),delete a.props.url,pd(a),a.nodes.push(o),e[r]=a)}delete o.parent}},Bd=(e,t,n)=>{var r;let o=[];for(let a=0;a<e.length&&!(e[a].t>=n&&0==a||e[a].t<=t&&a==e.length-1||(null==(r=e[a+1])?void 0:r.t)<=t);a++)o.push(e[a]);return 0==o.length&&(o=e[e.length-1].s),jd&&!(0,Ne.isEqual)(e,o)&&console.log({type:"validKs",ip:t,op:n,origin:e,optimize:o}),o},Vd=(e,t,n=e.ip)=>{const r=0===e.ty?n:e.ip,o=t.assets,a=["r","p","a","s","o"];if(e.refId){const l=o.find((t=>t.id===e.refId));(null==l?void 0:l.layers)&&l.layers.forEach((e=>{a.forEach((t=>{var n,o,a;Array.isArray(null==(o=null==(n=null==e?void 0:e.ks)?void 0:n[t])?void 0:o.k)&&(null==(a=e.ks)||a[t].k.forEach((e=>{void 0!==e.t&&(e.t+=r)})))})),void 0!==e.ip&&0!==e.ty&&(e.ip+=r),void 0!==e.op&&0!==e.ty&&(e.op+=r),Vd(e,t,n)}))}};var Hd=Object.defineProperty,Gd=Object.defineProperties,_d=Object.getOwnPropertyDescriptors,Ud=Object.getOwnPropertySymbols,Wd=Object.prototype.hasOwnProperty,Kd=Object.prototype.propertyIsEnumerable,Xd=(e,t,n)=>t in e?Hd(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Yd=(e,t)=>{for(var n in t||(t={}))Wd.call(t,n)&&Xd(e,n,t[n]);if(Ud)for(var n of Ud(t))Kd.call(t,n)&&Xd(e,n,t[n]);return e},Jd=(e,t)=>Gd(e,_d(t));const qd=new URLSearchParams(window.location.search).get("debug");let Qd={ip:0,op:0,_errors:[]};const ep=(e,t)=>{Qd=e,qd&&console.log(`--- ${Date.now()} lottieParse ---`);const n=e.assets;for(let e=0;e<n.length;e++){const r=n[e],o=`${r.u}${r.p}`,a=t.find((e=>e[0].endsWith(o)));a&&(r.u="",r.p=a[1])}const r=Nd(n,Fd(e.layers)),o={id:(0,R.xv)(),type:"Container",props:{name:e.nm,width:e.w,height:e.h,anchorX:.5,anchorY:.5,scaleX:1,scaleY:1,rotation:0,x:0,y:0},nodes:r.reduce(((t,n,o)=>{const a=(0,Ne.cloneDeep)(e);Vd(n,a);const l=tp(n,a);return l?(l.props.asMask=gd(o,r),t.push(l)):Qd._errors.push(`不支持 “${n.nm}” ${bd(n.ty)}节点`),t}),[]).reverse()};return Md(o.nodes),Rd(o),o},tp=(e,t)=>{switch((e=>{e.tm&&Qd._errors.push(`不支持 “${e.nm}” 图层的【时间映射】功能`),e.tt>=2&&Qd._errors.push(`不支持 “${e.nm}” ${(e=>{switch(e){case 1:return"Alpha 遮罩";case 2:return"Alpha 反转遮罩";case 3:return"亮度遮罩";case 4:return"亮度反转遮罩";default:return"未知"}})(e.tt)}`)})(e),e.ty){case 2:return rp("Sprite",e,t);case 5:return cp(e,t);case 9:return dp(e,t);case 0:return up(e,t);case 6:return sp(e,t);case 4:return op(e,t);default:return null}},np=(e,t,n,r)=>{var o,a;const l=e.masksProperties,i=t.fr;if(e.hasMask&&l.length>0){l.length>1&&Qd._errors.push(`不支持 “${e.nm}” 多蒙版混合`);const t=l.find((e=>"a"==e.mode));if(t){t.inv&&Qd._errors.push(`不支持 “${t.nm}” 反转蒙版`);const l=t.pt.k,c=(0,Ne.isArray)(l)?ud(l[0].s[0].v):ud(l.v),s=c[1].x-c[0].x,d=c[2].y-c[1].y,p=null==(o=e.ks)?void 0:o.o,u=(0,Ne.isArray)(p.k)?p.k[0].s[0]:p.k,m={id:(0,R.xv)(),type:"Shape",name:t.nm,props:{alpha:u/100,shapeType:"rectangle",anchorX:.5,anchorY:.5,scaleX:1,scaleY:1,rotation:0,x:c[0].x+(5==e.ty?n.x-r.x:0),y:c[0].y+(5==e.ty?n.y-r.y:0),width:s,height:d,asMask:!0},scripts:vp(null==(a=e.ks)?void 0:a.o,i,{count:0,gap:0,duration:0})};if((0,Ne.isArray)(l)){const e=[];for(let t=0;t<l.length;t++)e.push(ud(l[t].s[0].v));for(let t=0;t<l.length-1;t++){const n=l[t],r=l[t+1],o=e[t],a=e[t+1],c=fd(o),s=fd(a);(0,Ne.isEqual)(c,s)||m.scripts.push({id:(0,R.xv)(),type:"Effect",props:{name:"位移动画",script:"Move",presetAnchor:!1,duration:(r.t-n.t)/i*1e3,time:(n.t-Qd.ip)/i*1e3,ease:vd(n.i,n.o),distanceX:s.x-c.x,distanceY:s.y-c.y,__script:["baseEffect","Move_位移动画"]}});const d=yd(o),p=yd(a);(0,Ne.isEqual)(d,p)||m.scripts.push({id:(0,R.xv)(),type:"Effect",props:{name:"缩放到",script:"Scale",presetAnchor:!1,duration:(r.t-n.t)/i*1e3,time:n.t/i*1e3,ease:vd(n.i,n.o),scaleRangeX:p.width/d.width-1,scaleRangeY:p.height/d.height-1,__script:["baseEffect","Scale"]}})}}return m}Qd._errors.push(`仅支持 “${e.nm}” 相加蒙版`)}},rp=(e,t,n)=>{var r,o,a,l,i;const{count:c,gap:s}=Ed(t._loop),d=t.op-t.ip,p=c>0?t.op+d*c+(c-1)*s:t.op,u=((e,t)=>{var n,r,o,a,l,i,c,s,d,p,u,m;const f=t.find((t=>t.id==e.refId)),y=null!=(n=null==e?void 0:e.w)?n:null==f?void 0:f.w,g=null!=(r=null==e?void 0:e.h)?r:null==f?void 0:f.h,h=null==(o=e.ks)?void 0:o.o,v=(0,Ne.isArray)(null==h?void 0:h.k)?null==(a=null==h?void 0:h.k[0])?void 0:a.s[0]:null==h?void 0:h.k,b=null==(l=e.ks)?void 0:l.a,E=sd(null==b?void 0:b.k[0])?null==(i=null==b?void 0:b.k[0])?void 0:i.s:null==b?void 0:b.k,x=null==(c=e.ks)?void 0:c.p,k=hd(E,sd(null==x?void 0:x.k[0])?null==(s=null==x?void 0:x.k[0])?void 0:s.s:null==x?void 0:x.k),w=null==(d=e.ks)?void 0:d.r,S=(0,Ne.isArray)(null==w?void 0:w.k)?null==(p=null==w?void 0:w.k[0])?void 0:p.s[0]:null==w?void 0:w.k,O=null==(u=e.ks)?void 0:u.s,Z=sd(null==O?void 0:O.k[0])?null==(m=null==O?void 0:O.k[0])?void 0:m.s:null==O?void 0:O.k,P=E[0]/y,C=E[1]/g;return{width:y,height:g,url:(0,Ne.isString)(null==f?void 0:f.u)&&(0,Ne.isString)(null==f?void 0:f.p)?`${f.u}${f.p}`:void 0,alpha:v/100,anchorX:isNaN(P)?0:P,anchorY:isNaN(C)?0:C,x:k[0],y:k[1],rotation:S,scaleX:Z[0]/100,scaleY:Z[0]/100}})(t,n.assets),m={fr:n.fr,ip:n.ip,op:n.op},f={id:(0,R.xv)(),type:e,ind:t.ind,parent:t.parent,props:Jd(Yd({name:t.nm},u),{visible:!(t.ip-n.ip>n.ip)}),nodes:[],scripts:vp(null==(r=t.ks)?void 0:r.o,m.fr,{count:c,gap:s,duration:d}).concat(bp(null==(o=t.ks)?void 0:o.r,m.fr,{count:c,gap:s,duration:d})).concat(hp(null==(a=t.ks)?void 0:a.s,m.fr,{count:c,gap:s,duration:d})).concat(yp(null==(l=t.ks)?void 0:l.p,m.fr,{count:c,gap:s,duration:d})).concat(fp(m,t.ip,p))};if(u.width>0&&u.height>0){f.scripts=f.scripts.concat(gp(null==(i=t.ks)?void 0:i.a,m.fr,u.width,u.height,{count:c,gap:s,duration:d}));const e=np(t,n,md(f.props),{x:f.props.x,y:f.props.y});e&&f.nodes.push(e)}return f},op=(e,t)=>{const n=rp("Container",e,t);return delete n.props.url,e.shapes.forEach((t=>{const r=t.it.find((e=>"rc"==e.ty));if(r){const e=ip(r,t);ap(e,t),lp(e,t),n.props.width=0,n.props.height=0,n.nodes.push(e)}else Qd._errors.push(`不支持 “${e.nm} ${t.nm}”`)})),n},ap=(e,t)=>{const n=t.it.find((e=>"fl"==e.ty));if(n){const t=n.c,r=sd(t.k[0])?t.k[0].s:t.k,o=n.o,a=(0,Ne.isArray)(o.k)?o.k[0].s[0]:o.k;e.props.fillColor=`rgba(${255*r[0]}, ${255*r[1]}, ${255*r[2]}, ${r[3]*a/100})`}},lp=(e,t)=>{const n=t.it.find((e=>"st"==e.ty));if(n){const t=n.c,r=sd(t.k[0])?t.k[0].s:t.k,o=n.o,a=(0,Ne.isArray)(o.k)?o.k[0].s[0]:o.k,l=n.w,i=(0,Ne.isArray)(l.k)?l.k[0].s[0]:l.k;e.props.lineColor=`rgba(${255*r[0]}, ${255*r[1]}, ${255*r[2]}, ${r[3]*a/100})`,e.props.lineWidth=i}},ip=(e,t)=>{const n=e.s,r=sd(n.k[0])?n.k[0].s:n.k,o=e.r,a=(0,Ne.isArray)(o.k)?o.k[0].s[0]:o.k,l=e.p,i=sd(l.k[0])?l.k[0].s:l.k,c=t.it.find((e=>"tr"==e.ty)),s=c.a,d=sd(s.k[0])?s.k[0].s:s.k,p=c.s,u=sd(p.k[0])?p.k[0].s:p.k,m=c.r,f=(0,Ne.isArray)(m.k)?m.k[0].s[0]:m.k,y=c.p,g=hd([r[0]/2+d[0]-i[0],r[1]/2+d[1]-i[1]],sd(y.k[0])?y.k[0].s:y.k),h={id:(0,R.xv)(),type:"Shape",props:{name:e.nm,shapeType:"rectangle",width:r[0],height:r[1],roundedSize:a,x:g[0],y:g[1],scaleX:u[0]/100,scaleY:u[1]/100,rotation:f,alpha:1},nodes:[]},v=i[0]-d[0],b=i[1]-d[1];return h.props.anchorX=.5-v/r[0],h.props.anchorY=.5-b/r[1],h},cp=(e,t)=>{var n;const r=rp("Text",e,t);delete r.url;const o=e.t.d.k[0].s,a=o.fc;r.props.color=`rgba(${255*a[0]},${255*a[1]},${255*a[2]},1)`,r.props.fontSize=o.s,r.props.text=o.t.replaceAll("\r","\r\n"),r.props.valign="middle";const l=r.props.text.split("\r\n").length;r.props.height=l*o.lh;const i=((e,t)=>{let n=document.querySelector("#lottie-svg");n||(n=document.createElementNS("http://www.w3.org/2000/svg","svg"),n.setAttribute("xmlns","http://www.w3.org/2000/svg"),n.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink"),n.setAttribute("viewBox",`0 0 ${e.width} ${e.height}`),n.setAttribute("width",`${e.width}`),n.setAttribute("height",`${e.height}`),n.setAttribute("id","lottie-svg"),n.setAttribute("preserveAspectRatio","xMidYMid meet"),n.setAttribute("style","position:fixed; top:0; left:0; transform: translate3d(0px, 0px, 0px); visibility:hidden;"),document.body.appendChild(n)),n.innerHTML="";const r=document.createElementNS("http://www.w3.org/2000/svg","g");r.setAttribute("fill",t.color),r.setAttribute("font-family",t.font),r.setAttribute("font-size",`${t.fontSize}`),r.setAttribute("font-style","normal"),r.setAttribute("font-weight","normal"),r.setAttribute("opacity","1"),r.setAttribute("display","block"),n.appendChild(r);const o=document.createElementNS("http://www.w3.org/2000/svg","text");o.setAttribute("text-anchor","start"),o.setAttribute("letter-spacing","0"),r.appendChild(o);const a=t.text.split("\r\n"),l=t.height/a.length;return a.forEach(((e,t)=>{const n=document.createElementNS("http://www.w3.org/2000/svg","tspan");n.setAttribute("x","0"),n.setAttribute("y",""+l*t),n.textContent=e,o.appendChild(n)})),r.getBoundingClientRect()})({width:t.w,height:t.h},Jd(Yd({},r.props),{font:o.f}));let c=0;switch(o.j){case 2:c+=i.width/2,r.props.align="center";break;case 1:c+=i.width,r.props.align="right";break;default:r.props.align="left"}r.props.width=i.width;const s=i.left-c,d=i.top;r.props.anchorX-=s/r.props.width,r.props.anchorY-=d/r.props.height,r.props.x+=s,r.props.y+=d;const{count:p,gap:u}=Ed(e._loop),m=e.op-e.ip;r.scripts=r.scripts.concat(gp(null==(n=e.ks)?void 0:n.a,t.fr,r.props.width,r.props.height,{count:p,gap:u,duration:m}));const f=np(e,t,md(r.props),{x:r.props.x,y:r.props.y});return f&&r.nodes.push(f),r},sp=(e,t)=>{const n=t.assets.find((t=>t.id==e.refId)),r=e.op-e.ip,{count:o,gap:a}=Ed(e._loop);return{id:(0,R.xv)(),type:"Sound",ind:e.ind,parent:e.parent,props:{name:e.nm,url:`${n.u}${n.p}`},scripts:mp(t.fr,e.nm,e.ip,e.op,{count:o,gap:a,duration:r})}},dp=(e,t)=>{const n=rp("Video",e,t);if(e.tm){const r=t._projectId,o=t._dispatch,a=n.props.url;n.type="Sprite",n.props.url="",pp(n,a,e.tm.k,r,(e=>{o((0,N.changeProps)([n.id],{url:e.url}))}))}else{const r=e.op-e.ip,{count:o,gap:a}=Ed(e._loop);n.scripts=n.scripts.concat(mp(t.fr,e.nm,e.ip,e.op,{count:o,gap:a,duration:r}))}return n},pp=(e,t,n,r,o)=>{const a=document.createElement("video"),l=e.props;a.muted=!0,a.setAttribute("crossOrigin","Anonymous"),a.src=(0,De.GR)(t),a.width=l.width,a.height=l.height,a.play();const i=document.createElement("canvas");i.width=l.width,i.height=l.height;const c=i.getContext("2d");a.onplay=()=>{a.currentTime=n},c&&(a.onseeked=()=>{return void 0,null,e=function*(){a.pause(),c.drawImage(a,0,0,l.width,l.height),i.toBlob((e=>{e&&(0,Te.SN)(Yd({file:new File([e],`${l.name}.jpg`),type:5},{projectId:r})).then(o)}),"image/jpeg",.8)},new Promise(((t,n)=>{var r=t=>{try{a(e.next(t))}catch(e){n(e)}},o=t=>{try{a(e.throw(t))}catch(e){n(e)}},a=e=>e.done?t(e.value):Promise.resolve(e.value).then(r,o);a((e=e.apply(undefined,null)).next())}));var e})},up=(e,t)=>{const n=rp("Container",e,t),r=t.assets,o=r.find((t=>t.id==e.refId)),a=Nd(r,Fd(o.layers)),{count:l,gap:i}=Ed(e._loop),c=e.op-e.ip;return n.nodes=n.nodes.concat(a.reduce(((e,n,r)=>{const o=tp(n,t);if(o){o.props.asMask=gd(r,a);const s=[];for(let e=0;e<l;e++)o.scripts.forEach((r=>{const a=(0,Ne.cloneDeep)(r);a.id=(0,R.xv)(),a.props.time+=(e+1)*(c+i)/t.fr*1e3,s.push(a),dd(o,((e+1)*(c+i)+n.ip)/t.fr*1e3)}));o.scripts=o.scripts.concat(s),e.push(o)}else Qd._errors.push(`不支持 “${n.nm}” ${bd(n.ty)}节点`);return e}),[]).reverse()),Md(n.nodes),Rd(n),n},mp=(e,t,n,r,o)=>{const a=r-n,l=[];return l.push({id:(0,R.xv)(),type:"Controller",props:{script:"Controller",name:t,time:(n-Qd.ip)/e*1e3,loop:o.count>0,loopInterval:o.count>0?(o.gap+o.duration-a)/e*1e3:0,duration:a/e*1e3}}),l},fp=(e,t,n)=>{const r=e.fr,o=[];return t>e.ip&&o.push({id:(0,R.xv)(),type:"Effect",props:{name:"立即出现",script:"ImmediateIO",time:(t-e.ip)/r*1e3,duration:0,__script:["inEffect","ImmediateIO_立即出现"]}}),n<=e.op&&o.push({id:(0,R.xv)(),type:"Effect",props:{name:"立即消失",isInEffect:!1,script:"ImmediateIO",time:(n-e.ip)/r*1e3,duration:0,__script:["outEffect","ImmediateIO_立即消失"]}}),o},yp=(e,t,n)=>{const r=null==e?void 0:e.k,o=[];if(sd(r[0]))for(let e=0;e<r.length-1;e++){const a=r[e],l=r[e+1];if((0,Ne.isEqual)(a.s,l.s))continue;const i=l.t-a.t,c={id:(0,R.xv)(),type:"Effect",props:{name:"位移动画",script:"Move",presetAnchor:!1,duration:(l.t-a.t)/t*1e3,time:(a.t-Qd.ip)/t*1e3,ease:vd(a.i,a.o),loop:n.count>0,loopInterval:n.count>0?(n.gap+n.duration-i)/t*1e3:0,distanceX:l.s[0]-a.s[0],distanceY:l.s[1]-a.s[1],__script:["baseEffect","Move_位移动画"]}};o.push(c)}return o},gp=(e,t,n,r,o)=>{const a=null==e?void 0:e.k,l=[];if(sd(a[0]))for(let e=0;e<a.length-1;e++){const i=a[e],c=a[e+1];if((0,Ne.isEqual)(i.s,c.s))continue;const s=c.t-i.t,d={id:(0,R.xv)(),type:"Effect",props:{name:"锚点动画",script:"Anchor",duration:(c.t-i.t)/t*1e3,time:(i.t-Qd.ip)/t*1e3,ease:vd(i.i,i.o),loop:o.count>0,loopInterval:o.count>0?(o.gap+o.duration-s)/t*1e3:0,axisX:(c.s[0]-i.s[0])/n,axisY:(c.s[1]-i.s[1])/r,__script:["baseEffect","Anchor_锚点动画"]}},p={id:(0,R.xv)(),type:"Effect",props:{name:"位移动画",script:"Move",presetAnchor:!1,duration:(c.t-i.t)/t*1e3,time:(i.t-Qd.ip)/t*1e3,ease:vd(i.i,i.o),loop:o.count>0,loopInterval:o.count>0?(o.gap+o.duration-s)/t*1e3:0,distanceX:i.s[0]-c.s[0],distanceY:i.s[1]-c.s[1],__script:["baseEffect","Move_位移动画"]}};l.push(d),l.push(p)}return l},hp=(e,t,n)=>{const r=null==e?void 0:e.k,o=[];if(sd(r[0]))for(let e=0;e<r.length-1;e++){const a=r[e],l=r[e+1];if((0,Ne.isEqual)(a.s,l.s))continue;const i=l.t-a.t,c={id:(0,R.xv)(),type:"Effect",props:{name:"缩放到",script:"ScaleTo",presetAnchor:!1,duration:(l.t-a.t)/t*1e3,time:(a.t-Qd.ip)/t*1e3,ease:vd(a.i,a.o),loop:n.count>0,loopInterval:n.count>0?(n.gap+n.duration-i)/t*1e3:0,scaleX:l.s[0]/100,scaleY:l.s[1]/100,__script:["baseEffect","ScaleTo_缩放到"]}};o.push(c)}return o},vp=(e,t,n)=>{const r=null==e?void 0:e.k,o=[];if((0,Ne.isArray)(r))for(let e=0;e<r.length-1;e++){const a=r[e],l=r[e+1];if((0,Ne.isEqual)(a.s,l.s))continue;const i=l.t-a.t,c={id:(0,R.xv)(),type:"Effect",props:{name:"透明动画",script:"AlphaTo",duration:i/t*1e3,time:(a.t-Qd.ip)/t*1e3,ease:vd(a.i,a.o),loop:n.count>0,loopInterval:n.count>0?(n.gap+n.duration-i)/t*1e3:0,alpha:l.s[0]/100,__script:["baseEffect","AlphaTo_透明动画"]}};o.push(c)}return o},bp=(e,t,n)=>{const r=null==e?void 0:e.k,o=[];if((0,Ne.isArray)(r))for(let e=0;e<r.length-1;e++){const a=r[e],l=r[e+1];if((0,Ne.isEqual)(a.s,l.s))continue;const i=l.t-a.t,c={id:(0,R.xv)(),type:"Effect",props:{name:"旋转动画",script:"Rotate",presetAnchor:!1,duration:i/t*1e3,time:(a.t-Qd.ip)/t*1e3,ease:vd(a.i,a.o),loop:n.count>0,loopInterval:n.count>0?(n.gap+n.duration-i)/t*1e3:0,rotateRange:l.s[0]-a.s[0],__script:["baseEffect","Rotate_旋转动画"]}};o.push(c)}return o};var Ep,xp,kp,wp,Sp,Op=n(42809),Zp=n(23247),Pp=n.n(Zp),Cp=n(3197),Ip=Object.defineProperty,jp=Object.defineProperties,Ap=Object.getOwnPropertyDescriptors,Mp=Object.getOwnPropertySymbols,Dp=Object.prototype.hasOwnProperty,Np=Object.prototype.propertyIsEnumerable,Tp=(e,t,n)=>t in e?Ip(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Rp=(e,t,n,r)=>{return void 0,null,o=function*(){if(t.editor.playing)return;const{id:o}=t;if(o){const{id:t,orderId:l}=yield Cp.aY({projectId:o,name:n.name,sceneContent:JSON.stringify((0,R.GV)(n))});e((0,N.addScene)((a=((e,t)=>{for(var n in t||(t={}))Dp.call(t,n)&&Tp(e,n,t[n]);if(Mp)for(var n of Mp(t))Np.call(t,n)&&Tp(e,n,t[n]);return e})({},n),jp(a,Ap({sceneId:t,orderId:l}))),r))}else e((0,N.addScene)(n,r));var a},new Promise(((e,t)=>{var n=e=>{try{a(o.next(e))}catch(e){t(e)}},r=e=>{try{a(o.throw(e))}catch(e){t(e)}},a=t=>t.done?e(t.value):Promise.resolve(t.value).then(n,r);a((o=o.apply(undefined,null)).next())}));var o},Fp=n(66716),Lp=n(1850),zp=n(23530),$p=n(39089),Bp=["title","titleId"];function Vp(){return Vp=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Vp.apply(this,arguments)}var Hp=function(e,t){var n=e.title,o=e.titleId,a=function(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}(e,Bp);return r.createElement("svg",Vp({width:37,height:37,viewBox:"0 0 37 37",fill:"none",xmlns:"http://www.w3.org/2000/svg",ref:t,"aria-labelledby":o},a),n?r.createElement("title",{id:o},n):null,Ep||(Ep=r.createElement("path",{d:"M12.7131 26.5312H24.17C24.7518 26.5312 25.2253 27 25.2288 27.5797C25.2288 28.1594 24.7556 28.6279 24.17 28.6279H12.7131C12.1276 28.6279 11.6543 28.1594 11.6543 27.5797C11.6543 27 12.1276 26.5312 12.7131 26.5312Z",fill:"#C1C1C1"})),xp||(xp=r.createElement("path",{d:"M25.7988 6.18821H11.2808C10.8435 6.18821 10.4893 5.8339 10.4893 5.40468C10.4893 4.97174 10.8435 4.62109 11.2808 4.62109H25.7988C26.2361 4.62109 26.5903 4.97174 26.5903 5.40468C26.5903 5.83757 26.2361 6.18821 25.7988 6.18821Z",fill:"#C1C1C1"})),kp||(kp=r.createElement("path",{d:"M26.6107 10.2273H10.1159C9.67843 10.2273 9.32072 9.87663 9.32424 9.44369C9.32424 9.01076 9.67843 8.66016 10.1159 8.66016H26.6107C27.048 8.66016 27.4022 9.01076 27.4022 9.44369C27.4022 9.87663 27.048 10.2273 26.6107 10.2273Z",fill:"#C1C1C1"})),wp||(wp=r.createElement("path",{d:"M27.8769 14.2628H8.94965C8.51234 14.2628 8.1582 13.9087 8.1582 13.4793C8.1582 13.0464 8.51234 12.6957 8.94965 12.6957H27.8769C28.3143 12.6957 28.6684 13.0464 28.6684 13.4793C28.6684 13.9122 28.3143 14.2628 27.8769 14.2628Z",fill:"#C1C1C1"})),Sp||(Sp=r.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M31.3419 2.72997L36.3113 18.4625C36.5208 18.8989 36.6473 19.3856 36.6473 19.9009V32.8674C36.6473 34.7424 35.1041 36.2702 33.2104 36.2702H3.43696C1.54324 36.2702 0 34.7424 0 32.8674V19.9009C0 19.3856 0.12654 18.9026 0.332456 18.4625L5.3056 2.72648C5.79337 1.17349 7.46686 0 9.19807 0H27.4495C29.1806 0 30.8539 1.17349 31.3419 2.72997ZM33.2104 33.6506C33.644 33.6506 34.0019 33.3 34.0019 32.867H33.9982V19.9004C33.9982 19.471 33.644 19.1169 33.2067 19.1169H24.1137C23.004 21.2457 20.7849 22.6233 18.3238 22.6233C15.8625 22.6233 13.6399 21.2494 12.5302 19.1169H3.43699C2.99968 19.1169 2.64553 19.4675 2.64553 19.9004V32.867C2.64553 33.2964 2.99968 33.6506 3.43699 33.6506H33.2104ZM9.19455 2.61719C8.63793 2.61719 7.97297 3.04659 7.82845 3.50449L3.72266 16.4999H13.4015C13.9653 16.4999 14.4675 16.854 14.6519 17.3836C15.194 18.9509 16.6686 20.0063 18.324 20.0063C19.9791 20.0063 21.4537 18.9509 21.9958 17.3836C22.1765 16.854 22.6824 16.4962 23.2463 16.4962H32.925L28.8194 3.50815C28.6856 3.08591 28.0749 2.61719 27.4497 2.61719H9.19455Z",fill:"#C1C1C1"})))},Gp=(0,r.forwardRef)(Hp),_p=(n.p,n(69808)),Up=n(22142),Wp=Object.defineProperty,Kp=Object.defineProperties,Xp=Object.getOwnPropertyDescriptors,Yp=Object.getOwnPropertySymbols,Jp=Object.prototype.hasOwnProperty,qp=Object.prototype.propertyIsEnumerable,Qp=(e,t,n)=>t in e?Wp(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,eu=(e,t)=>{for(var n in t||(t={}))Jp.call(t,n)&&Qp(e,n,t[n]);if(Yp)for(var n of Yp(t))qp.call(t,n)&&Qp(e,n,t[n]);return e},tu=(e,t)=>Kp(e,Xp(t));function nu(){const{getState:e,dispatch:t}=(0,a.oR)(),n=(0,N.useProject)("type"),{propsMode:r}=(0,N.useEditor)(0,"propsMode");return"Project"===n&&"Project"===r?Up.createElement("div",{className:"scene-history"},Up.createElement(ie.Z,{title:"历史回退",placement:"top"},Up.createElement(ce.Z,{size:"small",type:"default",icon:Up.createElement(oe.Z,{component:_p.Z,onClick:()=>{const{project:n}=e();t((0,N.restoreState)(tu(eu({},n),{type:"History",editor:tu(eu({},n.editor),{readOnly:!0})})))}})}))):null}var ru=n(9904),ou=n(4285),au={};au.styleTagTransform=w(),au.setAttributes=b(),au.insert=h().bind(null,"head"),au.domAPI=y(),au.insertStyleElement=x(),m()(ou.Z,au),ou.Z&&ou.Z.locals&&ou.Z.locals;var lu=n(22142),iu=(0,r.memo)((({index:e,editor:t,orderId:n})=>{const{showImDialog:o}=(0,N.useImbot)(),a=((e,{loading:t,playable:n})=>{const[o,a]=(0,r.useState)();return(0,N.useSubscribe)((t=>{var n;try{const{project:r}=t();if(4!==r.settings.typeOfPlay){const{scenes:n}=(0,R.qU)(t().project);return n.find((t=>t.orderId===e))?a():a({title:"未用场景",content:"当前场景没有被使用，该场景包含的转化按钮以及图片素材等都将被忽略不计。如需使用当前场景，请确保从主场景用“切换场景”事件直接或间接跳转至当前场景。"})}const o=(0,Ze.zl)(r.scenes),l=(0,Ze.Qs)((0,Ze.v4)(e,r.scenes));return a({title:`${null!=(n=o[e])?n:""} ${l}`,content:`${l}视频，层级${o[e]}`})}catch(e){console.error(e)}}),1600),n?{title:"加载页",content:"加载页不支持复制、删除、移动页面顺序。此页面的配置信息由抖音端在加载直出互动时进行播放"}:t?{title:"加载页",content:"加载页面不支持复制、删除、移动页面顺序。此页面只在加载较慢的情况下出现，理想情况下不出现"}:o})(n,t),{token:l}=c.Z.useToken();if(!a)return lu.createElement("div",{className:(0,mt.cx)("scene-item-index",(0,mt.iv)({background:l.colorBgMask}))},`${e}`.padStart(2,"0"));const{title:i,content:s}=a;return lu.createElement("div",{className:(0,mt.cx)("scene-item-loading",(0,mt.iv)({background:l.colorBgMask}))},i," ",lu.createElement(Kc.sg,{title:s+"(点击?查看详细解释)",placement:"bottomLeft"},lu.createElement(oe.Z,{component:ru.Z,onClick:e=>{e.stopPropagation(),o(i)}})))})),cu=n(26107),su=n(62203),du=n(43465),pu=n(67271),uu=n(20572),mu=n(36006),fu=Object.defineProperty,yu=Object.defineProperties,gu=Object.getOwnPropertyDescriptors,hu=Object.getOwnPropertySymbols,vu=Object.prototype.hasOwnProperty,bu=Object.prototype.propertyIsEnumerable,Eu=(e,t,n)=>t in e?fu(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,xu=(e,t)=>{for(var n in t||(t={}))vu.call(t,n)&&Eu(e,n,t[n]);if(hu)for(var n of hu(t))bu.call(t,n)&&Eu(e,n,t[n]);return e};var ku=n(22142),wu=Object.defineProperty,Su=Object.defineProperties,Ou=Object.getOwnPropertyDescriptors,Zu=Object.getOwnPropertySymbols,Pu=Object.prototype.hasOwnProperty,Cu=Object.prototype.propertyIsEnumerable,Iu=(e,t,n)=>t in e?wu(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,ju=(e,t)=>{for(var n in t||(t={}))Pu.call(t,n)&&Iu(e,n,t[n]);if(Zu)for(var n of Zu(t))Cu.call(t,n)&&Iu(e,n,t[n]);return e},Au=(e,t)=>Su(e,Ou(t)),Mu=(e,t,n)=>new Promise(((r,o)=>{var a=e=>{try{i(n.next(e))}catch(e){o(e)}},l=e=>{try{i(n.throw(e))}catch(e){o(e)}},i=e=>e.done?r(e.value):Promise.resolve(e.value).then(a,l);i((n=n.apply(e,t)).next())}));const Du=e=>ku.createElement(cu.Z,Au(ju({},e),{theme:"filled",fill:"#333"})),Nu=e=>ku.createElement(su.Z,Au(ju({},e),{theme:"filled",fill:"#333"}));var Tu=(0,r.memo)((({scene:e,deletable:t})=>{const{dispatch:n,getState:o}=(0,a.oR)(),i=(0,r.useCallback)(((e,t)=>{n((0,N.changeEditor)(e,{lockCapture:t},!1,l.ActionFlag.SideEffect))}),[n]),[c,s]=(0,r.useState)(!1),d=(0,r.useCallback)((()=>{s(!1)}),[]),p=(0,r.useCallback)((e=>Mu(void 0,null,(function*(){const{project:t}=o();if(t.editor.playing)throw new Error("正在播放不能删除！");const r=t.scenes.filter((({type:e})=>"Scene"===e));if(r.length<2)throw new Error("最后一个场景不能删除！");if(r.length<3)throw new Error("请保留一个非加载场景作为主场景！");if(t.id){const r=(0,R.zh)(t,e);yield Cp.r4(r.sceneId).then((()=>{n((0,N.deleteScene)(e))}))}else n((0,N.deleteScene)(e))}))),[n,o]),u=(0,r.useCallback)((e=>{const{scenes:t}=o().project,r=t.findIndex((t=>t.id===e));if(r>-1)return Rp(n,o().project,(0,N.copyScene)(t[r]),r+1)}),[n,o]),m=(0,r.useCallback)((t=>Mu(void 0,null,(function*(){const n=o().project;if(e)return((e,t,n)=>{return r=function*(){const{name:r,cover:o,description:a,platformTags:l,isAuthControl:i}=n,{scenes:c,customScripts:s}=(0,R.Lu)(e,t,n.orderIds),{previewUrl:d}=yield(0,Te.D5)(o||t.editor.capture||"","cover.png");return(0,Li.hM)({name:r||t.name,file:new File([JSON.stringify({scenes:c.map((e=>(0,R.GV)(e))),customScripts:s,settings:(p=xu({},e.settings),u={sceneOrders:c.filter((({type:e})=>"Scene"===e)).map((({orderId:e})=>e))},yu(p,gu(u)))})],"data.json",{type:"application/json"}),cover:d,onPlatform:!0,type:26,description:a,platformTags:l,isAuthControl:null!=i&&i});var p,u},new Promise(((e,t)=>{var n=e=>{try{a(r.next(e))}catch(e){t(e)}},o=e=>{try{a(r.throw(e))}catch(e){t(e)}},a=t=>t.done?e(t.value):Promise.resolve(t.value).then(n,o);a((r=r.apply(void 0,null)).next())}));var r})(n,e,t)}))),[o,e]),[f,y]=(e=>{const{cover:t="",onChange:n}=(0,N.useEditor)(0,"cover"),r=`?orderId=${e}`;return[t.includes(r),()=>{t.includes(r)?n(t.split("?orderId=")[0]):n(`${t.split("?orderId=")[0]}${r}`)}]})(e.orderId),g=(0,N.useHasUserPermission)("publishScenes"),h=(0,N.useSettings)("enabled3d"),v=(0,N.useSettings)("typeOfPlay"),{loading:b}=e.editor,{lockCapture:E}=(0,Lp.a)(e.id,{lockCapture:"editor.lockCapture"});return ku.createElement("div",{className:"scene-ops",style:{transformOrigin:"0 0",transform:"scale(0.9)"},onClick:e=>{e.stopPropagation()}},!b&&ku.createElement(ie.Z,{title:"复制场景",placement:"bottom"},ku.createElement(ce.Z,{size:"small",type:"default",icon:ku.createElement(oe.Z,{component:du.Z}),onClick:()=>{u(e.id)}})),!b&&g&&!h&&0===v&&ku.createElement(ku.Fragment,null,ku.createElement(ie.Z,{title:"发布场景",placement:"bottom"},ku.createElement(ce.Z,{size:"small",type:"default",icon:ku.createElement(oe.Z,{component:pu.Z}),onClick:()=>{e.name?e.nodes.length?s(!0):Pe.ZP.error("不能发布空白场景"):Pe.ZP.error("不能发布未命名场景")}})),c&&ku.createElement(mu.Z,{resourceType:"Scene",scene:e,onPublish:m,onClose:d})),ku.createElement(ie.Z,{title:E?"取消锁定":"锁定封面",placement:"bottom"},ku.createElement(ce.Z,{size:"small",type:"default",icon:ku.createElement(oe.Z,{component:E?Du:uu.Z}),onClick:()=>{i(e.id,!E)}})),ku.createElement(ie.Z,{title:f?"取消设置":"设为项目封面",placement:"bottom"},ku.createElement(ce.Z,{size:"small",type:"default",icon:ku.createElement(oe.Z,{component:f?Nu:su.Z}),onClick:y})),t&&ku.createElement(ie.Z,{title:"删除场景",placement:"bottom"},ku.createElement(ce.Z,{size:"small",type:"default",icon:ku.createElement(oe.Z,{component:ka.Z}),onClick:()=>{e.nodes.length?P.Z.confirm({okText:"确定",cancelText:"取消",title:"是否确定删除此场景？",onOk(){p(e.id).catch((e=>{Pe.ZP.error(e.message)}))}}):p(e.id).catch((e=>{Pe.ZP.error(e.message)}))}})))})),Ru=n(22142);const Fu=({sceneId:e,orderId:t,selected:n,sceneIndex:o,sceneDisabled:l})=>{var i;const[s,d]=(0,r.useState)(!1),{width:p,height:u}=(0,N.useProjectHeight)(132),{getSceneById:m,onSelectScene:f,onChangeSceneName:y}=(0,Lp.$)(),g=(e=>{const t=(0,r.useRef)(null);return(0,r.useEffect)((()=>{if(e&&t.current){const e=requestAnimationFrame((()=>{var e;null==(e=t.current)||e.scrollIntoView({block:"center",behavior:"smooth"})}));return()=>{cancelAnimationFrame(e)}}}),[e]),t})(n),{id:h,prevSceneId:v}=(0,a.v9)((({project:e})=>({id:e.id,prevSceneId:e.editor.selectedSceneId})),a.wU),{previewImage:b,sceneName:E}=(0,Lp.a)(e,{previewImage:"editor.capture",sceneName:"name"}),x=m(e),{token:k}=c.Z.useToken();return x?Ru.createElement("div",{key:e,ref:g,className:(0,mt.cx)("scene-item",n&&"scene-item-selected",n&&(0,mt.iv)({background:k.colorPrimaryBg,"& .scene-item-content":{borderColor:k.colorPrimaryBorder},"& .scene-item-name":{color:k.colorPrimaryText}})),onClick:()=>{const n=m(v);n&&n.id!==e&&(0,Oc.J1)(h,v,n),(0,$p.oA)(String(t)),f(e)},id:0===o?po.S6:void 0},Ru.createElement("div",{className:"scene-item-content",style:{width:p,height:u}},!l&&Ru.createElement(Tu,{scene:x,deletable:0!==o}),Ru.createElement(iu,{orderId:x.orderId,index:o,editor:x.editor}),Ru.createElement(nu,null),Ru.createElement("div",{className:"scene-item-preview",style:x.nodes.length<=0?{backgroundColor:"#fafafa"}:{backgroundColor:"white",backgroundImage:`url(${b})`}},x.nodes.length<=0&&Ru.createElement(xa.Z,{style:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",pointerEvents:"none"},description:Ru.createElement("span",{className:(0,mt.iv)({color:k.colorTextQuaternary})},"空白场景"),image:Ru.createElement(Gp,null),imageStyle:{width:37,height:37}})),Ru.createElement("div",{className:"scene-item-name",onDoubleClick:()=>{l||d(!0)}},s?Ru.createElement(it.Z,{size:"small",autoFocus:!0,defaultValue:(null==(i=x.name)?void 0:i.toString())||"",maxLength:20,onBlur:e=>{d(!1),y(x.id,e.target.value)},onPressEnter:e=>{d(!1),y(x.id,e.target.value)}}):Ru.createElement("div",null,E||"未命名场景")))):null};var Lu=(0,r.memo)((0,zp.W8)(Fu)),zu=(0,r.memo)((0,zp.JN)((({scenes:e,sceneDisabled:t,selectedId:n})=>r.createElement("div",{className:"scene-list"},e.map(((e,t)=>({scene:e,index:t}))).filter((({scene:e})=>"Scene"===e.type)).map((({scene:e,index:o},a)=>{const l=0===a?Fu:Lu;return r.createElement(l,{index:o,key:e.id,sceneId:e.id,orderId:e.orderId,sceneIndex:a,sceneDisabled:t,selected:e.id===n})})))))),$u=n(97287),Bu=n(99137),Vu=n.p+"images/356e8d2809cb3a749628.png";function Hu({activeKey:e,visible:t,search:n,onFinish:o}){const[a,l]=(0,r.useState)(!1),[i,c]=(0,r.useState)({id:"0",name:"全部"}),s=e=>{c({id:e.id,name:e.name})},[d,p]=(0,r.useState)([]),[u,m]=(0,r.useState)(null);return(0,r.useEffect)((()=>{(0,Li.zs)({category:9,pageSize:999,origin:1,parentName:"场景"}).then((({tags:e})=>{e.sort(((e,t)=>"112001"===t.id&&"其他"===t.name?-1:1)),p(e)}))}),[]),(0,r.useEffect)((()=>{t&&e===Ju.Public&&(l(!0),(0,Li.YZ)(Object.assign({page:1,pageSize:999,sort:"created_at desc",types:"26",statuses:"1",onPlatform:!0},n?{keyword:n}:{},"0"!==i.id?{tagIds:i.id}:{})).then((({materialList:e})=>{m(e),l(!1)})))}),[e,i,n,t]),n?(null==u?void 0:u.length)?r.createElement(j.Z,{spinning:a},r.createElement("div",{style:{height:580,padding:"16px 24px",overflowY:"auto"}},r.createElement(em,{scenesList:u,title:`"${n}"的搜索结果`,onFinish:o}))):r.createElement("div",{style:{height:580,padding:"16px 24px"}},r.createElement(xa.Z,{imageStyle:{height:260,marginTop:130},image:Vu,description:"未找到符合搜索条件的场景模板"})):r.createElement("div",{style:{display:"flex"}},r.createElement("div",{style:{flexBasis:190,boxShadow:"0px 2px 4px 0px #00000025",marginTop:16,display:"flex",flexDirection:"column",maxHeight:"580px",overflow:"scroll"}},r.createElement("a",{style:{padding:"12px 12px 12px 40px",cursor:"pointer"},className:"0"===i.id?Yu.selectedType:"",onClick:()=>s({id:"0",name:"全部"})},"全部"),d.map((e=>r.createElement("a",{key:e.id,style:{padding:"12px 12px 12px 40px",cursor:"pointer"},className:i.id===e.id?Yu.selectedType:"",onClick:()=>{s(e),(0,R.r3)(R.GM.SceneLibrary,{type:"分类选择",value:e.name})}},e.name)))),r.createElement("div",{style:{flex:1}},u?u.length?r.createElement(j.Z,{spinning:a},r.createElement("div",{style:{height:580,padding:"16px 24px",overflow:"scroll"}},r.createElement(em,{title:i.name,onFinish:o,scenesList:u}))):r.createElement(j.Z,{spinning:a},r.createElement("div",{style:{height:580,padding:"16px 24px"}},r.createElement(xa.Z,{imageStyle:{height:260,marginTop:130},image:Vu,description:"未找到符合搜索条件的场景模板"}))):r.createElement(j.Z,{spinning:a},r.createElement("div",{style:{height:580,padding:"16px 24px"}}))))}var Gu=n.p+"images/dab404dd3b9c09c2d66f.png";function _u({activeKey:e,visible:t,search:n,onFinish:o}){const[a,l]=(0,r.useState)(!1),[i,c]=(0,r.useState)(null);return(0,r.useEffect)((()=>{t&&e===Ju.Recent&&(l(!0),(0,Li.bT)({types:26,keyword:n||""}).then((({list:e})=>{c(e),l(!1)})))}),[e,n,t]),i?i.length?r.createElement(j.Z,{spinning:a},r.createElement("div",{style:{height:580,padding:"16px 24px",overflowY:"auto"}},r.createElement(em,{scenesList:i,onFinish:o,title:n?`"${n}"的搜索结果`:void 0}))):r.createElement(j.Z,{spinning:a},r.createElement("div",{style:{height:580,padding:"16px 24px"}},r.createElement(xa.Z,{imageStyle:{height:260,marginTop:130},image:Gu,description:"未找到最近使用的场景模板"}))):r.createElement(j.Z,{spinning:a},r.createElement("div",{style:{height:580,padding:"16px 24px"}}))}var Uu=n(40643),Wu={};Wu.styleTagTransform=w(),Wu.setAttributes=b(),Wu.insert=h().bind(null,"head"),Wu.domAPI=y(),Wu.insertStyleElement=x(),m()(Uu.Z,Wu),Uu.Z&&Uu.Z.locals&&Uu.Z.locals;const{TabPane:Ku}=qi.Z,Xu={btn:(0,mt.iv)({display:"none",position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)"}),desc:(0,mt.iv)({padding:"12px 9px",overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis"}),mask:(0,mt.iv)({position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",display:"none"})},Yu={selectedType:(0,mt.iv)({background:"#EEF3FE",color:"#3955F6!important"}),scenesSection:(0,mt.iv)({display:"flex",flexWrap:"wrap"}),sceneItem:(0,mt.iv)({width:200,margin:"0 18px 18px 0",border:"1px solid #EEEEEE",borderRadius:"4px",cursor:"pointer",[`&:hover .${Xu.mask}`]:{display:"block"},[`&:hover .${Xu.btn}`]:{display:"block"},[`&:hover .${Xu.desc}`]:{display:"none"},".ant-btn":{padding:"4px 46px"}}),scenePreview:(0,mt.iv)({height:356,borderRadius:"4px 4px 0 0",position:"relative"}),sceneFooter:(0,mt.iv)({position:"relative",height:44})};var Ju,qu;function Qu({visible:e,loading:t,onFinish:n,title:o="选择模板场景"}){const[a,l]=(0,r.useState)(""),[i,c]=(0,r.useState)(""),[s,d]=(0,r.useState)("1");return r.createElement(P.Z,{className:"sceneModal",open:e,onCancel:()=>n(),footer:null,width:1160,destroyOnClose:!0,afterClose:()=>{d("1"),l(""),c("")},title:r.createElement(j.Z,{spinning:t},r.createElement("div",{style:{padding:"16px 24px"}},o),r.createElement("div",{style:{position:"relative"}},r.createElement(qi.Z,{centered:!0,defaultActiveKey:"1",tabBarExtraContent:r.createElement("div",{style:{position:"absolute",right:24,top:7}},r.createElement(it.Z.Search,{placeholder:"请输入",allowClear:!0,value:a,onChange:e=>{l(e.currentTarget.value),e.currentTarget.value||c("")},onSearch:()=>{(0,R.r3)(R.GM.SceneLibrary,{type:"场景搜索",value:a}),c(a)},onBlur:()=>{a||c("")}})),onChange:e=>{d(e),l(""),c(""),(0,R.r3)(R.GM.SceneLibrary,{type:"1"===e?"点击公共场景":"点击最近使用"})}},r.createElement(Ku,{key:Ju.Public,tab:"公共场景"},r.createElement(Hu,{activeKey:s,open:e,search:i,onFinish:n})),r.createElement(Ku,{key:Ju.Recent,tab:"最近使用"},r.createElement(_u,{activeKey:s,open:e,search:i,onFinish:n})))))})}function em({scenesList:e,title:t,onFinish:n}){const o=(0,r.useRef)(null),{clearIframe:a,postMessage:l}=(0,Sl.s_)(o),[i,c]=(0,r.useState)(0),[s,d]=(0,r.useState)(0),[p,u]=(0,r.useState)(!1),m=(e,t,n)=>{c(e),d(t),u(!0),o.current&&l({type:"change",url:n,projectType:"scene"})};return r.createElement("section",{style:{position:"relative"}},t&&r.createElement("div",{style:{fontSize:16,marginBottom:17},id:t},t),r.createElement("div",{className:Yu.scenesSection},e&&e.map(((e,t)=>r.createElement(tm,{key:t,scene:e,onFinish:n,onPreviewStart:m})))),r.createElement("div",{style:{left:`${i}px`,top:`${s}px`,width:198,height:356,position:"absolute",zIndex:1e3,visibility:p?"visible":"hidden"},onMouseLeave:()=>{u(!1),a()}},r.createElement(Sl.t1,{ref:o,width:198,height:356})))}function tm({scene:e,onFinish:t,onPreviewStart:n}){const{name:o,cover:a,url:l}=e;return r.createElement("div",{className:Yu.sceneItem},r.createElement("div",{className:Yu.scenePreview,onClick:e=>{const{offsetLeft:t,offsetTop:r}=e.currentTarget;n(t,r,l)}},r.createElement("div",{style:{width:"100%",height:"100%",backgroundImage:`url(${a})`,backgroundSize:"contain",backgroundRepeat:"no-repeat",backgroundPosition:"center",cursor:"pointer"}},r.createElement("div",{className:Xu.mask},r.createElement("div",{style:{opacity:.7}},r.createElement($u.Z,{theme:"filled",size:"50",fill:"#333"}))))),r.createElement("div",{className:Yu.sceneFooter},r.createElement(ce.Z,{className:Xu.btn,type:"primary",icon:r.createElement(Bu.Z,null),onClick:()=>{(0,R.r3)(R.GM.SceneLibrary,{type:"使用模板场景"}),t(e),(0,Li.LT)(e.id).catch((e=>console.log(e)))}},"立即使用"),r.createElement("div",{className:Xu.desc},o||"未命名场景")))}(qu=Ju||(Ju={})).Public="1",qu.Recent="2";var nm=n(22142),rm=Object.defineProperty,om=Object.defineProperties,am=Object.getOwnPropertyDescriptors,lm=Object.getOwnPropertySymbols,im=Object.prototype.hasOwnProperty,cm=Object.prototype.propertyIsEnumerable,sm=(e,t,n)=>t in e?rm(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,dm=(e,t)=>{for(var n in t||(t={}))im.call(t,n)&&sm(e,n,t[n]);if(lm)for(var n of lm(t))cm.call(t,n)&&sm(e,n,t[n]);return e},pm=(e,t,n)=>new Promise(((r,o)=>{var a=e=>{try{i(n.next(e))}catch(e){o(e)}},l=e=>{try{i(n.throw(e))}catch(e){o(e)}},i=e=>e.done?r(e.value):Promise.resolve(e.value).then(a,l);i((n=n.apply(e,t)).next())}));const um=(0,cd.Z)({selector:".editor-scenes",top:4,left:168}),mm=(e,t)=>{const{enable:n=!0,enabled:r=n}=t;return"Product"===e&&r};function fm(){const{dispatch:e,getState:t}=(0,a.oR)(),n=(0,a.v9)((({project:e})=>e)),{scenes:o,settings:l,editor:i}=n,s=3===l.typeOfPlay&&3===l.category,{selectedSceneId:d,playing:p,sceneMode:u,readOnly:m,settingsOn:f}=i,y="Product"===u||m,g=mm(u,l),{onSelectScene:h}=(0,Lp.$)(),v=(0,r.useCallback)(((t,n)=>{e((0,N.reorderScene)(t,n))}),[e]),{token:b}=c.Z.useToken();return nm.createElement("div",{className:(0,mt.cx)("editor-scenes",(0,mt.iv)({borderRight:`1px solid ${b.colorBorder}`}))},y||4!==l.typeOfPlay&&!s?!(0,At.Yt)(t().project)&&nm.createElement(gm,{disabled:p>0}):nm.createElement(ym,{disabled:p>0,typeOfPlay:l.typeOfPlay,category:l.category}),g&&nm.createElement(hm,{active:f}),nm.createElement(zu,{distance:4,scenes:o,lockAxis:"y",helperClass:(0,mt.iv)({zIndex:2}),sceneDisabled:y,selectedId:g&&f?0:d,onSortEnd:({oldIndex:e,newIndex:t})=>{e!==t&&v(e,t),o[e].id!==d&&h(o[e].id)}}))}const ym=({disabled:e,typeOfPlay:t,category:n})=>{const[o,l]=(0,r.useState)(!1),{dispatch:i,getState:c}=(0,a.oR)(),s=(0,N.useAddNode)(),d=3===t&&3===n;return nm.createElement("div",{className:(0,mt.iv)({padding:8})},nm.createElement(ce.Z,{disabled:e,icon:nm.createElement(le.Z,null),type:"primary",style:{width:"100%"},onClick:()=>{(0,R.r3)(R.GM.SceneLibrary,{type:"添加视频场景"}),l(!0)}},"添加视频场景"),o&&nm.createElement(um,{eleType:d?"VRVideo":"NativeVideo",onClose:()=>l(!1),onChange:e=>pm(void 0,[e],(function*({url:e,name:n,extra:r}){const{project:o}=c();yield Rp(i,o,(0,N.newScene)(n),o.scenes.length),yield s({mime:4===t?"PVVideo":d?"VRVideo":"Video",url:e,extra:r,name:n,mapNode(e){var t;return e.editor=(t=dm({},e.editor),om(t,am({isLocked:!0,isHidden:d}))),e.props.jumpSceneId=0,(0,R.kj)(e)}}),d&&(yield s({mime:"Scene3D",name:"VR3D场景",url:""})),l(!1)}))}))},gm=(0,r.memo)((({disabled:e})=>{const[t,n]=(0,r.useState)(!1),[o,l]=(0,r.useState)(!1),[i,c]=(0,r.useState)(!1),[s,d]=(0,r.useState)(!1),[p,u]=(0,r.useState)([]),{onAddNode:m}=(0,N.useOnAddNodeFromFiles)(),{dispatch:f,getState:y}=(0,a.oR)(),g=(0,N.useProject)("id"),h=(0,r.useCallback)((e=>pm(void 0,null,(function*(){try{const{project:t}=y();return pm(void 0,[{scene:e,project:t,dispatch:f}],(function*({scene:e,project:t,dispatch:n}){const{settings:r,scenes:o}=t,{width:a,height:l}=r;if(!(null==e?void 0:e.url)){const e=yield(0,N.newSceneAsync)("场景 "+(o.filter((({type:e})=>"Scene"===e)).length-1),{enabled3d:r.enabled3d,height:l,width:a});return Rp(n,t,e,o.length)}const{url:i,name:c}=e,{data:s}=yield Pp().get(i),{customScripts:d,scenes:p}=s,u=p.map((e=>(e.editor.moment=0,"Scene"===e.type&&(e.props.name=`${c} - ${e.props.name}`),(0,R.m7)(e))));return(0,Fp.Z)(n,t,u,o.length+p.length-1,d)}))}catch(e){console.log(e),Pe.ZP.error(e.message||"模板场景添加失败")}}))),[f,y]),v=(0,Ae.Z)((()=>{u([])}));return nm.createElement("div",{className:"scene-menu",id:po.wb},nm.createElement(L.Z.Button,{style:{width:"100%"},disabled:e,overlay:nm.createElement(F.Z,null,nm.createElement(F.Z.Item,{key:"1",style:{width:147},onClick:()=>{c(!0),(0,R.r3)(R.GM.SceneLibrary,{type:"场景库页面曝光"})}},"添加模板场景"),nm.createElement(F.Z.Item,{key:"2",onClick:()=>{n(!0),(0,R.r3)(R.GM.SceneLibrary,{type:"从 Figma 导入场景"})}},nm.createElement("span",null,"从Figma导入"),nm.createElement(ie.Z,{title:"点击查看帮助文档",placement:"bottom"},nm.createElement(id.Z,{style:{position:"absolute",right:10,top:"50%",marginTop:"-7px"},onClick:e=>{(0,R.r3)(R.GM.Tutorial,{type:"资源面板"}),e.stopPropagation(),window.open("https://magicplay.oceanengine.com/tutorials/docs/import-figma")}}))),nm.createElement(F.Z.Item,{key:"3",onClick:()=>{l(!0),(0,R.r3)(R.GM.SceneLibrary,{type:"从 PSD 导入场景"})}},nm.createElement("span",null,"从PSD导入"),nm.createElement(ie.Z,{title:"点击查看帮助文档",placement:"bottom"},nm.createElement(id.Z,{style:{position:"absolute",right:10,top:"50%",marginTop:"-7px"},onClick:e=>{(0,R.r3)(R.GM.Tutorial,{type:"资源面板"}),e.stopPropagation(),window.open("https://magicplay.oceanengine.com/tutorials/docs/import-psd")}}))),nm.createElement(Ce.BX,{uploading:s,accepts:".zip,.json",setUploading:d,beforeUpload:()=>e=>pm(void 0,null,(function*(){d(!0),f((0,N.changeEditor)(0,{loading:!0}));const t={projectId:g,distinct:!0},n=[];if((0,R.r3)(R.GM.UploadResource,{type:"用户上传量"}),"application/json"==e.type)try{const t=JSON.parse(String(yield(e=>new Promise((t=>{const n=new FileReader;n.onload=function(){t(n.result)},n.readAsText(e)})))(e))),n=ep(t,[]);yield h();const r=(0,R.zh)(y().project);setTimeout((()=>{f((0,N.addFromNode)(r.id,0,n))}),100),(0,R.r3)(R.GM.UploadResource,{type:"上传成功量"})}catch(e){console.log(e)}else{const r=new(je()),o=yield r.loadAsync(e),a=Object.entries(o.files),l=[],i=[];for(const[e,t]of a){const n=e.split("/"),r=n[n.length-1];e.startsWith("__MACOSX/")||t.dir||r.startsWith(".")||(r.endsWith(".png")||r.endsWith(".jpg")||r.endsWith(".jpeg")||r.endsWith(".mp4")||r.endsWith(".mp3")?l.push([e,t]):r.endsWith(".json")&&i.push([e,t]))}const c=[];let s=[];for(let e=0;e<l.length;e++){const n=yield l[e][1].async("blob"),r=l[e][0];r.endsWith(".mp4")?c.push((0,Te.rB)(dm({file:new File([n],r),type:6},t)).catch((e=>e))):r.endsWith(".mp3")?c.push((0,Te.rB)(dm({file:new File([n],r),type:8},t)).catch((e=>e))):c.push((0,Te.rB)(dm({file:new File([n],r),type:5},t)).catch((e=>e)))}c.length>0&&(s=(yield Promise.all(c)).reduce(((e,t,r)=>(t&&(t.url?e.push([l[r][0],(0,De.Hn)(t.url)]):t.message&&n.push(`${l[r][0]} ${t.message}`)),e)),[]));try{const e=JSON.parse(yield i[0][1].async("string"));e._projectId=g,e._dispatch=f,e._errors=n;const t=ep(e,s);yield h();const r=(0,R.zh)(y().project);setTimeout((()=>{f((0,N.addFromNode)(r.id,0,t))}),100),(0,R.r3)(R.GM.UploadResource,{type:"上传成功量"})}catch(e){console.warn(e),n.push(e.message)}}return u(n),d(!1),f((0,N.changeEditor)(0,{loading:!1})),!1})),onAddResourceEntry:()=>{}},nm.createElement(F.Z.Item,{onClick:()=>{(0,R.r3)(R.GM.SceneLibrary,{type:"从 AE(Lottie) 导入场景"})}},nm.createElement("span",null,"从AE(Lottie)导入"),nm.createElement(ie.Z,{title:"点击查看帮助文档",placement:"bottom"},nm.createElement(id.Z,{style:{position:"absolute",right:"-7px",top:"50%",marginTop:"-7px"},onClick:e=>{(0,R.r3)(R.GM.Tutorial,{type:"资源面板"}),e.stopPropagation(),window.open("https://magicplay.oceanengine.com/tutorials/docs/import-ae")}}))))),icon:nm.createElement(ys.Z,null),type:"primary",placement:"bottomRight",onClick:()=>{h(),(0,R.r3)(R.GM.SceneLibrary,{type:"添加空白场景"})},onOpenChange:e=>{e&&(0,R.r3)(R.GM.SceneLibrary,{type:"模版场景按钮曝光"})}},"添加空白场景"),nm.createElement(Qu,{visible:i,onFinish:e=>{e?(d(!0),h(e).then((()=>{d(!1),c(!1)}))):c(!1)},loading:s}),t&&nm.createElement(Ce.DV,{onFinish:e=>pm(void 0,null,(function*(){for(const{url:t,name:n}of e)yield h(),yield m({mime:"PSD",name:n,url:t});n(!1)})),onHide:()=>n(!1)}),o&&nm.createElement(Ce.Nn,{onFinish:e=>pm(void 0,null,(function*(){for(const{url:t,name:n}of e)yield h(),yield m({mime:"PSD",name:n,url:t});l(!1)})),onHide:()=>l(!1)}),nm.createElement(P.Z,{title:"提示",open:p.length>0,onOk:v,onCancel:v},p.map(((e,t)=>nm.createElement("p",{key:`msg-${t}`},e)))))})),hm=({active:e})=>{const t=(0,a.I0)(),n=(0,r.useCallback)((()=>{t((0,N.changeEditor)(0,{settingsOn:!0}))}),[t]);return nm.createElement(ce.Z,{type:"text",size:"large",icon:nm.createElement(oe.Z,{component:Op.Z}),onClick:n,style:{height:64,background:e?"#EEF3FE":"white",borderRadius:0}},"全局设置")};var vm=n(46641),bm=n(43825),Em=n(91259),xm=n(66769),km=n(22142),wm=({onAddSpace:e})=>{const[t,n]=(0,r.useState)(!1);return km.createElement("div",{style:{display:"grid"}},km.createElement(ce.Z,{style:{marginBottom:"5px"},loading:t,onClick:()=>{return void 0,null,t=function*(){n(!0),yield e(),n(!1)},new Promise(((e,n)=>{var r=e=>{try{a(t.next(e))}catch(e){n(e)}},o=e=>{try{a(t.throw(e))}catch(e){n(e)}},a=t=>t.done?e(t.value):Promise.resolve(t.value).then(r,o);a((t=t.apply(undefined,null)).next())}));var t}},"新增区域"))},Sm=n(22142),Om=({space:e,panoramas:t,panoramaEdit:n,onClickSpace:o,onClickPanorama:l,onAddPanorama:i,onDelPanorama:s,onDelSpace:d})=>{const{token:p}=c.Z.useToken(),{getState:u}=(0,a.oR)(),{propsMode:m}=(0,N.useEditor)(0,"propsMode"),[f,y]=(0,r.useState)(n.panoramaId),[g,h]=(0,r.useState)(0),[v,b]=(0,r.useState)(!1);(0,r.useEffect)((()=>{n.type&&y("panorama"===n.type?n.panoramaId:n.spaceId)}),[n]);const E=Sm.createElement(F.Z,null,Sm.createElement(F.Z.Item,{key:1,onClick:d},"删除"));return Sm.createElement(L.Z,{overlay:E,trigger:["contextMenu"]},Sm.createElement("div",{style:{position:"relative",display:"flex",flexDirection:"column",marginBottom:"10px",padding:"5px",background:p.colorBgLayout,border:f===e.id?`2px solid ${p.colorPrimary}`:""},onClick:o},Sm.createElement("span",null,e.name),t.map((e=>{var t;const n=null==(t=(0,R.Ng)(u().project,e.cubemapUrl))?void 0:t.cover;return Sm.createElement("div",{key:e.id,style:{position:"relative",marginBottom:"2px",border:f===e.id?`2px solid ${p.colorPrimaryBorder}`:""},onClick:t=>{t.stopPropagation(),l(e.id)},onMouseEnter:()=>{h(e.id)},onMouseLeave:()=>{h(0)}},n?Sm.createElement("img",{src:n,style:{width:"120px",height:"120px"}}):Sm.createElement(xa.Z,{imageStyle:{height:"50px"},image:xa.Z.PRESENTED_IMAGE_SIMPLE,description:"暂无封面"}),Sm.createElement(oe.Z,{style:{position:"absolute",right:10,top:5,padding:"2px",fontSize:"12px",color:"white",display:g===e.id?"block":"none",background:"rgba(0,0,0,.5)"},component:ka.Z,onClick:t=>{t.stopPropagation(),s(e.id)}}),Sm.createElement("div",{style:{position:"absolute",bottom:0,fontSize:"11px",background:"rgba(0,0,0,.5)",color:"white",padding:"2px"}},e.name))})),"Project"===m&&Sm.createElement(ce.Z,{style:{marginTop:"10px"},loading:v,onClick:e=>{return void 0,null,t=function*(){e.stopPropagation(),b(!0);try{yield i()}catch(e){console.error("创建 Panorama 失败：",e),Pe.ZP.error("创建全景失败")}finally{b(!1)}},new Promise(((e,n)=>{var r=e=>{try{a(t.next(e))}catch(e){n(e)}},o=e=>{try{a(t.throw(e))}catch(e){n(e)}},a=t=>t.done?e(t.value):Promise.resolve(t.value).then(r,o);a((t=t.apply(undefined,null)).next())}));var t}},Sm.createElement(le.Z,{style:{fontSize:"16px"}}),"新增全景")))},Zm=n(22142),Pm=Object.defineProperty,Cm=Object.defineProperties,Im=Object.getOwnPropertyDescriptors,jm=Object.getOwnPropertySymbols,Am=Object.prototype.hasOwnProperty,Mm=Object.prototype.propertyIsEnumerable,Dm=(e,t,n)=>t in e?Pm(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Nm=(e,t)=>{for(var n in t||(t={}))Am.call(t,n)&&Dm(e,n,t[n]);if(jm)for(var n of jm(t))Mm.call(t,n)&&Dm(e,n,t[n]);return e},Tm=(e,t)=>Cm(e,Im(t)),Rm=(e,t,n)=>new Promise(((r,o)=>{var a=e=>{try{i(n.next(e))}catch(e){o(e)}},l=e=>{try{i(n.throw(e))}catch(e){o(e)}},i=e=>e.done?r(e.value):Promise.resolve(e.value).then(a,l);i((n=n.apply(e,t)).next())})),Fm=()=>{const{onDelete:e}=(0,N.useOnDelete)();(0,N.useEditorHotkeys)("delete,backspace",(()=>{const{editor:{edit3d:t}}=(0,R.zh)(n().project);t&&e()}));const{dispatch:t,getState:n}=(0,a.oR)(),{createPanorama:o,createSpace:l}=(0,B.KW)(),i=(0,B.PF)(),{propsMode:c}=(0,N.useEditor)(0,"propsMode"),{panoramaData:s,panoramaEdit:d,spaces:p,settings:u,editor:{sceneMode:m,settingsOn:f}}=(0,a.v9)((({project:e})=>{var t,n;const{panoramaDataOrderId:r}=e.editor.panoramaEdit,o=(0,R.HE)(e).find((e=>e.orderId===r)),a=null!=(t=null==o?void 0:o.spaces)?t:[],l=null!=(n=null==o?void 0:o.panoramas)?n:[];return{panoramaAreaComponents:e.scenes,panoramaEdit:e.editor.panoramaEdit,spaces:a,panoramaData:o,panoramas:l,editor:e.editor,settings:e.settings}}),a.wU),y=mm(m,u);(0,r.useEffect)((()=>(i({enabled:!0}),()=>{i({enabled:!1})})),[]);const g=e=>{const r=(0,At.Di)(n().project,e);r?(t((0,N.changeEditor)(0,{settingsOn:!1,selectedSceneId:r.id,panoramaEdit:Tm(Nm({},d),{type:"panorama",panoramaId:e})})),t((0,N.changeEditor)(r.id,{selected:{}})),d.panoramaId!==e&&i()):Pe.ZP.error("全景组件丢失")},h=()=>{const e=(0,At.wJ)(s),r=e?(0,At.Di)(n().project,e.id):void 0;e&&r?(t((0,N.changeEditor)(0,{settingsOn:!1,selectedSceneId:null==r?void 0:r.id,panoramaEdit:Tm(Nm({},d),{type:"panorama",panoramaId:e.id})})),t((0,N.changeEditor)(r.id,{selected:{}}))):t((0,N.changeEditor)(0,{selectedSceneId:void 0,panoramaEdit:Tm(Nm({},d),{type:void 0})})),i()},v=e=>{1!==s.panoramas.length?(t((0,N.updatePanoramaData)(s.id,{spaces:s.spaces.map((t=>Tm(Nm({},t),{panoramaIds:t.panoramaIds.filter((t=>t!==e))}))),panoramas:s.panoramas.filter((t=>t.id!==e)).map((t=>{var n,r;return Tm(Nm({},t),{pathways:null!=(r=null==(n=t.pathways)?void 0:n.filter((t=>t!==e)))?r:[]})}))})),e===d.panoramaId&&h()):Pe.ZP.error("无法删除，需至少保留一个全景")};return Zm.createElement("div",{style:{position:"relative",display:"flex",flexDirection:"column",justifyContent:"space-between",alignItems:"center",margin:"10px 15px"}},["Project","Product"].includes(c)&&(0,At.Yt)(n().project)&&Zm.createElement(ce.Z,{style:{marginBottom:"10px"},onClick:()=>{const e=n().project.scenes.find((e=>1===e.orderId)).id;t((0,N.changeEditor)(0,{settingsOn:!1,selectedSceneId:e,panoramaEdit:Tm(Nm({},d),{type:void 0})})),t((0,N.changeEditor)(e,{playable:!0}))}},"直出互动设置"),y&&Zm.createElement(hm,{active:f}),Zm.createElement("div",{style:{height:"90%"}},Zm.createElement("div",{style:{height:"100%",overflowY:"scroll",marginBottom:"10px"}},p.map((e=>{const r=e.panoramaIds.reduce(((e,t)=>{var n;const r=null==(n=null==s?void 0:s.panoramas)?void 0:n.find((e=>e.id===t));return r&&e.push(r),e}),[]);return Zm.createElement(Om,{key:e.id,space:e,panoramas:r,panoramaEdit:d,onClickSpace:()=>{(e=>{var r,o;const a=(0,At.oU)(n().project,e);t((0,N.changeEditor)(0,{selectedSceneId:null==a?void 0:a.id,settingsOn:!1,panoramaEdit:Tm(Nm({},d),{type:"space",spaceId:e,panoramaId:null!=(o=null==(r=s.spaces.find((t=>t.id===e)))?void 0:r.panoramaIds[0])?o:0})})),a&&t((0,N.changeEditor)(a.id,{selected:{}})),i()})(e.id)},onClickPanorama:g,onAddPanorama:()=>{var n;n=e.id,Rm(void 0,null,(function*(){const e=yield o(n);t((0,N.updatePanoramaData)(s.id,{spaces:null==s?void 0:s.spaces.map((t=>t.id===n?Tm(Nm({},t),{panoramaIds:[...t.panoramaIds,e.id]}):t)),panoramas:[...s.panoramas,e]}))}))},onDelPanorama:v,onDelSpace:()=>{var n;n=e.id,Rm(void 0,null,(function*(){let e=[];const r=s.spaces.filter((t=>(t.id===n&&(e=t.panoramaIds),t.id!==n)));1===s.panoramas.length&&e.includes(s.panoramas[0].id)?Pe.ZP.error("无法删除，需至少保留一个全景"):(t((0,N.updatePanoramaData)(s.id,{spaces:r,panoramas:s.panoramas.filter((t=>!e.includes(t.id))).map((t=>{var n,r;return Tm(Nm({},t),{pathways:null!=(r=null==(n=t.pathways)?void 0:n.filter((t=>!e.includes(t))))?r:[]})}))})),(n===d.spaceId||e.includes(d.panoramaId))&&h())}))}})})))),"Project"===c&&Zm.createElement(wm,{onAddSpace:()=>Rm(void 0,null,(function*(){const e=yield l();t((0,N.updatePanoramaData)(s.id,{spaces:[...s.spaces,e]}))}))}))},Lm=n(23091),zm=n(57416),$m=(n(37112),n(22142));function Bm(){const[e,t]=(0,T.Em)("onboarding"),[n,o]=(0,r.useState)(!0),a=(0,N.useSettings)("typeOfPlay");return(0,r.useEffect)((()=>{if(3===a&&e&&n){const e=Math.floor(369),t=3===a?"https://v9-default.365yg.com/40cda788ca1e96a778206a25b00b0ae3/75a2528e/video/tos/cn/tos-cn-v-736065/1daa5c232b91467b9d8accf29b36249f/":"https://v3-default.ixigua.com/d032b2b295e15eee10a1e368d749e35a/7447c0e3/video/tos/cn/tos-cn-v-736065/a048e6ee07234090b14764553a63538f/",n=new zm.ZP({id:"xgVideo1",url:t,height:`${e}px`,width:"100%",cssFullscreen:!1,playbackRate:!1,controls:!1,commonStyle:{playedColor:"#5676EA",sliderBtnStyle:{borderColor:"none"}}});return()=>{n.destroy(!0)}}}),[a,e,n]),3!==a?null:$m.createElement($m.Fragment,null,$m.createElement(P.Z,{width:704,title:$m.createElement("div",{className:(0,mt.iv)({textAlign:"center",fontSize:16})},"直出互动编辑器怎么用？"),footer:null,closeIcon:$m.createElement(oe.Z,{component:_c.Z}),centered:!0,maskClosable:!1,open:e&&n,onCancel:()=>{t(!1)},className:(0,mt.iv)({".ant-modal-header":{borderBottom:"none"},".ant-modal-body":{padding:"0 24px 24px"}})},$m.createElement("div",null,$m.createElement("div",{id:"xgVideo1"}),$m.createElement("div",{className:(0,mt.iv)({margin:"16px 0 24px",textAlign:"center",height:40,fontSize:12})},$m.createElement("span",null,"点击视频，了解详细教程。关闭后也可点右上角的 ",$m.createElement("b",null,"帮助-教程中心")," 查看教程视频。"),$m.createElement("br",null),$m.createElement("span",null,"或者你也可以点击",$m.createElement("b",null,"「查看分步骤引导」"),"在页面中跟随指引熟悉工具。")),$m.createElement("div",{className:(0,mt.iv)({display:"flex",justifyContent:"center"})},$m.createElement(ce.Z,{type:"primary",className:(0,mt.iv)({margin:"0 auto",height:34}),onClick:()=>{o(!1)}},"查看分步引导")))),e&&!n&&$m.createElement(po.Bt,{onClose:()=>t(!1)}))}var Vm=n(22142);const Hm=({children:e,title:t})=>Vm.createElement("div",{className:(0,mt.iv)({padding:"8px 12px"})},Vm.createElement("h4",{className:(0,mt.iv)({paddingBottom:12,margin:0})},t),e);var Gm=Object.defineProperty,_m=Object.defineProperties,Um=Object.getOwnPropertyDescriptors,Wm=Object.getOwnPropertySymbols,Km=Object.prototype.hasOwnProperty,Xm=Object.prototype.propertyIsEnumerable,Ym=(e,t,n)=>t in e?Gm(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Jm=(e,t)=>{for(var n in t||(t={}))Km.call(t,n)&&Ym(e,n,t[n]);if(Wm)for(var n of Wm(t))Xm.call(t,n)&&Ym(e,n,t[n]);return e};function qm(){const{getState:e}=(0,a.oR)(),[t,n]=(0,r.useState)(""),[o,l]=(0,r.useState)("abcde"),[i,c]=(0,r.useState)("none"),[s,d]=(0,r.useState)(""),p=(0,r.useRef)(null),{clearIframe:u,postMessage:m}=function(e){const t=(0,r.useRef)([]);return window.previewLog=()=>{console.log(t.current)},{postMessage:n=>{var r,o;t.current.push(n),null==(o=null==(r=e.current)?void 0:r.contentWindow)||o.postMessage(JSON.stringify(n),"*")},clearIframe:()=>{var t,n;null==(n=null==(t=e.current)?void 0:t.contentWindow)||n.postMessage(JSON.stringify({type:"clear"}),"*")}}}(p);return(0,An.Z)("ViewResource",(t=>{return r=this,o=[t],a=function*({type:t,entry:r}){if("enter"===t){const{category:t,url:i,name:s,description:u,extra:f}=r;if(["Lottie","Particle","FrameAnime","Spine","DragonBones","Sprite","Animation","PSD","Live2d","Skybox"].includes(t)){const r=ef(t);if(["spine","dragonBones","component","psd"].includes(r)?c("big"):c("small"),n(s),l(u),null==f?void 0:f.previewVideo)d(null==f?void 0:f.previewVideo);else if(p.current)if("number"==typeof i){const{project:t}=e(),{scenes:n,customScripts:r,settings:l}=t,c={scenes:n.filter((e=>"Animation"===e.type)).map((e=>(0,R.GV)(e))),customScripts:r,settings:(o=Jm({},l),a={sceneOrders:[i]},_m(o,Um(a)))};m({type:"change",url:l.basePath,projectType:"scene",loop:!0,data:c})}else m({type:"change",url:i,projectType:r,loop:!0})}}else c("none"),d(""),u();var o,a},new Promise(((e,t)=>{var n=e=>{try{i(a.next(e))}catch(e){t(e)}},l=e=>{try{i(a.throw(e))}catch(e){t(e)}},i=t=>t.done?e(t.value):Promise.resolve(t.value).then(n,l);i((a=a.apply(r,o)).next())}));var r,o,a})),r.createElement("div",{className:(0,mt.iv)({position:"absolute",top:4,right:-4,width:214,padding:6,borderRadius:4,border:"1px solid #d9d9d9",transform:"translate(100%)",pointerEvents:"none"}),style:{visibility:"none"!==i?"visible":"hidden"}},s&&r.createElement("video",{style:{position:"absolute",top:6,left:6,zIndex:99999},src:s,autoPlay:!0,loop:!0,width:200,height:"big"===i?356:200}),r.createElement(Qm,{ref:p,width:200,height:"big"===i?356:200,scale:1.2}),r.createElement("div",{className:(0,mt.iv)({overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis",textAlign:"center"})},t),o&&r.createElement("div",{className:(0,mt.iv)({borderTop:"1px solid #ccc",paddingTop:4,wordBreak:"break-all",wordWrap:"break-word",maxHeight:200,overflow:"scroll"})},o))}const Qm=r.memo(r.forwardRef(((e,t)=>{var n=e,{width:o,height:a,scale:l=1}=n,i=((e,t)=>{var n={};for(var r in e)Km.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&Wm)for(var r of Wm(e))t.indexOf(r)<0&&Xm.call(e,r)&&(n[r]=e[r]);return n})(n,["width","height","scale"]);return r.createElement("div",{className:(0,mt.iv)({width:o,height:a,overflow:"hidden"})},r.createElement("iframe",Jm({ref:t,src:(0,De.cM)({release:!0})?"https://magicplay.oceanengine.com/static-cloud/invoke/riko_player?type=preload":["https://local-clab.","bytedance",".net/static-cloud/invoke/riko_player?type=preload"].join(""),allow:"autoplay",frameBorder:"0",className:(0,mt.iv)(Jm({width:o,height:a,position:"relative",transformOrigin:"0 0",border:"none"},l?{transform:`scale(${l})`,left:`-${o*(l-1)/2}px`,top:`-${a*(l-1)/2}px`}:{}))},i)))}))),ef=e=>("FrameAnime"===e&&(e="frame"),"Sprite"===e&&(e="image"),"Animation"===e&&(e="component"),"PSD"===e&&(e="psd"),e.replace(/^\w/,(e=>e.toLowerCase())));var tf=Object.defineProperty,nf=Object.defineProperties,rf=Object.getOwnPropertyDescriptors,of=Object.getOwnPropertySymbols,af=Object.prototype.hasOwnProperty,lf=Object.prototype.propertyIsEnumerable,cf=(e,t,n)=>t in e?tf(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,sf=(e,t)=>{for(var n in t||(t={}))af.call(t,n)&&cf(e,n,t[n]);if(of)for(var n of of(t))lf.call(t,n)&&cf(e,n,t[n]);return e},df=(e,t)=>nf(e,rf(t)),pf=(e,t,n)=>new Promise(((r,o)=>{var a=e=>{try{i(n.next(e))}catch(e){o(e)}},l=e=>{try{i(n.throw(e))}catch(e){o(e)}},i=e=>e.done?r(e.value):Promise.resolve(e.value).then(a,l);i((n=n.apply(e,t)).next())})),uf=n(22142),mf=Object.defineProperty,ff=Object.defineProperties,yf=Object.getOwnPropertyDescriptors,gf=Object.getOwnPropertySymbols,hf=Object.prototype.hasOwnProperty,vf=Object.prototype.propertyIsEnumerable,bf=(e,t,n)=>t in e?mf(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Ef=(e,t)=>{for(var n in t||(t={}))hf.call(t,n)&&bf(e,n,t[n]);if(gf)for(var n of gf(t))vf.call(t,n)&&bf(e,n,t[n]);return e},xf=(e,t)=>ff(e,yf(t));const kf=({entries:e})=>uf.createElement("div",{className:(0,mt.iv)({display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gridAutoRows:"auto",overflow:"auto",maxHeight:"100%",rowGap:"8px",width:256})},e.map((e=>uf.createElement(wf,Ef({key:e.id},e))))),wf=e=>{const t=(e=>{const{trigger:t}=(0,An.Z)("ViewResource");return(0,r.useEffect)((()=>{t({type:"leave"})}),[t]),{onMouseEnter(){t({type:"enter",entry:e})},onMouseLeave(){t({type:"leave"})}}})(e),n=(({category:e,url:t,name:n,cover:r,extra:o,props:a})=>{const l=(0,N.useAddNode)(),[,i]=(0,ut.c)({item:{type:"resource",mime:e,url:t,name:n,cover:r,props:a}});return{ref:i,onClick:(c=()=>pf(void 0,null,(function*(){if("PVSlider"===e){const e=yield new Promise(((e,t)=>{let n;l({mime:"PVSlider",name:"滑条轨道",url:"https://creativelab-proxy.bytedance.com/api/upload/bucket/material/private/db0847b71d6608d9e48307f0de76dd5e.png",mapNode(e){return e.type="PVSprite",n=e,e}},!0).then((()=>{e(n)})).catch(t)}));a=df(sf({},a),{x:e.props.x+4,y:e.props.y+4,distance:428})}return yield l({mime:e,name:n,url:t,cover:r,extra:o,mapNode(e){return"PVAlphaVideo"===(e=df(sf({},e),{props:sf(sf({},e.props),a)})).type&&((e=(0,R.kj)(e,720,1280)).editor=df(sf({},e.editor),{isLocked:!0})),e}},!0)})),()=>pf(void 0,null,(function*(){try{return yield c()}catch(e){Pe.ZP.error(e.message)}})))};var c})(e);return uf.createElement("div",xf(Ef({},t),{className:(0,mt.iv)({flexDirection:"column",justifySelf:"center",display:"flex"})}),uf.createElement("img",xf(Ef({},n),{src:e.cover,className:(0,mt.iv)({width:72,height:72,objectFit:"contain",borderRadius:"2px",border:"1px solid #f0f0f0",backgroundColor:"#F5F5F5",cursor:"pointer"})})),uf.createElement(lr.Z.Text,{type:"secondary",className:(0,mt.iv)({width:72,textAlign:"center",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"})},e.name))};var Sf=n(22142);const Of=[{title:"交互组件",entries:[{id:"VRButton",category:"VRButton",cover:"https://creativelab-proxy.bytedance.com/api/upload/bucket/material/ea45652bee36e9d4d34a03c879d55f86.png",url:"https://creativelab-proxy.bytedance.com/api/upload/bucket/material/1ac7643d1f6d110b27ffbcfe122a27bc.png",name:"图文按钮",description:"图文按钮",props:{activeUrl:"https://creativelab-proxy.bytedance.com/api/upload/bucket/material/1ac7643d1f6d110b27ffbcfe122a27bc.png",buttonType:"normal",showGuide:!1,text:"图文按钮"}}]},{title:"装饰组件",entries:[{id:"VRSprite",category:"VRSprite",cover:"https://creativelab-proxy.bytedance.com/api/upload/bucket/material/0866050d5fc094bf01ee60f32f3321d0.png",url:"https://creativelab-proxy.bytedance.com/api/upload/bucket/material/0866050d5fc094bf01ee60f32f3321d0.png",name:"图片",description:"装饰图片"},{id:"VRSound",category:"VRSound",cover:"https://creativelab-proxy.bytedance.com/api/upload/bucket/material/2046091147074299ddb30517fd825109.png",url:"https://creativelab-proxy.bytedance.com/api/upload/bucket/material/6d1a3846a5013e128ddb9b0eb49afb29.mp3",name:"声音",description:"背景声音"},{id:"VRText",category:"VRText",cover:"https://creativelab-proxy.bytedance.com/api/upload/bucket/material/9b9e6c80c3e32aaba88fb958fe72bc3d.png",url:"说明文案",name:"文本",description:"说明文案"}]}];function Zf(){const[e,t]=(0,r.useState)(!0);return Sf.createElement(Z.Z.Content,{className:(0,mt.iv)({flex:"0 0 auto",position:"relative",zIndex:1})},Sf.createElement("div",{className:(0,mt.iv)({boxShadow:"4px 2px 6px -3px rgba(0,0,0,0.08)",transform:"translateX(100%)",position:"absolute",height:"100%",right:0,top:0})},e&&Sf.createElement("div",{className:(0,mt.iv)({overflow:"auto",maxHeight:"100%"})},Of.map((({title:e,entries:t},n)=>Sf.createElement(Hm,{key:n,title:e},Sf.createElement(kf,{entries:t}))))),Sf.createElement(ce.Z,{size:"small",icon:Sf.createElement(oe.Z,{component:e?oo.Z:ao.Z}),type:"link",style:{borderRadius:"0 4px 4px 0",transform:"translate(100%)",position:"absolute",transition:"0s",border:"none",right:0,top:0},onClick:()=>t(!e)}),Sf.createElement(qm,null)))}var Pf=n(76463),Cf=(e,t,n)=>new Promise(((r,o)=>{var a=e=>{try{i(n.next(e))}catch(e){o(e)}},l=e=>{try{i(n.throw(e))}catch(e){o(e)}},i=e=>e.done?r(e.value):Promise.resolve(e.value).then(a,l);i((n=n.apply(e,t)).next())}));const If=(0,mt.iv)({height:"100%",minWidth:1080}),jf=(0,mt.iv)({"&, &>.ant-spin-container":{height:"100%"}});class Af extends r.Component{constructor(){super(...arguments),this.state={hasError:!1}}static getDerivedStateFromError(){return{hasError:!0}}render(){return this.state.hasError?r.createElement(Z.Z.Content,null,"Something went wrong."):this.props.children}}function Mf(){const{getState:e}=(0,a.oR)(),{hidePreviewer:t,hideProperty:n,hideElements:o,hideResource:l,hideScenes:s}={hidePreviewer:(0,D.ND)({title:"隐藏可视画板",flagBit:8},!0),hideProperty:(0,D.ND)({title:"隐藏属性面板",flagBit:16}),hideElements:(0,D.ND)({title:"隐藏时间面板",flagBit:32}),hideResource:(0,D.ND)({title:"隐藏资源面板",flagBit:64}),hideScenes:(0,D.ND)({title:"隐藏场景列表",flagBit:128})},{visible:d,remember:p,setVisible:u,setRemember:m}=(0,T.RL)("componentWarning",{byStep:!1}),[,f]=(0,T.Em)("not_a_chrome"),{sceneMode:y}=(0,N.useEditor)(0,"sceneMode"),g=(0,N.useSettings)("enabled3d"),h=(0,N.useSettings)("typeOfPlay"),v=(0,N.useSettings)("category"),b=(0,N.useProject)("id"),{loading:E,onChange:x}=(0,N.useEditor)(0,"loading"),{playable:k}=(0,N.useEditor)("playable"),w=(0,N.useProject)("type"),{edit3d:S}=(0,N.useEditor)("edit3d"),O=(0,vm.nm)(),{initialLayer:F}=(0,Em.s)(),{delSearchUrl:L,initialPanoramaState:z,autoEnterPanoramaEdit:$}=(0,B.KW)(),{initialModel3DState:V,delSearchUrl:G}=(0,Pf.G)(),_=(0,r.useMemo)((()=>{switch(w){case"Project":return r.createElement(fm,null);case"PanoramaData":return r.createElement(Fm,null);default:return null}}),[w]),U=(0,r.useMemo)((()=>"Product"===y||k?"Product"===y&&(0,At.Yt)(e().project)&&S?r.createElement(wc,null):null:4===h?r.createElement(co,null):3===h&&3===v?r.createElement(Zf,null):r.createElement(wc,null)),[e,k,y,h,S]);(0,r.useEffect)((()=>{var e;E||(Number(null==(e=/Chrome\/(\d*)/i.exec(navigator.userAgent))?void 0:e[1])<79?P.Z.info({content:"为了更好的使用体验，建议使用最新谷歌Chrome浏览器打开本编辑器。",okText:"我知道了",onOk:()=>{f(!1,!1)}}):f(!1))}),[E,f]),(0,r.useEffect)((()=>{const t=()=>Cf(this,null,(function*(){yield O(),F()}));g&&b&&(()=>{Cf(this,null,(function*(){try{x(!0);const n="1"===(0,R.Qw)().emptyVR;(0,At.y_)(e().project)&&(0,R.Qw)().initialVR&&(yield z(),L()),(0,R.Qw)().initialCar&&(yield V(),G()),yield t(),(0,At.y_)(e().project)?setTimeout((()=>Cf(this,null,(function*(){yield $(n),x(!1)}))),100):x(!1)}catch(t){x(!1),P.Z.error({title:"错误",content:`${(0,At.y_)(e().project)?"VR":"3D"} 项目初始化失败:${t.message}`})}}))})()}),[g,b,x]),(0,N.useImbot)(),(0,N.useIdeMessage)(),(()=>{const e=(0,a.I0)(),t=(0,r.useRef)(null),{storeData:n,playing:o}=(0,a.v9)((({project:e})=>({storeData:(0,R.AR)(e),playing:e.editor.playing})),a.wU);(0,r.useEffect)((()=>{o&&n?t.current=n:!o&&t.current&&(e((0,N.updateGlobalVars)(t.current)),t.current=null)}),[o,e])})();const{token:W}=c.Z.useToken();return r.createElement(i.ZP,{theme:{components:{Layout:{colorBgBody:W.colorBgContainer}}}},r.createElement(M.W,{backend:A.PD},r.createElement(bm.A,null),r.createElement(xc,null),r.createElement(Z.Z,{className:(0,mt.cx)(If,(0,mt.iv)({color:W.colorTextBase}))},d&&"Component"===w&&r.createElement(C.Z,{type:"info",showIcon:!0,closable:!0,message:"您当前正在编辑组件，保存后该组件会同步到“我的素材”中。点击提交按钮，您可继续编辑作品",onClose:()=>{u(!1)},action:r.createElement(I.Z,{checked:p,onChange:({target:{checked:e}})=>{m(e)}},"不再提醒")}),r.createElement(xm.Z,null),r.createElement(ld.Z,null),r.createElement(Z.Z,{onContextMenu:e=>{e.preventDefault()}},r.createElement(j.Z,{size:"large",tip:"加载中...",spinning:E,wrapperClassName:jf},r.createElement(Z.Z,{style:{flexDirection:"row",overflow:"hidden",height:"100%"}},!s&&_,"History"===w&&r.createElement(Lc,null),r.createElement(Z.Z,{style:{overflow:"hidden"}},r.createElement(Z.Z,{style:{flexDirection:"row",overflow:"hidden",borderBottom:"1px solid transparent"}},!l&&U,r.createElement(Af,null,t?r.createElement(Z.Z.Content,null):r.createElement(Sc.ZP,null)),"Product"!==y&&!k&&r.createElement(od,null),r.createElement(Af,null,!n&&r.createElement(xr,null))),!o&&"Product"!==y&&!k&&r.createElement(dr,null),"Product"!==y&&!k&&r.createElement(H,null)))))),r.createElement(Lm.Z,null),r.createElement(Bm,null)))}window.VERSION=`undefined/${l.RIKO_VERSION}`,console.log(window.VERSION),document.addEventListener("wheel",(e=>{(e.ctrlKey||e.metaKey)&&e.preventDefault()}),{passive:!1});for(const e of["keydown","keyup","keypress"])document.addEventListener(e,(e=>{!e.ctrlKey&&!e.metaKey||"ArrowLeft"!==e.key&&"ArrowRight"!==e.key&&"s"!==e.key||e.preventDefault()}));o.render(r.createElement(i.ZP,{locale:s.Z,theme:{token:{colorPrimary:"#3955f6",colorInfo:"#3955f6"},algorithm:location.search.includes("dark")?c.Z.darkAlgorithm:c.Z.defaultAlgorithm}},r.createElement(a.zt,{store:N.default},r.createElement(Mf,null))),document.getElementById("root"))}},function(e){var t=function(t){return e(e.s=t)};e.O(0,[183,716,981,498,122,380,47,97,242,64],(function(){return t(75917),t(96827)})),e.O()}]);