"use strict";(self.webpackChunk_byted_editor=self.webpackChunk_byted_editor||[]).push([[396],{50396:function(e,t,a){a.r(t),a.d(t,{default:function(){return oe}});var l=a(50509),n=a(22142),r=a(1537),i=a(61754),o=a(76151),c=a(10839),s=a(87207),d=a(16066),u=a(26750),m=a(62255),p=a(85870),y=a(68961),f=a(70072),v=a(43746),E=a(34450),b=a.n(E),g=a(30),h=a(22142),w=Object.defineProperty,S=Object.defineProperties,P=Object.getOwnPropertyDescriptors,O=Object.getOwnPropertySymbols,x=Object.prototype.hasOwnProperty,C=Object.prototype.propertyIsEnumerable,_=(e,t,a)=>t in e?w(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,D=(e,t)=>{for(var a in t||(t={}))x.call(t,a)&&_(e,a,t[a]);if(O)for(var a of O(t))C.call(t,a)&&_(e,a,t[a]);return e};const Z=[{value:void 0,label:"全部"},...Object.entries(v.t4).filter((([,e])=>"number"==typeof e)).map((([e,t])=>({value:t,label:e})))],j=({currentPage:e,onSearch:t})=>{const a=(0,g.useCurrentParams)((e=>e.oldParams)),[l,r]=(0,n.useState)({id:void 0,platform:void 0,date:[b()().startOf("day").subtract(7,"d"),b()().startOf("day").subtract(1,"d")]}),[i,o]=(0,n.useState)(null),[c,v]=(0,n.useState)([b()().startOf("day").subtract(7,"d"),b()().startOf("day").subtract(1,"d")]),E=(e,t)=>{var a;r((a=D({},l),S(a,P({[e]:t}))))};return(0,n.useEffect)((()=>{a.id&&"case"===e&&(t(a),r(D(D({},l),a)))}),[a]),h.createElement(s.T,{direction:"horizontal",size:1,style:{padding:"20px 0",alignItems:"center",marginBottom:"20px"}},h.createElement(s.T,{size:1,style:{flexGrow:1,gridTemplateRows:"auto auto 1fr"}},h.createElement(d.Z,{gutter:[16,16],style:{margin:0,display:"flex",alignItems:"center",height:"100px",padding:"0 10px"}},h.createElement(u.Z,{className:"gutter-row",span:8,style:{display:"flex",alignItems:"center"}},h.createElement("div",{style:{color:"#999999",width:"90px",textAlign:"end"}},"项目ID："),h.createElement(m.Z,{allowClear:!0,style:{width:"300px"},value:l.id,onChange:e=>{E("id",e.target.value?Number(e.target.value):void 0)}})),"case"!==e&&h.createElement(u.Z,{className:"gutter-row",span:8,style:{display:"flex",alignItems:"center"}},h.createElement("div",{style:{color:"#999999",width:"90px",textAlign:"end"}},"团队ID："),h.createElement(m.Z,{allowClear:!0,style:{width:"300px"},value:l.teamId,onChange:e=>{E("teamId",e.target.value?Number(e.target.value):void 0)}})),"case"!==e&&h.createElement(u.Z,{className:"gutter-row",span:8,style:{display:"flex",alignItems:"center"}},h.createElement("div",{style:{color:"#999999",width:"90px",textAlign:"end"}},"用户ID："),h.createElement(m.Z,{allowClear:!0,style:{width:"300px"},value:l.userId,onChange:e=>{E("userId",e.target.value?Number(e.target.value):void 0)}})),"case"===e&&h.createElement(u.Z,{className:"gutter-row",span:8,style:{display:"flex",alignItems:"center"}},h.createElement("div",{style:{color:"#999999",width:"90px",textAlign:"end"}},"playable_url："),h.createElement(m.Z,{allowClear:!0,style:{width:"300px"},onChange:e=>{var t;E("playable_url",null!=(t=e.target.value)?t:void 0)}})),h.createElement(u.Z,{className:"gutter-row",span:8,style:{display:"flex",alignItems:"center"}},h.createElement("div",{style:{color:"#999999",width:"90px",textAlign:"end"}},"时间："),h.createElement(p.Z.RangePicker,{allowClear:!1,value:l.date||c,disabledDate:e=>{if(!i)return!1;const t=e&&e.diff(b()(),"days")>=0;return!!(e&&b()().diff(e,"days")>30)||!!t},onCalendarChange:e=>o(e),onChange:e=>{E("date",e)},onOpenChange:e=>{e?(v([null,null]),o([null,null])):v(null)},style:{width:"300px"}})),h.createElement(u.Z,{className:"gutter-row",span:8,style:{display:"flex",alignItems:"center"}},h.createElement("div",{style:{color:"#999999",width:"90px",textAlign:"end"}},"平台："),h.createElement(y.Z,{style:{width:300},allowClear:!0,value:l.platform,onChange:e=>{E("platform",e)}},Z.map((({value:e,label:t})=>h.createElement(y.Z.Option,{key:e,value:e},t))))))),h.createElement("div",{style:{padding:"0 15px",marginRight:"20px"}},h.createElement(f.Z,{type:"primary",onClick:()=>{t(l)}},"搜索")))};var k=a(93255),I=a(14266),A=a(23380),U=a(73760),$=a(22142),N=Object.defineProperty,F=Object.defineProperties,L=Object.getOwnPropertyDescriptors,T=Object.getOwnPropertySymbols,z=Object.prototype.hasOwnProperty,V=Object.prototype.propertyIsEnumerable,H=(e,t,a)=>t in e?N(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,R=(e,t)=>{for(var a in t||(t={}))z.call(t,a)&&H(e,a,t[a]);if(T)for(var a of T(t))V.call(t,a)&&H(e,a,t[a]);return e},G=(e,t)=>F(e,L(t)),M=(e,t,a)=>new Promise(((l,n)=>{var r=e=>{try{o(a.next(e))}catch(e){n(e)}},i=e=>{try{o(a.throw(e))}catch(e){n(e)}},o=e=>e.done?l(e.value):Promise.resolve(e.value).then(r,i);o((a=a.apply(e,t)).next())})),J=({visible:e,currentPage:t})=>{const[a,l]=(0,n.useState)(!1),[d,u]=(0,n.useState)(),[m,p]=(0,n.useState)(),[y,f]=(0,n.useState)(),[v,E]=(0,n.useState)(),[b,g]=(0,n.useState)(),[h,w]=(0,n.useState)(),[S,P]=(0,n.useState)(),[O,x]=(0,n.useState)(),[C,_]=(0,n.useState)(),[D,Z]=(0,n.useState)({playableUrl:"",auditH5:"",direct_playable_type:0}),[N,F]=(0,n.useState)(0),[L,T]=(0,n.useState)([]),z=(0,A.Z)("edit"),V=z(["versionList"],(e=>M(void 0,null,(function*(){var t,a,l,n,i,o;const{data:c}=yield r.o.fetchVersionList({params:e});w(c),Z({playableUrl:null!=(a=null==(t=c[0])?void 0:t.playable_url)?a:"",auditH5:null!=(n=null==(l=c[0])?void 0:l.audit_h5.replace(/\"/g,""))?n:"",direct_playable_type:null!=(o=null==(i=c[0])?void 0:i.direct_playable_type)?o:""})})))),H=(e,t="province_name")=>M(void 0,null,(function*(){const a=yield r.o.fetchUserArea(G(R({},e),{area:t}));E(a)})),J=z(["userPortrait"],(e=>M(void 0,null,(function*(){yield(e=>M(void 0,null,(function*(){const t=yield r.o.fetchUserGender({params:e});p(t)})))(e),yield(e=>M(void 0,null,(function*(){const t=yield r.o.fetchUserAge({params:e});f(t)})))(e),yield H(e)})))),B=z(["caseTrend"],(e=>M(void 0,null,(function*(){const{data:t}=yield r.o.fetchTrendData({params:e});u(t)})))),K=z(["sceneAnalysis"],(e=>M(void 0,null,(function*(){const t=yield r.o.fetchSceneAnalysisData({params:e});x(t)})))),W=z(["sceneFlow","sankeyDiagram","SceneAnalysis"],(e=>M(void 0,null,(function*(){var t,a;const l=3===D.direct_playable_type?yield r.o.fetchSectionMapVideo({params:e}):yield r.o.fetchSectionMapH5({params:e});_(l);const n=3===Number(D.direct_playable_type)?yield r.o.fetchSceneFlowVideo({params:e}):yield r.o.fetchSceneFlowH5({params:e});P(G(R({},n),{sections:null!=(a=null==(t=null==n?void 0:n.sections)?void 0:t.map((e=>{var t;return G(R({},e),{section:null==(t=l.find((t=>t.playable_section_remark===e.name)))?void 0:t.playable_intent_section})})))?a:[]}))})))),q=()=>{const e=document.documentElement.scrollTop;e<200?F(0):e>=200&&e<800?F(200):e>=800&&F(800)};return(0,n.useEffect)((()=>(window.addEventListener("scroll",q,!0),()=>{window.removeEventListener("scroll",q,!1)})),[]),(0,n.useEffect)((()=>{if("case"===t)try{e=D.playableUrl,M(void 0,null,(function*(){0!==N||L.includes(0)?200!==N||L.includes(200)?800!==N||L.includes(800)||(yield W((0,I.E)(G(R({},b),{playable_url:e}))),yield K((0,I.E)(G(R({},b),{playable_url:e})))):yield J((0,I.E)(G(R({},b),{playable_url:e}))):yield B((0,I.E)(G(R({},b),{playable_url:e}))),T((e=>e.concat(N)))}))}catch(e){i.ZP.error(e)}var e}),[D,N]),$.createElement("div",{style:{display:e?"block":"none"}},$.createElement(j,{onSearch:e=>M(void 0,null,(function*(){if(T([]),e.id||e.playable_url){if(l(!0),e.id&&e.playable_url){e.id=void 0,g(e);try{yield V((0,I.E)(e))}catch(e){i.ZP.error(e)}}else{g(e);try{yield V((0,I.E)(e))}catch(e){i.ZP.error(e)}}l(!1)}else i.ZP.warning("请填写项目id或playable_url")})),currentPage:t}),$.createElement("div",{style:{margin:"20px"}},a?$.createElement(o.Z,{style:{width:"100%",top:"50%"}}):$.createElement($.Fragment,null,$.createElement(s.$0,{title:"素材列表",Component:$.createElement(s.Fr,{data:h,params:b,fetchVersionList:V,setCurrentPlayableData:Z,currentPlayableData:D})}),D.playableUrl&&$.createElement(s.$0,{title:"趋势图",Component:$.createElement(s.pJ,{data:d})}),D.playableUrl&&$.createElement(s.$0,{title:"用户画像",Component:$.createElement(k.j,{genderData:m,ageData:y,areaData:v,fetchAreaData:H,params:(0,I.E)(G(R({},b),{playable_url:D.playableUrl}))})}),D.playableUrl&&$.createElement(s.$0,{title:"场景分析",Component:$.createElement($.Fragment,null,$.createElement(s.Ff,{visible:e,sceneFlowData:(0,U.pick)(S,["sections","edges"]),sceneAnalysisData:O,currentPlayableData:D}),O&&$.createElement(s.so,{sceneAnalysisData:O,sectionMap:C}))}),D.playableUrl&&$.createElement(s.$0,{title:"桑基图",Component:D.playableUrl?$.createElement(s.zV,{data:(0,U.pick)(S,["nodes","links"])}):$.createElement(c.Z,null)}))))},B=a(22142),K=Object.defineProperty,W=Object.defineProperties,q=Object.getOwnPropertyDescriptors,Q=Object.getOwnPropertySymbols,X=Object.prototype.hasOwnProperty,Y=Object.prototype.propertyIsEnumerable,ee=(e,t,a)=>t in e?K(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,te=(e,t)=>{for(var a in t||(t={}))X.call(t,a)&&ee(e,a,t[a]);if(Q)for(var a of Q(t))Y.call(t,a)&&ee(e,a,t[a]);return e},ae=(e,t)=>W(e,q(t)),le=(e,t,a)=>new Promise(((l,n)=>{var r=e=>{try{o(a.next(e))}catch(e){n(e)}},i=e=>{try{o(a.throw(e))}catch(e){n(e)}},o=e=>e.done?l(e.value):Promise.resolve(e.value).then(r,i);o((a=a.apply(e,t)).next())})),ne=({visible:e,setCurrentPage:t,currentPage:a})=>{const[l,i]=(0,n.useState)(!1),[d,u]=(0,n.useState)(),[m,p]=(0,n.useState)(),[y,f]=(0,n.useState)(),[v,E]=(0,n.useState)(),[g,h]=(0,n.useState)(),[w,S]=(0,n.useState)(),[P,O]=(0,n.useState)(),[x,C]=(0,n.useState)(),[_,D]=(0,n.useState)(),[Z,A]=(0,n.useState)(0),[U,$]=(0,n.useState)([]),N=e=>le(void 0,null,(function*(){const{data:t}=yield r.o.fetchOverviewList({params:e});p(t)})),F=(e,t="province_name")=>le(void 0,null,(function*(){const a=yield r.o.fetchUserArea(ae(te({},e),{area:t}));O(a)})),L=e=>le(void 0,null,(function*(){i(!0),$([]),e.userId||e.id||e.teamId?yield(e=>le(void 0,null,(function*(){const{data:t}=yield r.o.fetchProjects((0,I.E)(e));E(ae(te({},e),{ids:t,role:""}))})))(ae(te({},e),{role:"super_admin"})):E(ae(te({},e),{role:"super_admin",ids:[-1]}))}));(0,n.useEffect)((()=>{L(ae(te({},v),{date:[b()().startOf("day").subtract(7,"d"),b()().startOf("day").subtract(1,"d")]}))}),[]);const T=()=>{const e=document.documentElement.scrollTop;e<300?A(0):e>=300&&e<800?A(300):e>=800&&A(800)};(0,n.useEffect)((()=>(window.addEventListener("scroll",T,!0),()=>{window.removeEventListener("scroll",T,!1)})),[]);return(0,n.useEffect)((()=>{var e;"main"===a&&v&&(e=v,le(void 0,null,(function*(){0!==Z||U.includes(0)?300!==Z||U.includes(300)?800!==Z||U.includes(800)||(yield(e=>le(void 0,null,(function*(){const t=yield r.o.fetchRankingData({params:e});C(t)})))((0,I.E)(e)),yield(e=>le(void 0,null,(function*(){const t=yield r.o.fetchEffectData({params:e});D(t)})))((0,I.E)(e))):(yield(e=>le(void 0,null,(function*(){const t=yield r.o.fetchUserGender({params:e});h(t)})))((0,I.E)(e)),yield(e=>le(void 0,null,(function*(){const t=yield r.o.fetchUserAge({params:e});S(t)})))((0,I.E)(e)),yield F((0,I.E)(e))):(yield(e=>le(void 0,null,(function*(){const{data:t}=yield r.o.fetchOverview({params:e});u(t)})))((0,I.E)(e)),yield N((0,I.E)(e)),yield(e=>le(void 0,null,(function*(){const{data:t}=yield r.o.fetchTrendData({params:e});f(t)})))((0,I.E)(e)),i(!1)),$((e=>e.concat(Z)))})))}),[v,Z]),B.createElement("div",{style:{display:e?"block":"none",width:"100%"}},B.createElement(j,{onSearch:L}),B.createElement("div",{style:{margin:"40px"}},l?B.createElement(o.Z,{style:{width:"100%",top:"50%"}}):0===(null==v?void 0:v.ids.length)&&"super_admin"!==(null==v?void 0:v.role)?B.createElement(c.Z,null):B.createElement(B.Fragment,null,B.createElement(s.$0,{title:"数据概览",Component:B.createElement(s.g2,{data:d})}),B.createElement(s.$0,{title:"项目列表",Component:B.createElement(s.ve,{data:m,setCurrentPage:t,params:v,fetchOverviewList:N})}),B.createElement(s.$0,{title:"趋势分析",Component:B.createElement(s.pJ,{data:y})}),B.createElement(s.$0,{title:"用户画像",Component:B.createElement(k.j,{genderData:g,ageData:w,areaData:P,fetchAreaData:F,params:(0,I.E)(te({},v))})}),B.createElement(s.$0,{title:"排行榜",Component:B.createElement(s.SD,{rankingData:x})}),B.createElement(s.$0,{title:"正负向统计",Component:B.createElement(s.bW,{effectData:_})}))))},re=a(22142);const ie=[{label:"账号总览",key:"main"},{label:"项目",key:"case"}];var oe=()=>{const[e,t]=(0,n.useState)("main");return re.createElement("div",{style:{backgroundColor:"#f9fafb",width:"100%"}},re.createElement(l.Z,{onClick:e=>{console.log("click ",e),t(e.key)},selectedKeys:[e],mode:"horizontal",items:ie}),re.createElement("div",null,re.createElement(ne,{visible:"main"===e,setCurrentPage:t,currentPage:e}),re.createElement(J,{visible:"case"===e,currentPage:e})))}}}]);