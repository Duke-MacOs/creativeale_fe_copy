"use strict";(self.webpackChunk_byted_editor=self.webpackChunk_byted_editor||[]).push([[359],{96359:function(e,t,n){n.r(t),n.d(t,{default:function(){return Je}});var a=n(33099),l=n(23264),r=n(88902),i=n(68961),c=n(2961),o=n(16066),s=n(26750),m=n(62255),d=n(26494),u=n(78048),p=n(22142);const{Option:g}=i.Z,h=[{name:"场景",cid:26,sortWeight:990},{name:"互动组件",cid:4,sortWeight:980},{name:"互动组件3D",cid:32,sortWeight:980},{name:"脚本",cid:25,sortWeight:970},{name:"图片",cid:5,sortWeight:790},{name:"视频",cid:6,sortWeight:780},{name:"直出加载视频",cid:34,sortWeight:780},{name:"交互视频",cid:35,sortWeight:780},{name:"透明视频",cid:36,sortWeight:780},{name:"VR视频",cid:37,sortWeight:780},{name:"音频",cid:8,sortWeight:770},{name:"字体",cid:29,sortWeight:760},{name:"3D模型",cid:27,sortWeight:750},{name:"材质",cid:28,sortWeight:740},{name:"PSD",cid:21,sortWeight:730},{name:"贴图",cid:33,sortWeight:720},{name:"2D粒子",cid:13,sortWeight:590},{name:"3D粒子",cid:14,sortWeight:580},{name:"序列帧",cid:18,sortWeight:570},{name:"Lottie",cid:12,sortWeight:560},{name:"龙骨动画",cid:23,sortWeight:550},{name:"脊柱动画",cid:24,sortWeight:540},{name:"Live2d",cid:30,sortWeight:530},{name:"天空盒",cid:31,sortWeight:520}].filter((e=>![25,26,21].includes(e.cid)));function v({keyword:e,types:t,onChange:n}){const[a]=c.Z.useForm(),l=(0,d.Z)((e=>{1===e.length&&"types"===e[0].name[0]&&n({types:a.getFieldValue("types").join(","),keyword:a.getFieldValue("keyword")})})),r=(0,d.Z)((()=>{n({keyword:a.getFieldValue("keyword")})}));return p.createElement("div",{className:u.Z.filterWrapper},p.createElement(c.Z,{form:a,initialValues:{keyword:e,types:t.split(",").map(Number).filter((e=>h.find((({cid:t})=>t===e))))},colon:!1,onFieldsChange:l},p.createElement(o.Z,{gutter:36,justify:"center"},p.createElement(s.Z,{span:6,xxl:5},p.createElement(c.Z.Item,{name:"types",label:p.createElement("span",{className:u.Z.filterLabel},"类型")},p.createElement(i.Z,{mode:"multiple",placeholder:"请选择",maxTagCount:2,showArrow:!0},h.map((e=>p.createElement(g,{key:e.cid,value:e.cid},e.name)))))),p.createElement(s.Z,{span:6,xxl:5},p.createElement(c.Z.Item,{name:"keyword",label:p.createElement("span",{className:u.Z.filterLabel},"搜索")},p.createElement(m.Z.Search,{placeholder:"请输入资源名称、ID",onSearch:r}))))))}var Z=n(22142),E=n(70072),f=n(33058),y=n(39193);const C=Z.createContext({category:{list:null,activeCategoryId:null,refreshList:()=>Promise.resolve(),addCategory:()=>{},cancelAddCategory:()=>{}},library:{loading:!1,list:null,total:0,refreshList:()=>Promise.resolve()}});var b=n(32078),x=n(61754),N=n(34394),k=n(26840),w=n(80330),I=n(73760),P=n(99305),L=n(325),S=n(85770),O=n(12031),R=n(72704),F=n(65040),D=n(10155),T=n(61645),W=n(40985),B=n(62226),j=Object.defineProperty,$=Object.defineProperties,U=Object.getOwnPropertyDescriptors,z=Object.getOwnPropertySymbols,A=Object.prototype.hasOwnProperty,M=Object.prototype.propertyIsEnumerable,V=(e,t,n)=>t in e?j(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;function H(e){return{onUpdate:(0,d.Z)((({name:t})=>(0,B.Z6)({id:e,name:t}).then((e=>e.id)))),onDelete:(0,d.Z)((t=>e?(0,B.XY)(e,t):Promise.reject("Category Id is not defined")))}}const K=Z.createContext(!1);function _({category:e,isActive:t,editable:n,onSelect:a}){const{category:{list:l,refreshList:r,cancelAddCategory:i},library:{refreshList:c}}=(0,Z.useContext)(C),{onUpdate:o,onDelete:s}=H(e.id),[p,g]=(0,Z.useState)(e.name),[h,v]=(0,Z.useState)(!!e.isNew),[y,B]=(0,Z.useState)(!1),[j,$]=(0,Z.useState)(!1),[U,z]=(0,Z.useState)(!1),A=(0,Z.useRef)(!1),M=(0,Z.useRef)(null),V=(0,Z.useRef)(null),_=(0,Z.useRef)(!1),[G,J]=b.Z.useModal(),Y={[encodeURI("全部")]:{canDrop:!1,icon:L.Z},[encodeURI("未分类")]:{canDrop:!1,icon:S.Z},[encodeURI("我的收藏")]:{canDrop:!0,icon:O.Z},[encodeURI("回收站")]:{canDrop:!0,icon:R.Z}},Q=encodeURI(e.name),X=Y[Q]?Y[Q].icon:F.Z,q=!(Y[Q]&&!Y[Q].canDrop||t||(0,I.isNil)(e.id)),[{isOver:ee,isDanger:te},ne]=(0,w.L)({accept:["resource"],canDrop(){return q},drop(t){const{item:n,sourceCategoryId:l}=t;if("0"===e.id){const e=n.categories.length>1;b.Z.confirm({title:"删除物料",icon:null,centered:!0,content:e?"该物料属于多个分类，删除后同时会从其他分类下消失":`您将删除“${n.name}”`,okText:"确认",cancelText:"取消",onOk:()=>{(0,T.mO)([n.id]).then((()=>{r(),c(),x.ZP.success(`成功删除“${n.name}”`)}))}})}else{const t=e.id;if(!(0,I.isNil)(t)){const i=n.categories.map((e=>e.id)).filter((e=>e!==l));(0,T.EZ)([n.id],i.concat(t)).then((()=>{x.ZP.success(`成功将${n.name}加入${e.name}`),a(e.id),r()}))}}},collect(e){return{isOver:e.isOver(),isDanger:!e.canDrop()}}}),ae=(0,d.Z)((()=>{!h&&e.id&&a(e.id)})),le=(0,d.Z)((()=>{!Y[Q]&&n&&$(!0)})),re=(0,d.Z)((()=>{$(!1)})),ie=(0,d.Z)((()=>{const t=p.trim();if(""===t.trim()||e.name===p)return(0,I.isNil)(e.id)&&i(),void v(!1);B(!0),o({name:t}).then((e=>(r(),e))).then((e=>{e&&a(e),v(!1),B(!1)})).catch((e=>{const n=(l||[]).find((e=>e.name===t));x.ZP.error(n?"该分类名已存在":e.message),B(!1)}))})),ce=(0,d.Z)((e=>{const t=e.currentTarget.value;!_.current&&t.length>10?g(t.slice(0,10)):g(t)})),oe=(0,d.Z)((e=>{e.stopPropagation(),v(!0),setTimeout((()=>{M.current&&M.current.focus()}),300)})),se=(0,d.Z)((n=>{n.stopPropagation(),G.confirm({title:"删除分类",icon:null,centered:!0,content:Z.createElement(K.Consumer,null,(t=>Z.createElement(Z.Fragment,null,Z.createElement("div",{className:u.Z.deleteCatModalContent},"您将删除",e.name),Z.createElement(N.Z,{checked:t,className:u.Z.deleteCatModalCheckbox,onChange:e=>{const t=e.target.checked;z(t),A.current=t}},"将分类中的物料同时丢进回收站")))),okText:"确认",cancelText:"取消",onOk:()=>{s(A.current).then((()=>{const n=l||[],i=n.findIndex((t=>t.id===e.id));if(i>=0&&t){const e=i<n.length-1?i+1:i-1;a(n[e].id)}r(),x.ZP.success(`成功删除“${e.name}”${A.current?",以及该分类下的"+e.count+"个物料":""}`)})).catch((e=>{x.ZP.error(e.message)}))}})}));return(0,Z.useEffect)((()=>{var t,n;(0,I.isNil)(e.id)&&V.current&&(null==(t=V.current)||t.scrollIntoView({behavior:"auto",block:"center"}),null==(n=M.current)||n.focus())}),[e.id]),Z.createElement(Z.Fragment,null,Z.createElement("div",{className:(0,W.xG)({[u.Z.sidebarItem]:1,active:t}),ref:ne,onClick:ae,onMouseEnter:le,onMouseLeave:re},h||y?Z.createElement("div",{className:u.Z.sidebarItemContent},Z.createElement(X,{className:u.Z.sidebarIcon,theme:"outline"}),Z.createElement("div",{ref:V,className:u.Z.sidebarItemLeft},Z.createElement(m.Z,{ref:M,placeholder:"请输入分类名称",className:u.Z.sidebarInput,value:p,maxLength:10,suffix:y?Z.createElement(P.Z,null):Z.createElement("span",{className:u.Z.stringLength},p.length,"/",10),onBlur:ie,onChange:ce,onCompositionStart:()=>_.current=!0,onCompositionEnd:()=>_.current=!1}))):Z.createElement("div",{className:(0,W.xG)({[u.Z.sidebarItemContent]:1,hover:ee&&!te,dangerHover:ee&&te&&!t})},Z.createElement("div",{className:u.Z.sidebarItemLeft},Z.createElement(X,{className:u.Z.sidebarIcon,theme:"outline"}),Z.createElement("span",{className:u.Z.sidebarTitle},e.name)),j?Z.createElement("div",{style:{marginRight:"-8px"}},Z.createElement(k.Z,{placement:"top",title:"编辑"},Z.createElement(E.Z,{type:"link",className:u.Z.sidebarBtn,icon:Z.createElement(f.Z,{component:D.Z}),onClick:oe})),Z.createElement(k.Z,{placement:"top",title:"删除"},Z.createElement(E.Z,{type:"link",className:u.Z.sidebarBtn,icon:Z.createElement(f.Z,{component:R.Z}),onClick:se}))):Z.createElement("div",{className:u.Z.sidebarNum},e.count))),Z.createElement(K.Provider,{value:U},J))}var G=n(22142);function J({active:e,editable:t,onChange:n}){const{category:{list:a,addCategory:l}}=(0,Z.useContext)(C);return G.createElement("div",{className:u.Z.sidebar},t&&G.createElement("div",{className:u.Z.sidebarHeader},G.createElement(E.Z,{type:"link",icon:G.createElement(f.Z,{component:y.Z,style:{fontSize:"16px"}}),onClick:l},"新增分类")),G.createElement("div",{className:u.Z.sidebarList},(a||[]).map((a=>G.createElement(_,{key:a.name,editable:t,category:a,isActive:e===a.id,onSelect:n})))))}var Y=n(50509),Q=n(76151),X=n(78296),q=n(69641),ee=n(1502),te=n(62732);function ne(e){const[t,n]=(0,Z.useState)(null),[a,l]=(0,Z.useState)(0),[r,i]=(0,Z.useState)(!1),c=(0,d.Z)((()=>(i(!0),(0,T.xP)(e).then((({materialList:e,pagination:t})=>{n(e),l(t.total),i(!1)})))));return(0,Z.useEffect)((()=>{c()}),[e,c]),{loading:r,list:t,total:a,fetchList:c,setList:n}}function ae(){return{onBatchUpdate:(0,d.Z)((e=>(0,T.LI)(e))),onBatchUpdateCategories:(0,d.Z)(((e,t)=>(0,T.EZ)(e,t))),onBatchDelete:(0,d.Z)((e=>(0,T.mO)(e))),onBatchRestore:(0,d.Z)((e=>(0,T.xo)(e))),onBatchClean:(0,d.Z)((e=>(0,T.Kr)(e)))}}const{Option:le}=i.Z,re={form:(0,te.iv)({height:"300px"}),label:(0,te.iv)({paddingLeft:"28px",color:"#999"})};function ie({ids:e,onCancel:t}){const[n]=c.Z.useForm(),{onBatchUpdateCategories:a}=ae(),{category:{list:l,refreshList:r},library:{refreshList:m}}=(0,Z.useContext)(C),[p,g]=(0,Z.useState)(!1),h=(0,Z.useRef)(!1),v=(0,Z.useMemo)((()=>(l||[]).filter((e=>"0"!==e.id&&"1"!==e.id&&"未分类"!==e.name))),[l]);(0,Z.useEffect)((()=>{1!==e.length||h.current||(h.current=!0,(0,T.KI)(e[0]).then((e=>{n.setFieldsValue({categoryIds:e.categories.filter((e=>"未分类"!==e.name)).map((e=>e.id))})})))}),[e,n]);const f=(0,d.Z)((()=>{t()})),y=(0,d.Z)((()=>{const l=n.getFieldsValue().categoryIds;l.length?(g(!0),a(e,l).then((()=>{g(!1),r(),m(),x.ZP.success(`已成功为${e.length}个物料重新分类`),t()}))):x.ZP.error("请选择需要修改的分类")}));return Z.createElement(b.Z,{title:"修改分类",open:!0,width:600,centered:!0,footer:Z.createElement("div",{className:u.Z.modalFooter},Z.createElement("div",{className:u.Z.modalFooterTips},e.length>1?`您将为${e.length}个物料重新分类`:""),Z.createElement(E.Z,{onClick:f},"取消"),Z.createElement(E.Z,{type:"primary",loading:p,onClick:y},"确认")),onOk:y,onCancel:f},Z.createElement(c.Z,{className:re.form,form:n,initialValues:{categoryIds:[]},colon:!1},Z.createElement(o.Z,null,Z.createElement(s.Z,{span:18},Z.createElement(c.Z.Item,{name:"categoryIds",label:Z.createElement("span",{className:re.label},"分类")},Z.createElement(i.Z,{mode:"multiple",placeholder:"请选择",showArrow:!0},(v||[]).map((e=>{const t=e.id;return Z.createElement(le,{key:t,value:t},e.name)}))))))))}var ce=n(40953),oe=Object.defineProperty,se=Object.defineProperties,me=Object.getOwnPropertyDescriptors,de=Object.getOwnPropertySymbols,ue=Object.prototype.hasOwnProperty,pe=Object.prototype.propertyIsEnumerable,ge=(e,t,n)=>t in e?oe(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;const he={header:(0,te.iv)({display:"flex",backgroundColor:"#f8f9fa",lineHeight:"50px"}),col1:(0,te.iv)({paddingLeft:"50px",flex:"0 0 150px"}),col2:(0,te.iv)({paddingLeft:"96px",flex:1}),content:(0,te.iv)({maxHeight:"350px",overflowY:"auto"}),contentRow:(0,te.iv)({display:"flex",alignItems:"center",padding:"8px 0",borderBottom:"1px solid #e4e9ed","&:last-child":{borderBottom:0}}),poster:(0,te.iv)({width:"100px",height:"100px",borderRadius:"4px",backgroundColor:"#f2f2f2",objectFit:"contain"}),input:(0,te.iv)({width:"260px"})};function ve({items:e,onCancel:t}){const{onBatchUpdate:n}=ae(),a=(0,Z.useRef)(null),{library:{refreshList:l}}=(0,Z.useContext)(C),[r,i]=(0,Z.useState)((()=>e.reduce(((e,t)=>(e[t.id]=t.name,e)),{}))),[c,o]=(0,Z.useState)(!1),s=(0,d.Z)((()=>{t()})),p=(0,d.Z)((()=>{const e=Object.entries(r).map((([e,t])=>({id:e,name:t})));o(!0),n(e).then((()=>{x.ZP.success(`已成功为${e.length}个物料重命名`),o(!1),l(),t()}))}));return Z.createElement(b.Z,{title:"批量重命名",width:600,open:!0,footer:Z.createElement("div",{className:u.Z.modalFooter},Z.createElement("div",{className:u.Z.modalFooterTips},"您将修改",e.length,"个资源的名称"),Z.createElement(E.Z,{onClick:s},"取消"),Z.createElement(E.Z,{type:"primary",loading:c,onClick:p},"确认")),onOk:p,onCancel:s},Z.createElement("div",{className:he.header},Z.createElement("div",{className:he.col1},"物料样式"),Z.createElement("div",{className:he.col2},"物料名称")),Z.createElement("div",{className:he.content},e.map((e=>Z.createElement("div",{key:e.id,className:he.contentRow},Z.createElement("div",{className:he.col1,ref:a,style:{height:"100px"}},Z.createElement(ce.Z,{data:e,CoverBoxRef:a})),Z.createElement("div",{className:he.col2},Z.createElement(m.Z,{className:he.input,value:r[e.id],maxLength:15,onChange:t=>{i((n=>{return a=((e,t)=>{for(var n in t||(t={}))ue.call(t,n)&&ge(e,n,t[n]);if(de)for(var n of de(t))pe.call(t,n)&&ge(e,n,t[n]);return e})({},n),l={[e.id]:t.target.value},se(a,me(l));var a,l}))}})))))))}var Ze=n(60920),Ee=n(18691),fe=n(77397),ye=n(21876),Ce=n(92546),be=n(16848),xe=n(34708);const Ne={drawer:(0,te.iv)({"& .ant-image-mask":{opacity:0,cursor:"zoom-in"}}),content:(0,te.iv)({display:"flex",height:"100%"}),contentLeft:(0,te.iv)({flex:"0 0 250px",width:"250px",display:"flex",alignItems:"center",marginTop:"-8px",marginLeft:"-8px",minHeight:"444px",backgroundColor:"#F2F4F7"}),contentRight:(0,te.iv)({flex:1,padding:"0 24px",width:0,height:"100%"}),contentRow:(0,te.iv)({padding:"12px 0",display:"flex",alignItems:"center","&:first-child":{paddingTop:0}}),contentCol1:(0,te.iv)({flex:"0 0 60px",textAlign:"right",color:"#999"}),contentCol2:(0,te.iv)({flex:"0 0 1",paddingLeft:"20px",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}),loadingWrapper:(0,te.iv)({paddingTop:"200px",height:"500px",textAlign:"center"}),nameButton:(0,te.iv)({marginLeft:"8px",padding:"4px 8px"})};function ke({id:e,visible:t,onCancel:n}){var a,l,r,i,c;const{library:{refreshList:o}}=(0,Z.useContext)(C),[s,p]=(0,Z.useState)(null),[g,h]=(0,Z.useState)(!1),[v,f]=(0,Z.useState)(!1),[y,b]=(0,Z.useState)(!1),[N,k]=(0,Z.useState)(!1),[w,L]=(0,Z.useState)(""),{onBatchUpdate:S}=ae(),O=(0,Z.useMemo)((()=>{var e;const t=null==(e=null==s?void 0:s.extra)?void 0:e.size;let n=0,a="KB";return(0,I.isNumber)(t)&&(n=t/1024,n>1024&&(n/=1024,a="MB")),n.toFixed(2)+a}),[s]),R=(0,d.Z)((()=>{(0,I.isNil)(e)||(h(!0),(0,T.KI)(e).then((e=>{p(e),h(!1),L(e.name)})))})),F=(0,d.Z)((e=>{const t=e.currentTarget.value;t.length<=50&&L(t)})),D=(0,d.Z)((()=>{e&&(w.trim()?(b(!0),S([{id:e,name:w}]).then((()=>{R(),k(!0),b(!1),f(!1)}))):x.ZP.error("资源名称不能为空"))})),W=(0,d.Z)((()=>{n()}));return(0,Z.useEffect)((()=>{t&&R()}),[t,R]),(0,Z.useEffect)((()=>{!t&&N&&(k(!1),o())}),[t,N,o]),Z.createElement(ye.Z,{title:"资源详情",placement:"right",width:896,open:t,rootClassName:Ne.drawer,footer:Z.createElement("div",{style:{textAlign:"right"}},Z.createElement(E.Z,{onClick:W},"关闭")),onClose:W},Z.createElement(Q.Z,{size:"large",spinning:g},Z.createElement("div",{className:Ne.content},Z.createElement("div",{className:Ne.contentLeft,style:{cursor:(null==s?void 0:s.type.cid)===be.Rj.image?"zoom-in":"default"}},s&&t&&Z.createElement("div",{style:{zoom:.66}},Z.createElement(xe.Z,{detail:s}))),Z.createElement("div",{className:Ne.contentRight},Z.createElement("div",{className:Ne.contentRow},Z.createElement("div",{className:Ne.contentCol1},"资源名称"),v?Z.createElement("div",{className:Ne.contentCol2},Z.createElement(m.Z,{style:{width:"300px"},value:w,maxLength:50,suffix:y?Z.createElement(P.Z,null):Z.createElement("span",{className:u.Z.stringLength},w.length,"/",50),onChange:F}),Z.createElement(E.Z,{className:Ne.nameButton,type:"primary",loading:y,onClick:D},"确认"),Z.createElement(E.Z,{className:Ne.nameButton,type:"default",onClick:()=>f(!1)},"取消")):Z.createElement(Z.Fragment,null,Z.createElement("div",{className:Ne.contentCol2},null==s?void 0:s.name),Z.createElement(E.Z,{type:"link",size:"small",icon:Z.createElement(Ce.Z,null),onClick:()=>f(!0)}))),Z.createElement("div",{className:Ne.contentRow},Z.createElement("div",{className:Ne.contentCol1},"资源ID"),Z.createElement("div",{className:Ne.contentCol2},null==s?void 0:s.id)),Z.createElement("div",{className:Ne.contentRow},Z.createElement("div",{className:Ne.contentCol1},"文件大小"),Z.createElement("div",{className:Ne.contentCol2},O)),(null==(a=null==s?void 0:s.extra)?void 0:a.width)&&(null==(l=null==s?void 0:s.extra)?void 0:l.height)&&Z.createElement("div",{className:Ne.contentRow},Z.createElement("div",{className:Ne.contentCol1},"像素尺寸"),Z.createElement("div",{className:Ne.contentCol2},`${null==(r=null==s?void 0:s.extra)?void 0:r.width}*${null==s?void 0:s.extra.height}`)),Z.createElement("div",{className:Ne.contentRow},Z.createElement("div",{className:Ne.contentCol1},"格式"),Z.createElement("div",{className:Ne.contentCol2},null==(i=null==s?void 0:s.extra)?void 0:i.ext)),Z.createElement("div",{className:Ne.contentRow},Z.createElement("div",{className:Ne.contentCol1},"上传者"),Z.createElement("div",{className:Ne.contentCol2},null==(c=null==s?void 0:s.extra)?void 0:c.userName))))))}var we=n(50969),Ie=n(65852),Pe=n(47914),Le=n(8702);function Se({item:e,selected:t,category:n,onSelect:a,onShowModal:l,onFinishUpdate:r,onPreviewStart:i,handlePreviewEnd:c}){const[o,s]=(0,Z.useState)(!1),m=(0,Z.useRef)(null),p=(0,Z.useRef)(null),{onDelete:g,onRestore:h,onClean:v,onRemoveFromCategory:f}=(y=e.id,{onUpdate:(0,d.Z)((({name:e})=>(0,T.LI)([{id:y,name:e}]))),onDelete:(0,d.Z)((()=>(0,T.mO)([y]))),onRemoveFromCategory:(0,d.Z)((e=>(0,T.am)([y],e))),onRestore:(0,d.Z)((()=>(0,T.xo)([y]))),onClean:(0,d.Z)((()=>(0,T.Kr)([y])))});var y;const[,C]=(0,Ie.c)({item:{type:"resource",item:e,sourceCategoryId:n.id,sourceDragger:p},collect:e=>({isDragging:e.isDragging()})}),k=(0,d.Z)((t=>{var n,a;s(!0);const{offsetLeft:l,offsetTop:r,clientWidth:c,clientHeight:o}=t.currentTarget;if(![Pe.mZ.Video,Pe.mZ.Audio,Pe.mZ.Image,Pe.mZ.Text].includes(e.type.cid))if(null==(n=e.extra)?void 0:n.previewVideo){const t=null==(a=e.extra)?void 0:a.previewVideo;i(l,r,c,o,t,"Video")}else(0,Le.Nm)({id:e.type.cid})&&i(l,r,c,o,e.previewUrl,be.N7[e.type.cid])})),w=(0,d.Z)((()=>{s(!1),c()})),I=(0,d.Z)((()=>{const t=e.categories.length>1;b.Z.confirm({className:u.Z.modalWrapper,title:"删除物料",icon:null,centered:!0,closable:!0,content:t?"该物料属于多个分类，删除后同时会从其他分类下消失":`您将删除“${e.name}”`,okText:"确认",cancelText:"取消",onOk:()=>{g().then((()=>{r(),x.ZP.success(`成功删除“${e.name}”`)}))}})})),P=(0,d.Z)((()=>{m.current&&(m.current.value=String(e.id),m.current.select(),document.execCommand("Copy"),x.ZP.info("复制成功"))})),L=Z.createElement(Y.Z,null,Z.createElement(Y.Z.Item,{key:"remove",onClick:()=>{f([n.id]).then((()=>{r(),x.ZP.success(`成功将物料从${n.name}中移除`)}))}},"从分类中移除"),Z.createElement(Y.Z.Item,{key:"delete",onClick:I},"删除"));return Z.createElement("div",{ref:C,className:u.Z.item,onMouseEnter:k,onMouseLeave:w},Z.createElement("div",{ref:p,className:u.Z.itemPreview},Z.createElement(ce.Z,{data:e,CoverBoxRef:p}),Z.createElement("div",{className:u.Z.itemTag},e.type.name),Z.createElement(N.Z,{className:u.Z.itemCheckbox,checked:t,onChange:t=>{const{checked:n}=t.target;a(e.id,n)}}),o&&Z.createElement("div",{className:u.Z.itemOptions},"0"===n.id?Z.createElement(Z.Fragment,null,Z.createElement(E.Z,{type:"link",onClick:()=>{h().then((()=>{r(),x.ZP.success("成功将物料还原")}))}},"还原"),Z.createElement(E.Z,{type:"link",onClick:()=>{v().then((()=>{r(),x.ZP.success("成功将物料清理")}))}},"清理")):Z.createElement(Z.Fragment,null,Z.createElement(E.Z,{type:"link",onClick:()=>l("updateCat",[e.id])},"修改分类"),Z.createElement(E.Z,{type:"link",onClick:()=>l("detail",[e.id])},"详情"),Z.createElement(E.Z,{type:"link",onClick:()=>l("apply",[e.id])},"发布"),["全部","未分类"].includes(n.name)?Z.createElement(E.Z,{type:"link",onClick:I},"删除"):Z.createElement(X.Z,{overlay:L,trigger:["hover"]},Z.createElement(E.Z,{type:"link"},"更多"))))),Z.createElement("div",{className:u.Z.itemFooter},Z.createElement(we.Z,{content:Z.createElement("div",{className:u.Z.itemIdTips},Z.createElement("span",null,"物料ID: ",e.id),Z.createElement(E.Z,{size:"small",type:"link",onClick:P},"复制"))},Z.createElement("div",{className:u.Z.itemId},"ID")),Z.createElement(we.Z,{content:e.name},Z.createElement("div",{className:u.Z.itemName},e.name)),Z.createElement("input",{className:u.Z.copyInput,type:"text",ref:m,value:e.id,readOnly:!0})))}var Oe=n(51514),Re=n(1293),Fe=Object.defineProperty,De=Object.defineProperties,Te=Object.getOwnPropertyDescriptors,We=Object.getOwnPropertySymbols,Be=Object.prototype.hasOwnProperty,je=Object.prototype.propertyIsEnumerable,$e=(e,t,n)=>t in e?Fe(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Ue=(e,t)=>{for(var n in t||(t={}))Be.call(t,n)&&$e(e,n,t[n]);if(We)for(var n of We(t))je.call(t,n)&&$e(e,n,t[n]);return e},ze=(e,t)=>De(e,Te(t));Laya.init(0,0),document.body.style.overflow="auto";const Ae=(0,te.iv)({padding:"32px",height:"428px",textAlign:"center"});function Me({pagination:e,onPaginationUpdate:t,setList:n}){const{userInfo:{teamId:a}}=(0,Oe.Pc)(),{category:{list:l,activeCategoryId:r,refreshList:i},library:{loading:c,list:o,total:s,refreshList:m}}=(0,Z.useContext)(C),p=l&&r?l.find((e=>e.id===r)):null,{onBatchDelete:g,onBatchRestore:h,onBatchClean:v}=ae(),[f,y]=(0,Z.useState)({}),[k,w]=(0,Z.useState)({updateCat:{visible:!1,ids:[]},detail:{visible:!1,id:null},rename:{visible:!1,items:[]},apply:{visible:!1,id:""}}),P=(0,Z.useRef)(null),{clearIframe:L,postMessage:S}=(0,Re.s_)(P),[O,R]=(0,Z.useState)({width:0,height:0,left:0,top:0,visible:!1});(0,Z.useEffect)((()=>{1!==e.page&&0===(null==o?void 0:o.length)&&t(ze(Ue({},e),{page:e.page-1}))}),[o]);const F=(0,Z.useMemo)((()=>(o||[]).filter((e=>{var t;return null==(t=f[e.id])?void 0:t.selected}))),[f,o]),D=F.length===(o&&o.length),T=(0,d.Z)(((e,t)=>{y((n=>ze(Ue({},n),{[e]:ze(Ue({},n[e]),{selected:t})})))})),W=(0,d.Z)((e=>{const{checked:t}=e.target;y((e=>{const n={};return null==o||o.forEach((a=>{n[a.id]=ze(Ue({},e[a.id]),{selected:t})})),n}))})),B=(0,d.Z)((e=>()=>{w((t=>ze(Ue({},t),{[e]:ze(Ue({},t[e]),{visible:!1})})))})),j=(0,Z.useMemo)((()=>Z.createElement(Y.Z,null,Z.createElement(Y.Z.Item,{key:"cat",onClick:()=>{0!==F.length?w((e=>ze(Ue({},e),{updateCat:ze(Ue({},e.updateCat),{visible:!0,ids:F.map((e=>e.id))})}))):x.ZP.error("请勾选需要操作的素材")}},"批量修改分类"),Z.createElement(Y.Z.Item,{key:"rename",onClick:()=>{0!==F.length?w((e=>ze(Ue({},e),{rename:ze(Ue({},e.rename),{visible:!0,items:F})}))):x.ZP.error("请勾选需要操作的素材")}},"批量重命名"),Z.createElement(Y.Z.Item,{key:"delete",onClick:()=>{const e=F.find((e=>e.categories.length>1)),t=F.length;0!==t?b.Z.confirm({className:u.Z.modalWrapper,title:"删除物料",icon:null,centered:!0,closable:!0,content:e?"部分物料属于多个分类，删除后同时会从其他分类下消失":`您将删除${t}个物料`,okText:"确认",cancelText:"取消",onOk:()=>{g(F.map((e=>e.id))).then((()=>{x.ZP.success(`成功将${t}个物料删除`),m(),i()}))}}):x.ZP.error("请勾选需要操作的素材")}},"批量删除"))),[F,g,i,m]),$=(0,Z.useMemo)((()=>Z.createElement(Y.Z,null,Z.createElement(Y.Z.Item,{key:"revert",onClick:()=>{h(F.map((e=>e.id))).then((()=>{const e=F.length;x.ZP.success(`成功将${e}个物料还原`),i(),m()}))}},"批量还原"),Z.createElement(Y.Z.Item,{key:"clear",onClick:()=>{v(F.map((e=>e.id))).then((()=>{const e=F.length;x.ZP.success(`成功将${e}个物料清理`),i(),m()}))}},"批量清理"))),[h,F,i,m,v]);if((0,Z.useEffect)((()=>{o&&y((e=>{const t={};for(const n of o)t[n.id]=e[n.id]||{selected:!1};return t}))}),[o]),(0,Z.useEffect)((()=>{window.scrollTo(0,0)}),[e]),!o||!p)return Z.createElement("div",{className:Ae},Z.createElement(Q.Z,{size:"large",spinning:!0}));const U=(e,t,n,a,l,r)=>{R({width:n,height:a,left:e,top:t,visible:!0}),console.log("1!:",{type:"change",url:l,projectType:r}),P.current&&S({type:"change",url:l,projectType:r})},z=()=>{R((e=>ze(Ue({},e),{visible:!1}))),L()};return Z.createElement(Z.Fragment,null,p&&Z.createElement(Z.Fragment,null,Z.createElement("div",{className:u.Z.optionBar},(o||[]).length>0&&Z.createElement(Z.Fragment,null,Z.createElement(N.Z,{className:u.Z.optionCheckbox,checked:D,indeterminate:F.length>0&&!D,onChange:W},"全选"),"0"===p.id?Z.createElement(X.Z,{overlay:$,trigger:["click"]},Z.createElement(E.Z,{className:u.Z.optionButton},"批量操作 ",Z.createElement(ee.Z,null))):Z.createElement(X.Z,{overlay:j,trigger:["click"]},Z.createElement(E.Z,{className:u.Z.optionButton},"批量操作 ",Z.createElement(ee.Z,null)))),Z.createElement(Ee.Z,{teamId:a,categoryId:r||"",onRefetch:()=>{i(),m()}})),Z.createElement(Q.Z,{size:"large",spinning:c},0===(o||[]).length?Z.createElement(fe.F2,{message:"该分类下暂无相关物料"}):Z.createElement(Z.Fragment,null,Z.createElement("div",{className:u.Z.list},(o||[]).map((e=>{var t,a;return Z.createElement(Se,{key:e.id,item:e,category:p,list:o,setList:n,selected:null!=(a=null==(t=f[e.id])?void 0:t.selected)&&a,onSelect:T,onPreviewStart:U,handlePreviewEnd:z,onFinishUpdate:()=>{m(),i()},onShowModal:(e,t)=>{w((n=>ze(Ue({},n),{[e]:Ue(ze(Ue({},n[e]),{visible:!0}),["detail","apply"].includes(e)?{id:t[0]}:{ids:t})})))}})})),Z.createElement("div",{style:{left:`${O.left+1}px`,top:`${O.top}px`,width:`${O.width}px`,height:"209px",position:"absolute",zIndex:9,visibility:O.visible?"visible":"hidden",pointerEvents:"none"},onMouseLeave:z},Z.createElement(Re.t1,{ref:P,width:O.width,height:209}))),Z.createElement("div",{className:u.Z.pagination},Z.createElement(q.Z,{current:e.page,total:s,showTotal:e=>`共${e}条记录`,defaultPageSize:e.pageSize,defaultCurrent:e.page,showSizeChanger:!0,showQuickJumper:!0,pageSizeOptions:["20","60","100"],onChange:(n,a)=>{const l={};n!==e.page&&(l.page=n),(0,I.isNil)(a)||a===e.pageSize||(l.pageSize=a,l.page=1),t(l,{resetPage:!1})}}))))),k.updateCat.visible&&Z.createElement(ie,{ids:k.updateCat.ids,onCancel:B("updateCat")}),k.rename.visible&&Z.createElement(ve,{items:k.rename.items,onCancel:B("rename")}),k.apply.visible&&Z.createElement(Ze.Z,{id:""+k.apply.id,type:"examine",onCancel:B("apply")}),Z.createElement(ke,{visible:k.detail.visible,id:k.detail.id,onCancel:B("detail")}))}var Ve=n(97029),He=n(5635),Ke=n(75382),_e=n(22142);const Ge=()=>{const{list:e,fetchList:t,onAddCategory:n,onCancelAddCategory:r}=function(e){const[t,n]=(0,Z.useState)(null),a=(0,d.Z)((()=>(0,B.Jm)().then((e=>{const{categories:t,subTotal:a,total:l}=e;n(t.map((e=>{var t,n,r;return n=((e,t)=>{for(var n in t||(t={}))A.call(t,n)&&V(e,n,t[n]);if(z)for(var n of z(t))M.call(t,n)&&V(e,n,t[n]);return e})({},e),r={count:"全部"===e.name?l:null!=(t=a[e.id])?t:0},$(n,U(r))})))})))),l=(0,d.Z)((()=>{t&&(t.find((e=>e.isNew))||n((e=>{if(!e)return e;const t=[...e];return t.splice(-1,0,{name:"",isNew:!0,count:0}),t})))})),r=(0,d.Z)((()=>{n((e=>e?[...e].filter((e=>!(0,I.isNil)(e.id))):e))}));return(0,Z.useEffect)((()=>{e&&a()}),[a,e]),{list:t,fetchList:a,onAddCategory:l,onCancelAddCategory:r}}(!0),{params:i,onParamsChange:c}=(0,Ve.N6)(),{loading:o,list:s,total:m,fetchList:p,setList:g}=ne(i),{categoryId:h,keyword:E,types:f}=i,{token:y}=He.Z.useToken();return _e.createElement(C.Provider,{value:{category:{list:e,activeCategoryId:h,refreshList:t,addCategory:n,cancelAddCategory:r},library:{loading:o,list:s,total:m,refreshList:p}}},_e.createElement("div",{className:(0,te.cx)(u.Z.wrapper,(0,te.iv)({background:y.colorBgContainer}))},_e.createElement(v,{keyword:E,types:f,onChange:c}),_e.createElement("div",{className:u.Z.container},_e.createElement(a.W,{backend:l.PD},_e.createElement("div",{className:u.Z.content},_e.createElement("div",{className:u.Z.sidebarWrapper},_e.createElement(J,{active:h,editable:!0,onChange:e=>{c({categoryId:e})}})),_e.createElement("div",{style:{flex:1}},_e.createElement(Me,{setList:g,pagination:i,onPaginationUpdate:c})))))))};var Je=()=>{const[e,t]=(0,Z.useState)("1");return _e.createElement(r.Z,{style:{padding:"0 10px",flex:"1"},defaultActiveKey:e,onChange:t},_e.createElement(r.Z.TabPane,{tab:"团队管理",key:"1"},_e.createElement(Ge,null)),_e.createElement(r.Z.TabPane,{tab:"商城管理",key:"2"},_e.createElement(Ke.Z,{type:"admin",visible:"2"===e})))}}}]);