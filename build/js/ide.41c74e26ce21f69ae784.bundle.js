(self.webpackChunk_byted_editor=self.webpackChunk_byted_editor||[]).push([[562],{98336:function(e,t,r){"use strict";var n=r(30655),o=r.n(n),a=r(60811),i=r.n(a)()(o());i.push([e.id,"body {\n  margin: 0;\n  overflow: hidden;\n  overscroll-behavior-x: none;\n}\n#root {\n  height: 100vh;\n  overflow-x: auto;\n}\n.global-dragging-cursor {\n  cursor: move;\n  pointer-events: none;\n  user-select: none;\n}\n.global-resize-y-cursor {\n  cursor: ns-resize;\n  pointer-events: none;\n  user-select: none;\n}\n[disabled] {\n  pointer-events: none;\n}\n.global-user-drag-none img {\n  -webkit-user-drag: none;\n}\n.ant-layout .ant-layout-sider {\n  background: #1e1f1c !important;\n}\n",""]),t.Z=i},31765:function(e,t,r){"use strict";var n=r(14540),o=r(22142),a=r(42761),i=r(93379),s=r.n(i),l=r(7795),c=r.n(l),u=r(90569),d=r.n(u),p=r(3565),m=r.n(p),f=r(19216),g=r.n(f),b=r(44589),v=r.n(b),y=r(98336),h={};h.styleTagTransform=v(),h.setAttributes=m(),h.insert=d().bind(null,"head"),h.domAPI=c(),h.insertStyleElement=g(),s()(y.Z,h),y.Z&&y.Z.locals&&y.Z.locals;var w=r(291),k=r(55066),x=r(26494),E=r(81958),S=r(61485),O=(r(57690),r(30027)),C=r(53836),I=r(9716),j=Object.defineProperty,P=Object.getOwnPropertySymbols,T=Object.prototype.hasOwnProperty,Z=Object.prototype.propertyIsEnumerable,N=(e,t,r)=>t in e?j(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,D=(e,t)=>{for(var r in t||(t={}))T.call(t,r)&&N(e,r,t[r]);if(P)for(var r of P(t))Z.call(t,r)&&N(e,r,t[r]);return e};const L=Symbol("UpdateSetting"),R=e=>({type:L,setting:e});var F=new class{constructor(){this.dict={}}getAllTabs(){return this.dict}getTab(e){return this.dict[e]}setTabs(e){this.dict=e}},M=Object.defineProperty,z=Object.getOwnPropertySymbols,H=Object.prototype.hasOwnProperty,A=Object.prototype.propertyIsEnumerable,U=(e,t,r)=>t in e?M(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,B=(e,t)=>{for(var r in t||(t={}))H.call(t,r)&&U(e,r,t[r]);if(z)for(var r of z(t))A.call(t,r)&&U(e,r,t[r]);return e};const V=Symbol("UpdateTabs"),$=Symbol("SwitchTab"),_=Symbol("DeleteTab"),W=Symbol("SwitchHistory"),J=Symbol("SwitchTag"),K=e=>({type:V,tabs:e}),Y=(e,t)=>({type:$,tabId:e,range:t}),G=e=>({type:W,historyId:e}),q=e=>({type:J,data:e});var Q=Object.defineProperty,X=Object.getOwnPropertySymbols,ee=Object.prototype.hasOwnProperty,te=Object.prototype.propertyIsEnumerable,re=(e,t,r)=>t in e?Q(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,ne=(e,t)=>{for(var r in t||(t={}))ee.call(t,r)&&re(e,r,t[r]);if(X)for(var r of X(t))te.call(t,r)&&re(e,r,t[r]);return e};const oe=Symbol("UpdateWorkspace"),ae=e=>({type:oe,workspace:e});r(23313);var ie=Object.defineProperty,se=Object.getOwnPropertySymbols,le=Object.prototype.hasOwnProperty,ce=Object.prototype.propertyIsEnumerable,ue=(e,t,r)=>t in e?ie(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;const de=Symbol("RestoreState"),pe=[(e,t)=>(0,I.ZP)(e,(e=>{t.type===L&&(e.setting=D(D({},e.setting),t.setting),localStorage.setItem("webIde._setting",JSON.stringify(e.setting)))})),(e,t)=>(0,I.ZP)(e,(e=>{switch(t.type){case V:e.tabs=B(B({},e.tabs),t.tabs),F.setTabs(e.tabs);break;case _:delete e.tabs[t.tabId],F.setTabs(e.tabs);break;case $:e.workspace.initialRange=t.range,e.workspace.currentTab=t.tabId,e.workspace.selectedHistoryId=null,e.workspace.selectedTag=null;break;case W:e.workspace.selectedTag=null,e.workspace.selectedHistoryId=t.historyId;break;case J:e.workspace.selectedHistoryId=null,e.workspace.selectedTag=t.data}})),(e,t)=>(0,I.ZP)(e,(e=>{t.type===oe&&(e.workspace=ne(ne({},e.workspace),t.workspace))}))],me=localStorage.getItem("webIde._setting"),fe=me?JSON.parse(me):{};"Katzenmilch"===fe.theme?fe.theme="Light":["Dark","Light"].includes(fe.theme)||(fe.theme="Dark");const ge={setting:((e,t)=>{for(var r in t||(t={}))le.call(t,r)&&ue(e,r,t[r]);if(se)for(var r of se(t))ce.call(t,r)&&ue(e,r,t[r]);return e})({fontSize:14,theme:"Dark"},fe),workspace:{readOnly:!0,loading:!1,currentTab:null,selectedHistoryId:null,selectedTag:null,resourceNav:[],markers:[]},tabs:{}};var be=r(61754),ve=r(3197),ye=r(73760),he=Object.defineProperty,we=Object.defineProperties,ke=Object.getOwnPropertyDescriptors,xe=Object.getOwnPropertySymbols,Ee=Object.prototype.hasOwnProperty,Se=Object.prototype.propertyIsEnumerable,Oe=(e,t,r)=>t in e?he(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,Ce=(e,t)=>{for(var r in t||(t={}))Ee.call(t,r)&&Oe(e,r,t[r]);if(xe)for(var r of xe(t))Se.call(t,r)&&Oe(e,r,t[r]);return e};function Ie(e){const t={},r=[];return e.forEach((e=>{const n=e,{projectId:o,id:a,name:i,language:s}=n,l=((e,t)=>{var r={};for(var n in e)Ee.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&xe)for(var n of xe(e))t.indexOf(n)<0&&Se.call(e,n)&&(r[n]=e[n]);return r})(n,["projectId","id","name","language"]);let c=0,u=i,d="";if(i.endsWith(".ts")||i.endsWith(".js")?(u=i.slice(0,-3),d=i.slice(-3)):(c=10,d="typescript"===s?".ts":".js"),t[u]&&c++,0===c)r.push(Promise.resolve(e)),t[u]=1;else{let n=i;10!==c&&(n=`${u}(${t[u]})`),t[i]=(0,ye.isNil)(t[u])?1:t[u]+1,r.push((0,ve.aq)({id:a,projectId:o,name:n+d,sceneContent:JSON.stringify(Ce({language:s},l))}).then((()=>{return t=Ce({},e),we(t,ke({name:n+d}));var t})))}})),Promise.all(r)}var je=r(32078);let Pe=(new Date).getTime();function Te(){const e=new RegExp(/^(\/app|\/play)\/(project|template|product|show|simple)?/);return opener&&opener.origin===window.location.origin&&e.test(opener.location.pathname)}function Ze(){const e=(0,o.useMemo)((()=>{const e=new URLSearchParams(location.search);return Number(e.get("project"))||0}),[]),t=(0,o.useCallback)((()=>{je.Z.warning({title:"请通过对应万能互动项目进入本页面",content:"点击“前往”按钮将为您自动跳转",okText:"前往",onOk:()=>{window.open(window.location.origin)}})}),[]);return(0,o.useMemo)((()=>({openByEditor:Te,postMessage:(r,n)=>{if(!Te())return t(),Promise.reject(new Error("当前未打开万能互动编辑器页面"));const o=window.opener,a=++Pe;return null==o||o.postMessage({type:r,params:n,id:a,projectId:e},window.location.origin),new Promise(((e,r)=>{const n=o=>{const{id:i,result:s,error:l}=o.data;if(a===i){if(l){const e=JSON.parse(l.message);-2===e.code&&t(),r(e)}else e(s);window.removeEventListener("message",n)}};window.addEventListener("message",n)}))}})),[e,t])}var Ne=Object.defineProperty,De=Object.defineProperties,Le=Object.getOwnPropertyDescriptors,Re=Object.getOwnPropertySymbols,Fe=Object.prototype.hasOwnProperty,Me=Object.prototype.propertyIsEnumerable,ze=(e,t,r)=>t in e?Ne(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;const He=()=>{const e=new URLSearchParams(location.search);return{orderId:String(e.get("tab"))||"0",projectId:Number(e.get("project"))||0}};var Ae=r(61645);function Ue(e){let t=!1;return"typescript"!==e.getModeId()&&(e=at(e.uri.path.slice(1,-3)+"_"+(new Date).getTime()+".ts",e.getValue(),"typescript"),t=!0),function(e){return new Promise(((t,r)=>{k.Fd.languages.typescript.getTypeScriptWorker().then((n=>{n(e.uri).then((n=>{n.getEmitOutput(e.uri.toString()).then((function(e){t(e.outputFiles[0].text)})).catch((()=>{r(new Error("typescript file compile error"))}))}))}))}))}(e).then((r=>{if(e.getValue()&&!r)throw new Error("编译出现错误，请保存重试");return t&&e.dispose(),r}))}function Be(e,t=[]){const r=new RegExp(/import\s[\s\S]*\s?from\s['"]\.\/([\w\-]+)['"]/,"i"),n=e.findMatches(r,!1,!0,!1,null,!0),o=Object.fromEntries(Object.entries(F.getAllTabs()).map((([e,t])=>[t.name.slice(0,-3),t])));return n.forEach((({matches:e})=>{if((0,ye.isArray)(e)&&2===(null==e?void 0:e.length)){const r=e[1];if(o[r]){const e=st(r+("typescript"===o[r].resourceLanguage?".ts":".js"));e&&t.every((t=>t.uri!==e.uri))&&(t.push({uri:e.uri,model:e}),Be(e,t))}}})),t}const Ve=[];var $e=Object.defineProperty,_e=Object.defineProperties,We=Object.getOwnPropertyDescriptors,Je=Object.getOwnPropertySymbols,Ke=Object.prototype.hasOwnProperty,Ye=Object.prototype.propertyIsEnumerable,Ge=(e,t,r)=>t in e?$e(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;function qe(e){const{id:t}=e;return(0,ve.gt)(t).then((({name:t,sceneContent:r})=>{const{language:n,ideCode:o,jsCode:a}=JSON.parse(r);let i=o,s=!1;return i?a||(s=!0):(s=!0,i="export default class Script extends Riko.Script {\n    onAwake() {\n      console.log(this.target);\n      // TODO\n    }\n  }"),at(t,i,n),lt.add(t,i),l=((e,t)=>{for(var r in t||(t={}))Ke.call(t,r)&&Ge(e,r,t[r]);if(Je)for(var r of Je(t))Ye.call(t,r)&&Ge(e,r,t[r]);return e})({},e),_e(l,We({name:t,resourceLanguage:n,resourceContent:i,needsSave:s,saveStatus:0}));var l}))}const Qe={};function Xe(e){k.Fd.languages.registerCompletionItemProvider(e,{provideCompletionItems:function(e,t){const{lineNumber:r,column:n}=t,o=e.getLineContent(r),a={startLineNumber:r,endLineNumber:r,startColumn:n,endColumn:n},i=o.match(/^(import)\s[\s\S]*\s?from\s['"]\.\/['"]/);return i?Promise.resolve().then((()=>{const t=Object.values(F.getAllTabs());if(i)return{suggestions:t.filter((t=>t.name.slice(0,-3)!==e.uri.path.slice(1,-3))).map((e=>{const t=e.name.slice(0,-3);return{label:t,kind:k.Fd.languages.CompletionItemKind.File,insertText:t,range:a}}))}})):{suggestions:[]}},triggerCharacters:["/"]})}const et={setupList:[function(){return k.Fd.languages.typescript.javascriptDefaults.setCompilerOptions({target:k.Fd.languages.typescript.ScriptTarget.ES2016,allowNonTsExtensions:!0}),k.Fd.languages.typescript.typescriptDefaults.setCompilerOptions({target:k.Fd.languages.typescript.ScriptTarget.ES2016,moduleResolution:k.Fd.languages.typescript.ModuleResolutionKind.NodeJs,module:k.Fd.languages.typescript.ModuleKind.CommonJS,allowNonTsExtensions:!0,allowJs:!0,removeComments:!0,experimentalDecorators:!0,emitDecoratorMetadata:!0}),{activationEvents:["onSave"],task:(e,t)=>{return r=this,null,n=function*(){const r=Be(e).filter((t=>t.uri!==e.uri)).map((e=>e.model)),n={entry:{name:e.uri.path.slice(1).replace(/\.ts$/,".js"),content:""},deps:[]},o=yield Ue(e);(0,ye.isString)(o)&&(n.entry.content=o);for(const e of r){const t=yield Ue(e);(0,ye.isString)(t)&&n.deps.push({name:e.uri.path.slice(1).replace(/\.ts$/,".js"),content:t})}try{const e=yield(0,Ae.cI)(n.entry,n.deps);return(0,ye.isNil)(t)||(t.jsCode=e),t}catch(e){throw Ve.forEach((t=>t(e.response.data))),e}},new Promise(((e,t)=>{var o=e=>{try{i(n.next(e))}catch(e){t(e)}},a=e=>{try{i(n.throw(e))}catch(e){t(e)}},i=t=>t.done?e(t.value):Promise.resolve(t.value).then(o,a);i((n=n.apply(r,null)).next())}));var r,n}}},function(){return Xe("typescript"),Xe("javascript"),k.Fd.languages.typescript.typescriptDefaults.setEagerModelSync(!0),k.Fd.languages.typescript.javascriptDefaults.setEagerModelSync(!0),{activationEvents:["onMarkersUpdate"],task:(e,t)=>{const r=k.Fd.editor.getModelMarkers({resource:e.uri}).filter((e=>"2307"===e.code)),n={},o=F.getAllTabs();return Object.values(o).forEach((e=>{n[e.name.slice(0,-3)]=e})),r.forEach((t=>{const{startColumn:r,endColumn:o,startLineNumber:a,endLineNumber:i}=t,s=e.getValueInRange({startColumn:r,endColumn:o,startLineNumber:a,endLineNumber:i}).slice(1,-1);if(s.startsWith("./")){const e=s.slice(2);n[e]&&!Qe[n[e].id]&&(Qe[n[e].id]=!0,qe(n[e]).then((()=>{Qe[n[e].id]=!1})).catch((e=>{console.error(e.message)})))}})),Promise.resolve(t)}}}],eventTasks:{onSave:[],onChange:[],onMarkersUpdate:[]}};const tt="workspace://";function rt(e){return`${tt}node_modules/${e}`}function nt(e){return`${tt}src/${e}`}function ot(e){return k.Fd.Uri.parse(e)}function at(e,t,r,n=!1){return st(e)||k.Fd.editor.createModel(t,r,ot(n?rt(e):nt(e)))}function it(e,t){const r=st(e);if(r)return null==r||r.setValue(t),r;throw new Error("文件不存在")}function st(e){return k.Fd.editor.getModel(ot(nt(e)))}const lt=new class{constructor(){this.dict={}}add(e,t,r=!1){const n=r?rt(e):nt(e),o=k.Fd.languages.typescript.javascriptDefaults.addExtraLib(t,n),a=k.Fd.languages.typescript.typescriptDefaults.addExtraLib(t,n);this.dict[n]={jsLib:o,tsLib:a}}remove(e){const t=nt(e);if(this.dict[t]){const{jsLib:e,tsLib:r}=this.dict[t];e.dispose(),r.dispose(),delete this.dict[t]}}};var ct=r(64175),ut=r(43294);const dt=new class{constructor(){this.dict={}}get(e){return this.dict[e]}set(e,t){this.dict[e]=t}has(e){return Object.keys(this.dict).includes(e.toString())}};var pt=(e,t,r)=>new Promise(((n,o)=>{var a=e=>{try{s(r.next(e))}catch(e){o(e)}},i=e=>{try{s(r.throw(e))}catch(e){o(e)}},s=e=>e.done?n(e.value):Promise.resolve(e.value).then(a,i);s((r=r.apply(e,t)).next())}));function mt(e){e&&e.getAction("editor.action.formatDocument").run()}var ft=r(18725),gt=Object.defineProperty,bt=Object.defineProperties,vt=Object.getOwnPropertyDescriptors,yt=Object.getOwnPropertySymbols,ht=Object.prototype.hasOwnProperty,wt=Object.prototype.propertyIsEnumerable,kt=(e,t,r)=>t in e?gt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,xt=(e,t)=>{for(var r in t||(t={}))ht.call(t,r)&&kt(e,r,t[r]);if(yt)for(var r of yt(t))wt.call(t,r)&&kt(e,r,t[r]);return e},Et=(e,t)=>bt(e,vt(t));function St(e,t=!1){var r,n;const{postMessage:i}=Ze(),s=(0,a.I0)(),l=(0,a.v9)((t=>(0,ye.isNil)(e)?null:t.ide.tabs[e])),c=l&&null!=(r=l.resourceLanguage)?r:"typescript",u=!!l&&l.needsSave,d=l?l.saveStatus:0,p=l&&null!=(n=l.resourceContent)?n:"",m=(0,o.useRef)({showsSyncResult:!1,saveStatus:0,needsSave:!1}),f=(0,x.Z)((t=>{return r=this,n=[t],o=function*({showsResult:t=!1}){if((0,ye.isNil)(l)||(0,ye.isNil)(e))return Promise.resolve();{const{id:r,name:n}=l,o=st(n),a=o?o.getValue():p;m.current=Et(xt({},m.current),{saveStatus:1,needsSave:!1}),s(K({[e]:Et(xt({},l),{needsSave:!1,saveStatus:1})}));try{i("saveCustomScript",{id:r,name:n,content:{type:"CustomScript",language:c,ideCode:a}});const o=Et(xt({},l),{resourceLanguage:c,resourceContent:a,saveStatus:0,needsSave:m.current.needsSave});m.current=Et(xt({},m.current),{saveStatus:0}),s(K({[e]:o})),localStorage.setItem(ft.Y,String((new Date).getTime())),t&&be.ZP.success("保存成功")}catch(r){m.current=Et(xt({},m.current),{saveStatus:0}),s(K({[e]:Et(xt({},l),{saveStatus:0,needsSave:!0})})),t&&be.ZP.error(r.message)}}},new Promise(((e,t)=>{var a=e=>{try{s(o.next(e))}catch(e){t(e)}},i=e=>{try{s(o.throw(e))}catch(e){t(e)}},s=t=>t.done?e(t.value):Promise.resolve(t.value).then(a,i);s((o=o.apply(r,n)).next())}));var r,n,o})),g=(0,x.Z)(((t=!1)=>{(0,ye.isNil)(l)||(0,ye.isNil)(e)||(m.current=Et(xt({},m.current),{needsSave:!0,showsSyncResult:t}),s(K({[e]:Et(xt({},l),{needsSave:!0})})))}));return(0,o.useEffect)((()=>{const{saveStatus:e,showsSyncResult:r,needsSave:n}=m.current;t&&n&&1!==e&&f({showsResult:r})}),[m.current,t,f]),{tab:l,tabContent:p,needsSave:u,saveStatus:d,language:c,saveTab:f,localSyncTab:g}}const Ot=[S.Z];var Ct=(0,O.MT)((0,O.UY)({ide:function(e=ge,t){if(t.type===de)return t.state;let r=e;for(const e of pe)r=e(r,t);return r}}),(0,C.Uo)((0,O.md)(...Ot)));const It=o.createContext({instance:null});var jt=r(27752),Pt=r(45858),Tt=r(62732),Zt=Object.defineProperty,Nt=Object.defineProperties,Dt=Object.getOwnPropertyDescriptors,Lt=Object.getOwnPropertySymbols,Rt=Object.prototype.hasOwnProperty,Ft=Object.prototype.propertyIsEnumerable,Mt=(e,t,r)=>t in e?Zt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,zt=(e,t)=>{for(var r in t||(t={}))Rt.call(t,r)&&Mt(e,r,t[r]);if(Lt)for(var r of Lt(t))Ft.call(t,r)&&Mt(e,r,t[r]);return e},Ht=(e,t)=>Nt(e,Dt(t));const At={position:"fixed",bottom:"24px",right:"48px",display:"flex",alignItems:"center",justifyContent:"center",width:"50px",height:"50px",borderRadius:"50%",border:"2px solid",zIndex:100,cursor:"pointer",userSelect:"none"},Ut={position:"fixed",bottom:"40px",right:"60px",width:"300px",height:"350px",border:"1px solid",zIndex:99,borderRadius:"10px",overflowY:"auto"},Bt={margin:"8px 4px",padding:"2px 4px",borderRadius:"6px",fontSize:"14px",cursor:"pointer"},Vt={darkTipsBox:(0,Tt.iv)(Ht(zt({},At),{borderColor:"#3955f6",backgroundColor:"#555",boxShadow:"4px 4px 6px 6px rgba(0,0,0,0.1)","&:hover":{backgroundColor:"#666"}})),darkList:(0,Tt.iv)(Ht(zt({},Ut),{backgroundColor:"#333",borderColor:"#444",color:"#fff",boxShadow:"0 0 6px 6px rgba(0,0,0,0.1)","&::-webkit-scrollbar":{display:"none"}})),lightTipsBox:(0,Tt.iv)(Ht(zt({},At),{borderColor:"transparent",boxShadow:"0 3px 6px -4px rgb(0 0 0 / 12%), 0 6px 16px 0 rgb(0 0 0 / 8%), 0 9px 28px 8px rgb(0 0 0 / 5%)","&:hover":{backgroundColor:"#edf4fd"}})),lightList:(0,Tt.iv)(Ht(zt({},Ut),{borderColor:"#ddd",color:"#333",boxShadow:"0 1px 2px -2px rgb(0 0 0 / 16%), 0 3px 6px 0 rgb(0 0 0 / 12%), 0 5px 12px 4px rgb(0 0 0 / 9%)","&::-webkit-scrollbar":{display:"none"}})),darkItem:(0,Tt.iv)(Ht(zt({},Bt),{"&:hover":{backgroundColor:"#444"}})),lightItem:(0,Tt.iv)(Ht(zt({},Bt),{"&:hover":{backgroundColor:"#f5f5f5"}})),itemLineTips:(0,Tt.iv)({paddingLeft:"2px",paddingRight:"4px",fontWeight:"bold"})};var $t=({theme:e})=>{const[t,r]=(0,o.useState)(!0),{instance:n}=(0,o.useContext)(It),i=(0,a.v9)((e=>e.ide.workspace.markers)),[s,l]=(0,o.useState)([]),c=e[0].toLowerCase()+e.slice(1);(0,o.useEffect)((()=>{return e=({errors:e})=>l(e.map((({loc:e,message:t})=>{const[r,n]=e.split(":");return{severity:8,message:t,startLineNumber:Number(r),startColumn:Number(n)}}))),Ve.push(e),()=>{const t=Ve.findIndex((t=>t===e));t>-1&&Ve.splice(t,1)};var e}));const u={1:{name:"Hint",color:"#e8de58"},2:{name:"Info",color:"#58dae8"},4:{name:"Warning",color:"#e8de58"},8:{name:"Error",color:"#f93b3b"}};return i.length||s.length?o.createElement(o.Fragment,null,o.createElement("div",{className:Vt[`${c}TipsBox`],onClick:()=>{r((e=>!e))}},o.createElement(Pt.Z,{count:i.length,size:"small"},o.createElement(jt.Z,{theme:"outline",size:"26",fill:"dark"===c?"#fff":"#428ce0",style:{lineHeight:"11px"}}))),t&&o.createElement("div",{className:Vt[`${c}List`]},[...s,...i].map((({severity:e,message:t,startLineNumber:r,startColumn:a,endLineNumber:i,endColumn:s},l)=>o.createElement("div",{key:l,className:Vt[`${c}Item`],onClick:()=>{n&&(n.revealPositionInCenterIfOutsideViewport({lineNumber:r,column:a},1),(s||i)&&n.setSelection({startLineNumber:r,endLineNumber:i,startColumn:a,endColumn:s}))}},o.createElement("span",{style:{color:u[e].color}},"[",u[e].name,"]"),o.createElement("span",{className:Vt.itemLineTips},"Line ",r,":",a,":"),t))))):null},_t=r(71478),Wt=r(62255),Jt=r(26840),Kt=r(70072),Yt=r(92791),Gt=r(34450),qt=r.n(Gt),Qt=r(95611),Xt=r.n(Qt),er=r(47910),tr=r.n(er),rr=r(67613),nr=r(72704),or=r(20288),ar=r(41650),ir=r(33058),sr=r(71092),lr=r(22142),cr=Object.defineProperty,ur=Object.defineProperties,dr=Object.getOwnPropertyDescriptors,pr=Object.getOwnPropertySymbols,mr=Object.prototype.hasOwnProperty,fr=Object.prototype.propertyIsEnumerable,gr=(e,t,r)=>t in e?cr(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,br=(e,t,r)=>new Promise(((n,o)=>{var a=e=>{try{s(r.next(e))}catch(e){o(e)}},i=e=>{try{s(r.throw(e))}catch(e){o(e)}},s=e=>e.done?n(e.value):Promise.resolve(e.value).then(a,i);s((r=r.apply(e,t)).next())}));qt().extend(tr());const vr=()=>{const{trigger:e}=(0,sr.Z)("historyReload");return{trigger:e}},yr=()=>{const{dispatch:e}=(0,a.oR)(),{currentTab:t}=(0,a.v9)((e=>{const{workspace:t}=e.ide;return{currentTab:t.currentTab}}),a.wU),{tab:r,localSyncTab:n}=St(t,!0);return{onCloseCompare:()=>{e(G(null)),e(q(null))},onApply:t=>br(void 0,null,(function*(){const o=yield(0,_t.Vj)(t);var a,i;r&&o?je.Z.confirm({title:"历史记录覆盖",content:(a=qt()(new Date(o.createTime)).locale(Xt()).fromNow(),i=o.name,lr.createElement("p",null,"确定将文件替换为",lr.createElement("span",{style:{color:"orange"}},a," ",i))),cancelText:"取消",onOk:()=>{if(o.resourceContent)try{it(r.name,o.resourceContent),lt.add(r.name,o.resourceContent),e(G(null)),n(),be.ZP.success("替换成功")}catch(e){be.ZP.error(e)}}}):be.ZP.error("文件已经被删除")}))}};var hr=r(22142),wr=(e,t,r)=>new Promise(((n,o)=>{var a=e=>{try{s(r.next(e))}catch(e){o(e)}},i=e=>{try{s(r.throw(e))}catch(e){o(e)}},s=e=>e.done?n(e.value):Promise.resolve(e.value).then(a,i);s((r=r.apply(e,t)).next())}));qt().extend(tr());const kr={listContainer:(0,Tt.iv)({height:"300px",overflowY:"scroll",color:"white","::-webkit-scrollbar":{display:"none"}}),collapse:(0,Tt.iv)({backgroundColor:"#1e1f1c",".ant-collapse-header":{color:"white !important"},".ant-collapse-content-box":{padding:"4px"}})},xr=({item:e,onUpdate:t})=>{const[r,n]=(0,o.useState)(e.name),[a,i]=(0,o.useState)(!1),s=(0,o.useRef)(null);return hr.createElement("div",{style:{display:"inline-block",width:"35%"},onDoubleClick:e=>{e.stopPropagation(),i(!0),setTimeout((()=>{var e;null==(e=s.current)||e.focus()}),200)}},hr.createElement(Wt.Z,{ref:s,size:"small",value:r,bordered:a,disabled:!a,onClick:e=>e.preventDefault(),onChange:e=>{n(e.target.value)},onBlur:()=>wr(void 0,null,(function*(){i(!1),yield(0,_t.bh)(e.historyId,r),t()})),onPressEnter:()=>{var e;null==(e=s.current)||e.blur()}}))},Er=({selectedHistoryId:e,item:t,onPin:r,onSelectHistory:n,onApply:a,onDelete:i,onUpdate:s})=>{const[l,c]=(0,o.useState)(!1);return hr.createElement("div",{style:{margin:"5px",padding:"0 4px",background:e===t.historyId?"#404238":l?"gray":"unset",color:e===t.historyId?"#8496fb":"white"},onClick:n,onMouseOver:()=>{c(!0)},onMouseLeave:()=>{c(!1)}},hr.createElement("span",{style:{display:"inline-block",width:"75px",userSelect:"none"}},qt()(new Date(t.createTime)).locale(Xt()).fromNow())," ",hr.createElement(xr,{item:t,onUpdate:s}),(l||t.isLocked)&&hr.createElement(Jt.Z,{title:"置顶"},hr.createElement(Kt.Z,{type:"text",size:"small",style:{float:"right",color:t.isLocked?"#8496fb":"white"},icon:hr.createElement(ir.Z,{component:rr.Z}),onClick:e=>{e.stopPropagation(),r()}})),l&&hr.createElement(Jt.Z,{title:"删除"},hr.createElement(Kt.Z,{type:"text",size:"small",style:{float:"right",color:"white",visibility:l?"unset":"hidden"},icon:hr.createElement(ir.Z,{component:nr.Z}),onClick:e=>{e.stopPropagation(),i()}})),l&&hr.createElement(Jt.Z,{title:"覆盖"},hr.createElement(Kt.Z,{type:"text",size:"small",style:{float:"right",color:"white",visibility:l?"unset":"hidden"},icon:hr.createElement(ir.Z,{component:or.Z}),onClick:e=>{e.stopPropagation(),a()}})))},Sr=()=>{const{onApply:e}=(()=>{const{dispatch:e}=(0,a.oR)(),{currentTab:t}=(0,a.v9)((e=>{const{workspace:t}=e.ide;return{currentTab:t.currentTab}}),a.wU),{tab:r,localSyncTab:n}=St(t,!0);return{onApply:t=>{return o=function*(){r&&t?je.Z.confirm({title:"标签覆盖",content:"是否将标签覆盖",cancelText:"取消",onOk:()=>{if(t)try{it(r.name,t.jscode),lt.add(r.name,t.jscode),e(q(null)),n(),be.ZP.success("替换成功")}catch(e){be.ZP.error(e)}}}):be.ZP.error("文件已经被删除")},new Promise(((e,t)=>{var r=e=>{try{a(o.next(e))}catch(e){t(e)}},n=e=>{try{a(o.throw(e))}catch(e){t(e)}},a=t=>t.done?e(t.value):Promise.resolve(t.value).then(r,n);a((o=o.apply(void 0,null)).next())}));var o}}})(),{onApply:t,onCloseCompare:r}=yr(),{selectedHistoryId:n,selectedTag:o}=(0,a.v9)((e=>{const{workspace:t}=e.ide;return{selectedTag:t.selectedTag,selectedHistoryId:t.selectedHistoryId}}),a.wU);return hr.createElement("div",{style:{position:"absolute",top:"2px",right:"50px",zIndex:2}},hr.createElement(Kt.Z,{style:{marginRight:"5px"},size:"small",type:"primary",onClick:()=>{n?t(n):o&&e(o)}},"覆盖"),hr.createElement(Kt.Z,{size:"small",onClick:r},"关闭"))};function Or({createDiffEditor:e}){const{dispatch:t}=(0,a.oR)(),[r,n]=(0,o.useState)(0),[i,s]=(0,o.useState)([]),{currentTab:l,selectedHistoryId:c}=(0,a.v9)((e=>{const{workspace:t}=e.ide;return{currentTab:t.currentTab,selectedHistoryId:t.selectedHistoryId}}),a.wU),{tab:u}=St(l,!0),{onApply:d}=yr();(0,o.useEffect)((()=>{c&&(0,_t.Vj)(c).then((e=>{(null==e?void 0:e.id)===l&&void 0!==l||(t(G(null)),p())}))}),[l,c,t]);const p=()=>{n((e=>e+1))};(0,sr.Z)("historyReload",p),(0,o.useEffect)((()=>{l?(0,_t.Je)(l).then((e=>{e&&s(e.reverse().sort((e=>e.isLocked?-1:1)))})):s([])}),[l,r]);const m=e=>wr(this,null,(function*(){yield(0,_t.M$)(e),p(),c===e&&t(G(null))})),f=hr.createElement(hr.Fragment,null,hr.createElement("span",{style:{marginRight:"5px"}},"历史记录"),hr.createElement(Kt.Z,{style:{color:"white"},type:"text",size:"small",icon:hr.createElement(ir.Z,{component:ar.Z}),onClick:e=>wr(this,null,(function*(){e.stopPropagation(),u?je.Z.confirm({title:"删除",content:hr.createElement("p",null,"确定要删除",hr.createElement("span",{style:{color:"orange"}},u.name),"的所有非置顶历史记录吗？"),onOk:()=>wr(this,null,(function*(){u&&(yield(0,_t.sd)(u.id)),t(G(null)),p()}))}):be.ZP.error("文件不存在")}))}));return hr.createElement("div",{style:{color:"white"}},hr.createElement(Yt.Z,{defaultActiveKey:["1"],bordered:!1,className:kr.collapse},hr.createElement(Yt.Z.Panel,{header:f,key:"1"},hr.createElement("div",{className:kr.listContainer},i.map(((r,n)=>{var o;return hr.createElement(Er,{key:null!=(o=r.historyId)?o:n,item:r,selectedHistoryId:c,onUpdate:p,onPin:()=>{var e,t;r.historyId&&(e=r.historyId,t=!r.isLocked,(0,_t.cS)(e,t),p())},onApply:()=>{r.historyId&&d(r.historyId)},onDelete:()=>{r.historyId&&m(r.historyId)},onSelectHistory:()=>{var n;r.historyId&&(n=r.historyId,(0,_t.Vj)(n).then((r=>{if(t(G(n)),u&&r&&r.historyId&&r.resourceContent&&r.resourceLanguage){const t=st(u.name),n=at(r.historyId.toString(),r.resourceContent,r.resourceLanguage);t&&n&&e(t,n)}})))}})}))))))}var Cr=Object.defineProperty,Ir=Object.defineProperties,jr=Object.getOwnPropertyDescriptors,Pr=Object.getOwnPropertySymbols,Tr=Object.prototype.hasOwnProperty,Zr=Object.prototype.propertyIsEnumerable,Nr=(e,t,r)=>t in e?Cr(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,Dr=(e,t)=>{for(var r in t||(t={}))Tr.call(t,r)&&Nr(e,r,t[r]);if(Pr)for(var r of Pr(t))Zr.call(t,r)&&Nr(e,r,t[r]);return e},Lr=(e,t)=>Ir(e,jr(t)),Rr=(e,t,r)=>new Promise(((n,o)=>{var a=e=>{try{s(r.next(e))}catch(e){o(e)}},i=e=>{try{s(r.throw(e))}catch(e){o(e)}},s=e=>e.done?n(e.value):Promise.resolve(e.value).then(a,i);s((r=r.apply(e,t)).next())}));function Fr(){const{trigger:e}=vr(),t=(0,a.I0)(),{currentTab:r,setting:n,readOnly:i,initialRange:s}=(0,a.v9)((e=>({currentTab:e.ide.workspace.currentTab,setting:e.ide.setting,readOnly:e.ide.workspace.readOnly,initialRange:e.ide.workspace.initialRange})),a.wU);!function(e){const t=(0,a.I0)(),{tab:r}=St(e),n=(0,o.useRef)(e);(0,o.useEffect)((()=>{e&&r&&n.current!==e&&(n.current=e,qe(r).then((r=>{t(K({[e]:r}))})))}),[e,r,t])}(r);const{tab:l,localSyncTab:c}=St(r,!0),u=l?st(l.name):null,d=(0,o.useRef)(null),{setInstance:p}=(()=>{const e=(0,o.useRef)(null),{currentTab:t}=(0,a.v9)((e=>{const{workspace:t}=e.ide;return{currentTab:t.currentTab}}),a.wU),r=(0,o.useRef)(null),{tab:n}=St(t,!0),{trigger:i}=vr(),s=(0,o.useCallback)((()=>br(void 0,null,(function*(){var e,t,r,o;n&&(yield(0,_t.kO)((r=((e,t)=>{for(var r in t||(t={}))mr.call(t,r)&&gr(e,r,t[r]);if(pr)for(var r of pr(t))fr.call(t,r)&&gr(e,r,t[r]);return e})({},n),o={resourceContent:null!=(t=null==(e=st(n.name))?void 0:e.getValue())?t:""},ur(r,dr(o)))),i())}))),[n,i]);return(0,o.useEffect)((()=>{const t=e.current;r.current&&r.current.dispose(),t&&(r.current=t.onDidBlurEditorText(s))}),[s]),{setInstance:t=>{e.current=t}}})(),m=(0,x.Z)((()=>Rr(this,null,(function*(){if(l&&u){const r=(e=l.name,k.Fd.editor.getModelMarkers({resource:ot(nt(e))}));t(ae({markers:r.filter((e=>"80004"!==e.code))}));try{yield function(e,t,r){return n=this,o=function*(){const n=et.eventTasks[t],o=n.length;let a=0;if(e)for(;a<o;)yield n[a](e,r),a++;return r},new Promise(((e,t)=>{var r=e=>{try{i(o.next(e))}catch(e){t(e)}},a=e=>{try{i(o.throw(e))}catch(e){t(e)}},i=t=>t.done?e(t.value):Promise.resolve(t.value).then(r,a);i((o=o.apply(n,null)).next())}));var n,o}(u,"onMarkersUpdate",null)}catch(e){console.error(e.message)}}var e}))));(0,o.useEffect)((()=>{const e=d.current;if(null==e||e.setModel(u),mt(e),r){const t=dt.get(r);t&&(null==e||e.restoreViewState(t),null==e||e.focus())}return()=>{r&&dt.set(r,null==e?void 0:e.saveViewState())}}),[r,u]),(0,o.useEffect)((()=>{const e=function(e,t){if(e){const t=e._instantiationService._parent._services._entries;for(const e of t)if("markerDecorationsService"===e[0].toString())return e[1]}return null}(d.current);e&&e._onDidChangeMarker.event((function(){m()}))}),[d.current,m]),(0,o.useEffect)((()=>{const t=d.current;r&&t&&!i&&t.addCommand(k.Fd.KeyMod.CtrlCmd|k.Fd.KeyCode.KEY_S,(()=>{var r,n;i||(c(!0),mt(t),l&&((0,_t.kO)(Lr(Dr({},l),{resourceContent:null!=(n=null==(r=st(l.name))?void 0:r.getValue())?n:""})),e()))}))}),[r,l,c,i]),(0,o.useEffect)((()=>{const e=d.current;e&&s&&(e.setSelection(s),e.revealRangeInCenter(s))}),[s]);const{run:f}=(0,E.Z)((()=>Rr(this,null,(function*(){var t,r;l&&(yield(0,_t.kO)(Lr(Dr({},l),{resourceContent:null!=(r=null==(t=st(l.name))?void 0:t.getValue())?r:""})),e())}))),2e4),{run:g}=(0,E.Z)((e=>Rr(this,null,(function*(){r&&!i&&(c(),l&&(lt.add(l.name,e),f()))}))),300),b={folding:!0,foldingHighlight:!0,automaticLayout:!0,formatOnPaste:!0,formatOnType:!0,tabSize:2,lineDecorationsWidth:4,fontSize:n.fontSize,theme:n.theme,padding:{top:10,bottom:10},lightbulb:{enabled:!0},readOnly:i};return o.createElement(It.Provider,{value:{instance:d.current}},o.createElement(k.ZP,{options:b,onChange:e=>{g(e)},editorDidMount:e=>{e.focus(),d.current=e,p(e)}}),o.createElement($t,{theme:n.theme}))}k.Fd.editor.defineTheme("Dark",{base:"vs-dark",inherit:!0,rules:[{token:"",background:"272822"},{token:"comment",foreground:"75715e"},{token:"string",foreground:"e6db74"},{token:"constant.numeric",foreground:"ae81ff"},{token:"constant.language",foreground:"ae81ff"},{token:"constant.character",foreground:"ae81ff"},{token:"constant.other",foreground:"ae81ff"},{token:"keyword",foreground:"f92672"},{token:"storage",foreground:"f92672"},{token:"storage.type",foreground:"66d9ef",fontStyle:"italic"},{token:"entity.name.class",foreground:"a6e22e",fontStyle:"underline"},{token:"entity.other.inherited-class",foreground:"a6e22e",fontStyle:"italic underline"},{token:"entity.name.function",foreground:"a6e22e"},{token:"variable.parameter",foreground:"fd971f",fontStyle:"italic"},{token:"entity.name.tag",foreground:"f92672"},{token:"entity.other.attribute-name",foreground:"a6e22e"},{token:"support.function",foreground:"66d9ef"},{token:"support.constant",foreground:"66d9ef"},{token:"support.type",foreground:"66d9ef",fontStyle:"italic"},{token:"support.class",foreground:"66d9ef",fontStyle:"italic"},{token:"invalid",foreground:"f8f8f0",background:"f92672"},{token:"invalid.deprecated",foreground:"f8f8f0",background:"ae81ff"},{token:"meta.structure.dictionary.json string.quoted.double.json",foreground:"cfcfc2"},{token:"meta.diff",foreground:"75715e"},{token:"meta.diff.header",foreground:"75715e"},{token:"markup.deleted",foreground:"f92672"},{token:"markup.inserted",foreground:"a6e22e"},{token:"markup.changed",foreground:"e6db74"},{token:"constant.numeric.line-number.find-in-files - match",foreground:"ae81ffa0"},{token:"entity.name.filename.find-in-files",foreground:"e6db74"}],colors:{"editor.foreground":"#F8F8F2","editor.background":"#272822","editor.selectionBackground":"#49483E","editor.lineHighlightBackground":"#3E3D32","editorCursor.foreground":"#F8F8F0","editorWhitespace.foreground":"#3B3A32","editorIndentGuide.activeBackground":"#9D550FB0","editor.selectionHighlightBorder":"#222218"}}),k.Fd.editor.defineTheme("light",{base:"vs",inherit:!0,rules:[{token:"",background:"FFFFFF"},{token:"comment",foreground:"919191"},{token:"string",foreground:"00a33f"},{token:"constant.language",foreground:"a535ae"},{token:"keyword",foreground:"ff5600"},{token:"storage",foreground:"ff5600"},{token:"entity.name.type",foreground:"21439c"},{token:"entity.name.function",foreground:"21439c"},{token:"support.function",foreground:"a535ae"},{token:"support.constant",foreground:"a535ae"},{token:"support.type",foreground:"a535ae"},{token:"support.class",foreground:"a535ae"},{token:"support.variable",foreground:"a535ae"},{token:"invalid",foreground:"ffffff",background:"990000"},{token:"constant.other.placeholder.py",foreground:"990000"}],colors:{"editor.foreground":"#000000","editor.background":"#F9F9F9","editor.selectionBackground":"#BAD6FD","editor.lineHighlightBackground":"#00000012","editorCursor.foreground":"#000000","editorWhitespace.foreground":"#BFBFBF"}}),lt.add("laya/index.d.ts",ut,!0),at("laya/index.d.ts",ut,"typescript",!0),lt.add("riko/index.d.ts",ct,!0),at("riko/index.d.ts",ct,"typescript",!0),et.setupList.forEach((e=>{const{activationEvents:t,task:r}=e();t.forEach((e=>{et.eventTasks[e].push(r)}))})),function(){pt(this,null,(function*(){const[e,t,n]=yield Promise.all([r.e(115).then(r.t.bind(r,66575,23)),r.e(115).then(r.t.bind(r,54039,23)),r.e(115).then(r.t.bind(r,40139,23))]);k.Fd.languages.registerDocumentFormattingEditProvider("javascript",{provideDocumentFormattingEdits(r){return pt(this,null,(function*(){const n=e.format(r.getValue(),{parser:"babel",plugins:[t],singleQuote:!0});return[{range:r.getFullModelRange(),text:n}]}))}}),k.Fd.languages.registerDocumentFormattingEditProvider("typescript",{provideDocumentFormattingEdits(t){return pt(this,null,(function*(){const r=e.format(t.getValue(),{parser:"typescript",plugins:[n],singleQuote:!0});return[{range:t.getFullModelRange(),text:r}]}))}})}))}();var Mr=r(55309),zr=r(43686),Hr=r(80226),Ar=r(56385),Ur=r(48816),Br=r(40985),Vr=r.p+"2bcfa7f6148e78fa643bea1bf4111921.svg",$r=r(66445),_r=r(50509),Wr=r(78296),Jr=r(78722),Kr=Object.defineProperty,Yr=Object.defineProperties,Gr=Object.getOwnPropertyDescriptors,qr=Object.getOwnPropertySymbols,Qr=Object.prototype.hasOwnProperty,Xr=Object.prototype.propertyIsEnumerable,en=(e,t,r)=>t in e?Kr(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,tn=(e,t)=>{for(var r in t||(t={}))Qr.call(t,r)&&en(e,r,t[r]);if(qr)for(var r of qr(t))Xr.call(t,r)&&en(e,r,t[r]);return e};var rn=r(98466),nn=r(2961),on=Object.defineProperty,an=Object.defineProperties,sn=Object.getOwnPropertyDescriptors,ln=Object.getOwnPropertySymbols,cn=Object.prototype.hasOwnProperty,un=Object.prototype.propertyIsEnumerable,dn=(e,t,r)=>t in e?on(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;const pn={showModal:()=>{throw new Error("Empty Function")}},mn=()=>{var e;const[t,r]=(0,o.useState)(!1),[n,a]=(0,o.useState)(!1),i=(0,o.useRef)(),s=(0,o.useRef)(),l=(0,o.useRef)(null);pn.showModal=(e,t)=>{var n,o;e?(s.current=null!=(o=null==(n=st(e.name))?void 0:n.getValue())?o:"",i.current=e,r(!0),l.current=null!=t?t:null):be.ZP.error("脚本不存在")};const[c]=nn.Z.useForm();return o.createElement(je.Z,{title:`${null==(e=i.current)?void 0:e.name} 标签`,open:t,width:500,okText:"创建",cancelText:"取消",destroyOnClose:!0,confirmLoading:n,onOk:()=>{c.submit()},onCancel:()=>{r(!1)}},o.createElement(nn.Z,{labelCol:{span:5},wrapperCol:{span:17},form:c,preserve:!1,onFinish:e=>{return void 0,null,t=function*(){var t,n,o;if(i.current){a(!0);try{yield function(e){return rn.dJ.post("scene/createScriptTag",e)}((n=((e,t)=>{for(var r in t||(t={}))cn.call(t,r)&&dn(e,r,t[r]);if(ln)for(var r of ln(t))un.call(t,r)&&dn(e,r,t[r]);return e})({},e),o={projectId:i.current.projectId,sceneId:i.current.id,jscode:s.current},an(n,sn(o)))),null==(t=l.current)||t.call(l),be.ZP.success("标签创建成功"),r(!1)}catch(e){be.ZP.error(e.message?e.message:"标签创建失败")}finally{a(!1)}}},new Promise(((e,r)=>{var n=e=>{try{a(t.next(e))}catch(e){r(e)}},o=e=>{try{a(t.throw(e))}catch(e){r(e)}},a=t=>t.done?e(t.value):Promise.resolve(t.value).then(n,o);a((t=t.apply(undefined,null)).next())}));var t}},o.createElement(nn.Z.Item,{label:"标签名称",name:"tagName",rules:[{required:!0,whitespace:!0,message:"请输入标签名称"},{max:20,message:"标签名称不可超过20个字"}]},o.createElement(Wt.Z,{type:"string",placeholder:"请输入标签名称"})),o.createElement(nn.Z.Item,{label:"标签描述",name:"desc",initialValue:""},o.createElement(Wt.Z.TextArea,{placeholder:"请输入标签描述"}))))};var fn=r(41258),gn=r(22142);const bn=({data:e,onSelect:t,selectedTag:r})=>{const[n,a]=(0,o.useState)(!1);return gn.createElement("div",{style:{cursor:"pointer",margin:"5px",padding:"0 4px",background:(null==r?void 0:r._id)===e._id?"#404238":n?"gray":"unset",color:(null==r?void 0:r._id)===e._id?"#8496fb":"white"},onClick:t,onMouseOver:()=>{a(!0)},onMouseLeave:()=>{a(!1)}},gn.createElement("span",{style:{display:"inline-block",width:"80px"}},(e=>{const t=e.getUTCMonth()+1,r=e.getUTCDate();return e.getUTCFullYear()+"-"+t+"-"+r})(new Date(e.createAt))),gn.createElement(Jt.Z,{title:e.desc,color:"#2db7f5",mouseEnterDelay:1},gn.createElement("span",{style:{marginLeft:"10px"}},e.tagName)))};var vn=({createDiffEditor:e})=>{const{dispatch:t}=(0,a.oR)(),[r,n]=(0,o.useState)(),{selectedTag:i,projectId:s,currentTab:l,currentData:c}=(0,a.v9)((e=>{const{workspace:t,tabs:r}=e.ide;return{selectedTag:t.selectedTag,projectId:t.projectId,currentTab:t.currentTab,currentData:t.resourceNav.map((e=>r[e])).find((e=>e.id===t.currentTab))}}),a.wU),u=(0,o.useCallback)((()=>{s&&l?function(e,t){return rn.dJ.get(`scene/getScriptTags?projectId=${e}&sceneId=${t}`)}(s,l).then((({data:e})=>{n(e.data.reverse())})):n([])}),[s,l]);(0,o.useEffect)(u,[u]);const d=gn.createElement(gn.Fragment,null,gn.createElement("span",{style:{marginRight:"5px"}},"标签"),gn.createElement(Kt.Z,{style:{color:"white"},type:"text",size:"small",icon:gn.createElement(ir.Z,{component:fn.Z}),onClick:e=>{e.stopPropagation(),pn.showModal(c,u)}}));return gn.createElement(gn.Fragment,null,gn.createElement("div",{style:{color:"white"}},gn.createElement(Yt.Z,{bordered:!1,className:kr.collapse},gn.createElement(Yt.Z.Panel,{header:d,key:"1"},gn.createElement("div",{className:kr.listContainer},null==r?void 0:r.map(((r,n)=>gn.createElement(bn,{data:r,key:n,selectedTag:i,onSelect:()=>{(r=>{var n;const o=st(null!=(n=null==c?void 0:c.name)?n:""),a=at(r.tagName,r.jscode,"typescript");t(q(r)),o&&a&&e(o,a)})(r)}}))))))),gn.createElement(mn,null))},yn=r(22142);const hn={item:(0,Tt.iv)({position:"relative",padding:"8px 16px",color:"#fff",fontSize:"14px",lineHeight:"20px",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",cursor:"pointer","&:hover":{backgroundColor:"#272822"}}),itemActive:(0,Tt.iv)({backgroundColor:"#404238!important",color:"#8496fb"}),itemIcon:(0,Tt.iv)({marginRight:"4px",lineHeight:"11px",verticalAlign:"sub",fontSize:"18px"}),itemInput:(0,Tt.iv)({padding:"0 4px",width:"160px",backgroundColor:"#53546d !important",borderRadius:0,color:"#fff"}),tipsDot:(0,Tt.iv)({position:"absolute",top:"50%",right:"16px",marginTop:"-3px",width:"6px",height:"6px",borderRadius:"50%",backgroundColor:"rgba(206, 17, 38, 0.5)"}),tipsModify:(0,Tt.iv)({position:"absolute",top:"8px",right:"16px",fontSize:"12px",lineHeight:"20px",color:"#fdf8c8"}),tipsReadOnly:(0,Tt.iv)({position:"absolute",top:"8px",right:"16px",fontSize:"12px",color:"#777"}),contextMenu:(0,Tt.iv)({"& .ant-dropdown-menu":{paddingTop:"2px",paddingBottom:"2px",backgroundColor:"#333",borderRadius:0,border:"1px solid #555",width:"120px",boxShadow:"0 0 6px 6px rgb(0 0 0 / 10%)"},"& .ant-dropdown-menu-item":{padding:"2px 12px",color:"#fff",fontSize:"12px"},"& .ant-dropdown-menu-item-active":{backgroundColor:"#3955f6"}}),container:e=>(0,Tt.iv)({height:"100%",display:e?"flex":"none",flexDirection:"column",justifyContent:"space-between"}),list:(0,Tt.iv)({flex:1,overflowY:"scroll","::-webkit-scrollbar":{display:"none"}})};function wn({data:e}){const{currentTab:t,readOnly:r}=(0,a.v9)((e=>({currentTab:e.ide.workspace.currentTab,readOnly:e.ide.workspace.readOnly})),a.wU),n=(0,a.I0)(),i=function(){const{dispatch:e,getState:t}=(0,a.oR)(),{postMessage:r}=Ze();return(0,x.Z)(((n,o)=>{const{name:a}=n,i=t().ide.tabs;return o===a?Promise.resolve():r("renameCustomScript",{id:n.id,name:o}).then((()=>{const{id:t}=n,r=st(a);if(r){const e=r.getModeId();at(o,r.getValue(),e),lt.add(o,r.getValue()),setTimeout((()=>{lt.remove(a),r&&r.dispose()}),300)}var s,l;e(K({[t]:(s=tn({},i[t]),l={name:o},Yr(s,Gr(l)))}))})).catch((e=>{be.ZP.error(e.message)}))}))}(),s=function(){const{dispatch:e,getState:t}=(0,a.oR)(),{postMessage:r}=Ze();return(0,x.Z)((n=>r("deleteCustomScript",{id:n.id,orderId:n.orderId}).then((()=>{const{resourceNav:r,currentTab:o}=t().ide.workspace,a=r.findIndex((e=>e===n.id)),i=[...r];i.splice(a,1);const s={resourceNav:i};var l;o===n.id&&(a===r.length-1?s.currentTab=r[r.length-2]:s.currentTab=r[a+1]),e(ae(s)),e((l=n.id,{type:_,tabId:l})),(0,_t.sd)(n.id),setTimeout((()=>{const e=st(n.name);e&&e.dispose(),lt.remove(n.name)}),300)})).catch((e=>{be.ZP.error(e.message)}))))}(),[l,c]=(0,o.useState)(!1),[u,d]=(0,o.useState)(e.name.split(".")[0]),[p,m]=(0,o.useState)(!1),f=(0,o.useRef)(null),g=(0,o.useMemo)((()=>e.name.split(".").pop()),[e.name]),b=(0,o.useMemo)((()=>yn.createElement(_r.Z,null,yn.createElement(_r.Z.Item,{key:"rename",onClick:()=>{c(!0),setTimeout((()=>{var e;return null==(e=f.current)?void 0:e.focus()}),200)}},"重命名"),yn.createElement(_r.Z.Item,{key:"delete",onClick:()=>{je.Z.confirm({content:`确认删除${e.name}吗`,centered:!0,onOk:()=>{s(e)}})}},"删除"))),[e,s]);(0,o.useEffect)((()=>{e.needsSave&&!p&&m(!0)}),[e.needsSave,p]);const v=yn.createElement("div",{key:e.id,className:(0,Br.xG)({[hn.item]:1,[hn.itemActive]:e.id===t}),onClick:()=>n(Y(e.id)),onDoubleClick:()=>{c(!0),setTimeout((()=>{var e;return null==(e=f.current)?void 0:e.focus()}),100)}},yn.createElement(Jr.Z,{className:hn.itemIcon,theme:"outline"}),l?yn.createElement(Wt.Z,{className:hn.itemInput,value:u,ref:f,bordered:!1,onClick:e=>e.stopPropagation(),onChange:e=>{const t=e.currentTarget.value;d(t)},onBlur:()=>{i(e,`${u}.${g}`).then((()=>c(!1))).catch((e=>{be.ZP.error(e.message)}))}}):e.name,e.id===t&&r&&yn.createElement("div",{className:hn.tipsReadOnly},"只读"),e.needsSave?yn.createElement("div",{className:hn.tipsDot}):p?yn.createElement("div",{className:hn.tipsModify},"M"):null);return r?v:yn.createElement(Wr.Z,{overlayClassName:hn.contextMenu,overlay:b,trigger:["contextMenu"],placement:"bottomLeft"},v)}function kn({data:e,visible:t}){const{createDiffEditor:r}=(()=>{const e=(0,o.useRef)(null);return{createDiffEditor:(t,r)=>{e.current||(e.current=k.Fd.editor.createDiffEditor(document.getElementById("diffContainer"),{readOnly:!0})),e.current.setModel({original:t,modified:r})}}})(),n=(0,a.v9)((e=>e.ide.workspace.currentTab),a.wU);return(0,o.useEffect)((()=>{var t,r,o,a;document.title=null!=(a=null!=(o=null==(t=e.find((e=>e.id===n)))?void 0:t.name)?o:null==(r=e[0])?void 0:r.name)?a:"脚本编辑器"}),[n,e]),yn.createElement("div",{className:hn.container(t)},yn.createElement("div",{className:hn.list},e.map((e=>yn.createElement(wn,{key:e.id,data:e})))),yn.createElement(vn,{createDiffEditor:r}),yn.createElement(Or,{createDiffEditor:r}))}var xn=r(74856);const En={inputWrapper:(0,Tt.iv)({padding:"8px"}),input:(0,Tt.iv)({width:"100%",backgroundColor:"#3e3e3e !important",borderRadius:0,borderColor:"transparent",fontSize:"14px",color:"#ccc"}),resultList:(0,Tt.iv)({color:"#fff","& .ant-tree":{background:"none !important",color:"#ddd"},"& .ant-tree-list":{"& .ant-tree-treenode":{width:"100% !important",userSelect:"none","&:hover":{backgroundColor:"#404238"}}},"& .ant-tree-treenode-motion":{width:"100% !important",overflow:"hidden !important"},"& .ant-tree-node-content-wrapper":{width:"100%",overflow:"hidden !important","&:hover":{backgroundColor:"transparent"}},"& .ant-tree-indent-unit":{width:"0"},"& .ant-tree-title":{display:"block",fontSize:"14px",overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis"}}),count:(0,Tt.iv)({padding:"4px 8px",color:"#ccc",fontSize:"12px"})};function Sn({visible:e}){const t=(0,a.I0)(),{resourceNav:r}=(0,a.v9)((e=>{const{workspace:t,tabs:r}=e.ide;return{resourceNav:t.resourceNav.map((e=>r[e]))}}),a.wU),[n,i]=(0,o.useState)([]),[s,l]=(0,o.useState)([]),[c,u]=(0,o.useState)(""),[d,p]=(0,o.useState)(0),{run:m}=(0,E.Z)((()=>{if(!e||!c)return;const t=[],n=[];let o=0;for(const e of r)n.push(qe(e).then((()=>{const r=st(e.name);if(r){const n=r.findMatches(c,!1,!1,!1,null,!0);if(n.length){t.push({key:e.id,title:e.name,children:[]});for(const a of n){o++;const n=t[t.length-1].children;if(n){const t=a.range,o=r.getLineContent(t.startLineNumber),i=t.startColumn<28?1:t.startColumn-28;n.push({key:String(e.id)+"-"+JSON.stringify(t),title:window.filterXSS(o.slice(i-1,t.startColumn-1)+'<span style="background-color: rgba(224,96,40,0.44)">'+o.slice(t.startColumn-1,t.endColumn-1)+"</span>"+o.slice(t.endColumn-1),{onIgnoreTagAttr(e,t,r){if(e&&["style","class"].indexOf(t)>-1)return`${t}="${r}"`}})})}}}}})));Promise.all(n).then((()=>{i(t),p(o),l(t.map((e=>e.key)))}))})),f=(0,x.Z)((e=>{const t=e.currentTarget.value;u(t),m()}));return o.createElement("div",{style:{display:e?"block":"none"}},o.createElement("div",{className:En.inputWrapper},o.createElement(Wt.Z,{className:En.input,value:c,placeholder:"搜索",onChange:f})),c&&o.createElement("div",{className:En.count},n.length,"文件中有",d,"个结果"),o.createElement("div",{className:En.resultList},o.createElement(xn.Z,{showIcon:!0,expandedKeys:s,selectedKeys:[],selectable:!0,treeData:n,titleRender:e=>o.createElement("span",{dangerouslySetInnerHTML:{__html:e.title}}),onSelect:e=>{const r=e[0];if((0,ye.isNumber)(r)&&l((e=>{const t=(e=[...e]).indexOf(r);return t>=0?e.splice(t,1):e.push(r),e})),(0,ye.isString)(r)){const e=r.split("-");t(Y(Number(e[0]),JSON.parse(e[1])))}}})))}var On=r(3207),Cn=r(7910),In=r(22142);const jn={sider:(0,Tt.iv)({backgroundColor:"#1e1f1c",overflow:"auto","& .ant-layout-sider-children":{display:"flex",flexDirection:"column"},"::-webkit-scrollbar":{display:"none"}}),header:(0,Tt.iv)({display:"flex",alignItems:"center",padding:"12px 12px 12px 16px",backgroundColor:"black",zIndex:1}),headerTitle:(0,Tt.iv)({paddingLeft:"8px",color:"#fff",verticalAlign:"middle",fontWeight:"bold"}),main:(0,Tt.iv)({position:"relative",flex:1,height:0}),mainCon:(0,Tt.iv)({position:"absolute",top:0,right:0,left:0,bottom:0,display:"flex"}),mainLeft:(0,Tt.iv)({flex:"0 0 50px",backgroundColor:"black"}),mainRight:(0,Tt.iv)({flex:1,width:0,overflowX:"hidden",overflowY:"auto","&::-webkit-scrollbar-thumb":{backgroundColor:"#555",borderRadius:"2px"},"&::-webkit-scrollbar":{width:"4px"}}),navItem:(0,Tt.iv)({display:"flex",alignItems:"center",justifyContent:"center",height:"50px",cursor:"pointer",color:"#929292","&:hover":{color:"#fff"}}),navItemActive:(0,Tt.iv)({position:"relative",color:"#fff"}),footer:(0,Tt.iv)({height:"50px",borderTop:"1px solid #333",backgroundColor:"#111",lineHeight:"50px",textAlign:"center",color:"#fff",cursor:"pointer","&:hover":{backgroundColor:"#3955f6"}}),settingWrapper:(0,Tt.iv)({"& .editor-property-grid-wrapper":{marginLeft:"6px",marginRight:"6px"},"& .editor-property .ant-collapse .ant-collapse-item .ant-collapse-header":{paddingTop:"12px",color:"#fff"},"& .editor-property .ant-collapse .ant-collapse-item":{borderTop:0}})};function Pn(){const{setting:e,resourceNav:t,projectId:r,readOnly:n}=(0,a.v9)((e=>{const{setting:t,workspace:r,tabs:n}=e.ide;return{setting:t,projectId:r.projectId,readOnly:r.readOnly,resourceNav:r.resourceNav.map((e=>n[e]))}}),a.wU),i=(0,a.I0)(),[s,l]=(0,o.useState)(!1),[c,u]=(0,o.useState)("files"),d=function(){const{dispatch:e,getState:t}=(0,a.oR)(),{postMessage:r}=Ze();return(0,x.Z)(((n,o)=>{const{projectId:a,resourceNav:i}=t().ide.workspace,s=n+("typescript"===o?".ts":".js");return a?r("addCustomScript",{name:s,language:o}).then((({id:t,orderId:r})=>{e(K({[t]:{id:t,orderId:r,projectId:a,name:s,needsSave:!1,saveStatus:0}})),e(ae({resourceNav:[t].concat(i),currentTab:t}))})):Promise.reject(new Error("请打开指定工作区"))}))}(),{fontSize:p,theme:m}=e;return In.createElement(w.Z.Sider,{className:jn.sider,style:{filter:"Light"===m?"invert(1) hue-rotate(180deg)":"unset"},width:320,onContextMenu:e=>e.preventDefault()},In.createElement("div",{className:jn.header},In.createElement("img",{src:Vr}),In.createElement("span",{className:jn.headerTitle},"万能互动 IDE")),In.createElement("div",{className:jn.main},In.createElement("div",{className:jn.mainCon},In.createElement("div",{className:jn.mainLeft},In.createElement(Jt.Z,{title:"资源管理器",placement:"right"},In.createElement("div",{className:(0,Br.xG)({[jn.navItem]:1,[jn.navItemActive]:"files"===c}),onClick:()=>u("files")},In.createElement(zr.Z,{theme:"outline",size:"22",style:{lineHeight:"11px"}}))),In.createElement(Jt.Z,{title:"搜索",placement:"right"},In.createElement("div",{className:(0,Br.xG)({[jn.navItem]:1,[jn.navItemActive]:"search"===c}),onClick:()=>u("search")},In.createElement(Hr.Z,{theme:"outline",size:"22",style:{lineHeight:"11px"}}))),In.createElement(Jt.Z,{title:"Api文档",placement:"right"},In.createElement("div",{className:jn.navItem,onClick:()=>window.open((0,Cn.cM)({release:!0})?"https://riko.bytedance.com":["https://riko.","web.","bytedance.","net"].join(""))},In.createElement(Ar.Z,{theme:"outline",size:"22",style:{lineHeight:"11px"}}))),In.createElement(Jt.Z,{title:"设置",placement:"right"},In.createElement("div",{className:(0,Br.xG)({[jn.navItem]:1,[jn.navItemActive]:"setting"===c}),onClick:()=>u("setting")},In.createElement(Ur.Z,{theme:"outline",size:"22",style:{lineHeight:"11px"}})))),In.createElement("div",{className:jn.mainRight},In.createElement(kn,{visible:"files"===c,data:t}),In.createElement(Sn,{visible:"search"===c}),"setting"===c&&In.createElement("div",{className:jn.settingWrapper},(0,On.default)({spark:"grid",content:[{spark:"element",content(e){return e({spark:"select",label:"字号",value:p,options:[{label:"12",value:12},{label:"14",value:14},{label:"16",value:16},{label:"18",value:18}],onChange(e){i(R({fontSize:e}))}})}},{spark:"element",content(e){return e({spark:"select",label:"主题",value:m,options:[{label:"Dark",value:"Dark"},{label:"Light",value:"Light"}],onChange(e){i(R({theme:e}))}})}}]}))))),r&&!n&&In.createElement("div",{className:jn.footer,onClick:()=>{l(!0)}},In.createElement(Mr.Z,{style:{paddingRight:"6px"}}),"新建脚本"),s&&In.createElement($r.I,{onConfirm:(e,t)=>d(e,t).then((()=>{l(!1)})),onCancel:()=>{l(!1)}}))}var Tn=r(22142);const Zn=(0,Tt.iv)({height:"100%",minWidth:1080,overflowY:"hidden"}),Nn=(0,Tt.iv)({position:"absolute",top:"0",left:"0",width:"100%",height:"100%"});function Dn(){!function(){const{orderId:e,projectId:t}=He(),r=(0,a.I0)(),n=(0,o.useRef)(null),i=(0,a.v9)((e=>e.ide.tabs)),{postMessage:s}=Ze();(0,o.useEffect)((()=>{t?(0,ve.GG)(t).then((e=>Ie(e.scenes.filter((e=>{const t=JSON.parse(e.sceneContent);return"CustomScript"===t.type&&1!==t.status})).map((e=>{const{projectId:t,id:r,orderId:n,name:o,sceneContent:a}=e;return i=((e,t)=>{for(var r in t||(t={}))Fe.call(t,r)&&ze(e,r,t[r]);if(Re)for(var r of Re(t))Me.call(t,r)&&ze(e,r,t[r]);return e})({},JSON.parse(a)),De(i,Le({id:r,orderId:n,projectId:t,name:o}));var i}))))).then((e=>{const n=e.sort((()=>-1)).map((e=>e.id)),o=e.reduce(((e,t)=>{const{id:r,name:n,projectId:o,orderId:a,language:i}=t;return e[r]={id:r,orderId:a,projectId:o,name:n,resourceLanguage:i,needsSave:!1,saveStatus:0},e}),{});return r(K(o)),r(ae({projectId:t,resourceNav:n})),s("initial",{})})).then((({readOnly:e})=>{r(ae({readOnly:e}))})).catch((e=>{be.ZP.error("Ide初始化出错："+e.message)})):be.ZP.error("请从编辑器项目打开工作区")}),[t,r,s]),(0,o.useEffect)((()=>{if(Number(e)!==n.current&&Object.keys(i).length>0){n.current=Number(e);const t=Object.values(i).find((t=>t.orderId===Number(e)));t&&r(Y(t.id))}}),[e,i,r])}();const{selectedHistoryId:e,selectedTag:t}=(0,a.v9)((e=>({selectedHistoryId:e.ide.workspace.selectedHistoryId,selectedTag:e.ide.workspace.selectedTag})),a.wU);return Tn.createElement(w.Z,{className:Zn},Tn.createElement(Pn,null),Tn.createElement(w.Z,{style:{position:"relative",backgroundColor:"#272822"}},Tn.createElement("div",{id:"diffContainer",className:Nn,style:{visibility:null===e&&null===t?"hidden":"unset"}},Tn.createElement(Sr,null)),Tn.createElement("div",{className:Nn,style:{visibility:null!==e||null!==t?"hidden":"unset"}},Tn.createElement(Fr,null))))}n.render(o.createElement(a.zt,{store:Ct},o.createElement(Dn,null)),document.getElementById("root"));for(const e of["keydown","keyup","keypress"])document.addEventListener(e,(e=>{(e.ctrlKey||e.metaKey)&&"s"===e.key&&e.preventDefault()}))},23313:function(){}},function(e){var t=function(t){return e(e.s=t)};e.O(0,[183,716,981,100,97],(function(){return t(75917),t(31765)})),e.O()}]);